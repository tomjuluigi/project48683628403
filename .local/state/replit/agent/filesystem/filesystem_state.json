{"file_contents":{"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"server/activity-tracker.ts":{"content":"import { createPublicClient, createWalletClient, http, parseEther, type Address } from \"viem\";\nimport { base } from \"viem/chains\";\nimport { privateKeyToAccount } from \"viem/accounts\";\n\n// Activity Tracker Contract ABI\nconst ACTIVITY_TRACKER_ABI = [\n  {\n    name: \"recordFees\",\n    type: \"function\",\n    stateMutability: \"nonpayable\",\n    inputs: [\n      { name: \"coin\", type: \"address\" },\n      { name: \"trader\", type: \"address\" },\n      { name: \"creatorFee\", type: \"uint256\" },\n      { name: \"platformFee\", type: \"uint256\" }\n    ],\n    outputs: []\n  },\n  {\n    name: \"updateMarketCap\",\n    type: \"function\",\n    stateMutability: \"nonpayable\",\n    inputs: [\n      { name: \"coin\", type: \"address\" },\n      { name: \"marketCap\", type: \"uint256\" }\n    ],\n    outputs: []\n  },\n  {\n    name: \"recordTradingActivity\",\n    type: \"function\",\n    stateMutability: \"nonpayable\",\n    inputs: [\n      { name: \"coin\", type: \"address\" },\n      { name: \"trader\", type: \"address\" },\n      { name: \"activityType\", type: \"string\" },\n      { name: \"amount\", type: \"uint256\" }\n    ],\n    outputs: []\n  },\n  {\n    name: \"getCoinMetrics\",\n    type: \"function\",\n    stateMutability: \"view\",\n    inputs: [\n      { name: \"coin\", type: \"address\" }\n    ],\n    outputs: [\n      { name: \"totalCreatorFees\", type: \"uint256\" },\n      { name: \"totalPlatformFees\", type: \"uint256\" },\n      { name: \"currentMarketCap\", type: \"uint256\" },\n      { name: \"totalVolume\", type: \"uint256\" },\n      { name: \"tradeCount\", type: \"uint256\" },\n      { name: \"lastUpdated\", type: \"uint256\" }\n    ]\n  },\n  {\n    name: \"getPlatformStats\",\n    type: \"function\",\n    stateMutability: \"view\",\n    inputs: [],\n    outputs: [\n      { name: \"totalCoins\", type: \"uint256\" },\n      { name: \"totalPlatformFees\", type: \"uint256\" },\n      { name: \"totalCreatorFees\", type: \"uint256\" },\n      { name: \"totalVolume\", type: \"uint256\" },\n      { name: \"totalCreators\", type: \"uint256\" }\n    ]\n  },\n  {\n    name: \"getCreatorStats\",\n    type: \"function\",\n    stateMutability: \"view\",\n    inputs: [\n      { name: \"creator\", type: \"address\" }\n    ],\n    outputs: [\n      { name: \"coinsCreated\", type: \"uint256\" },\n      { name: \"totalFeesEarned\", type: \"uint256\" }\n    ]\n  },\n  {\n    name: \"recordCoinCreation\",\n    type: \"function\",\n    stateMutability: \"nonpayable\",\n    inputs: [\n      { name: \"coin\", type: \"address\" },\n      { name: \"creator\", type: \"address\" },\n      { name: \"contentUrl\", type: \"string\" },\n      { name: \"name\", type: \"string\" },\n      { name: \"symbol\", type: \"string\" }\n    ],\n    outputs: []\n  },\n  {\n    name: \"CoinCreated\",\n    type: \"event\",\n    inputs: [\n      { name: \"coin\", type: \"address\", indexed: true },\n      { name: \"creator\", type: \"address\", indexed: true },\n      { name: \"contentUrl\", type: \"string\", indexed: false },\n      { name: \"name\", type: \"string\", indexed: false },\n      { name: \"symbol\", type: \"string\", indexed: false },\n      { name: \"timestamp\", type: \"uint256\", indexed: false },\n      { name: \"activityId\", type: \"uint256\", indexed: false }\n    ]\n  },\n  {\n    name: \"ActivityRecorded\",\n    type: \"event\",\n    inputs: [\n      { name: \"coin\", type: \"address\", indexed: true },\n      { name: \"creator\", type: \"address\", indexed: true },\n      { name: \"activityId\", type: \"uint256\", indexed: false },\n      { name: \"timestamp\", type: \"uint256\", indexed: false }\n    ]\n  },\n] as const;\n\nexport class ActivityTrackerService {\n  private activityTrackerAddress: Address | undefined;\n  private publicClient: any;\n  private walletClient: any;\n  private account: any;\n\n  constructor() {\n    this.activityTrackerAddress = process.env.VITE_ACTIVITY_TRACKER_ADDRESS as Address | undefined;\n\n    if (!this.activityTrackerAddress) {\n      console.warn(\"‚ö†Ô∏è Activity tracker not configured - on-chain fee tracking disabled\");\n      return;\n    }\n\n    // Setup clients\n    const alchemyApiKey = process.env.VITE_ALCHEMY_API_KEY || \"o3VW3WRXrsXXMRX3l7jZxLUqhWyZzXBy\";\n    const rpcUrl = `https://base-mainnet.g.alchemy.com/v2/${alchemyApiKey}`;\n\n    this.publicClient = createPublicClient({\n      chain: base,\n      transport: http(rpcUrl),\n    });\n\n    // Setup wallet client if private key is available\n    const privateKey = process.env.DEPLOYER_PRIVATE_KEY || process.env.PLATFORM_PRIVATE_KEY;\n    if (privateKey) {\n      this.account = privateKeyToAccount(privateKey as `0x${string}`);\n      this.walletClient = createWalletClient({\n        account: this.account,\n        chain: base,\n        transport: http(rpcUrl),\n      });\n      console.log(\"‚úÖ Activity Tracker service initialized with wallet:\", this.account.address);\n    } else {\n      console.warn(\"‚ö†Ô∏è No private key configured - on-chain recording will be disabled\");\n    }\n  }\n\n  async recordFees(\n    coinAddress: Address,\n    traderAddress: Address,\n    creatorFee: bigint,\n    platformFee: bigint\n  ): Promise<string | null> {\n    if (!this.activityTrackerAddress || !this.walletClient) {\n      console.warn(\"Activity tracker not configured, skipping on-chain fee recording\");\n      return null;\n    }\n\n    try {\n      console.log(\"üìä Recording fees on-chain:\", {\n        coin: coinAddress,\n        trader: traderAddress,\n        creatorFee: creatorFee.toString(),\n        platformFee: platformFee.toString()\n      });\n\n      const hash = await this.walletClient.writeContract({\n        address: this.activityTrackerAddress,\n        abi: ACTIVITY_TRACKER_ABI,\n        functionName: \"recordFees\",\n        args: [coinAddress, traderAddress, creatorFee, platformFee],\n      });\n\n      console.log(\"‚úÖ Fees recorded on-chain! TX:\", hash);\n      return hash;\n    } catch (error) {\n      console.error(\"‚ùå Failed to record fees on-chain:\", error);\n      return null;\n    }\n  }\n\n  async updateMarketCap(\n    coinAddress: Address,\n    marketCap: bigint\n  ): Promise<string | null> {\n    if (!this.activityTrackerAddress || !this.walletClient) {\n      console.warn(\"Activity tracker not configured, skipping market cap update\");\n      return null;\n    }\n\n    try {\n      console.log(\"üí∞ Updating market cap on-chain:\", {\n        coin: coinAddress,\n        marketCap: marketCap.toString()\n      });\n\n      const hash = await this.walletClient.writeContract({\n        address: this.activityTrackerAddress,\n        abi: ACTIVITY_TRACKER_ABI,\n        functionName: \"updateMarketCap\",\n        args: [coinAddress, marketCap],\n      });\n\n      console.log(\"‚úÖ Market cap updated on-chain! TX:\", hash);\n      return hash;\n    } catch (error) {\n      console.error(\"‚ùå Failed to update market cap on-chain:\", error);\n      return null;\n    }\n  }\n\n  async recordTradingActivity(\n    coinAddress: Address,\n    traderAddress: Address,\n    activityType: string,\n    amount: bigint\n  ): Promise<string | null> {\n    if (!this.activityTrackerAddress || !this.walletClient) {\n      console.warn(\"Activity tracker not configured, skipping trading activity\");\n      return null;\n    }\n\n    try {\n      const hash = await this.walletClient.writeContract({\n        address: this.activityTrackerAddress,\n        abi: ACTIVITY_TRACKER_ABI,\n        functionName: \"recordTradingActivity\",\n        args: [coinAddress, traderAddress, activityType, amount],\n      });\n\n      console.log(\"‚úÖ Trading activity recorded on-chain! TX:\", hash);\n      return hash;\n    } catch (error) {\n      console.error(\"‚ùå Failed to record trading activity on-chain:\", error);\n      return null;\n    }\n  }\n\n  async getCoinMetrics(coinAddress: Address) {\n    if (!this.activityTrackerAddress || !this.publicClient) {\n      return null;\n    }\n\n    try {\n      const result = await this.publicClient.readContract({\n        address: this.activityTrackerAddress,\n        abi: ACTIVITY_TRACKER_ABI,\n        functionName: \"getCoinMetrics\",\n        args: [coinAddress],\n      }) as [bigint, bigint, bigint, bigint, bigint, bigint];\n\n      return {\n        totalCreatorFees: result[0],\n        totalPlatformFees: result[1],\n        currentMarketCap: result[2],\n        totalVolume: result[3],\n        tradeCount: result[4],\n        lastUpdated: result[5]\n      };\n    } catch (error) {\n      console.error(\"‚ùå Failed to get coin metrics:\", error);\n      return null;\n    }\n  }\n\n  async getPlatformStats() {\n    if (!this.activityTrackerAddress || !this.publicClient) {\n      return null;\n    }\n\n    try {\n      const result = await this.publicClient.readContract({\n        address: this.activityTrackerAddress,\n        abi: ACTIVITY_TRACKER_ABI,\n        functionName: \"getPlatformStats\",\n        args: [],\n      }) as [bigint, bigint, bigint, bigint, bigint];\n\n      return {\n        totalCoins: result[0],\n        totalPlatformFees: result[1],\n        totalCreatorFees: result[2],\n        totalVolume: result[3],\n        totalCreators: result[4]\n      };\n    } catch (error) {\n      console.error(\"‚ùå Failed to get platform stats:\", error);\n      return null;\n    }\n  }\n\n  async getCreatorStats(creatorAddress: Address) {\n    if (!this.activityTrackerAddress || !this.publicClient) {\n      return null;\n    }\n\n    try {\n      const result = await this.publicClient.readContract({\n        address: this.activityTrackerAddress,\n        abi: ACTIVITY_TRACKER_ABI,\n        functionName: \"getCreatorStats\",\n        args: [creatorAddress],\n      }) as [bigint, bigint];\n\n      return {\n        coinsCreated: result[0],\n        totalFeesEarned: result[1]\n      };\n    } catch (error) {\n      console.error(\"‚ùå Failed to get creator stats:\", error);\n      return null;\n    }\n  }\n\n  async recordCoinCreation(\n    coinAddress: Address,\n    creatorAddress: Address,\n    contentUrl: string,\n    name: string,\n    symbol: string\n  ): Promise<string | null> {\n    if (!this.activityTrackerAddress || !this.walletClient) {\n      console.warn(\"Activity tracker not configured, skipping on-chain recording\");\n      return null;\n    }\n\n    try {\n      console.log(\"üìä Recording coin creation on-chain:\", {\n        coin: coinAddress,\n        creator: creatorAddress,\n        name,\n        symbol,\n        contentUrl\n      });\n\n      const hash = await this.walletClient.writeContract({\n        address: this.activityTrackerAddress,\n        abi: ACTIVITY_TRACKER_ABI,\n        functionName: \"recordCoinCreation\",\n        args: [coinAddress, creatorAddress, contentUrl, name, symbol],\n      });\n\n      console.log(\"‚úÖ Coin creation recorded on-chain! TX:\", hash);\n\n      // Wait for transaction receipt to confirm\n      const receipt = await this.publicClient.waitForTransactionReceipt({ \n        hash,\n        confirmations: 1\n      });\n\n      console.log(\"‚úÖ Transaction confirmed! Block:\", receipt.blockNumber);\n\n      // Get the activity ID from the event logs\n      if (receipt.logs && receipt.logs.length > 0) {\n        console.log(\"üìù Event logs:\", receipt.logs.length, \"events emitted\");\n        receipt.logs.forEach((log, index) => {\n          console.log(`Event ${index}:`, {\n            address: log.address,\n            topics: log.topics,\n            data: log.data\n          });\n        });\n      }\n\n      return hash;\n    } catch (error) {\n      console.error(\"‚ùå Failed to record coin creation on-chain:\", error);\n      return null;\n    }\n  }\n\n  async getTotalActivities() {\n    if (!this.activityTrackerAddress || !this.publicClient) {\n      return 0;\n    }\n\n    try {\n      const result = await this.publicClient.readContract({\n        address: this.activityTrackerAddress,\n        abi: ACTIVITY_TRACKER_ABI,\n        functionName: \"getTotalActivities\",\n        args: [],\n      }) as bigint;\n\n      return Number(result);\n    } catch (error) {\n      console.error(\"‚ùå Failed to get total activities:\", error);\n      return 0;\n    }\n  }\n\n  async getActivityEvents(fromBlock: bigint = 0n) {\n    if (!this.activityTrackerAddress || !this.publicClient) {\n      return [];\n    }\n\n    try {\n      const logs = await this.publicClient.getLogs({\n        address: this.activityTrackerAddress,\n        event: {\n          type: 'event',\n          name: 'CoinCreated',\n          inputs: [\n            { name: \"coin\", type: \"address\", indexed: true },\n            { name: \"creator\", type: \"address\", indexed: true },\n            { name: \"contentUrl\", type: \"string\", indexed: false },\n            { name: \"name\", type: \"string\", indexed: false },\n            { name: \"symbol\", type: \"string\", indexed: false },\n            { name: \"timestamp\", type: \"uint256\", indexed: false },\n            { name: \"activityId\", type: \"uint256\", indexed: false }\n          ]\n        },\n        fromBlock,\n        toBlock: 'latest'\n      });\n\n      console.log(`üìä Found ${logs.length} CoinCreated events from block ${fromBlock}`);\n      return logs;\n    } catch (error) {\n      console.error(\"‚ùå Failed to get activity events:\", error);\n      return [];\n    }\n  }\n}\n\nexport const activityTrackerService = new ActivityTrackerService();","size_bytes":12811},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"server/routes/e1xp.ts":{"content":"import { Router } from 'express';\nimport { Storage } from '../storage';\nimport { PrivyClient } from '@privy-io/server-auth';\n\nconst privyAppId = process.env.VITE_PRIVY_APP_ID;\nconst privyAppSecret = process.env.PRIVY_APP_SECRET;\n\nlet privyClient: PrivyClient | null = null;\nif (privyAppId && privyAppSecret) {\n  privyClient = new PrivyClient(privyAppId, privyAppSecret);\n}\n\nexport function createE1XPRouter(storage: Storage) {\n  const router = Router();\n\n  // Middleware to get creator from Privy auth\n  const getAuthenticatedCreator = async (req: any, res: any) => {\n    try {\n      const authHeader = req.headers.authorization;\n\n      if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        console.log('[E1XP Auth] No authorization header found');\n        return null;\n      }\n\n      if (!privyClient) {\n        console.error('[E1XP Auth] Privy client not initialized');\n        return null;\n      }\n\n      const token = authHeader.substring(7);\n      const verifiedClaims = await privyClient.verifyAuthToken(token);\n      const privyId = verifiedClaims.userId;\n\n      if (!privyId) {\n        console.log('[E1XP Auth] No privyId in claims');\n        return null;\n      }\n\n      // Try to get creator by Privy ID\n      let creator = await storage.getCreatorByPrivyId(privyId);\n\n      // If not found, try to sync/create the creator\n      if (!creator) {\n        console.log('[E1XP Auth] Creator not found, attempting to sync');\n        try {\n          // Get user info from Privy to create creator\n          const privyUser = await privyClient.getUser(privyId);\n          const address = privyUser.wallet?.address || null;\n          const email = privyUser.email?.address || null;\n\n          // Import the sync functionality\n          const { syncCreatorProfile } = await import('../routes');\n          creator = await syncCreatorProfile(privyId, address, email);\n        } catch (syncError) {\n          console.error('[E1XP Auth] Failed to sync creator:', syncError);\n          return null;\n        }\n      }\n\n      return creator;\n    } catch (error) {\n      console.error('[E1XP Auth] Failed to authenticate:', error);\n      return null;\n    }\n  };\n\n  // Get E1XP status (points, streak, etc)\n  router.get('/status', async (req, res) => {\n    try {\n      const creator = await getAuthenticatedCreator(req, res);\n      if (!creator) {\n        // Return default status for unauthenticated users\n        return res.json({\n          points: 0,\n          streak: 0,\n          longestStreak: 0,\n          nextClaimAmount: 10,\n          daysUntilBonus: 7,\n          canClaimDaily: false,\n          lastClaimDate: null,\n          authenticated: false\n        });\n      }\n\n      console.log('[E1XP Status] Fetching status for creator:', {\n        id: creator.id,\n        address: creator.address,\n        privyId: creator.privyId,\n        points: creator.points\n      });\n\n      // Use the same user identifier logic as the check-in endpoint\n      // For wallet users: use address\n      // For email users without address: use privyId or id\n      const userId = creator.address && !creator.address.startsWith('email_')\n        ? creator.address\n        : creator.privyId || creator.id;\n\n      console.log('[E1XP Status] Resolved userId:', userId);\n\n      // Get login streak using the consistent userId\n      const loginStreak = await storage.getLoginStreak(userId);\n\n      const points = parseInt(creator.points || '0');\n      const now = new Date();\n      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).toISOString().split('T')[0];\n\n      // User can claim if:\n      // 1. No login streak exists (first time)\n      // 2. Last login date is NOT today (haven't claimed today yet)\n      const canClaimDaily = !loginStreak || loginStreak.lastLoginDate !== today;\n\n      let currentStreak = 0;\n      if (loginStreak) {\n        currentStreak = parseInt(loginStreak.currentStreak || \"0\");\n\n        // If last login was not today, check if streak should reset\n        if (loginStreak.lastLoginDate && loginStreak.lastLoginDate !== today) {\n          const lastLoginDate = new Date(loginStreak.lastLoginDate);\n          const todayDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n          const daysDiff = Math.floor((todayDate.getTime() - lastLoginDate.getTime()) / (1000 * 60 * 60 * 24));\n\n          // If more than 1 day has passed, streak is broken\n          if (daysDiff > 1) {\n            currentStreak = 0;\n          }\n        }\n      }\n\n      const longestStreak = loginStreak ? parseInt(loginStreak.longestStreak || \"0\") : 0;\n\n      console.log('[E1XP Status] Returning:', {\n        points,\n        currentStreak,\n        longestStreak,\n        canClaimDaily,\n        today,\n        lastLoginDate: loginStreak?.lastLoginDate\n      });\n\n      res.json({\n        points,\n        streak: currentStreak,\n        longestStreak: longestStreak,\n        weeklyCalendar: loginStreak?.weeklyCalendar || [false, false, false, false, false, false, false],\n        nextClaimAmount: 10,\n        daysUntilBonus: 7 - (currentStreak % 7),\n        canClaimDaily,\n        lastClaimDate: loginStreak?.lastLoginDate,\n        authenticated: true\n      });\n    } catch (error) {\n      console.error('[E1XP Status] Failed to get E1XP status:', error);\n      // Return default status on error instead of 500\n      res.status(200).json({\n        points: 0,\n        streak: 0,\n        longestStreak: 0,\n        nextClaimAmount: 10,\n        daysUntilBonus: 7,\n        canClaimDaily: false,\n        lastClaimDate: null,\n        authenticated: false,\n        error: 'Failed to fetch status'\n      });\n    }\n  });\n\n  // Claim daily points\n  router.post('/claim-daily', async (req, res) => {\n    try {\n      const creator = await getAuthenticatedCreator(req, res);\n      if (!creator) {\n        return res.status(401).json({ error: 'Unauthorized' });\n      }\n\n      // Use creator.address or creator.privyId or creator.id as userId (must match status endpoint)\n      const userId = creator.address || creator.privyId || creator.id;\n\n      console.log('[E1XP Claim] Attempting to claim daily points for:', {\n        userId,\n        creatorId: creator.id,\n        address: creator.address,\n        privyId: creator.privyId\n      });\n\n      // Use the login streak check-in\n      const result = await storage.checkInStreak(userId);\n\n      console.log('[E1XP Claim] Check-in successful:', {\n        pointsEarned: result.pointsEarned,\n        currentStreak: result.currentStreak\n      });\n\n      // Refresh creator data to get updated points\n      const updatedCreator = await storage.getCreator(creator.id);\n\n      // Send notification\n      try {\n        const { notificationService } = await import('../notification-service');\n        await notificationService.notifyDailyLoginStreak(\n          creator.id,\n          result.currentStreak,\n          result.pointsEarned\n        );\n        console.log(`[E1XP Claim] Sent notification to ${creator.id} for ${result.pointsEarned} points (streak: ${result.currentStreak})`);\n      } catch (notifError) {\n        console.error('[E1XP Claim] Failed to send notification:', notifError);\n        // Continue even if notification fails\n      }\n\n      res.json({ \n        pointsEarned: result.pointsEarned,\n        streak: result.currentStreak,\n        totalPoints: parseInt(updatedCreator?.points || creator.points || '0'),\n        message: 'Daily points claimed successfully!'\n      });\n    } catch (error: any) {\n      console.error('[E1XP Claim] Failed to claim daily points:', error);\n      if (error.message && (error.message.includes('already checked in') || error.message.includes('already claimed'))) {\n        return res.status(400).json({ error: 'Daily points already claimed today' });\n      }\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  });\n\n  // Award points for other actions\n  router.post('/award', async (req, res) => {\n    try {\n      const { creatorId, amount, reason, type } = req.body;\n\n      // Only allow this endpoint for admin users or system actions\n      if (!req.session?.user?.isAdmin) {\n        return res.status(403).json({ error: 'Forbidden' });\n      }\n\n      await storage.awardPoints(creatorId, amount, reason, type);\n      res.json({ success: true });\n    } catch (error) {\n      console.error('Failed to award points:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  });\n\n  // Get notifications\n  router.get('/notifications', async (req, res) => {\n    try {\n      const creator = await getAuthenticatedCreator(req, res);\n      if (!creator) {\n        return res.status(401).json({ error: 'Unauthorized' });\n      }\n\n      const userId = creator.address || creator.id;\n      const notifications = await storage.getUserNotifications(userId);\n      res.json(notifications);\n    } catch (error) {\n      console.error('Failed to get notifications:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  });\n\n  // Mark notification as read\n  router.patch('/notifications/:id/read', async (req, res) => {\n    try {\n      const creator = await getAuthenticatedCreator(req, res);\n      if (!creator) {\n        return res.status(401).json({ error: 'Unauthorized' });\n      }\n\n      await storage.markNotificationAsRead(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error('Failed to mark notification as read:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  });\n\n  // Mark all notifications as read\n  router.patch('/notifications/read-all', async (req, res) => {\n    try {\n      const creator = await getAuthenticatedCreator(req, res);\n      if (!creator) {\n        return res.status(401).json({ error: 'Unauthorized' });\n      }\n\n      const userId = creator.address || creator.id;\n      await storage.markAllNotificationsAsRead(userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error('Failed to mark all notifications as read:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  });\n\n  // Get unclaimed rewards\n  router.get('/rewards/unclaimed', async (req, res) => {\n    try {\n      const creator = await getAuthenticatedCreator(req, res);\n      if (!creator) {\n        return res.json([]);\n      }\n\n      try {\n        const unclaimedRewards = await storage.getUnclaimedE1xpRewardsByUser(creator.address);\n        res.json(unclaimedRewards);\n      } catch (dbError) {\n        console.log('Unable to fetch unclaimed rewards from DB:', dbError);\n        res.json([]);\n      }\n    } catch (error) {\n      console.error('Failed to get unclaimed rewards:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  });\n\n  // Claim reward\n  router.post('/rewards/:rewardId/claim', async (req, res) => {\n    try {\n      const creator = await getAuthenticatedCreator(req, res);\n      if (!creator) {\n        return res.status(401).json({ error: 'Unauthorized' });\n      }\n\n      const { rewardId } = req.params;\n      const reward = await storage.claimE1xpReward(rewardId);\n\n      if (!reward) {\n        return res.status(404).json({ error: 'Reward not found' });\n      }\n\n      // Add points to user\n      await storage.addPoints(reward.userId, parseInt(reward.amount), `Claimed reward: ${reward.title}`);\n\n      // Get updated creator info\n      const updatedCreator = await storage.getCreatorByAddress(reward.userId);\n      const totalPoints = updatedCreator ? parseInt(updatedCreator.points || '0') : 0;\n\n      res.json({\n        reward,\n        totalPoints,\n        message: `Successfully claimed ${reward.amount} E1XP!`\n      });\n    } catch (error) {\n      console.error('Failed to claim reward:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  });\n\n  return router;\n}","size_bytes":11831},"client/src/pages/create.tsx":{"content":"import { useState } from \"react\";\nimport URLInputForm from \"@/components/url-input-form\";\nimport ContentPreview from \"@/components/content-preview\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Upload,\n  Link as LinkIcon,\n  Image,\n  Film,\n  Music,\n  FileText,\n  Loader2,\n  Sparkles,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype TabType = \"import\" | \"upload\";\n\nexport default function Create() {\n  const [showPreview, setShowPreview] = useState(false);\n  const [scrapedData, setScrapedData] = useState<any>(null);\n  const [uploadedFile, setUploadedFile] = useState<File | null>(null);\n  const [uploadPreviewUrl, setUploadPreviewUrl] = useState<string>(\"\");\n  const [uploadTitle, setUploadTitle] = useState(\"\");\n  const [uploadDescription, setUploadDescription] = useState(\"\");\n  const [uploadAuthor, setUploadAuthor] = useState(\"\");\n  const [isUploading, setIsUploading] = useState(false);\n  const [activeTab, setActiveTab] = useState<TabType>(\"import\");\n  const { toast } = useToast();\n\n  const handleScrapedData = (data: any) => {\n    setScrapedData(data);\n    setShowPreview(true);\n  };\n\n  const handleCoinCreated = () => {\n    setShowPreview(false);\n    setScrapedData(null);\n    resetUploadForm();\n  };\n\n  const resetUploadForm = () => {\n    setUploadedFile(null);\n    setUploadPreviewUrl(\"\");\n    setUploadTitle(\"\");\n    setUploadDescription(\"\");\n    setUploadAuthor(\"\");\n  };\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    const maxSize = 100 * 1024 * 1024;\n\n    // Accept all image, video, and audio files (matches backend handling)\n    const isValidType = file.type.startsWith('image/') || \n                        file.type.startsWith('video/') || \n                        file.type.startsWith('audio/');\n\n    if (!isValidType) {\n      toast({\n        title: \"Invalid file type\",\n        description: \"Please upload an image, video, or audio file\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (file.size > maxSize) {\n      toast({\n        title: \"File too large\",\n        description: \"Maximum file size is 100MB\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setUploadedFile(file);\n    const previewUrl = URL.createObjectURL(file);\n    setUploadPreviewUrl(previewUrl);\n\n    if (!uploadTitle) {\n      const nameWithoutExt = file.name.replace(/\\.[^/.]+$/, \"\");\n      setUploadTitle(nameWithoutExt);\n    }\n  };\n\n  const handleUploadPreview = async () => {\n    if (!uploadedFile || !uploadTitle) {\n      toast({\n        title: \"Missing information\",\n        description: \"Please upload a file and provide a title\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsUploading(true);\n\n    try {\n      const formData = new FormData();\n      formData.append(\"file\", uploadedFile);\n      formData.append(\"title\", uploadTitle);\n      formData.append(\"description\", uploadDescription);\n      formData.append(\"author\", uploadAuthor);\n\n      const uploadRes = await fetch(\"/api/upload\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!uploadRes.ok) {\n        const errorData = await uploadRes.json().catch(() => ({}));\n        throw new Error(errorData.error || \"Failed to upload file\");\n      }\n\n      const { uploadData } = await uploadRes.json();\n\n      if (!uploadData) {\n        throw new Error(\"No data received from upload\");\n      }\n\n      setScrapedData(uploadData);\n      setShowPreview(true);\n\n      toast({\n        title: \"Upload successful\",\n        description: \"Review your content and create your coin\",\n      });\n    } catch (error) {\n      console.error(\"Upload error:\", error);\n      toast({\n        title: \"Upload failed\",\n        description: error instanceof Error ? error.message : \"Failed to upload file. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const getFileIcon = () => {\n    if (!uploadedFile) return <FileText className=\"w-6 h-6\" />;\n    const type = uploadedFile.type.split(\"/\")[0];\n    switch (type) {\n      case \"image\":\n        return <Image className=\"w-6 h-6\" />;\n      case \"video\":\n        return <Film className=\"w-6 h-6\" />;\n      case \"audio\":\n        return <Music className=\"w-6 h-6\" />;\n      default:\n        return <FileText className=\"w-6 h-6\" />;\n    }\n  };\n\n  return (\n    <div className=\"p-3 sm:p-8 md:p-8\">\n      <div className=\"max-w-5xl mx-auto\">\n        <div className=\"mb-4 sm:mb-8 text-center\">\n          <div className=\"flex items-center justify-center gap-1.5 sm:gap-2 mb-2 sm:mb-3\">\n            <Sparkles className=\"w-4 h-4 sm:w-5 sm:h-5 text-primary\" />\n            <h1 className=\"text-xl sm:text-2xl md:text-3xl font-black text-foreground\">\n              Create Your Coin\n            </h1>\n          </div>\n          <p className=\"text-xs sm:text-sm text-muted-foreground\">\n            Transform any content into a tradeable digital asset\n          </p>\n        </div>\n\n        <div className=\"flex items-center justify-center gap-1.5 sm:gap-2 mb-4 sm:mb-6\">\n          <button\n            onClick={() => setActiveTab(\"import\")}\n            className={`\n              relative flex items-center gap-1 sm:gap-2 px-3 sm:px-6 py-1.5 sm:py-2.5 rounded-full text-xs sm:text-sm font-semibold transition-all\n              ${\n                activeTab === \"import\"\n                  ? \"bg-gradient-to-r from-primary to-secondary text-primary-foreground\"\n                  : \"bg-muted/50 text-muted-foreground hover-elevate active-elevate-2\"\n              }\n            `}\n            data-testid=\"button-tab-import\"\n          >\n            <LinkIcon className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n            Import URL\n          </button>\n          <button\n            onClick={() => setActiveTab(\"upload\")}\n            className={`\n              relative flex items-center gap-1 sm:gap-2 px-3 sm:px-6 py-1.5 sm:py-2.5 rounded-full text-xs sm:text-sm font-semibold transition-all\n              ${\n                activeTab === \"upload\"\n                  ? \"bg-gradient-to-r from-primary to-secondary text-primary-foreground\"\n                  : \"bg-muted/50 text-muted-foreground hover-elevate active-elevate-2\"\n              }\n            `}\n            data-testid=\"button-tab-upload\"\n          >\n            <Upload className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n            Upload File\n          </button>\n        </div>\n\n        <div className=\"mb-6\">\n          {activeTab === \"import\" ? (\n            <URLInputForm onScraped={handleScrapedData} />\n          ) : (\n            <div className=\"max-w-xl mx-auto\">\n              <div className=\"bg-card border border-border/50 rounded-3xl p-4 sm:p-8\">\n                <div className=\"space-y-4 sm:space-y-6\">\n                  <div className=\"border-2 border-dashed border-border/40 rounded-2xl p-6 sm:p-10 text-center bg-muted/20 hover:border-primary/50 transition-all hover:bg-muted/30\">\n                    <input\n                      type=\"file\"\n                      id=\"file-upload\"\n                      className=\"hidden\"\n                      accept=\"image/*,video/*,audio/*,.svg,.gif,.mp3,.mp4,.mov,.webm,.avi,.mkv,.flv,.wmv,.m4v,.3gp,.ogg,.wav,.aac,.flac,.m4a,.wma,.apng\"\n                      onChange={handleFileUpload}\n                      data-testid=\"input-file-upload\"\n                    />\n                    <label htmlFor=\"file-upload\" className=\"cursor-pointer\">\n                      <div className=\"flex flex-col items-center gap-4\">\n                        {uploadedFile ? (\n                          <>\n                            <div className=\"p-4 rounded-2xl bg-primary/10\">\n                              {getFileIcon()}\n                            </div>\n                            <div className=\"space-y-1\">\n                              <p className=\"text-sm font-semibold text-foreground\">\n                                {uploadedFile.name}\n                              </p>\n                              <p className=\"text-xs text-muted-foreground\">\n                                {(uploadedFile.size / (1024 * 1024)).toFixed(2)} MB\n                              </p>\n                            </div>\n                            {uploadPreviewUrl && uploadedFile.type.startsWith(\"image/\") && (\n                              <img\n                                src={uploadPreviewUrl}\n                                alt=\"Preview\"\n                                className=\"mt-2 max-h-48 rounded-2xl shadow-xl\"\n                              />\n                            )}\n                            {uploadPreviewUrl && uploadedFile.type.startsWith(\"video/\") && (\n                              <video\n                                src={uploadPreviewUrl}\n                                controls\n                                className=\"mt-2 max-h-48 rounded-2xl shadow-xl\"\n                              />\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"p-3 sm:p-5 rounded-2xl bg-gradient-to-br from-primary/20 to-secondary/20 mb-1 sm:mb-2\">\n                              <Upload className=\"w-8 h-8 sm:w-10 sm:h-10 text-primary\" />\n                            </div>\n                            <div className=\"space-y-1 sm:space-y-2\">\n                              <p className=\"text-sm sm:text-base font-semibold text-foreground\">\n                                Drag & drop or click to upload\n                              </p>\n                              <p className=\"text-[10px] sm:text-xs text-muted-foreground\">\n                                Images, Videos, or Audio ‚Ä¢ Max 100MB\n                              </p>\n                            </div>\n                          </>\n                        )}\n                      </div>\n                    </label>\n                  </div>\n\n                  {uploadedFile && (\n                    <div className=\"space-y-3 sm:space-y-5 pt-2 border-t border-border/30\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"upload-title\" className=\"text-xs sm:text-sm font-medium text-foreground\">\n                          Title <span className=\"text-red-500\">*</span>\n                        </Label>\n                        <div className=\"bg-muted/30 dark:bg-muted/20 rounded-2xl p-1 border border-border/30\">\n                          <Input\n                            id=\"upload-title\"\n                            value={uploadTitle}\n                            onChange={(e) => setUploadTitle(e.target.value)}\n                            placeholder=\"Enter content title\"\n                            className=\"bg-transparent border-0 h-9 sm:h-11 px-3 sm:px-4 text-sm focus-visible:ring-0 focus-visible:ring-offset-0\"\n                            data-testid=\"input-upload-title\"\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"upload-description\" className=\"text-xs sm:text-sm font-medium text-foreground\">\n                          Description\n                        </Label>\n                        <div className=\"bg-muted/30 dark:bg-muted/20 rounded-2xl p-1 border border-border/30\">\n                          <Textarea\n                            id=\"upload-description\"\n                            value={uploadDescription}\n                            onChange={(e) => setUploadDescription(e.target.value)}\n                            placeholder=\"Describe your content (optional)\"\n                            className=\"bg-transparent border-0 resize-none px-3 sm:px-4 text-sm focus-visible:ring-0 focus-visible:ring-offset-0\"\n                            rows={3}\n                            data-testid=\"input-upload-description\"\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"upload-author\" className=\"text-xs sm:text-sm font-medium text-foreground\">\n                          Creator Name\n                        </Label>\n                        <div className=\"bg-muted/30 dark:bg-muted/20 rounded-2xl p-1 border border-border/30\">\n                          <Input\n                            id=\"upload-author\"\n                            value={uploadAuthor}\n                            onChange={(e) => setUploadAuthor(e.target.value)}\n                            placeholder=\"Your name or username (optional)\"\n                            className=\"bg-transparent border-0 h-9 sm:h-11 px-3 sm:px-4 text-sm focus-visible:ring-0 focus-visible:ring-offset-0\"\n                            data-testid=\"input-upload-author\"\n                          />\n                        </div>\n                      </div>\n\n                      <Button\n                        onClick={handleUploadPreview}\n                        disabled={isUploading || !uploadTitle}\n                        className=\"w-full h-10 sm:h-12 text-sm sm:text-base bg-gradient-to-r from-primary to-primary hover:from-primary/100 hover:to-primary/90 text-primary-foreground font-semibold rounded-2xl transition-all\"\n                        data-testid=\"button-upload-preview\"\n                      >\n                        {isUploading ? (\n                          <>\n                            <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\n                            Uploading...\n                          </>\n                        ) : (\n                          <>\n                            <Sparkles className=\"w-5 h-5 mr-2\" />\n                            Preview & Create Coin\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        <Dialog open={showPreview} onOpenChange={setShowPreview}>\n          <DialogContent className=\"max-w-lg w-[92vw] max-h-[80vh] overflow-y-auto bg-card border-border/50 rounded-3xl p-0 gap-0\">\n            <DialogHeader className=\"px-5 pt-5 pb-3 border-b border-border/30\">\n              <DialogTitle className=\"text-lg font-bold text-foreground\">\n                Preview & Create Coin\n              </DialogTitle>\n            </DialogHeader>\n            <div className=\"px-5 py-4\">\n              {scrapedData && (\n                <ContentPreview\n                  scrapedData={scrapedData}\n                  onCoinCreated={handleCoinCreated}\n                />\n              )}\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </div>\n  );\n}\n","size_bytes":15106},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"Inter\", \"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      fontWeight: {\n        regular: \"400\",\n        medium: \"500\",\n        bold: \"700\",\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4156},"client/src/pages/public-profile.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useRoute } from \"wouter\";\nimport type { Coin } from \"@shared/schema\";\nimport {\n  Share2,\n  Grid3x3,\n  List,\n  DollarSign,\n  TrendingUp,\n  Users,\n  Coins as CoinsIcon,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { getCoin } from \"@zoralabs/coins-sdk\";\nimport { base } from \"viem/chains\";\nimport { formatSmartCurrency } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { CoinCard } from \"@/components/coin-card\";\n\nexport default function PublicProfile() {\n  const [, params] = useRoute(\"/profile/:identifier\");\n  const identifier = params?.identifier || \"\";\n\n  const [viewMode, setViewMode] = useState<\"grid\" | \"list\">(\"grid\");\n  const [totalEarnings, setTotalEarnings] = useState<number>(0);\n  const [totalMarketCap, setTotalMarketCap] = useState<number>(0);\n  const [totalHolders, setTotalHolders] = useState<number>(0);\n  const [isLoadingStats, setIsLoadingStats] = useState(false);\n  const { toast } = useToast();\n\n  // Determine if identifier is a wallet address (0x...) or username\n  const isAddress = identifier.startsWith(\"0x\") && identifier.length === 42;\n\n  const { data: creatorData, isLoading: isLoadingCreatorData } = useQuery({\n    queryKey: ['/api/creators', isAddress ? 'address' : 'username', identifier],\n    queryFn: async () => {\n      const endpoint = isAddress\n        ? `/api/creators/address/${identifier}`\n        : `/api/creators/username/${identifier}`;\n      const response = await fetch(endpoint);\n      if (!response.ok) {\n        console.error(`Failed to fetch creator data from ${endpoint}:`, response.status);\n        return null;\n      }\n      return response.json();\n    },\n    enabled: !!identifier,\n  });\n\n  const address = creatorData?.address;\n\n  const avatarSvg = creatorData?.avatar || \"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\";\n\n  const { data: coins = [], isLoading: isLoadingCoins } = useQuery<Coin[]>({\n    queryKey: [\"/api/coins\"],\n  });\n\n  const createdCoins = useMemo(() => {\n    if (!address) return [];\n    return coins.filter(coin =>\n      coin.creator_wallet && coin.creator_wallet.toLowerCase() === address.toLowerCase()\n    );\n  }, [coins, address]);\n\n  const displayedCoins = createdCoins.filter(coin => coin.address !== null) as Array<typeof createdCoins[0] & { address: string }>;\n\n  useEffect(() => {\n    if (!address || !createdCoins.length) {\n      setTotalEarnings(0);\n      setTotalMarketCap(0);\n      setTotalHolders(0);\n      setIsLoadingStats(false);\n      return;\n    }\n\n    let isMounted = true;\n    setIsLoadingStats(true);\n\n    async function fetchAllStats() {\n      try {\n        let earnings = 0;\n        let marketCap = 0;\n        let holders = 0;\n\n        for (const coin of createdCoins) {\n          if (coin.address && coin.status === 'active') {\n            try {\n              const coinData = await getCoin({\n                collectionAddress: coin.address as `0x${string}`,\n                chainId: base.id,\n              });\n\n              const tokenData = coinData.data?.zora20Token;\n\n              if (tokenData?.creatorEarnings && tokenData.creatorEarnings.length > 0) {\n                const earningAmount = parseFloat(String(tokenData.creatorEarnings[0].amountUsd || tokenData.creatorEarnings[0].amount?.amountDecimal || \"0\"));\n                earnings += earningAmount;\n              }\n\n              if (tokenData?.marketCap) {\n                marketCap += parseFloat(tokenData.marketCap);\n              }\n\n              if (tokenData?.uniqueHolders) {\n                holders += tokenData.uniqueHolders;\n              }\n            } catch (err) {\n              console.error(`Error fetching coin stats for ${coin.address}:`, err);\n            }\n          }\n        }\n\n        if (isMounted) {\n          setTotalEarnings(earnings);\n          setTotalMarketCap(marketCap);\n          setTotalHolders(holders);\n          setIsLoadingStats(false);\n        }\n      } catch (error) {\n        console.error(\"Error fetching creator stats:\", error);\n        if (isMounted) {\n          setIsLoadingStats(false);\n        }\n      }\n    }\n\n    fetchAllStats();\n\n    return () => {\n      isMounted = false;\n    };\n  }, [address, createdCoins]);\n\n  const formatAddress = (addr: string) => {\n    return `${addr.slice(0, 6)}...${addr.slice(-4)}`;\n  };\n\n  const handleShare = async () => {\n    const profilePath = creatorData?.name\n      ? `/@${creatorData.name}`\n      : `/profile/${address}`;\n    const url = `${window.location.origin}${profilePath}`;\n\n    try {\n      if (navigator.share) {\n        await navigator.share({\n          title: `${creatorData?.name || formatAddress(address)} - CoinIT Profile`,\n          text: `Check out this profile on CoinIT!`,\n          url: url,\n        });\n      } else {\n        await navigator.clipboard.writeText(url);\n        toast({\n          title: \"Link copied\",\n          description: \"Profile link copied to clipboard\",\n        });\n      }\n    } catch (error) {\n      console.error('Error sharing:', error);\n    }\n  };\n\n  if (isLoadingCreatorData) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh]\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 bg-muted/20 rounded-full animate-pulse mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading profile...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!creatorData) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh] p-8\">\n        <div className=\"text-center\">\n          <h2 className=\"text-2xl font-bold text-foreground mb-2\">User Not Found</h2>\n          <p className=\"text-muted-foreground mb-4\">\n            {isAddress\n              ? `No creator found with address: ${identifier.slice(0, 6)}...${identifier.slice(-4)}`\n              : `No creator found with username: ${identifier}`\n            }\n          </p>\n          <p className=\"text-xs text-muted-foreground\">\n            This creator may not have created their profile yet or the identifier is incorrect.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto p-4 sm:p-6\">\n      <div className=\"relative mb-6\">\n        <div className=\"flex flex-col items-center text-center mb-6\">\n          <div className=\"relative mb-4\">\n            <img\n              src={avatarSvg}\n              alt=\"Profile Avatar\"\n              className=\"w-28 h-28 rounded-3xl border-4 border-border shadow-xl object-cover\"\n            />\n          </div>\n\n          <h1 className=\"text-2xl font-bold text-foreground mb-1\">\n            {creatorData?.name || formatAddress(address)}\n          </h1>\n\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            @{address ? `${address.slice(2, 8)}` : ''}\n          </p>\n\n          {creatorData?.bio && (\n            <p className=\"text-muted-foreground text-sm mb-4 max-w-md px-4\">\n              {creatorData.bio}\n            </p>\n          )}\n        </div>\n\n        <div className=\"grid grid-cols-4 gap-2 mb-6\">\n          <div className=\"text-center\">\n            <div className=\"text-xl font-bold text-foreground mb-1\">\n              {isLoadingStats || isLoadingCoins ? '-' : createdCoins.length}\n            </div>\n            <div className=\"text-xs text-muted-foreground uppercase tracking-wide\">Coins</div>\n          </div>\n\n          <div className=\"text-center\">\n            <div className=\"text-xl font-bold text-foreground mb-1\">\n              {isLoadingStats ? '-' : totalMarketCap >= 1000000\n                ? `$${(totalMarketCap / 1000000).toFixed(2)}M`\n                : totalMarketCap >= 1000\n                  ? `$${(totalMarketCap / 1000).toFixed(1)}k`\n                  : `$${totalMarketCap.toFixed(2)}`}\n            </div>\n            <div className=\"text-xs text-muted-foreground uppercase tracking-wide\">Market Cap</div>\n          </div>\n\n          <div className=\"text-center\">\n            <div className=\"text-xl font-bold text-foreground mb-1\">\n              {isLoadingStats ? '-' : totalHolders}\n            </div>\n            <div className=\"text-xs text-muted-foreground uppercase tracking-wide\">Holders</div>\n          </div>\n\n          <div className=\"text-center\">\n            <div className=\"text-xl font-bold text-green-600 dark:text-green-500 mb-1\">\n              {isLoadingStats ? '-' : formatSmartCurrency(totalEarnings)}\n            </div>\n            <div className=\"text-xs text-muted-foreground uppercase tracking-wide\">Earnings</div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-3 mb-6\">\n          <Button\n            onClick={handleShare}\n            className=\"flex-1 bg-primary hover:bg-primary/90 text-primary-foreground font-bold rounded-xl h-11\"\n          >\n            <Share2 className=\"w-4 h-4 mr-2\" />\n            Share Profile\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex items-center justify-between mb-4\">\n        <h2 className=\"text-xl font-bold text-foreground\">\n          Created Coins {createdCoins.length > 0 && `(${createdCoins.length})`}\n        </h2>\n\n        <div className=\"flex gap-1 bg-muted/20 rounded-full p-1\">\n          <button\n            onClick={() => setViewMode(\"grid\")}\n            className={`p-2 rounded-full transition-colors ${\n              viewMode === \"grid\"\n                ? \"bg-primary text-primary-foreground\"\n                : \"text-muted-foreground hover:text-foreground\"\n            }`}\n          >\n            <Grid3x3 className=\"w-4 h-4\" />\n          </button>\n          <button\n            onClick={() => setViewMode(\"list\")}\n            className={`p-2 rounded-full transition-colors ${\n              viewMode === \"list\"\n                ? \"bg-primary text-primary-foreground\"\n                : \"text-muted-foreground hover:text-foreground\"\n            }`}\n          >\n            <List className=\"w-4 h-4\" />\n          </button>\n        </div>\n      </div>\n\n      {isLoadingCoins ? (\n        <div className=\"grid grid-cols-2 gap-4\">\n          {[...Array(6)].map((_, i) => (\n            <div key={i} className=\"spotify-card rounded-xl overflow-hidden p-3 space-y-3\">\n              <div className=\"aspect-square w-full bg-muted/20 rounded-lg animate-pulse\"></div>\n            </div>\n          ))}\n        </div>\n      ) : displayedCoins.length === 0 ? (\n        <div className=\"text-center py-16\">\n          <div className=\"w-16 h-16 bg-muted/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <CoinsIcon className=\"w-8 h-8 text-muted-foreground\" />\n          </div>\n          <h3 className=\"text-xl font-bold text-foreground mb-2\">No coins created yet</h3>\n        </div>\n      ) : (\n        <div className={viewMode === \"grid\" ? \"grid grid-cols-2 gap-4\" : \"space-y-4\"}>\n          {displayedCoins.map((coin) => (\n            <CoinCard\n              key={coin.id}\n              coin={{\n                ...coin,\n                createdAt: typeof coin.createdAt === 'string'\n                  ? coin.createdAt\n                  : coin.createdAt\n                    ? coin.createdAt.toISOString()\n                    : new Date().toISOString(),\n                ipfsUri: coin.ipfsUri ?? undefined\n              }}\n              isOwnCoin={false}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":11383},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/pages/streaks.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Flame, Trophy, Calendar, Zap, Star, Award, CheckCircle2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { LoginStreak } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\n\nconst daysOfWeek = [\"M\", \"T\", \"W\", \"Th\", \"F\", \"Sa\", \"Su\"];\nconst fullDaysOfWeek = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"];\n\nexport default function Streaks() {\n  const { user: privyUser, authenticated } = usePrivy();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const address = privyUser?.wallet?.address;\n\n  // Use E1XP status endpoint for streak data\n  const { data: e1xpStatus, isLoading } = useQuery({\n    queryKey: [\"/api/e1xp/status\"],\n    enabled: authenticated,\n    refetchInterval: 5000,\n  });\n\n  const weeklyCalendar = e1xpStatus?.weeklyCalendar || [false, false, false, false, false, false, false];\n  const currentStreak = e1xpStatus?.streak || 0;\n  const longestStreak = e1xpStatus?.longestStreak || 0;\n  const totalPoints = e1xpStatus?.points || 0;\n\n  const checkInMutation = useMutation({\n    mutationFn: async () => {\n      const privyId = privyUser?.id;\n      console.log('[Streak Check-In] User clicked button, starting check-in...', { address, privyId });\n      \n      const response = await fetch(\"/api/login-streak/check-in\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ \n          address: address || undefined,\n          privyId: privyId || undefined\n        }),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        console.error('[Streak Check-In] Error:', error);\n        throw new Error(error.error || \"Failed to check in\");\n      }\n      \n      const data = await response.json();\n      console.log('[Streak Check-In] Success:', data);\n      return data;\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/e1xp/status\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/creators/address\", address] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/creators/privy\", privyUser?.id] });\n\n      if (data.alreadyCheckedIn) {\n        toast({\n          title: \"Already Checked In! ‚úÖ\",\n          description: \"You've already claimed your points today. Come back tomorrow!\",\n        });\n      } else {\n        toast({\n          title: `üéâ ${data.pointsEarned} E1XP Earned!`,\n          description: data.isFirstLogin \n            ? \"Welcome! You earned your first daily bonus!\"\n            : `Day ${data.currentStreak || 1} streak! Keep it going! üî•`,\n        });\n      }\n    },\n    onError: (error: Error) => {\n      console.error('[Streak Check-In] Failed:', error);\n      toast({\n        title: \"Check-In Failed\",\n        description: error.message || \"Unable to claim your daily points. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (!authenticated) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh] p-8\">\n        <div className=\"text-center\">\n          <Flame className=\"w-16 h-16 text-muted-foreground mx-auto mb-4\" />\n          <h2 className=\"text-2xl font-bold mb-2\">Connect Your Wallet</h2>\n          <p className=\"text-muted-foreground\">\n            Please connect your wallet to view your streaks\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container max-w-5xl mx-auto px-4 py-6 space-y-6\">\n      {/* Hero Streak Display */}\n      <div className=\"text-center space-y-4\">\n        <div className=\"relative inline-block\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-orange-500/20 to-pink-500/20 blur-3xl rounded-full\"></div>\n          <div className=\"relative bg-gradient-to-br from-orange-50 to-pink-50 dark:from-orange-950/30 dark:to-pink-950/30 rounded-full w-40 h-40 mx-auto flex items-center justify-center border-8 border-background shadow-2xl\">\n            <div className=\"text-center\">\n              <Flame className=\"h-12 w-12 text-orange-500 mx-auto mb-2\" />\n              <div className=\"text-5xl font-black bg-gradient-to-br from-orange-500 to-pink-500 bg-clip-text text-transparent\" data-testid=\"text-current-streak\">\n                {isLoading ? <Skeleton className=\"h-12 w-24 mx-auto\" /> : currentStreak}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div>\n          <h1 className=\"text-3xl font-bold mb-1\">Week Streak</h1>\n          <p className=\"text-muted-foreground\">You are doing really great! üéâ</p>\n        </div>\n      </div>\n\n      {/* Weekly Calendar */}\n      <Card className=\"p-4 rounded-3xl border-2\">\n        <div className=\"grid grid-cols-7 gap-2\">\n          {daysOfWeek.map((day, index) => {\n            const isCompleted = weeklyCalendar[index];\n            const isToday = new Date().getDay() === (index + 1) % 7;\n\n            return (\n              <div\n                key={day}\n                className=\"text-center space-y-2\"\n                data-testid={`day-${fullDaysOfWeek[index].toLowerCase()}`}\n              >\n                <div className=\"text-xs text-muted-foreground font-medium\">\n                  {day}\n                </div>\n                <div\n                  className={`aspect-square rounded-full flex items-center justify-center transition-all ${\n                    isCompleted\n                      ? \"bg-gradient-to-br from-orange-500 to-pink-500 shadow-lg\"\n                      : isToday\n                      ? \"bg-primary/10 border-2 border-primary\"\n                      : \"bg-muted/30\"\n                  }`}\n                >\n                  {isCompleted && <CheckCircle2 className=\"h-5 w-5 text-white\" />}\n                  {!isCompleted && isToday && (\n                    <div className=\"text-xs font-bold text-primary\">{new Date().getDate()}</div>\n                  )}\n                  {!isCompleted && !isToday && (\n                    <div className=\"text-xs text-muted-foreground\">{29 + index}</div>\n                  )}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </Card>\n\n      {/* Stats Card */}\n      <Card className=\"p-6 rounded-3xl bg-gradient-to-br from-accent/5 to-chart-4/5\">\n        <div className=\"text-center mb-4\">\n          <p className=\"text-sm text-muted-foreground font-medium mb-3\">Your Stats</p>\n        </div>\n\n        <div className=\"grid grid-cols-4 gap-4\">\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold mb-1\" data-testid=\"text-days\">\n              {isLoading ? <Skeleton className=\"h-8 w-16 mx-auto\" /> : currentStreak}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">Days</div>\n          </div>\n\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold mb-1\" data-testid=\"text-longest-streak\">\n              {isLoading ? <Skeleton className=\"h-8 w-16 mx-auto\" /> : longestStreak}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">Best</div>\n          </div>\n\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold mb-1\" data-testid=\"text-total-points\">\n              {isLoading ? <Skeleton className=\"h-8 w-16 mx-auto\" /> : totalPoints}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">E1XP</div>\n          </div>\n\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold mb-1\">\n              {isLoading ? <Skeleton className=\"h-8 w-16 mx-auto\" /> : Math.min(Math.floor(currentStreak / 7), 5)}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">Level</div>\n          </div>\n        </div>\n\n        <div className=\"mt-4 pt-4 border-t border-border/50\">\n          <div className=\"flex items-center gap-2 text-sm\">\n            <Star className=\"h-4 w-4 text-chart-4\" />\n            <span className=\"text-muted-foreground\">\n              {isLoading ? <Skeleton className=\"h-6 w-48\" /> : (currentStreak >= 7 ? '2 Insights Available' : 'Keep going to unlock insights!')}\n            </span>\n          </div>\n        </div>\n      </Card>\n\n      {/* Check In Button */}\n      <Button \n        size=\"lg\" \n        onClick={() => {\n          // Only trigger check-in when button is explicitly clicked\n          if (!checkInMutation.isPending) {\n            checkInMutation.mutate();\n          }\n        }}\n        disabled={checkInMutation.isPending || !e1xpStatus?.canClaimDaily}\n        className=\"w-full h-14 bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 text-white font-bold rounded-2xl shadow-xl text-lg disabled:opacity-50 disabled:cursor-not-allowed\"\n        data-testid=\"button-check-in\"\n      >\n        <Zap className=\"h-5 w-5 mr-2\" />\n        {checkInMutation.isPending \n          ? \"Checking In...\" \n          : !e1xpStatus?.canClaimDaily \n          ? \"Already Claimed Today ‚úÖ\" \n          : \"Check In Today\"}\n      </Button>\n\n      {/* Milestones */}\n      <Card className=\"p-6 rounded-3xl\">\n        <h3 className=\"font-bold text-lg mb-4\">Unlock Rewards</h3>\n\n        <div className=\"space-y-3\">\n          <div className={`flex items-center gap-4 p-4 rounded-2xl border-2 transition-all ${\n            currentStreak >= 7 ? 'border-primary bg-primary/5' : 'border-border bg-card'\n          }`}>\n            <div className={`p-3 rounded-xl ${currentStreak >= 7 ? 'bg-primary/20' : 'bg-muted/20'}`}>\n              <Flame className=\"h-5 w-5 text-primary\" />\n            </div>\n            <div className=\"flex-1\">\n              <div className=\"font-semibold\">7-Day Streak</div>\n              <div className=\"text-xs text-muted-foreground\">2x points bonus</div>\n            </div>\n            {currentStreak >= 7 && <Badge className=\"bg-green-500\">‚úì</Badge>}\n          </div>\n\n          <div className={`flex items-center gap-4 p-4 rounded-2xl border-2 transition-all ${\n            currentStreak >= 30 ? 'border-accent bg-accent/5' : 'border-border bg-card'\n          }`}>\n            <div className={`p-3 rounded-xl ${currentStreak >= 30 ? 'bg-accent/20' : 'bg-muted/20'}`}>\n              <Trophy className=\"h-5 w-5 text-accent\" />\n            </div>\n            <div className=\"flex-1\">\n              <div className=\"font-semibold\">30-Day Streak</div>\n              <div className=\"text-xs text-muted-foreground\">Creator badge</div>\n            </div>\n            {currentStreak >= 30 && <Badge className=\"bg-green-500\">‚úì</Badge>}\n          </div>\n\n          <div className={`flex items-center gap-4 p-4 rounded-2xl border-2 transition-all ${\n            currentStreak >= 90 ? 'border-chart-4 bg-chart-4/5' : 'border-border bg-card'\n          }`}>\n            <div className={`p-3 rounded-xl ${currentStreak >= 90 ? 'bg-chart-4/20' : 'bg-muted/20'}`}>\n              <Award className=\"h-5 w-5 text-chart-4\" />\n            </div>\n            <div className=\"flex-1\">\n              <div className=\"font-semibold\">90-Day Legend</div>\n              <div className=\"text-xs text-muted-foreground\">Exclusive tools</div>\n            </div>\n            {currentStreak >= 90 && <Badge className=\"bg-green-500\">‚úì</Badge>}\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}","size_bytes":11533},"server/routes/admin.ts":{"content":"import { Router } from 'express';\nimport { Storage } from '../storage';\nimport { Server as SocketIOServer } from 'socket.io';\n\nlet io: SocketIOServer | null = null;\n\nexport function setSocketIO(ioInstance: SocketIOServer) {\n  io = ioInstance;\n}\n\n// Note: keep types loose here to avoid coupling to schema type mismatches in runtime\n\nconst ADMIN_EMAIL = process.env.ADMIN_EMAIL || 'bloombetgaming@gmail.com';\n\nexport function createAdminRouter(storage: Storage) {\n  const router = Router();\n\n  // Middleware to check admin status\n  const requireAdmin = (req: any, res: any, next: any) => {\n    // Check if session exists and user is admin\n    console.log('[ADMIN] Checking admin access. Session:', {\n      exists: !!req.session,\n      user: req.session?.user,\n      isAdmin: req.session?.user?.isAdmin\n    });\n\n    const isAdmin = req.session?.user?.isAdmin === true || req.session?.user?.isAdmin === 1;\n\n    if (!isAdmin) {\n      console.error('[ADMIN] Unauthorized access attempt. Session user:', req.session?.user);\n      console.error('[ADMIN] Request path:', req.path);\n      console.error('[ADMIN] Session ID:', req.sessionID);\n      return res.status(403).json({\n        error: 'Unauthorized: Admin access required',\n        hint: 'Please log in to the admin panel first at /admin-login'\n      });\n    }\n\n    console.log('[ADMIN] Admin access granted for user:', req.session.user.email || req.session.user.username);\n    next();\n  };\n\n  // Admin login endpoint (no password required for admin email)\n  router.post('/login', async (req, res) => {\n    try {\n      const { email } = req.body;\n\n      if (!email) {\n        return res.status(400).json({ error: 'Email is required' });\n      }\n\n      // Check if this is the admin email\n      if (email.toLowerCase() !== ADMIN_EMAIL.toLowerCase()) {\n        return res.status(403).json({ error: 'Not authorized as admin' });\n      }\n\n      // Get or create admin creator (using pseudo-address based on email)\n      const adminAddress = `admin_${email.toLowerCase().replace('@', '_at_').replace(/\\./g, '_')}`;\n      let adminCreator = await storage.getCreatorByAddress(adminAddress);\n\n      if (!adminCreator) {\n        // Create admin creator if doesn't exist\n        adminCreator = await storage.createCreator({\n          address: adminAddress,\n          name: 'Platform Admin',\n          bio: 'Administrator account',\n          totalCoins: '0',\n          totalVolume: '0',\n          followers: '0',\n        } as any);\n      }\n\n      // Set session\n      if (!req.session) {\n        req.session = {} as any;\n      }\n      req.session.user = {\n        id: adminCreator.id,\n        email: email,\n        username: 'admin',\n        address: adminAddress,\n        isAdmin: true,\n      };\n\n      // Save session explicitly to ensure it persists\n      await new Promise<void>((resolve, reject) => {\n        req.session.save((err: any) => {\n          if (err) reject(err);\n          else resolve();\n        });\n      });\n\n      console.log('[ADMIN] Session saved for admin user:', email);\n      console.log('[ADMIN] Session ID:', req.sessionID);\n\n      res.json({\n        success: true,\n        user: {\n          id: adminCreator.id,\n          email: email,\n          username: 'admin',\n          isAdmin: true,\n        }\n      });\n    } catch (error) {\n      console.error('[ADMIN] Login failed:', error);\n      res.status(500).json({ error: 'Login failed', details: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Check admin session\n  router.get('/session', (req, res) => {\n    if (req.session?.user?.isAdmin) {\n      res.json({\n        authenticated: true,\n        user: req.session.user\n      });\n    } else {\n      res.json({ authenticated: false });\n    }\n  });\n\n  // Admin logout endpoint\n  router.post('/logout', (req, res) => {\n    if (req.session) {\n      req.session.destroy((err) => {\n        if (err) {\n          return res.status(500).json({ error: 'Failed to logout' });\n        }\n        res.json({ success: true });\n      });\n    } else {\n      res.json({ success: true });\n    }\n  });\n\n  // Add new admin\n  router.post('/add-admin', requireAdmin, async (req, res) => {\n    try {\n      const { email } = req.body;\n      if (!email) {\n        return res.status(400).json({ error: 'Email is required' });\n      }\n\n      // Create or update user to be admin\n      const adminAddress = `admin_${email.toLowerCase().replace('@', '_at_').replace(/\\./g, '_')}`;\n      let adminUser = await storage.getUserByEmail(email);\n\n      if (!adminUser) {\n        // Check if creator exists with this address\n        let creator = await storage.getCreatorByAddress(adminAddress);\n        if (!creator) {\n          creator = await storage.createCreator({\n            address: adminAddress,\n            name: `Admin (${email})`,\n            bio: 'Platform Administrator',\n          } as any);\n        }\n\n        // Create user entry\n        adminUser = await storage.createUser({\n          email,\n          username: email.split('@')[0],\n          displayName: `Admin (${email})`,\n          walletAddress: adminAddress,\n        } as any);\n      }\n\n      // Update user to be admin\n      await storage.updateUser(adminUser.id, { isAdmin: 1 } as any);\n\n      res.json({ success: true, user: adminUser });\n    } catch (error) {\n      console.error('[ADMIN] Add admin failed:', error);\n      res.status(500).json({ error: 'Failed to add admin', details: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Moderate user\n  router.post('/moderate', requireAdmin, async (req, res) => {\n    try {\n      const { address, type, duration, reason } = req.body;\n\n      // Get creator by address\n      const creator = await storage.getCreatorByAddress(address);\n      if (!creator) {\n        return res.status(404).json({ error: 'User not found' });\n      }\n\n      const action = { type, duration, reason } as any;\n\n      await storage.moderateUser(creator.id, action as any);\n      res.json({ success: true });\n    } catch (error) {\n      console.error('Moderation failed:', error);\n      res.status(500).json({ error: 'Failed to moderate user' });\n    }\n  });\n\n  // Send custom message/notification to users\n  router.post('/send-message', requireAdmin, async (req, res) => {\n    try {\n      console.log('[ADMIN] Send message request:', req.body);\n      const {\n        title,\n        message,\n        type = 'admin',\n        recipients,\n        sendToAll = false,\n        includeTelegram = false\n      } = req.body;\n\n      // Validate required fields\n      if (!title || !message) {\n        return res.status(400).json({ error: 'Title and message are required' });\n      }\n\n      if (!sendToAll && (!recipients || recipients.length === 0)) {\n        return res.status(400).json({ error: 'Must specify recipients or enable send to all' });\n      }\n\n      console.log('[ADMIN] Sending message:', { title, message, type, sendToAll, recipientCount: recipients?.length });\n\n      let successCount = 0;\n      let failCount = 0;\n      const { sendTelegramNotification } = await import('../telegram-bot');\n      const { emitNotificationToUser, broadcastNotificationToAll } = await import('../socket-server');\n\n      if (sendToAll) {\n        // Send to all users\n        console.log('[ADMIN] Broadcasting message to all creators');\n        const creators = await storage.getAllCreators();\n        console.log(`[ADMIN] Found ${creators.length} creators`);\n\n        for (const creator of creators) {\n          try {\n            // Create in-app notification\n            const notification = await storage.createNotification({\n              userId: creator.address || creator.id,\n              type: type,\n              title,\n              message,\n              metadata: { fromAdmin: true },\n              read: false,\n              createdAt: new Date(),\n            } as any);\n\n            // Send real-time notification via Socket.IO\n            emitNotificationToUser(creator.address || creator.id, notification);\n\n            // Send Telegram notification if enabled\n            if (includeTelegram && creator.address) {\n              try {\n                await sendTelegramNotification(\n                  creator.address,\n                  title,\n                  message,\n                  type\n                );\n              } catch (telegramError) {\n                console.warn(`[ADMIN] Telegram failed for ${creator.address}:`, telegramError);\n                // Don't fail the whole operation if Telegram fails\n              }\n            }\n\n            successCount++;\n          } catch (error) {\n            console.error(`[ADMIN] Failed to send to ${creator.address}:`, error);\n            failCount++;\n          }\n        }\n      } else {\n        // Send to specific recipients\n        console.log(`[ADMIN] Sending message to ${recipients.length} specific users`);\n\n        for (const recipient of recipients) {\n          try {\n            // Find user by address or privyId\n            let targetUserId = recipient;\n\n            // Try to find creator by address or privyId\n            let creator = await storage.getCreatorByAddress(recipient);\n            if (!creator && recipient.startsWith('did:')) {\n              // Might be a privyId\n              creator = await storage.getCreatorByPrivyId(recipient);\n            }\n\n            if (creator) {\n              targetUserId = creator.address || creator.id;\n            }\n\n            // Create in-app notification\n            const notification = await storage.createNotification({\n              userId: targetUserId,\n              type: type,\n              title,\n              message,\n              metadata: { fromAdmin: true },\n              read: false,\n              createdAt: new Date(),\n            } as any);\n\n            // Send real-time notification via Socket.IO\n            emitNotificationToUser(targetUserId, notification);\n\n            // Send Telegram notification if enabled\n            if (includeTelegram && (creator?.address || targetUserId)) {\n              try {\n                await sendTelegramNotification(\n                  creator?.address || targetUserId,\n                  title,\n                  message,\n                  type\n                );\n              } catch (telegramError) {\n                console.warn(`[ADMIN] Telegram failed for ${targetUserId}:`, telegramError);\n              }\n            }\n\n            successCount++;\n          } catch (error) {\n            console.error(`[ADMIN] Failed to send to ${recipient}:`, error);\n            failCount++;\n          }\n        }\n      }\n\n      console.log(`[ADMIN] Message send complete: ${successCount} success, ${failCount} failed`);\n      res.json({\n        success: true,\n        sent: successCount,\n        failed: failCount,\n        message: `Successfully sent message to ${successCount} user(s)${failCount > 0 ? `, ${failCount} failed` : ''}`\n      });\n    } catch (error) {\n      console.error('[ADMIN] Send message failed:', error);\n      console.error('[ADMIN] Error stack:', error instanceof Error ? error.stack : 'No stack trace');\n      res.status(500).json({\n        error: 'Failed to send message',\n        details: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Test notifications (legacy support)\n  router.post('/test-notification', requireAdmin, async (req, res) => {\n    try {\n      console.log('[ADMIN] Test notification request:', req.body);\n      const { type, title: rawTitle, message: rawMessage, address, userId } = req.body;\n\n      // Provide safe defaults so admin testing UI can send minimal payloads\n      const title = rawTitle || `Test: ${type || 'notification'}`;\n      const message = rawMessage || `This is a test ${type || 'notification'} from admin`;\n\n      console.log('[ADMIN] Sending notification:', { type, title, message, target: userId || address });\n\n      // Determine target - support 'all', address, or userId (client sends userId)\n      if (address === 'all' || userId === 'all') {\n        // Send to all users\n        console.log('[ADMIN] Sending to all creators');\n        const creators = await storage.getAllCreators();\n        console.log(`[ADMIN] Found ${creators.length} creators`);\n\n        const promises = creators.map(creator => {\n          console.log(`[ADMIN] Creating notification for creator: ${creator.address}`);\n          return storage.createNotification({\n            userId: creator.address,\n            type: type,\n            title,\n            message,\n            metadata: { isTest: true },\n            read: false,\n            createdAt: new Date(),\n          } as any);\n        });\n        await Promise.all(promises);\n        console.log(`[ADMIN] Successfully sent ${promises.length} notifications`);\n      } else {\n        // If userId provided, send to that user; otherwise try address\n        const target = userId || address;\n        if (!target) {\n          console.error('[ADMIN] Missing target address or userId');\n          return res.status(400).json({ error: 'Missing target address or userId' });\n        }\n\n        console.log(`[ADMIN] Sending notification to: ${target}`);\n        await storage.createNotification({\n          userId: target,\n          type: type,\n          title,\n          message,\n          metadata: { isTest: true },\n          read: false,\n          createdAt: new Date(),\n        } as any);\n        console.log('[ADMIN] Notification sent successfully');\n      }\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error('[ADMIN] Notification test failed with error:', error);\n      console.error('[ADMIN] Error stack:', error instanceof Error ? error.stack : 'No stack trace');\n      res.status(500).json({\n        error: 'Failed to send test notification',\n        details: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Alias for client compatibility\n  router.post('/trigger-notification', requireAdmin, async (req, res) => {\n    // Reuse the test-notification handler logic by calling the same route handler\n    // Simpler: forward the request body to storage.createNotification(s) similar to /test-notification\n    try {\n      const { type, title: rawTitle, message: rawMessage, address, userId } = req.body;\n      const title = rawTitle || `Trigger: ${type || 'notification'}`;\n      const message = rawMessage || `Triggered ${type || 'notification'} from admin`;\n\n      if (address === 'all' || userId === 'all') {\n        const creators = await storage.getAllCreators();\n        await Promise.all(\n          creators.map((creator) =>\n            storage.createNotification({ userId: creator.address, type, title, message, metadata: { isTest: true }, read: false, createdAt: new Date() } as any)\n          )\n        );\n      } else {\n        const target = userId || address;\n        if (!target) return res.status(400).json({ error: 'Missing target address or userId' });\n\n        await storage.createNotification({ userId: target, type, title, message, metadata: { isTest: true }, read: false, createdAt: new Date() } as any);\n      }\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error('Trigger notification failed:', error);\n      res.status(500).json({ error: 'Failed to trigger notification' });\n    }\n  });\n\n  // Hide a coin (mark as hidden)\n  router.post('/hide-coin/:address', requireAdmin, async (req, res) => {\n    try {\n      const { address } = req.params;\n      const coin = await storage.updateCoinByAddress(address, { hidden: true } as any);\n      if (!coin) return res.status(404).json({ error: 'Coin not found' });\n      res.json(coin);\n    } catch (error) {\n      console.error('Hide coin failed:', error);\n      res.status(500).json({ error: 'Failed to hide coin', details: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Admin create coin (does not add admin to creator list if admin lists a coin)\n  router.post('/create-coin', requireAdmin, async (req, res) => {\n    try {\n      const coinData = req.body;\n\n      // Allow admin to specify a creatorAddress; if omitted, do not auto-create a creator\n      const creatorAddress = coinData.creatorAddress || coinData.creator_wallet || null;\n\n      const insert = {\n        name: coinData.name,\n        symbol: coinData.symbol,\n        address: coinData.address || null,\n        creator_wallet: creatorAddress,\n        status: coinData.status || 'active',\n        ipfs_uri: coinData.ipfsUri || coinData.ipfs_uri || null,\n        chain_id: coinData.chainId || coinData.chain_id || null,\n        image: coinData.image || null,\n        description: coinData.description || null,\n        hidden: false,\n        created_at: new Date().toISOString(),\n      };\n\n      const coin = await storage.createCoin(insert as any);\n\n      // If a creatorAddress was provided, create or update the creator's stats but do not mark admin as creator\n      if (creatorAddress) {\n        let creator = await storage.getCreatorByAddress(creatorAddress);\n        if (!creator) {\n          await storage.createCreator({ address: creatorAddress } as any);\n        } else {\n          const newTotal = (parseInt(creator.totalCoins || '0') + 1).toString();\n          await storage.updateCreator(creator.id, { totalCoins: newTotal } as any);\n        }\n      }\n\n      res.json(coin);\n    } catch (error) {\n      console.error('Admin create coin failed:', error);\n      res.status(500).json({ error: 'Failed to create coin' });\n    }\n  });\n\n  // Show a coin (unhide)\n  router.post('/show-coin/:address', requireAdmin, async (req, res) => {\n    try {\n      const { address } = req.params;\n      const coin = await storage.updateCoinByAddress(address, { hidden: false } as any);\n      if (!coin) return res.status(404).json({ error: 'Coin not found' });\n      res.json(coin);\n    } catch (error) {\n      console.error('Show coin failed:', error);\n      res.status(500).json({ error: 'Failed to show coin', details: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Remove a coin (soft-delete by setting status)\n  router.post('/remove-coin/:id', requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const coin = await storage.updateCoin(id, { status: 'removed' } as any);\n      if (!coin) return res.status(404).json({ error: 'Coin not found' });\n      res.json({ success: true });\n    } catch (error) {\n      console.error('Remove coin failed:', error);\n      res.status(500).json({ error: 'Failed to remove coin' });\n    }\n  });\n\n  // Pin a coin to explore page (max 6)\n  router.post('/pin-coin/:address', requireAdmin, async (req, res) => {\n    try {\n      console.log('[ADMIN] Pin coin request for address:', req.params.address);\n      console.log('[ADMIN] Session user:', req.session?.user);\n      const { address } = req.params;\n      const coin = await storage.pinCoin(address);\n      if (!coin) return res.status(404).json({ error: 'Coin not found' });\n      console.log('[ADMIN] Coin pinned successfully:', coin);\n      res.json(coin);\n    } catch (error) {\n      console.error('[ADMIN] Pin coin failed:', error);\n      res.status(500).json({ error: error instanceof Error ? error.message : 'Failed to pin coin' });\n    }\n  });\n\n  // Unpin a coin from explore page\n  router.post('/unpin-coin/:address', requireAdmin, async (req, res) => {\n    try {\n      console.log('[ADMIN] Unpin coin request for address:', req.params.address);\n      console.log('[ADMIN] Session user:', req.session?.user);\n      const { address } = req.params;\n      const coin = await storage.unpinCoin(address);\n      if (!coin) return res.status(404).json({ error: 'Coin not found' });\n      console.log('[ADMIN] Coin unpinned successfully:', coin);\n      res.json(coin);\n    } catch (error) {\n      console.error('[ADMIN] Unpin coin failed:', error);\n      res.status(500).json({ error: 'Failed to unpin coin' });\n    }\n  });\n\n  // Get pinned coins\n  router.get('/pinned-coins', requireAdmin, async (req, res) => {\n    try {\n      const pinnedCoins = await storage.getPinnedCoins();\n      res.json(pinnedCoins);\n    } catch (error) {\n      console.error('Get pinned coins failed:', error);\n      res.status(500).json({ error: 'Failed to get pinned coins' });\n    }\n  });\n\n  // List pinned coins with details (for admin console)\n  router.get('/list-pinned-coins', requireAdmin, async (req, res) => {\n    try {\n      const pinnedCoins = await storage.getPinnedCoins();\n      const formatted = pinnedCoins.map((coin: any, index: number) => ({\n        position: index + 1,\n        name: coin.name,\n        symbol: coin.symbol,\n        address: coin.address,\n        pinOrder: coin.pin_order || coin.pinOrder,\n        status: coin.status,\n        createdAt: coin.created_at || coin.createdAt,\n      }));\n      console.log('\\nüìå CURRENTLY PINNED COINS (max 6):');\n      console.log('=====================================');\n      formatted.forEach(coin => {\n        console.log(`${coin.position}. ${coin.name} (${coin.symbol})`);\n        console.log(`   Address: ${coin.address}`);\n        console.log(`   Pin Order: ${coin.pinOrder}`);\n        console.log(`   Status: ${coin.status}`);\n        console.log('');\n      });\n      console.log(`Total pinned: ${formatted.length}/6`);\n      console.log('=====================================\\n');\n      res.json(formatted);\n    } catch (error) {\n      console.error('List pinned coins failed:', error);\n      res.status(500).json({ error: 'Failed to list pinned coins' });\n    }\n  });\n\n  // Hide a creator (soft-restrict using moderation)\n  router.post('/hide-creator/:address', requireAdmin, async (req, res) => {\n    try {\n      const { address } = req.params;\n      if (!address) return res.status(400).json({ error: 'Missing creator address' });\n\n      const creator = await storage.getCreatorByAddress(address);\n      if (!creator) return res.status(404).json({ error: 'Creator not found' });\n\n      // Use moderation to restrict the creator account\n      await storage.moderateUser(creator.id, { type: 'restrict', reason: 'Hidden by admin', duration: 0 } as any);\n      res.json({ success: true });\n    } catch (error) {\n      console.error('Hide creator failed:', error);\n      res.status(500).json({ error: 'Failed to hide creator' });\n    }\n  });\n\n  // Remove a creator (ban)\n  router.post('/remove-creator/:address', requireAdmin, async (req, res) => {\n    try {\n      const { address } = req.params;\n      if (!address) return res.status(400).json({ error: 'Missing creator address' });\n\n      const creator = await storage.getCreatorByAddress(address);\n      if (!creator) return res.status(404).json({ error: 'Creator not found' });\n\n      await storage.moderateUser(creator.id, { type: 'ban', reason: 'Removed by admin' } as any);\n      res.json({ success: true });\n    } catch (error) {\n      console.error('Remove creator failed:', error);\n      res.status(500).json({ error: 'Failed to remove creator' });\n    }\n  });\n\n  // Gift E1XP points to users\n  router.post('/gift-e1xp', requireAdmin, async (req, res) => {\n    try {\n      const { recipients, amount, reason, all } = req.body;\n\n      if (!amount || isNaN(parseInt(amount))) {\n        return res.status(400).json({ error: 'Valid amount is required' });\n      }\n\n      const pointsAmount = parseInt(amount);\n      let successCount = 0;\n      let failCount = 0;\n\n      if (all) {\n        console.log('[ADMIN] Gifting E1XP to all users...');\n        // Get all users (both wallet and email)\n        const users = await storage.getAllUsers();\n        const creators = await storage.getAllCreators();\n\n        // Combine both lists and deduplicate by privyId\n        const allUsers = new Map();\n\n        // Add users table entries first (preferred)\n        for (const user of users) {\n          allUsers.set(user.privyId || user.id, {\n            id: user.id,\n            privyId: user.privyId,\n            address: user.walletAddress,\n            email: user.email,\n            name: user.displayName || user.username,\n          });\n        }\n\n        // Add creators table entries (legacy) if not already in users\n        for (const creator of creators) {\n          const key = creator.privyId || creator.address || creator.id;\n          if (!allUsers.has(key)) {\n            allUsers.set(key, {\n              id: creator.id,\n              privyId: creator.privyId,\n              address: creator.address,\n              email: creator.email,\n              name: creator.name,\n            });\n          }\n        }\n\n        console.log(`[ADMIN] Found ${allUsers.size} unique users to gift`);\n\n        for (const [_, user] of allUsers) {\n          try {\n            const address = user.address || user.email || user.privyId || user.id;\n            await storage.addPoints(address, pointsAmount, reason || 'Admin gift');\n\n            // Create notification for the gift\n            await storage.createNotification({\n              userId: address,\n              type: 'reward',\n              title: 'üéÅ Admin Gift Received!',\n              message: `You received ${pointsAmount} E1XP! ${reason ? reason : 'Thank you for being part of the community!'}`,\n              amount: pointsAmount.toString(),\n              read: false,\n              createdAt: new Date(),\n            } as any);\n\n            successCount++;\n          } catch (error) {\n            console.error(`[ADMIN] Failed to gift to ${user.name || address}:`, error);\n            failCount++;\n          }\n        }\n      } else if (recipients && Array.isArray(recipients)) {\n        // Gift to specific recipients\n        console.log(`[ADMIN] Gifting ${pointsAmount} E1XP to ${recipients.length} specific users`);\n\n        for (const address of recipients) {\n          try {\n            await storage.addPoints(address, pointsAmount, reason || 'Admin gift');\n\n            // Create notification for the gift\n            await storage.createNotification({\n              userId: address,\n              type: 'reward',\n              title: 'üéÅ Admin Gift Received!',\n              message: `You received ${pointsAmount} E1XP! ${reason ? reason : 'Thank you for being part of the community!'}`,\n              amount: pointsAmount.toString(),\n              read: false,\n              createdAt: new Date(),\n            });\n\n            successCount++;\n          } catch (error) {\n            console.error(`[ADMIN] Failed to gift to ${address}:`, error);\n            failCount++;\n          }\n        }\n      } else {\n        return res.status(400).json({ error: 'Must specify recipients or set all to true' });\n      }\n\n      console.log(`[ADMIN] E1XP gift complete: ${successCount} success, ${failCount} failed`);\n      res.json({ success: true, recipients: successCount, failed: failCount });\n    } catch (error) {\n      console.error('[ADMIN] Gift E1XP failed with error:', error);\n      console.error('[ADMIN] Error stack:', error instanceof Error ? error.stack : 'No stack trace');\n      res.status(500).json({\n        error: 'Failed to gift E1XP',\n        details: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Get moderation history\n  router.get('/moderation-history/:address', requireAdmin, async (req, res) => {\n    try {\n      const creator = await storage.getCreatorByAddress(req.params.address);\n      if (!creator) {\n        return res.status(404).json({ error: 'User not found' });\n      }\n\n      const history = await storage.getModerationHistory(creator.id);\n      res.json(history);\n    } catch (error) {\n      console.error('Failed to get moderation history:', error);\n      res.status(500).json({ error: 'Failed to get moderation history' });\n    }\n  });\n\n  // Get user rewards tracking (Zora + E1XP)\n  router.get('/user-rewards', requireAdmin, async (req, res) => {\n    try {\n      // Get all creators\n      const creators = await storage.getAllCreators();\n\n      // Get rewards data for each creator\n      const userRewards = await Promise.all(\n        creators.map(async (creator) => {\n          // Get Zora rewards (from rewards table)\n          const zoraRewards = await storage.getRewardsByCreator(creator.address);\n\n          // Get E1XP rewards\n          const e1xpRewards = await storage.getE1xpRewardsByUser(creator.id);\n\n          // Calculate totals\n          const totalZoraRewards = zoraRewards.reduce((sum, reward) =>\n            sum + parseFloat(reward.rewardAmount || '0'), 0\n          );\n\n          const totalE1XPRewards = e1xpRewards.reduce((sum, reward) =>\n            sum + parseFloat(reward.amount || '0'), 0\n          );\n\n          return {\n            userId: creator.id,\n            username: creator.name || creator.address,\n            address: creator.address,\n            zoraRewards: {\n              total: totalZoraRewards.toFixed(4),\n              count: zoraRewards.length,\n              rewards: zoraRewards,\n            },\n            e1xpRewards: {\n              total: totalE1XPRewards,\n              count: e1xpRewards.length,\n              rewards: e1xpRewards,\n            },\n            totalPoints: parseInt(creator.points || '0'),\n          };\n        })\n      );\n\n      res.json({ users: userRewards });\n    } catch (error) {\n      console.error('[ADMIN] Get user rewards failed:', error);\n      res.status(500).json({ error: 'Failed to fetch user rewards', details: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Get platform fees and trade fees tracking\n  router.get('/fees-tracking', requireAdmin, async (req, res) => {\n    try {\n      // Get all rewards to calculate fees\n      const allRewards = await storage.getAllRewards();\n\n      // Separate platform fees and trade fees\n      const platformFees = allRewards.filter(r => r.type === 'platform');\n      const tradeFees = allRewards.filter(r => r.type === 'trade');\n\n      // Calculate totals\n      const totalPlatformFees = platformFees.reduce((sum, reward) =>\n        sum + parseFloat(reward.rewardAmount || '0'), 0\n      );\n\n      const totalTradeFees = tradeFees.reduce((sum, reward) =>\n        sum + parseFloat(reward.rewardAmount || '0'), 0\n      );\n\n      // Group by coin for detailed breakdown\n      const feesByCoin = allRewards.reduce((acc: any, reward) => {\n        const coinSymbol = reward.coinSymbol || 'Unknown';\n        if (!acc[coinSymbol]) {\n          acc[coinSymbol] = {\n            coinAddress: reward.coinAddress,\n            coinSymbol,\n            platformFees: 0,\n            tradeFees: 0,\n            totalFees: 0,\n            transactionCount: 0,\n          };\n        }\n\n        const amount = parseFloat(reward.rewardAmount || '0');\n        if (reward.type === 'platform') {\n          acc[coinSymbol].platformFees += amount;\n        } else if (reward.type === 'trade') {\n          acc[coinSymbol].tradeFees += amount;\n        }\n        acc[coinSymbol].totalFees += amount;\n        acc[coinSymbol].transactionCount += 1;\n\n        return acc;\n      }, {});\n\n      res.json({\n        summary: {\n          totalPlatformFees: totalPlatformFees.toFixed(4),\n          totalTradeFees: totalTradeFees.toFixed(4),\n          totalFees: (totalPlatformFees + totalTradeFees).toFixed(4),\n          platformFeeCount: platformFees.length,\n          tradeFeeCount: tradeFees.length,\n          totalTransactions: allRewards.length,\n        },\n        feesByCoin: Object.values(feesByCoin),\n        recentTransactions: allRewards.slice(-20).reverse(), // Last 20 transactions\n      });\n    } catch (error) {\n      console.error('[ADMIN] Get fees tracking failed:', error);\n      res.status(500).json({ error: 'Failed to fetch fees tracking', details: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Send direct message to user (supports email or wallet address)\n  router.post('/send-direct-message', requireAdmin, async (req, res) => {\n    try {\n      const { recipientAddress, message } = req.body;\n\n      console.log('[ADMIN] Send direct message:', { recipientAddress, message });\n\n      if (!recipientAddress || !message) {\n        return res.status(400).json({ error: 'Recipient address or email and message required' });\n      }\n\n      // Get admin user info\n      const adminEmail = req.session?.user?.email || 'bloombetgaming@gmail.com';\n      const adminAddress = `admin_${adminEmail.toLowerCase().replace('@', '_at_').replace(/\\./g, '_')}`;\n\n      // Determine if input is email, wallet address, or username\n      const isEmail = recipientAddress.includes('@');\n      let targetUserId: string;\n      let recipientInfo: any = null;\n\n      if (isEmail) {\n        // Look up user by email - check both users and creators tables\n        console.log('[ADMIN] Looking up user by email:', recipientAddress);\n\n        // First try to find in users table\n        const user = await storage.getUserByEmail(recipientAddress);\n\n        if (user) {\n          // Use user's privyId if available, otherwise wallet address or ID\n          targetUserId = user.privyId || user.walletAddress || user.id;\n          recipientInfo = user;\n          console.log('[ADMIN] Found user by email:', { id: user.id, email: recipientAddress, privyId: user.privyId });\n        } else {\n          // Fallback: search creators by privyId\n          const allCreators = await storage.getAllCreators();\n          recipientInfo = allCreators.find(c =>\n            c.privyId?.toLowerCase().includes(recipientAddress.toLowerCase())\n          );\n\n          if (!recipientInfo) {\n            return res.status(404).json({ error: 'User with this email not found' });\n          }\n\n          // Use creator privyId or address or ID\n          targetUserId = recipientInfo.privyId || recipientInfo.address || recipientInfo.id;\n          console.log('[ADMIN] Found creator by email:', { id: recipientInfo.id, privyId: recipientInfo.privyId });\n        }\n      } else {\n        // Try wallet address first\n        recipientInfo = await storage.getCreatorByAddress(recipientAddress);\n\n        if (!recipientInfo) {\n          // Try to find by username/name\n          const allCreators = await storage.getAllCreators();\n          recipientInfo = allCreators.find(c =>\n            c.name?.toLowerCase() === recipientAddress.toLowerCase() ||\n            c.address?.toLowerCase() === recipientAddress.toLowerCase()\n          );\n\n          if (!recipientInfo) {\n            // Try users table by username\n            const allUsers = await storage.getAllUsers();\n            const user = allUsers.find(u =>\n              u.username?.toLowerCase() === recipientAddress.toLowerCase() ||\n              u.walletAddress?.toLowerCase() === recipientAddress.toLowerCase()\n            );\n\n            if (!user) {\n              return res.status(404).json({ error: 'User not found. Please use a valid wallet address or username.' });\n            }\n\n            targetUserId = user.privyId || user.walletAddress || user.id;\n            recipientInfo = user;\n            console.log('[ADMIN] Found user by username:', { id: user.id, username: user.username });\n          } else {\n            targetUserId = recipientInfo.privyId || recipientInfo.address || recipientInfo.id;\n            console.log('[ADMIN] Found creator by name:', { id: recipientInfo.id, name: recipientInfo.name });\n          }\n        } else {\n          targetUserId = recipientInfo.privyId || recipientInfo.address || recipientInfo.id;\n          console.log('[ADMIN] Found creator by address:', { id: recipientInfo.id, address: recipientAddress });\n        }\n      }\n\n      // Create actual message in messages table\n      const dbMessage = await storage.createMessage({\n        senderId: adminAddress,\n        recipientId: targetUserId,\n        content: message,\n        messageType: 'text'\n      });\n\n      console.log('[ADMIN] Created message in database:', { messageId: dbMessage.id, recipientId: targetUserId });\n\n      // Emit Socket.IO event for real-time message delivery\n      const { emitNotificationToUser } = await import('../socket-server');\n      if (io) {\n        console.log('[ADMIN] Emitting Socket.IO new_message event to user:', targetUserId);\n\n        // Emit new_message event (what inbox listens for)\n        const socketMessage = {\n          id: dbMessage.id,\n          conversationId: `conv_${[adminAddress, targetUserId].sort().join('_')}`,\n          senderId: adminAddress,\n          recipientId: targetUserId,\n          content: message,\n          createdAt: dbMessage.createdAt?.toISOString() || new Date().toISOString(),\n          read: false\n        };\n\n        const conversationUpdate = {\n          id: socketMessage.conversationId,\n          participants: [adminAddress, targetUserId].sort(),\n          lastMessage: socketMessage,\n          updatedAt: socketMessage.createdAt,\n          unreadCount: 1\n        };\n\n        // Emit to all possible user identifier rooms to ensure delivery\n        const roomsToEmit = [targetUserId.toLowerCase()];\n\n        // Add wallet address and Privy ID if available from recipientInfo\n        if (recipientInfo) {\n          if (recipientInfo.address && !roomsToEmit.includes(recipientInfo.address.toLowerCase())) {\n            roomsToEmit.push(recipientInfo.address.toLowerCase());\n          }\n          if (recipientInfo.privyId && !roomsToEmit.includes(recipientInfo.privyId.toLowerCase())) {\n            roomsToEmit.push(recipientInfo.privyId.toLowerCase());\n          }\n          if (recipientInfo.walletAddress && !roomsToEmit.includes(recipientInfo.walletAddress.toLowerCase())) {\n            roomsToEmit.push(recipientInfo.walletAddress.toLowerCase());\n          }\n        }\n\n        // Emit to all rooms\n        roomsToEmit.forEach(room => {\n          io.to(room).emit('new_message', socketMessage);\n          io.to(room).emit('conversation_updated', conversationUpdate);\n        });\n\n        console.log(`[ADMIN] Socket.IO message events emitted to rooms: ${roomsToEmit.join(', ')}`);\n      } else {\n        console.warn('[ADMIN] Socket.IO not available');\n      }\n\n      console.log('[ADMIN] Direct message sent successfully to:', isEmail ? `email user ${recipientAddress}` : `wallet ${recipientAddress}`);\n      res.json({\n        success: true,\n        recipientType: isEmail ? 'email' : 'wallet',\n        recipientId: targetUserId,\n        messageId: dbMessage.id\n      });\n    } catch (error) {\n      console.error('[ADMIN] Send message error:', error);\n      res.status(500).json({ error: 'Failed to send message' });\n    }\n  });\n\n  // Broadcast message to all users\n  router.post('/broadcast-message', requireAdmin, async (req, res) => {\n    try {\n      const { message } = req.body;\n\n      console.log('[ADMIN] Broadcasting message to all users:', message);\n\n      if (!message) {\n        return res.status(400).json({ error: 'Message required' });\n      }\n\n      // Get all users from both tables\n      const allCreators = await storage.getAllCreators();\n      const allUsers = await storage.getAllUsers();\n\n      // Combine and deduplicate by address\n      const addressSet = new Set<string>();\n      const allRecipients: string[] = [];\n\n      allCreators.forEach(c => {\n        if (c.address && !addressSet.has(c.address.toLowerCase())) {\n          addressSet.add(c.address.toLowerCase());\n          allRecipients.push(c.address.toLowerCase());\n        }\n      });\n\n      allUsers.forEach(u => {\n        if (u.walletAddress && !addressSet.has(u.walletAddress.toLowerCase())) {\n          addressSet.add(u.walletAddress.toLowerCase());\n          allRecipients.push(u.walletAddress.toLowerCase());\n        }\n      });\n\n      console.log(`[ADMIN] Sending to ${allRecipients.length} unique users`);\n\n      let successCount = 0;\n      for (const recipientAddress of allRecipients) {\n        try {\n          await storage.createNotification({\n            userId: recipientAddress,\n            type: 'admin',\n            title: 'üì¢ Announcement from Creatorland',\n            message: message,\n            metadata: { isBroadcast: true },\n            read: false,\n            createdAt: new Date(),\n          });\n          successCount++;\n        } catch (error) {\n          console.error(`[ADMIN] Failed to send to ${recipientAddress}:`, error);\n        }\n      }\n\n      // Emit Socket.IO event for real-time broadcast to all user rooms\n      if (io) {\n        console.log('[ADMIN] Emitting broadcast via Socket.IO to all user rooms');\n        const broadcastData = {\n          message: message,\n          timestamp: new Date().toISOString(),\n        };\n\n        // Send to each user's room individually for better delivery\n        allRecipients.forEach(recipientAddress => {\n          // Normalize to lowercase to match room join convention\n          io.to(recipientAddress.toLowerCase()).emit('admin_broadcast', broadcastData);\n        });\n\n        // Also send globally for any connected clients\n        io.emit('admin_broadcast', broadcastData);\n        console.log(`[ADMIN] Broadcast emitted to ${allRecipients.length} user rooms`);\n      } else {\n        console.warn('[ADMIN] Socket.IO not available');\n      }\n\n      console.log(`[ADMIN] Broadcast complete: ${successCount}/${allRecipients.length} notifications created`);\n      res.json({ success: true, successCount, total: allRecipients.length });\n    } catch (error) {\n      console.error('[ADMIN] Broadcast error:', error);\n      res.status(500).json({ error: 'Failed to broadcast message' });\n    }\n  });\n\n  return router;\n}","size_bytes":41375},"server/db.ts":{"content":"\nimport { drizzle } from 'drizzle-orm/node-postgres';\nimport pkg from 'pg';\nconst { Pool } = pkg;\nimport * as schema from '@shared/schema';\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: { rejectUnauthorized: false }\n});\n\nexport const db = drizzle(pool, { schema });\n","size_bytes":431},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/pages/coins.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { CoinCard } from \"@/components/coin-card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Coins } from \"lucide-react\";\nimport TradeModalMobile from \"@/components/trade-modal-mobile\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { useLocation } from \"wouter\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\ntype ZoraCoin = {\n  id: string;\n  name: string;\n  symbol: string;\n  address: string;\n  image?: string;\n  marketCap?: string;\n  volume24h?: string;\n  holders?: number;\n  creator?: string;\n  createdAt?: string;\n  category?: string;\n  platform?: string;\n  creator_wallet?: string;\n  metadata?: any;\n};\n\nexport default function CoinsPage() {\n  const [selectedCoin, setSelectedCoin] = useState<ZoraCoin | null>(null);\n  const [isTradeModalOpen, setIsTradeModalOpen] = useState(false);\n  const isMobile = useIsMobile();\n  const [, setLocation] = useLocation();\n\n  // Fetch pinned coins\n  const { data: pinnedCoinsData, isLoading: isLoadingPinned } = useQuery({\n    queryKey: [\"/api/coins/pinned\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/coins/pinned?_=\" + Date.now());\n      if (!response.ok) throw new Error(\"Failed to fetch pinned coins\");\n      const data = await response.json();\n      console.log(\"Pinned coins API response:\", data);\n      console.log(\"Type of response:\", typeof data, Array.isArray(data));\n      return data;\n    },\n    staleTime: 0,\n    refetchOnMount: true,\n  });\n\n  // Fetch platform coins (from database)\n  const { data: coinsData, isLoading: isLoadingCoins } = useQuery({\n    queryKey: [\"/api/coins\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/coins\");\n      if (!response.ok) throw new Error(\"Failed to fetch coins\");\n      return response.json();\n    },\n  });\n\n  // Convert pinned coins to ZoraCoin format (limit to 6)\n  const pinnedCoins: ZoraCoin[] = useMemo(() => {\n    if (!pinnedCoinsData || isLoadingPinned) return [];\n    \n    const rawCoins = Array.isArray(pinnedCoinsData) ? pinnedCoinsData : [];\n    console.log(\"Processing pinned coins:\", rawCoins.length);\n    \n    return rawCoins.slice(0, 6).map((coin: any) => {\n      console.log(\"Mapping pinned coin:\", {\n        name: coin.name,\n        address: coin.address,\n        pinOrder: coin.pin_order || coin.pinOrder\n      });\n      \n      return {\n        id: coin.id || coin.address,\n        name: coin.name || \"Unnamed Coin\",\n        symbol: coin.symbol || \"???\",\n        address: coin.address,\n        image: coin.image,\n        marketCap: coin.market_cap || coin.marketCap || \"0\",\n        volume24h: coin.volume_24h || coin.volume24h || \"0\",\n        holders: coin.holders || 0,\n        creator: coin.creator_wallet || coin.creatorWallet || coin.creator,\n        createdAt: coin.created_at || coin.createdAt,\n        category: \"Platform\",\n        platform: \"platform\",\n        creator_wallet: coin.creator_wallet || coin.creatorWallet || coin.creator,\n        metadata: coin,\n      };\n    });\n  }, [pinnedCoinsData, isLoadingPinned]);\n\n  console.log(\"Final pinned coins count:\", pinnedCoins.length);\n  if (pinnedCoins.length > 0) {\n    console.log(\"First pinned coin:\", pinnedCoins[0]);\n  }\n\n  const regularCoins: ZoraCoin[] = Array.isArray(coinsData) ? coinsData.map((coin: any) => ({\n    id: coin.id || coin.coin_address,\n    name: coin.name || \"Unnamed Coin\",\n    symbol: coin.symbol || \"???\",\n    address: coin.coin_address,\n    image: coin.metadata?.image,\n    marketCap: \"0\",\n    volume24h: \"0\",\n    holders: 0,\n    creator: coin.creator_wallet,\n    createdAt: coin.created_at,\n    category: \"Platform\",\n    platform: coin.metadata?.platform || \"platform\",\n    creator_wallet: coin.creator_wallet,\n    metadata: coin.metadata,\n  })) : [];\n\n  // Filter out any regular coins that are also pinned (to avoid duplicates)\n  const pinnedAddresses = new Set(pinnedCoins.map(c => c.address));\n  const filteredRegularCoins = regularCoins.filter(c => !pinnedAddresses.has(c.address));\n\n  // Combine pinned coins at the top (max 6) with regular coins\n  const coins: ZoraCoin[] = [...pinnedCoins, ...filteredRegularCoins];\n  \n  console.log(\"Total coins count:\", coins.length);\n  console.log(\"First 6 coins platforms:\", coins.slice(0, 6).map(c => c.platform));\n\n  const openTradeModal = (coin: ZoraCoin) => {\n    if (isMobile) {\n      setSelectedCoin(coin);\n      setIsTradeModalOpen(true);\n    } else {\n      setLocation(`/coin/${coin.address}`);\n    }\n  };\n\n  return (\n    <div className=\"container max-w-5xl mx-auto px-4 py-8 space-y-8\">\n      <div className=\"flex items-center gap-2\">\n        <Coins className=\"h-8 w-8 text-primary\" />\n        <h1 className=\"text-4xl font-bold\">Explore Coins</h1>\n      </div>\n\n      \n\n      {/* Coins Grid */}\n      {(isLoadingCoins || isLoadingPinned) ? (\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-1\">\n          {[...Array(24)].map((_, i) => (\n            <Skeleton\n              key={i}\n              className=\"h-64 w-full rounded-2xl\"\n            />\n          ))}\n        </div>\n      ) : coins.length > 0 ? (\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-1\">\n          {coins.map((coin) => (\n            <CoinCard\n              key={coin.id}\n              coin={coin}\n              onClick={() => openTradeModal(coin)}\n            />\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-16\">\n          <Coins className=\"w-16 h-16 text-muted-foreground mx-auto mb-4\" />\n          <h3 className=\"text-xl font-bold mb-2\">No coins found</h3>\n          <p className=\"text-muted-foreground\">\n            Try selecting a different category\n          </p>\n        </div>\n      )}\n\n      {/* Trade Modal - Mobile only */}\n      {selectedCoin && isMobile && (\n        <TradeModalMobile\n          coin={selectedCoin}\n          open={isTradeModalOpen}\n          onOpenChange={setIsTradeModalOpen}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":6057},"client/src/lib/wagmi.ts":{"content":"import { getDefaultConfig } from '@rainbow-me/rainbowkit';\nimport { http } from 'wagmi';\nimport { base, baseSepolia } from 'wagmi/chains';\n\n// WalletConnect project ID - will be set via environment variable\nconst projectId = import.meta.env.VITE_WALLETCONNECT_PROJECT_ID || '';\n\nif (!projectId) {\n  console.warn('VITE_WALLETCONNECT_PROJECT_ID not set. Get one at https://cloud.walletconnect.com');\n}\n\nexport const config = getDefaultConfig({\n  appName: 'CoinIT',\n  projectId: projectId || 'demo-project-id', // Fallback for development\n  chains: [base, baseSepolia],\n  transports: {\n    [base.id]: http(),\n    [baseSepolia.id]: http(),\n  },\n  ssr: false,\n});\n","size_bytes":659},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-3 overflow-hidden rounded-xl border p-3 pr-6 shadow-lg backdrop-blur-sm transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border-border/50 bg-background/95 text-foreground\",\n        destructive:\n          \"destructive group border-destructive/50 bg-destructive/95 text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-1.5 top-1.5 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground hover:bg-accent/50 focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-3.5 w-3.5\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-bold leading-snug\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-xs opacity-80 leading-relaxed mt-0.5\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4940},"client/src/components/trade-modal-mobile.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport type { Coin, Comment } from \"@shared/schema\";\nimport { useAccount, usePublicClient, useWalletClient } from \"wagmi\";\nimport { formatEther } from \"viem\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { getCoin, getCoinHolders } from \"@zoralabs/coins-sdk\";\nimport { base } from \"viem/chains\";\nimport { Drawer, DrawerContent, DrawerHeader, DrawerTitle, DrawerClose } from \"@/components/ui/drawer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Loader2, \n  CheckCircle2, \n  ExternalLink, \n  MessageCircle, \n  Coins, \n  Users, \n  ActivityIcon,\n  TrendingUp,\n  Copy,\n  Check,\n  X,\n  Info\n} from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { formatSmartCurrency } from \"@/lib/utils\";\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from \"recharts\";\n\ntype CoinProp = {\n  id: string;\n  name: string;\n  symbol: string;\n  address: string;\n  image?: string;\n  marketCap?: string;\n  volume24h?: string;\n  holders?: number;\n  creator?: string;\n  createdAt?: string;\n  category?: string;\n  platform?: string;\n  creator_wallet?: string;\n  metadata?: any;\n  type?: string;\n};\n\ninterface MobileTradeModalProps {\n  coin: CoinProp;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport default function MobileTradeModal({ coin, open, onOpenChange }: MobileTradeModalProps) {\n  const { toast } = useToast();\n  const [ethAmount, setEthAmount] = useState(\"0.001\");\n  const [isTrading, setIsTrading] = useState(false);\n  const [txHash, setTxHash] = useState<string | null>(null);\n  const [isBuying, setIsBuying] = useState(true);\n  const [standaloneComment, setStandaloneComment] = useState(\"\");\n  const [balance, setBalance] = useState<string>(\"0\");\n  const [marketCap, setMarketCap] = useState<string | null>(null);\n  const [volume24h, setVolume24h] = useState<string | null>(null);\n  const [creatorEarnings, setCreatorEarnings] = useState<string | null>(null);\n  const [coinImage, setCoinImage] = useState<string | null>(null);\n  const [holders, setHolders] = useState<Array<{\n    address: string;\n    balance: string;\n    percentage: number;\n    profile?: string | null;\n  }>>([]);\n  const [chartData, setChartData] = useState<Array<{ time: string; price: number }>>([]);\n  const [copiedAddress, setCopiedAddress] = useState(false);\n  const [totalSupply, setTotalSupply] = useState<string | null>(null);\n  const [priceChange24h, setPriceChange24h] = useState<number>(0);\n  const [currentPrice, setCurrentPrice] = useState<string | null>(null);\n\n  const { address, isConnected } = useAccount();\n  const { data: walletClient } = useWalletClient();\n  const publicClient = usePublicClient();\n\n  const { data: comments = [] } = useQuery<Comment[]>({\n    queryKey: ['/api/comments/coin', coin.address],\n    queryFn: async () => {\n      const response = await fetch(`/api/comments/coin/${coin.address}`, {\n        credentials: 'include'\n      });\n      if (!response.ok) throw new Error('Failed to fetch comments');\n      return response.json();\n    },\n    enabled: open && !!coin.address,\n  });\n\n  const createCommentMutation = useMutation({\n    mutationFn: async (commentData: { coinAddress: string; userAddress: string; comment: string; transactionHash?: string }) => {\n      return await apiRequest('POST', '/api/comments', commentData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/comments/coin', coin.address] });\n    },\n  });\n\n  const handleStandaloneComment = async () => {\n    if (!isConnected || !address || !coin.address || !standaloneComment.trim()) return;\n\n    try {\n      await createCommentMutation.mutateAsync({\n        coinAddress: coin.address,\n        userAddress: address,\n        comment: standaloneComment.trim(),\n      });\n      setStandaloneComment(\"\");\n      toast({ title: \"Comment added\", description: \"Your comment has been posted\" });\n    } catch (error) {\n      console.error('Failed to post comment:', error);\n      toast({ title: \"Failed to post comment\", variant: \"destructive\" });\n    }\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    setCopiedAddress(true);\n    setTimeout(() => setCopiedAddress(false), 2000);\n  };\n\n  useEffect(() => {\n    async function fetchBalance() {\n      if (!address || !publicClient) return;\n      try {\n        const bal = await publicClient.getBalance({ address });\n        setBalance(formatEther(bal));\n      } catch (error) {\n        console.error(\"Error fetching balance:\", error);\n      }\n    }\n    if (isConnected && open) fetchBalance();\n  }, [address, isConnected, publicClient, open]);\n\n  useEffect(() => {\n    async function fetchCoinStats() {\n      if (!coin.address) return;\n      try {\n        const response = await getCoin({\n          address: coin.address as `0x${string}`,\n          chain: base.id,\n        });\n\n        const coinData = response.data?.zora20Token;\n        if (coinData) {\n          // Market Cap\n          if (coinData.marketCap !== null && coinData.marketCap !== undefined) {\n            const mcValue = typeof coinData.marketCap === 'string' ? parseFloat(coinData.marketCap) : coinData.marketCap;\n            setMarketCap(mcValue.toFixed(2));\n          }\n          \n          // Volume 24h\n          if (coinData.volume24h !== null && coinData.volume24h !== undefined) {\n            const volValue = typeof coinData.volume24h === 'string' ? parseFloat(coinData.volume24h) : coinData.volume24h;\n            setVolume24h(volValue.toString());\n            setCreatorEarnings((volValue * 0.005).toString());\n          }\n          \n          // Total Supply\n          if (coinData.totalSupply) {\n            setTotalSupply(coinData.totalSupply);\n          }\n          \n          // Current Price\n          if (coinData.price) {\n            const price = typeof coinData.price === 'string' ? parseFloat(coinData.price) : coinData.price;\n            setCurrentPrice(coinData.price);\n            \n            // Generate realistic chart data based on current price\n            const now = Date.now();\n            const hourInMs = 60 * 60 * 1000;\n            const data = [];\n            \n            for (let i = 23; i >= 0; i--) {\n              const time = new Date(now - i * hourInMs);\n              const variance = (Math.random() - 0.5) * 0.1; // ¬±10% variance\n              const pricePoint = price * (1 + variance);\n              data.push({\n                time: time.toLocaleTimeString('en-US', { hour: 'numeric', hour12: true }),\n                price: parseFloat(pricePoint.toFixed(6))\n              });\n            }\n            setChartData(data);\n          }\n          \n          // Price Change 24h\n          if (coinData.priceChange24h !== null && coinData.priceChange24h !== undefined) {\n            setPriceChange24h(typeof coinData.priceChange24h === 'string' \n              ? parseFloat(coinData.priceChange24h) \n              : coinData.priceChange24h);\n          }\n          \n          // Coin Image\n          if (coinData.mediaContent?.previewImage) {\n            const previewImage = coinData.mediaContent.previewImage as any;\n            setCoinImage(previewImage.medium || previewImage.small || null);\n          }\n        }\n\n        const holdersResponse = await getCoinHolders({\n          chainId: base.id,\n          address: coin.address as `0x${string}`,\n          count: 20,\n        });\n\n        const holderBalances = holdersResponse.data?.zora20Token?.tokenBalances?.edges || [];\n        const supply = parseFloat(coinData?.totalSupply || \"0\");\n\n        if (holderBalances.length > 0 && supply > 0) {\n          const processedHolders = holderBalances.map((edge: any) => {\n            const balance = parseFloat(edge.node.balance || \"0\");\n            return {\n              address: edge.node.ownerAddress,\n              balance: edge.node.balance,\n              percentage: (balance / supply) * 100,\n              profile: edge.node.ownerProfile?.handle || null,\n            };\n          });\n          setHolders(processedHolders);\n        }\n      } catch (error) {\n        console.error(\"Error fetching coin stats:\", error);\n      }\n    }\n    if (open) fetchCoinStats();\n  }, [coin.address, open]);\n\n  const handleTrade = async () => {\n    if (!isConnected || !address || !walletClient || !publicClient) {\n      toast({ title: \"Wallet not connected\", description: \"Please connect your wallet first\", variant: \"destructive\" });\n      return;\n    }\n\n    const ethAmountNum = parseFloat(ethAmount);\n    if (!ethAmount || ethAmountNum <= 0) {\n      toast({ title: \"Invalid amount\", description: \"Please enter a valid ETH amount\", variant: \"destructive\" });\n      return;\n    }\n\n    setIsTrading(true);\n    try {\n      const { tradeZoraCoin } = await import(\"@/lib/zora\");\n      const result = await tradeZoraCoin({\n        coinAddress: coin.address as `0x${string}`,\n        ethAmount,\n        walletClient,\n        publicClient,\n        userAddress: address,\n        isBuying,\n      });\n\n      if (result?.hash) {\n        setTxHash(result.hash);\n        toast({ title: \"Trade successful!\", description: `You ${isBuying ? 'bought' : 'sold'} ${coin.symbol} tokens` });\n        const newBal = await publicClient.getBalance({ address });\n        setBalance(formatEther(newBal));\n      }\n    } catch (error) {\n      console.error(\"Trade failed:\", error);\n      toast({ title: \"Trade failed\", description: error instanceof Error ? error.message : \"Trade failed\", variant: \"destructive\" });\n    } finally {\n      setIsTrading(false);\n    }\n  };\n\n  const formatAddress = (address?: string) => {\n    if (!address) return 'Unknown';\n    return `${address.slice(0, 6)}...${address.slice(-4)}`;\n  };\n\n  const setQuickAmount = (amount: string) => {\n    if (amount === 'Max') {\n      setEthAmount((parseFloat(balance) * 0.9).toFixed(6));\n    } else {\n      setEthAmount(amount);\n    }\n  };\n\n  const displayImage = coinImage || coin?.image || coin?.metadata?.image;\n\n  return (\n    <Drawer open={open} onOpenChange={onOpenChange}>\n      <DrawerContent className=\"max-h-[85vh] bg-background border-none\">\n        {/* Simplified Header */}\n        <div className=\"sticky top-0 z-10 bg-background border-b border-border/30\">\n          <DrawerHeader className=\"px-3 py-2\">\n            <div className=\"flex items-center justify-between\">\n              <DrawerTitle className=\"text-base font-bold flex items-center gap-2\">\n                {coin.name}\n                <span className=\"text-xs font-normal text-muted-foreground\">@{coin.symbol}</span>\n              </DrawerTitle>\n              <DrawerClose asChild>\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\">\n                  <X className=\"h-3.5 w-3.5\" />\n                </Button>\n              </DrawerClose>\n            </div>\n          </DrawerHeader>\n        </div>\n\n        {/* Tabs */}\n        <Tabs defaultValue=\"trade\" className=\"flex-1 flex flex-col overflow-hidden\">\n          <TabsList className=\"w-full grid grid-cols-5 px-3 bg-transparent border-b border-border/20 h-9 rounded-none\">\n            <TabsTrigger value=\"trade\" className=\"text-xs data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:bg-transparent rounded-none\">Trade</TabsTrigger>\n            <TabsTrigger value=\"chart\" className=\"text-xs data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:bg-transparent rounded-none\">Chart</TabsTrigger>\n            <TabsTrigger value=\"comments\" className=\"text-xs data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:bg-transparent rounded-none\">Chat</TabsTrigger>\n            <TabsTrigger value=\"holders\" className=\"text-xs data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:bg-transparent rounded-none\">Holders</TabsTrigger>\n            <TabsTrigger value=\"details\" className=\"text-xs data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:bg-transparent rounded-none\">Info</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"trade\" className=\"flex-1 px-3 pb-3 overflow-y-auto mt-0 h-[320px]\">\n            <div className=\"space-y-2.5 pt-2\">\n              {/* Buy/Sell Toggle */}\n              <div className=\"grid grid-cols-2 gap-2\">\n                <Button\n                  onClick={() => setIsBuying(true)}\n                  className={`h-10 ${isBuying ? 'bg-green-500 hover:bg-green-600' : 'bg-muted/20 hover:bg-muted/30 text-muted-foreground'}`}\n                  disabled={isTrading || !!txHash}\n                >\n                  <span className=\"text-sm font-semibold\">Buy</span>\n                </Button>\n                <Button\n                  onClick={() => setIsBuying(false)}\n                  className={`h-10 ${!isBuying ? 'bg-red-500 hover:bg-red-600' : 'bg-muted/20 hover:bg-muted/30 text-muted-foreground'}`}\n                  disabled={isTrading || !!txHash}\n                >\n                  <span className=\"text-sm font-semibold\">Sell</span>\n                </Button>\n              </div>\n\n              {/* Amount Input */}\n              <div>\n                <Input\n                  type=\"number\"\n                  value={ethAmount}\n                  onChange={(e) => setEthAmount(e.target.value)}\n                  className=\"h-11 text-base bg-muted/20\"\n                  placeholder=\"Amount in ETH\"\n                  disabled={isTrading || !!txHash}\n                />\n                <p className=\"text-[10px] text-muted-foreground mt-1 px-1\">\n                  Balance: {parseFloat(balance).toFixed(4)} ETH\n                </p>\n              </div>\n\n              {/* Quick Amount Buttons */}\n              <div className=\"grid grid-cols-4 gap-1.5\">\n                {['0.001', '0.01', '0.1', 'Max'].map((label) => (\n                  <Button\n                    key={label}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setQuickAmount(label)}\n                    disabled={isTrading || !!txHash}\n                    className=\"h-7 text-xs\"\n                  >\n                    {label}\n                  </Button>\n                ))}\n              </div>\n\n              {/* Trade Button */}\n              <Button\n                onClick={handleTrade}\n                disabled={isTrading || !isConnected || !!txHash}\n                className=\"w-full h-11 text-sm font-semibold\"\n              >\n                {isTrading ? (\n                  <>\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Trading...\n                  </>\n                ) : (\n                  `${isBuying ? 'Buy' : 'Sell'} ${coin.symbol}`\n                )}\n              </Button>\n\n              {/* Success Message */}\n              {txHash && (\n                <div className=\"p-3 bg-green-500/10 rounded-lg\">\n                  <div className=\"flex items-center gap-2 mb-1.5\">\n                    <CheckCircle2 className=\"w-4 h-4 text-green-500\" />\n                    <span className=\"text-sm font-semibold text-green-500\">Trade Successful!</span>\n                  </div>\n                  <a\n                    href={`https://basescan.org/tx/${txHash}`}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"text-xs text-primary flex items-center gap-1 hover:underline\"\n                  >\n                    View on BaseScan\n                    <ExternalLink className=\"w-3 h-3\" />\n                  </a>\n                </div>\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"chart\" className=\"flex-1 px-3 pb-3 overflow-y-auto mt-0 h-[320px]\">\n            <div className=\"space-y-2 pt-2\">\n              {/* Price Info - Compact */}\n              <div className=\"flex items-baseline justify-between px-1\">\n                <p className=\"text-xl font-bold\">{currentPrice ? `$${parseFloat(currentPrice).toFixed(6)}` : 'N/A'}</p>\n                {priceChange24h !== 0 && (\n                  <span className={`text-sm font-semibold ${priceChange24h > 0 ? 'text-green-500' : 'text-red-500'}`}>\n                    {priceChange24h > 0 ? '+' : ''}{priceChange24h.toFixed(2)}%\n                  </span>\n                )}\n              </div>\n\n              {/* Chart */}\n              {chartData.length > 0 ? (\n                <div className=\"w-full h-[240px] rounded-lg\">\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <LineChart data={chartData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border))\" opacity={0.2} />\n                      <XAxis \n                        dataKey=\"time\" \n                        tick={{ fontSize: 9, fill: 'hsl(var(--muted-foreground))' }}\n                        stroke=\"hsl(var(--border))\"\n                      />\n                      <YAxis \n                        tick={{ fontSize: 9, fill: 'hsl(var(--muted-foreground))' }}\n                        stroke=\"hsl(var(--border))\"\n                        domain={['auto', 'auto']}\n                      />\n                      <Tooltip \n                        contentStyle={{ \n                          backgroundColor: 'hsl(var(--background))', \n                          border: '1px solid hsl(var(--border))',\n                          borderRadius: '6px',\n                          fontSize: '11px'\n                        }}\n                      />\n                      <Line \n                        type=\"monotone\" \n                        dataKey=\"price\" \n                        stroke=\"hsl(var(--primary))\" \n                        strokeWidth={2}\n                        dot={false}\n                      />\n                    </LineChart>\n                  </ResponsiveContainer>\n                </div>\n              ) : (\n                <div className=\"flex flex-col items-center justify-center h-[240px]\">\n                  <TrendingUp className=\"w-12 h-12 text-muted-foreground/20 mb-2\" />\n                  <p className=\"text-sm text-muted-foreground\">Loading chart...</p>\n                </div>\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"comments\" className=\"flex-1 px-3 pb-3 overflow-hidden mt-0 flex flex-col h-[320px]\">\n            <div className=\"flex gap-2 mb-2 pt-2\">\n              <Input\n                placeholder=\"Add a comment...\"\n                value={standaloneComment}\n                onChange={(e) => setStandaloneComment(e.target.value)}\n                className=\"flex-1 h-10 text-sm\"\n              />\n              <Button onClick={handleStandaloneComment} size=\"icon\" className=\"shrink-0 h-10 w-10\">\n                <MessageCircle className=\"w-4 h-4\" />\n              </Button>\n            </div>\n            \n            <ScrollArea className=\"flex-1\">\n              {comments.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {comments.map((c) => (\n                    <div key={c.id} className=\"p-2.5 bg-muted/10 rounded-lg\">\n                      <p className=\"text-[10px] font-medium text-muted-foreground mb-1\">{formatAddress(c.userAddress)}</p>\n                      <p className=\"text-sm\">{c.comment}</p>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"flex flex-col items-center justify-center h-full text-center py-12\">\n                  <MessageCircle className=\"w-12 h-12 text-muted-foreground/20 mb-2\" />\n                  <p className=\"text-sm text-muted-foreground\">No comments yet</p>\n                </div>\n              )}\n            </ScrollArea>\n          </TabsContent>\n\n          <TabsContent value=\"holders\" className=\"flex-1 px-3 pb-3 overflow-y-auto mt-0 h-[320px] pt-2\">\n            {holders.length > 0 ? (\n              <div className=\"space-y-1\">\n                {holders.map((holder, idx) => (\n                  <div key={holder.address} className=\"flex items-center justify-between p-2 bg-muted/10 rounded-lg\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-xs font-bold text-muted-foreground w-5\">#{idx + 1}</span>\n                      <div className=\"min-w-0\">\n                        <p className=\"text-xs font-medium truncate\">{holder.profile || formatAddress(holder.address)}</p>\n                      </div>\n                    </div>\n                    <p className=\"text-xs font-bold text-primary\">{holder.percentage.toFixed(1)}%</p>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"flex flex-col items-center justify-center h-full text-center py-8\">\n                <Users className=\"w-10 h-10 text-muted-foreground/20 mb-2\" />\n                <p className=\"text-xs text-muted-foreground\">No holders data</p>\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"details\" className=\"flex-1 px-3 pb-3 overflow-y-auto mt-0 h-[320px]\">\n            <div className=\"space-y-1 pt-2\">\n              <div className=\"flex items-center justify-between p-2 bg-muted/10 rounded-lg\">\n                <span className=\"text-xs text-muted-foreground\">Created</span>\n                <span className=\"text-xs font-medium\">{coin.createdAt ? new Date(coin.createdAt).toLocaleDateString() : 'Unknown'}</span>\n              </div>\n\n              <div className=\"flex items-center justify-between p-2 bg-muted/10 rounded-lg\">\n                <span className=\"text-xs text-muted-foreground\">Contract</span>\n                <div className=\"flex items-center gap-1.5\">\n                  <span className=\"text-xs font-mono\">{formatAddress(coin.address)}</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-6 w-6 p-0\"\n                    onClick={() => copyToClipboard(coin.address)}\n                  >\n                    {copiedAddress ? <Check className=\"w-3 h-3 text-green-500\" /> : <Copy className=\"w-3 h-3\" />}\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"flex items-center justify-between p-2 bg-muted/10 rounded-lg\">\n                <span className=\"text-xs text-muted-foreground\">Chain</span>\n                <span className=\"text-xs font-medium flex items-center gap-1.5\">\n                  <span className=\"w-1.5 h-1.5 rounded-full bg-blue-500\"></span>\n                  Base\n                </span>\n              </div>\n\n              <div className=\"flex items-center justify-between p-2 bg-muted/10 rounded-lg\">\n                <span className=\"text-xs text-muted-foreground\">Creator Fees</span>\n                <span className=\"text-xs font-medium\">{creatorEarnings ? formatSmartCurrency(parseFloat(creatorEarnings)) : '$0'}</span>\n              </div>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </DrawerContent>\n    </Drawer>\n  );\n}\n","size_bytes":23310},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/lib/zora-factory.ts":{"content":"import { createPublicClient, createWalletClient, http, type Address, type Hash, zeroAddress, parseUnits, encodeAbiParameters, parseAbiParameters, decodeEventLog } from \"viem\";\nimport { base, baseSepolia } from \"viem/chains\";\n\n// Zora Factory contract address (same on Base and Base Sepolia)\nconst ZORA_FACTORY_ADDRESS = \"0x777777751622c0d3258f214F9DF38E35BF45baF3\" as const;\n\n// Factory ABI - only the functions we need\nconst FACTORY_ABI = [\n  {\n    name: \"deploy\",\n    type: \"function\",\n    stateMutability: \"payable\",\n    inputs: [\n      { name: \"payoutRecipient\", type: \"address\" },\n      { name: \"owners\", type: \"address[]\" },\n      { name: \"uri\", type: \"string\" },\n      { name: \"name\", type: \"string\" },\n      { name: \"symbol\", type: \"string\" },\n      { name: \"poolConfig\", type: \"bytes\" },\n      { name: \"platformReferrer\", type: \"address\" },\n      { name: \"postDeployHook\", type: \"address\" },\n      { name: \"postDeployHookData\", type: \"bytes\" },\n      { name: \"coinSalt\", type: \"bytes32\" }\n    ],\n    outputs: [\n      { name: \"coin\", type: \"address\" },\n      { name: \"postDeployHookDataOut\", type: \"bytes\" }\n    ]\n  },\n  {\n    name: \"deployCreatorCoin\",\n    type: \"function\",\n    stateMutability: \"payable\",\n    inputs: [\n      { name: \"payoutRecipient\", type: \"address\" },\n      { name: \"owners\", type: \"address[]\" },\n      { name: \"uri\", type: \"string\" },\n      { name: \"name\", type: \"string\" },\n      { name: \"symbol\", type: \"string\" },\n      { name: \"poolConfig\", type: \"bytes\" },\n      { name: \"platformReferrer\", type: \"address\" },\n      { name: \"coinSalt\", type: \"bytes32\" }\n    ],\n    outputs: [\n      { name: \"coin\", type: \"address\" }\n    ]\n  },\n] as const;\n\n// PoolConfiguration Struct (from Zora's contract):\n// struct PoolConfiguration {\n//   uint8 version;\n//   uint16 numPositions;\n//   uint24 fee;\n//   int24 tickSpacing;\n//   uint16[] numDiscoveryPositions;\n//   int24[] tickLower;\n//   int24[] tickUpper;\n//   uint256[] maxDiscoverySupplyShare;\n// }\n\n// ZORA Token Address\nconst ZORA_ADDRESS = \"0x1111111111166b7fe7bd91427724b487980afc69\" as const;\n\n// Activity Tracker Contract ABI - for recording on-chain platform activities\nconst ACTIVITY_TRACKER_ABI = [\n  {\n    name: \"recordCoinCreation\",\n    type: \"function\",\n    stateMutability: \"nonpayable\",\n    inputs: [\n      { name: \"coin\", type: \"address\" },\n      { name: \"creator\", type: \"address\" },\n      { name: \"contentUrl\", type: \"string\" },\n      { name: \"coinName\", type: \"string\" },\n      { name: \"coinSymbol\", type: \"string\" }\n    ],\n    outputs: [\n      { name: \"activityId\", type: \"bytes32\" }\n    ]\n  }\n] as const;\n\n// Default pool configuration from Zora SDK (ZORA-paired coins)\n// Source: @zoralabs/coins-sdk/src/utils/poolConfigUtils.ts\n// These are the official default configs used by Zora for Creator Coins\n// This same configuration is used by successful coins like:\n// - balajis (0xcaf75598b8b9a6e645b60d882845d361f549f5ec)\n// - and thousands of other Creator Coins on Base\nconst COIN_ZORA_PAIR_LOWER_TICK = -138_000;\nconst COIN_ZORA_PAIR_UPPER_TICK = -81_000;\nconst COIN_ZORA_PAIR_NUM_DISCOVERY_POSITIONS = 11;\nconst COIN_ZORA_PAIR_MAX_DISCOVERY_SUPPLY_SHARE = parseUnits(\"0.05\", 18);\n\n// Encode the pool configuration for ZORA-paired Creator Coins\n// Based on successful transaction: 0x348d9a91b03a3a8e26e087b431b942dd36e989eb4e00ab8ae220f3346bc2a209\nfunction encodePoolConfig(): `0x${string}` {\n  const version = 4; // Version 4 is the current valid version (from working transactions)\n\n  return encodeAbiParameters(\n    parseAbiParameters('uint8, address, int24[], int24[], uint16[], uint256[]'),\n    [\n      version,                                         // version (uint8)\n      ZORA_ADDRESS,                                    // currency (address)\n      [COIN_ZORA_PAIR_LOWER_TICK],                    // tickLower (int24[])\n      [COIN_ZORA_PAIR_UPPER_TICK],                    // tickUpper (int24[])\n      [COIN_ZORA_PAIR_NUM_DISCOVERY_POSITIONS],       // numDiscoveryPositions (uint16[])\n      [COIN_ZORA_PAIR_MAX_DISCOVERY_SUPPLY_SHARE]     // maxDiscoverySupplyShare (uint256[])\n    ]\n  );\n}\n\n// Default pool config for ZORA-paired Creator Coins (most common type)\nconst DEFAULT_POOL_CONFIG = encodePoolConfig();\n\nexport interface DirectCoinParams {\n  name: string;\n  symbol: string;\n  metadataUri: string;\n  creatorAddress: Address;\n  platformReferrer?: Address;\n  manualPoolConfig?: `0x${string}`; // Optional: provide your own poolConfig\n  contentUrl?: string; // Optional: content URL for tracking\n  useActivityTracker?: boolean; // Optional: enable on-chain activity tracking\n}\n\nexport async function getWorkingPoolConfig(chainId: number = base.id): Promise<`0x${string}`> {\n  console.log(\"üîç Using ZORA-paired Creator Coin poolConfig\");\n  console.log(\"üìã Config parameters:\", {\n    version: 4,\n    currency: \"ZORA Token\",\n    lowerTick: COIN_ZORA_PAIR_LOWER_TICK,\n    upperTick: COIN_ZORA_PAIR_UPPER_TICK,\n    numPositions: COIN_ZORA_PAIR_NUM_DISCOVERY_POSITIONS,\n    maxSupplyShare: \"5%\"\n  });\n\n  return DEFAULT_POOL_CONFIG;\n}\n\n// Helper function to encode activity tracker hook data\n// Note: Zora factory passes coin and creator addresses separately to postDeploy\n// Hook data only needs contentUrl, coinName, coinSymbol\nfunction encodeActivityTrackerData(\n  contentUrl: string,\n  coinName: string,\n  coinSymbol: string\n): `0x${string}` {\n  return encodeAbiParameters(\n    parseAbiParameters('string, string, string'),\n    [contentUrl, coinName, coinSymbol]\n  );\n}\n\nexport async function deployCreatorCoinDirect(\n  params: DirectCoinParams,\n  walletClient: any,\n  chainId: number = base.id\n): Promise<{ hash: Hash; address: Address; createdAt: string }> {\n\n  const chain = chainId === baseSepolia.id ? baseSepolia : base;\n  const alchemyApiKey = import.meta.env.VITE_ALCHEMY_API_KEY || \"o3VW3WRXrsXXMRX3l7jZxLUqhWyZzXBy\";\n  const rpcUrl = `https://base-mainnet.g.alchemy.com/v2/${alchemyApiKey}`;\n\n  const publicClient = createPublicClient({\n    chain,\n    transport: http(rpcUrl),\n  });\n\n  // Get working poolConfig (use manual if provided, otherwise use empty to trigger factory defaults)\n  let poolConfig: `0x${string}`;\n\n  if (params.manualPoolConfig) {\n    console.log(\"‚úì Using manually provided poolConfig:\", params.manualPoolConfig);\n    poolConfig = params.manualPoolConfig;\n  } else {\n    console.log(\"üîÑ Using default poolConfig (version 4, ZORA-paired)...\");\n    poolConfig = await getWorkingPoolConfig(chainId);\n  }\n\n  console.log(\"üìã Final poolConfig to use:\", {\n    hex: poolConfig,\n    length: poolConfig.length,\n    isValid: poolConfig.startsWith('0x') && poolConfig.length > 2,\n    source: params.manualPoolConfig ? 'manual' : 'default'\n  });\n\n  // Admin platform referral (20% of fees)\n  const platformReferrer = params.platformReferrer || \n    import.meta.env.VITE_ADMIN_REFERRAL_ADDRESS || \n    \"0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7\";\n\n  console.log(\"üí∞ Platform referrer address:\", platformReferrer);\n\n  // Generate unique salt for deterministic deployment\n  const salt = `0x${Date.now().toString(16).padStart(64, '0')}` as `0x${string}`;\n  console.log(\"üßÇ Generated salt:\", salt);\n\n  // Check if activity tracker is enabled and get its address\n  // The activityTrackerAddress is determined based on chainId for Sepolia and a placeholder for mainnet.\n  // If useActivityTracker is false, it defaults to the zero address.\n  const activityTrackerAddress = params.useActivityTracker \n    ? (chainId === baseSepolia.id \n        ? \"0x71875350bD4fC5ACF47c4d3d19AEAa1023A63057\" as Address \n        : \"0x000000000000000000000000000000000000dEaD\" as Address) // Placeholder for mainnet\n    : \"0x0000000000000000000000000000000000000000\" as Address;\n\n  // Encode hook data if activity tracker is enabled and not using the zero address placeholder\n  const hookData = params.useActivityTracker && activityTrackerAddress !== \"0x0000000000000000000000000000000000000000\"\n    ? encodeActivityTrackerData(\n        params.contentUrl || params.metadataUri, // Use contentUrl if provided, otherwise metadataUri\n        params.name,\n        params.symbol\n      )\n    : \"0x\" as `0x${string}`; // Default to empty bytes if no tracker or placeholder\n\n  if (params.useActivityTracker) {\n    console.log(\"üìä On-chain activity tracking:\", activityTrackerAddress !== \"0x0000000000000000000000000000000000000000\" ? \"ENABLED\" : \"DISABLED (using placeholder/zero address)\");\n    console.log(\"üìç Post-deploy hook address:\", activityTrackerAddress);\n  }\n\n  try {\n    let hash: Hash;\n\n    // Always use deploy() function for consistency (supports hooks)\n    console.log(\"üîß Simulating deployment with deploy() function\");\n\n    const { request } = await publicClient.simulateContract({\n      address: ZORA_FACTORY_ADDRESS,\n      abi: FACTORY_ABI,\n      functionName: \"deploy\",\n      args: [\n        params.creatorAddress, // payoutRecipient\n        [params.creatorAddress], // owners\n        params.metadataUri, // uri\n        params.name, // name\n        params.symbol, // symbol\n        poolConfig, // poolConfig\n        platformReferrer as Address, // platformReferrer\n        activityTrackerAddress, // postDeployHook\n        hookData, // postDeployHookData\n        salt // coinSalt\n      ],\n      account: params.creatorAddress,\n    });\n\n    console.log(\"‚úÖ Contract simulation successful\");\n    hash = await walletClient.writeContract(request);\n    console.log(\"‚úÖ Transaction sent! Hash:\", hash);\n\n    // Wait for transaction\n    console.log(\"‚è≥ Waiting for transaction confirmation...\");\n    const receipt = await publicClient.waitForTransactionReceipt({ hash });\n    console.log(\"‚úÖ Transaction confirmed! Receipt:\", receipt);\n\n    // Decode the coin creation event to extract the deployed coin address\n    // The deploy() function supports both CreatorCoinCreated and CoinCreatedV4 events\n    let coinAddress: Address | undefined;\n\n    for (const log of receipt.logs) {\n      try {\n        const decodedLog = decodeEventLog({\n          abi: FACTORY_ABI,\n          data: log.data,\n          topics: log.topics,\n        });\n\n        // Check for both event types (CreatorCoinCreated and CoinCreatedV4)\n        if (decodedLog.eventName === \"CreatorCoinCreated\" || decodedLog.eventName === \"CoinCreatedV4\") {\n          coinAddress = (decodedLog.args as any).coin;\n          console.log(`‚úÖ Decoded ${decodedLog.eventName} event`);\n          console.log(\"üìç Deployed coin address:\", coinAddress);\n          break;\n        }\n      } catch (error) {\n        continue;\n      }\n    }\n\n    if (!coinAddress) {\n      throw new Error(\"Could not find coin address in transaction logs.\");\n    }\n\n    console.log(\"‚úÖ Coin deployed successfully:\", coinAddress);\n\n    // Get the blockchain timestamp from the transaction receipt\n    const block = await publicClient.getBlock({ \n      blockNumber: receipt.blockNumber \n    });\n    const createdAt = new Date(Number(block.timestamp) * 1000).toISOString();\n\n    return {\n      hash,\n      address: coinAddress,\n      createdAt // Include the blockchain timestamp\n    };\n  } catch (error) {\n    console.error(\"‚ùå Contract call failed:\", error);\n    if (error instanceof Error) {\n      console.error(\"Error message:\", error.message);\n      console.error(\"Error stack:\", error.stack);\n    }\n    throw error;\n  }\n}","size_bytes":11290},"server/points.ts":{"content":"import { db } from \"./db\";\nimport { users, pointsTransactions, referrals } from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\nimport { storage } from './supabase-storage';\nimport { sendTelegramNotification } from './telegram-bot';\nimport { notificationService } from './notification-service';\nimport type { Reward, Creator, Coin } from '@shared/schema';\n\nexport const POINTS_REWARDS = {\n  DAILY_LOGIN: 10,\n  DAILY_STREAK_3: 25,\n  DAILY_STREAK_7: 50,\n  DAILY_STREAK_30: 200,\n  TRADE_BUY: 5,\n  TRADE_SELL: 5,\n  CREATE_COIN: 100,\n  IMPORT_COIN: 50,\n  REFERRAL_SIGNUP: 500,\n  REFERRAL_FIRST_TRADE: 250,\n  REFERRAL_BONUS_MULTIPLIER: 2, // Double points for active referrals\n  PROFILE_COMPLETE: 30,\n  FIRST_CONNECTION: 20,\n  JOIN_GROUP: 15,\n};\n\nexport const BADGES = {\n  NEWCOMER: { name: \"Newcomer\", threshold: 0, icon: \"üå±\", description: \"Welcome to the platform!\" },\n  EXPLORER: { name: \"Explorer\", threshold: 100, icon: \"üîç\", description: \"Earned 100 E1XP points\" },\n  TRADER: { name: \"Trader\", threshold: 500, icon: \"üíé\", description: \"Made your first trade\" },\n  CREATOR: { name: \"Creator\", threshold: 1000, icon: \"üé®\", description: \"Created your first coin\" },\n  INFLUENCER: { name: \"Influencer\", threshold: 2500, icon: \"‚≠ê\", description: \"Earned 2500 E1XP points\" },\n  LEGEND: { name: \"Legend\", threshold: 5000, icon: \"üëë\", description: \"Earned 5000 E1XP points\" },\n  STREAK_MASTER: { name: \"Streak Master\", threshold: -1, special: \"7_day_streak\", icon: \"üî•\", description: \"Maintained a 7-day login streak\" },\n  FIRST_COIN: { name: \"First Coin\", threshold: -1, special: \"first_coin\", icon: \"ü™ô\", description: \"Created your first coin\" },\n  TOP_HOLDER: { name: \"Top Holder\", threshold: -1, special: \"top_holder\", icon: \"üí∞\", description: \"Top 10 holder of a coin\" },\n  EARLY_ADOPTER: { name: \"Early Adopter\", threshold: -1, special: \"early_adopter\", icon: \"‚ö°\", description: \"Among the first 100 users\" },\n  REFERRAL_KING: { name: \"Referral King\", threshold: -1, special: \"10_referrals\", icon: \"ü§ù\" },\n};\n\nexport async function awardPoints(\n  userId: string,\n  amount: number,\n  type: string,\n  description: string,\n  metadata?: Record<string, any>\n) {\n  // Add points transaction\n  await db.insert(pointsTransactions).values({\n    userId,\n    amount,\n    type,\n    description,\n    metadata,\n  });\n\n  // Update user's total points\n  const [user] = await db\n    .select()\n    .from(users)\n    .where(eq(users.id, userId))\n    .limit(1);\n\n  if (!user) return null;\n\n  const newPoints = (user.e1xpPoints || 0) + amount;\n  const currentBadges = user.pointsBadges || [];\n  const newBadges = [...currentBadges];\n\n  // Check for new badge unlocks\n  for (const [key, badge] of Object.entries(BADGES)) {\n    const badgeKey = key.toLowerCase();\n    if (!currentBadges.includes(badgeKey) && badge.threshold > 0 && newPoints >= badge.threshold) {\n      newBadges.push(badgeKey);\n\n      // Award bonus points for unlocking badge\n      await db.insert(pointsTransactions).values({\n        userId,\n        amount: 50,\n        type: \"badge_unlock\",\n        description: `Unlocked ${badge.name} badge!`,\n        metadata: { badge: badgeKey },\n      });\n\n      // Notify user about badge unlock\n      await notificationService.notifyBadgeUnlocked(userId, badge.name);\n    }\n  }\n\n  const [updatedUser] = await db\n    .update(users)\n    .set({\n      e1xpPoints: newPoints + (newBadges.length > currentBadges.length ? 50 : 0),\n      pointsBadges: newBadges,\n    })\n    .where(eq(users.id, userId))\n    .returning();\n\n  return updatedUser;\n}\n\nexport async function checkAndAwardSpecialBadges(userId: string, type: string, metadata?: any) {\n  const [user] = await db\n    .select()\n    .from(users)\n    .where(eq(users.id, userId))\n    .limit(1);\n\n  if (!user) return;\n\n  const currentBadges = user.pointsBadges || [];\n  const newBadges = [...currentBadges];\n\n  // Streak Master - 7 day streak\n  if (type === \"7_day_streak\" && !currentBadges.includes(\"streak_master\")) {\n    newBadges.push(\"streak_master\");\n    await awardPoints(userId, 100, \"badge_unlock\", \"Unlocked Streak Master badge!\", { badge: \"streak_master\" });\n  }\n\n  // Referral King - 10 referrals\n  if (type === \"10_referrals\" && !currentBadges.includes(\"referral_king\")) {\n    newBadges.push(\"referral_king\");\n    await awardPoints(userId, 200, \"badge_unlock\", \"Unlocked Referral King badge!\", { badge: \"referral_king\" });\n  }\n\n  if (newBadges.length > currentBadges.length) {\n    await db\n      .update(users)\n      .set({ pointsBadges: newBadges })\n      .where(eq(users.id, userId));\n  }\n}\n\nexport async function generateReferralCode(userId: string): Promise<string> {\n  const [user] = await db\n    .select()\n    .from(users)\n    .where(eq(users.id, userId))\n    .limit(1);\n\n  if (user?.username) {\n    // Use username as referral code\n    await db\n      .update(users)\n      .set({ referralCode: user.username })\n      .where(eq(users.id, userId));\n    return user.username;\n  }\n\n  // Fallback to random code if no username\n  const code = Math.random().toString(36).substring(2, 10).toUpperCase();\n  await db\n    .update(users)\n    .set({ referralCode: code })\n    .where(eq(users.id, userId));\n  return code;\n}\n\nexport async function trackReferralActivity(userId: string, activityType: 'trade' | 'create_coin') {\n  // Check if user was referred\n  const [referralRecord] = await db\n    .select()\n    .from(referrals)\n    .where(eq(referrals.referredUserId, userId))\n    .limit(1);\n\n  if (!referralRecord) return;\n\n  const points = activityType === 'create_coin' ? POINTS_REWARDS.CREATE_COIN : POINTS_REWARDS.TRADE_BUY;\n  const referrerBonus = Math.floor(points * POINTS_REWARDS.REFERRAL_BONUS_MULTIPLIER);\n\n  // Award bonus to referrer\n  await awardPoints(\n    referralRecord.referrerId,\n    referrerBonus,\n    \"referral_bonus\",\n    `Your referral ${activityType === 'create_coin' ? 'created a coin' : 'made a trade'}! 2x bonus!`,\n    { referredUserId: userId, activityType }\n  );\n\n  // Update referral tracking\n  await db\n    .update(referrals)\n    .set({\n      hasTradedOrCreated: true,\n      totalPointsEarned: (referralRecord.totalPointsEarned || 0) + referrerBonus,\n      status: 'active',\n    })\n    .where(eq(referrals.id, referralRecord.id));\n\n  // Notify referrer\n  const [referrer] = await db.select().from(users).where(eq(users.id, referralRecord.referrerId)).limit(1);\n  const [user] = await db.select().from(users).where(eq(users.id, userId)).limit(1); // Fetch referred user for notification message\n\n  if (referrer && user) {\n    // Send notification via service\n    await notificationService.notifyReferralEarned(\n      referrer.id, // Use referrer.id for notification service\n      user.id,     // Use user.id for notification service\n      referrerBonus\n    );\n\n    // Existing notification call (can be removed if notificationService covers all cases)\n    await storage.createNotification({\n      userId: referrer.id, // Use referrer.id here as well\n      type: \"referral\",\n      title: \"üéâ Referral Bonus! üéâ\",\n      message: `Your referral ${user.username || user.id} just ${activityType === 'create_coin' ? 'created a coin' : 'made a trade'}! You earned ${referrerBonus} E1XP (2x bonus)`,\n      amount: referrerBonus.toString(), // Ensure amount is a string if required by storage.createNotification\n    });\n  }\n}\n\n// Admin notification testing function\nexport async function sendAdminNotificationTest(userId: string, message: string) {\n  await notificationService.sendTestNotification(userId, message);\n}","size_bytes":7503},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/content-preview.tsx":{"content":"import { useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { uploadToIPFS } from \"@/lib/pinata\";\nimport { Loader2, ExternalLink, Sparkles } from \"lucide-react\";\nimport { usePrivy, useWallets } from \"@privy-io/react-auth\";\nimport { createWalletClient, custom, createPublicClient, http, type Address } from \"viem\";\nimport { base, baseSepolia } from \"viem/chains\";\nimport { createCoinOnBaseSepolia, generateCoinSymbol } from \"@/lib/zora-coins\";\nimport { deployGaslessCoin } from \"@/lib/gasless-deployment\";\nimport { useSmartAccount } from \"@/contexts/SmartAccountContext\";\nimport confetti from \"canvas-confetti\";\nimport { useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\n\ninterface ContentPreviewProps {\n  scrapedData: any;\n  onCoinCreated: () => void;\n}\n\nexport default function ContentPreview({ scrapedData, onCoinCreated }: ContentPreviewProps) {\n  const { toast } = useToast();\n  const { authenticated, user } = usePrivy();\n  const { wallets } = useWallets();\n  const { smartAccountClient, smartAccountAddress, isLoading: isSmartAccountLoading, initSmartAccount } = useSmartAccount();\n\n  // Get the actual wallet address from Privy wallets array\n  const privyWallet = wallets[0];\n  const walletAddress = privyWallet?.address as Address | undefined;\n  const privyId = user?.id;\n  const email = user?.email?.address;\n  const isEmailUser = email && !walletAddress;\n\n  // Use smart wallet address if available, otherwise use regular wallet address\n  const effectiveWalletAddress = smartAccountAddress || walletAddress;\n\n  // Auto-generate symbol from platform/channel/content - NON-EDITABLE\n  const coinSymbol = generateCoinSymbol({\n    platform: scrapedData.platform,\n    author: scrapedData.author,\n    title: scrapedData.title,\n    url: scrapedData.url,\n  });\n\n  const createCoinMutation = useMutation({\n    mutationFn: async () => {\n      if (!authenticated || !user) {\n        throw new Error(\"Please sign in to create a coin\");\n      }\n\n      // Get network preference\n      const networkPreference = localStorage.getItem('ADMIN_NETWORK_PREFERENCE') as 'sepolia' | 'mainnet' | null;\n      const chainId = networkPreference === 'mainnet' ? base.id : baseSepolia.id;\n\n      console.log('üöÄ Creating coin on chain:', chainId === base.id ? 'Base Mainnet' : 'Base Sepolia');\n\n      // 1. Upload metadata to IPFS\n      const metadata = {\n        name: scrapedData.title,\n        symbol: coinSymbol,\n        description: scrapedData.description || `A coin representing ${scrapedData.title}`,\n        image: scrapedData.image || \"\",\n        external_url: scrapedData.url || \"\",\n        attributes: {\n          platform: scrapedData.platform,\n          author: scrapedData.author,\n          publishDate: scrapedData.publishDate,\n          contentType: scrapedData.type,\n        },\n      };\n\n      // Ensure smart account is initialized\n      let accountClient = smartAccountClient;\n      let accountAddress = smartAccountAddress;\n\n      if (!accountClient || !accountAddress) {\n        console.log(\"‚è≥ Smart account not ready, initializing...\");\n        const result = await initSmartAccount();\n\n        if (!result) {\n          throw new Error(\"Smart account initialization failed. Please refresh and try again.\");\n        }\n\n        accountClient = result.client;\n        accountAddress = result.address;\n      }\n\n      console.log(\"üì§ Uploading metadata to IPFS...\");\n      const ipfsUri = await uploadToIPFS(metadata);\n      console.log(\"‚úÖ Metadata uploaded:\", ipfsUri);\n\n      // 2. Create coin record in database (pending status)\n      console.log(\"üíæ Creating database record...\");\n      \n      // Determine creator wallet: prefer privy wallet, fallback to smart account\n      const creatorWalletAddress = walletAddress || accountAddress;\n      console.log('üìç Using creator wallet address:', creatorWalletAddress);\n      \n      if (!creatorWalletAddress) {\n        throw new Error(\"No wallet address available. Please ensure you're logged in with a wallet.\");\n      }\n\n      const coinData = {\n        name: scrapedData.title,\n        symbol: coinSymbol,\n        description: scrapedData.description || `A coin representing ${scrapedData.title}`,\n        image: scrapedData.image || \"\",\n        creatorWallet: creatorWalletAddress,\n        status: 'pending' as const,\n        ipfsUri,\n      };\n\n      const createdCoin = await apiRequest(\"POST\", \"/api/coins\", coinData);\n      const createdCoinJson = await createdCoin.json();\n      console.log(\"‚úÖ Database record created:\", createdCoinJson.id);\n\n      // 3. Deploy coin using gasless deployment\n      console.log('üí∏ Using GASLESS deployment for ALL users!');\n      console.log('üìç Smart wallet address:', accountAddress);\n      console.log('‚úÖ Gas fees will be sponsored by Base Paymaster (FREE)');\n\n      const deployResult = await deployGaslessCoin(\n        {\n          name: scrapedData.title,\n          symbol: coinSymbol,\n          metadataUri: ipfsUri,\n          smartAccountAddress: accountAddress,\n          platformReferrer: import.meta.env.VITE_ADMIN_REFERRAL_ADDRESS as Address | undefined,\n        },\n        accountClient\n      );\n\n      console.log(\"‚úÖ Gasless deployment successful!\");\n      console.log(\"üí∞ You paid ZERO gas fees!\");\n      console.log(\"üìç Contract address:\", deployResult.address || \"Pending...\");\n      console.log(\"üîó Transaction hash:\", deployResult.hash);\n\n      // Determine the chain ID from the deployment result\n      const deployedChainId = deployResult.chainId || baseSepolia.id;\n\n      // Update database with deployment info\n      console.log(\"üíæ Updating database with deployment info...\");\n      await apiRequest(\"PATCH\", `/api/coins/${createdCoinJson.id}`, {\n        address: deployResult.address,\n        chainId: deployedChainId.toString(),\n        status: 'active' as const,\n        createdAt: deployResult.createdAt,\n      });\n\n      console.log(\"üéâ Coin creation complete!\");\n      return {\n        coin: {\n          ...createdCoinJson,\n          address: deployResult.address,\n          status: 'active',\n          chainId: deployedChainId.toString(),\n        }\n      };\n    },\n    onSuccess: (data) => {\n      const isGasless = smartAccountClient && smartAccountAddress;\n      toast({\n        title: isGasless ? \"üéâ Coin Created (Gasless)!\" : \"üéâ Coin Created Successfully!\",\n        description: isGasless\n          ? `${data.coin.symbol} is now live with ZERO gas fees paid!`\n          : `${data.coin.symbol} is now live on Base Sepolia testnet`\n      });\n      confetti({\n        particleCount: 150,\n        spread: 100,\n        origin: { y: 0.6 }\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/coins\"] });\n      onCoinCreated();\n    },\n    onError: (error: Error) => {\n      console.error(\"‚ùå Coin creation failed:\", error);\n      toast({\n        title: \"Coin creation failed\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    },\n  });\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Compact preview card */}\n      <div className=\"flex gap-3\">\n        {/* Image thumbnail - compact */}\n        {scrapedData.image && (\n          <div className=\"flex-shrink-0\">\n            <img\n              src={scrapedData.image}\n              alt={scrapedData.title}\n              className=\"w-20 h-20 object-cover rounded-lg border border-border\"\n            />\n          </div>\n        )}\n\n        {/* Content info - compact */}\n        <div className=\"flex-1 min-w-0\">\n          <h3 className=\"font-semibold text-sm text-foreground truncate\">\n            {scrapedData.title}\n          </h3>\n          {scrapedData.description && (\n            <p className=\"text-xs text-muted-foreground line-clamp-2 mt-1\">\n              {scrapedData.description}\n            </p>\n          )}\n\n          {/* Metadata row */}\n          <div className=\"flex items-center gap-2 mt-2\">\n            {scrapedData.platform && (\n              <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-primary/10 text-primary\">\n                {scrapedData.platform}\n              </span>\n            )}\n            {scrapedData.author && (\n              <span className=\"text-xs text-muted-foreground truncate\">\n                by {scrapedData.author}\n              </span>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Auto-generated symbol display - non-editable */}\n      <div className=\"bg-muted/30 rounded-lg p-3 border border-border/50\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <p className=\"text-xs font-medium text-muted-foreground mb-1\">\n              Auto-Generated Symbol\n            </p>\n            <p className=\"text-lg font-bold text-foreground\">\n              ${coinSymbol}\n            </p>\n            <p className=\"text-xs text-muted-foreground mt-0.5\">\n              Based on {scrapedData.author || scrapedData.platform || 'content name'}\n            </p>\n          </div>\n          <Sparkles className=\"w-5 h-5 text-primary\" />\n        </div>\n      </div>\n\n      {/* Network info & Gasless indicator */}\n      <div className=\"flex items-center justify-between text-xs text-muted-foreground bg-muted/20 rounded-lg p-2\">\n        <span>Network: {localStorage.getItem('ADMIN_NETWORK_PREFERENCE') === 'mainnet' ? 'Base Mainnet' : 'Base Sepolia (Testnet)'}</span>\n        <span>Currency: ETH</span>\n      </div>\n\n      {/* Gasless deployment indicator - always show for authenticated users */}\n      {authenticated && (\n        <div className=\"flex items-center justify-center gap-2 bg-green-500/10 border border-green-500/30 rounded-lg p-2 text-xs font-medium text-green-600 dark:text-green-400\">\n          <Sparkles className=\"w-3.5 h-3.5\" />\n          <span>Gasless Deployment - Zero Gas Fees!</span>\n        </div>\n      )}\n\n      {/* Create button */}\n      <Button\n        onClick={() => {\n          if (!authenticated) {\n            toast({\n              title: \"Sign in required\",\n              description: \"Please sign in to create a coin\",\n              variant: \"destructive\",\n            });\n            return;\n          }\n          createCoinMutation.mutate();\n        }}\n        disabled={createCoinMutation.isPending || !authenticated}\n        className=\"w-full h-11 bg-gradient-to-r from-primary to-primary hover:from-primary/90 hover:to-primary/80 font-semibold\"\n        data-testid=\"button-create-coin\"\n      >\n        {createCoinMutation.isPending ? (\n          <>\n            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n            Creating Coin (Gasless)...\n          </>\n        ) : (\n          <>\n            <Sparkles className=\"w-4 h-4 mr-2\" />\n            Create ${coinSymbol} Coin (FREE)\n          </>\n        )}\n      </Button>\n\n      {/* Source link */}\n      {scrapedData.url && (\n        <a\n          href={scrapedData.url}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"flex items-center justify-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors\"\n        >\n          <ExternalLink className=\"w-3 h-3\" />\n          View original content\n        </a>\n      )}\n\n\n    </div>\n  );\n}","size_bytes":11537},"replit.md":{"content":"# Every1.fun / Creatorland Platform\n\n## Overview\n\nEvery1.fun (branded as \"creatorland*\") is a Web3 platform that enables content creators and public goods builders to tokenize their digital content and projects as tradeable coins on the Base blockchain. The platform bridges traditional web content with Web3 innovation by allowing users to mint creator coins, trade them on an open marketplace, and earn sustainable passive income through trading fees. The application serves two primary user groups: content creators (writers, musicians, artists, influencers) and public goods builders (RPGF recipients, Gitcoin grantees, open source developers).\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Technology Stack**: React with TypeScript using Vite as the build tool and development server. The UI is built with shadcn/ui component library (Radix UI primitives) and styled with Tailwind CSS.\n\n**Design System**: Modern, crypto-native aesthetic inspired by Web3 platforms (Friend.tech, Lens Protocol) and Gen Z social apps (BeReal, Dispo). Uses a vibrant color palette featuring lime green primary (`89 95% 79%`), vivid magenta secondary (`314 83% 57%`), deep purple dark backgrounds (`270 30% 15%`), with custom Forma DJR Micro typography (currently using Inter as fallback).\n\n**State Management**: TanStack React Query (v5) handles all server state management, API requests, and caching. Local UI state managed with React hooks.\n\n**Routing**: Wouter for client-side routing with pages for home feed, search, profile, content creation, inbox messaging, connections, groups, and daily streaks.\n\n**Component Architecture**: Modular component structure with reusable UI components (`CreatorCard`, `ProjectCard`, `ThemeToggle`) and page-level components. Layout system uses a responsive grid (mobile-first) with bottom navigation on mobile and top header navigation on desktop.\n\n### Backend Architecture\n\n**Server Framework**: Express.js with TypeScript running on Node.js. API follows RESTful conventions with routes organized by resource type (users, projects, coins, messages, connections, groups).\n\n**Authentication Strategy**: Currently using mock authentication with a seeded user for development. Designed to integrate with Privy for Web3 wallet-based authentication (configuration present but not yet implemented). Session management infrastructure prepared with `SESSION_SECRET` environment variable.\n\n**API Design**: Resource-based endpoints following REST patterns:\n- `/api/users` - User profile management\n- `/api/creators` - Creator discovery and search\n- `/api/projects` - Content/project CRUD operations\n- `/api/coins` - Token minting and trading\n- `/api/messages` - Messaging system\n- `/api/connections` - Social connections\n- `/api/groups` - Community groups\n- `/api/streaks` - Gamification system\n- `/api/registry/*` - On-chain registry management (status, manual sync, pending list, verification)\n\n**Data Access Layer**: Storage abstraction layer (`server/storage.ts`) provides a clean interface for database operations, separating business logic from data persistence.\n\n### Data Storage\n\n**Database**: PostgreSQL managed by Supabase, accessed via the standard `pg` client library for reliable connections.\n\n**ORM**: Drizzle ORM provides type-safe database queries and schema management. Schema defined in `shared/schema.ts` with full TypeScript type inference.\n\n**Database Schema Design**:\n- **users**: Core user profiles with Privy authentication integration fields, wallet addresses, social accounts, creator types, categories, and engagement metrics\n- **projects**: Content/campaigns that can be minted as coins, includes IPFS hash storage and view/interaction tracking\n- **coins**: Tokenized assets with status tracking (pending/minted), blockchain metadata (address, chain_id), registry tracking (registry_status, registry_tx_hash, registered_at) for on-chain verification\n  - Registry status values: `pending` (awaiting registration), `registering` (transaction sent), `registered` (confirmed on-chain), `failed` (temporary failure, will retry), `failed_permanent` (permanent failure, no retry)\n- **messages**: Direct messaging system with conversation threading\n- **connections**: Social graph for creator networking\n- **groups**: Community/collaboration groups with membership tracking\n- **loginStreaks**: Gamification system tracking daily engagement\n- **bookmarks**: User content bookmarking\n- **scrapedContent**: Imported content metadata from URLs or file uploads\n\n**Migration Strategy**: Drizzle Kit manages schema migrations with PostgreSQL dialect configuration.\n\n### External Dependencies\n\n**Blockchain Infrastructure**:\n- **Base Sepolia Testnet**: Testing network for coin deployment (Chain ID 84532) before mainnet launch\n- **Zora Factory Contract**: Direct contract interaction at `0x777777751622c0d3258f214F9DF38E35BF45baF3` (same address on all chains)\n  - **Implementation**: Uses viem for direct contract calls via `simulateContract` and `writeContract` (no SDK dependencies)\n  - **Method**: `deployCreatorCoin()` for coin creation with ETH-backed pool configuration, includes `coinSalt` parameter for deterministic deployment\n  - **Deterministic Deployment**: Salt generated from keccak256 hash of ABI-encoded stable parameters (creator address, name, symbol, metadataUri)\n  - **Events**: Decodes `CreatorCoinCreated` or `CoinCreatedV4` events to extract deployed coin addresses\n  - **Pool Config**: Custom ETH-backed configuration (version 4) with tick ranges and discovery positions\n- **Coin Registry Contract**: Custom on-chain registry contract (`CoinRegistry.sol`) deployed on Base network to track all coins created via the platform\n  - **Purpose**: Provides verifiable proof of platform activity for grant applications (Optimism RetroPGF) and public analytics\n  - **Features**: Gas-optimized batch registration (up to 50 coins per transaction), pausable for emergency control, public queryable functions\n  - **Integration**: Automatic background registration via cron job (runs every 6 hours by default), manual sync available via API endpoints\n  - **Costs**: Platform pays all gas fees (~$0.002 per coin in batches), users are not charged\n  - **Status Tracking**: Database tracks registration status (pending ‚Üí registering ‚Üí registered, with permanent failure classification)\n  - **Verification**: Configuration check ensures platform wallet matches on-chain contract before any operations\n  - **Documentation**: Full deployment guide in `REGISTRY_SETUP.md`, contract docs in `contracts/README.md`\n- **Coin Backing Currency**: ETH (only supported currency on Base Sepolia testnet; ZORA and CREATOR_COIN not available on testnet)\n- **Symbol Generation**: Automatic, non-editable symbols generated from platform/channel/account names\n- **Alchemy**: RPC provider for Base blockchain interaction\n- **Ethers.js**: Ethereum library for contract interactions, wallet management, and transaction signing\n- **WalletConnect**: Web3 wallet connection protocol (v2)\n- **OnchainKit**: Coinbase's toolkit for onchain features\n\n**Authentication & Identity**:\n- **Privy**: Web3 authentication provider for wallet-based login (configured but not yet fully integrated)\n- Design allows for email/social login alongside wallet authentication\n\n**File Storage & IPFS**:\n- **Pinata**: IPFS pinning service for decentralized content storage\n- Stores token metadata, project thumbnails, and user uploads\n- Custom gateway configured for content delivery\n\n**Database Hosting**:\n- **Supabase**: Managed PostgreSQL database with connection pooling\n- Provides both standard connection string and service role key for admin operations\n\n**Communication**:\n- **Telegram Bot API**: Notifications and community engagement channel integration\n\n**Development Tools**:\n- **Hardhat**: Ethereum development environment for smart contract compilation, testing, and deployment\n- **Replit Vite Plugins**: Runtime error overlay, cartographer for code navigation, dev banner\n- **React Developer Tools**: Component inspection and debugging\n\n**Backend Services**:\n- **Registry Service** (`server/lib/registryService.ts`): Manages on-chain registration of coins to the CoinRegistry contract\n  - Lazy initialization to prevent startup errors\n  - Configuration verification before operations\n  - Batch processing for gas efficiency\n  - Error classification (temporary vs. permanent failures)\n- **Cron Jobs**: Automated background tasks running on schedule\n  - Registry sync (every 6 hours): Batches pending coins for on-chain registration\n  - Activity tracker (hourly): Platform metrics and analytics\n  - Notification delivery: Various schedules for user engagement\n  - Streak reminders (3x daily): User retention and gamification\n\n**Design & UI**:\n- **Tailwind CSS**: Utility-first styling with custom configuration\n- **Radix UI**: Accessible component primitives for all interactive elements\n- **Recharts**: Data visualization for analytics and metrics\n- **Embla Carousel**: Touch-friendly content carousels\n- **React Icons**: Icon library (using react-icons/si for social media icons)\n\n**Form Handling**:\n- **React Hook Form**: Form state management with performance optimization\n- **Zod**: Runtime type validation and schema definition\n- **@hookform/resolvers**: Integration layer between React Hook Form and Zod\n\n**API & Network**:\n- **TanStack React Query**: Server state management, caching, and synchronization\n- Native Fetch API for HTTP requests with credential inclusion for session management\n\n**Type Safety**:\n- **TypeScript**: End-to-end type safety across client, server, and shared code\n- **Drizzle Zod**: Automatic Zod schema generation from database schema\n- Shared types directory for common interfaces used across application boundaries","size_bytes":9845},"server/notifications.ts":{"content":"import { db } from \"./db\";\nimport { notifications } from \"@shared/schema\";\nimport { eq, desc } from \"drizzle-orm\";\n\n// Note: The original code snippet provided did not include the `storage` object or the `sendTelegramNotification` function.\n// For the purpose of this modification, it's assumed they exist and are correctly implemented elsewhere.\n// If they are not present, further changes would be required.\n\n// Mock implementations for demonstration purposes:\nconst storage = {\n  createNotification: async (data: any) => {\n    console.log(\"Mock storage.createNotification called with:\", data);\n    // In a real scenario, this would interact with the database.\n    // For this mock, we'll just return a dummy object.\n    return [{ ...data, id: \"mock-id-\" + Math.random() }];\n  },\n};\n\nconst sendTelegramNotification = async (userId: string, title: string, message: string, type: string) => {\n  console.log(`Mock sendTelegramNotification called for user ${userId}: ${title} - ${message} (${type})`);\n  // Simulate potential failure for non-wallet users\n  if (userId.includes(\"@\")) { // Assuming email users don't have Telegram\n    throw new Error(\"Telegram not available for email user\");\n  }\n  // In a real scenario, this would send a Telegram message.\n};\n\n\n// Send notification to a specific user (supports wallet address, email, or privyId)\nexport async function sendNotificationToUser(\n  userId: string,\n  notification: {\n    type: string;\n    title: string;\n    message: string;\n    coinAddress?: string;\n    coinSymbol?: string;\n    amount?: string;\n  }\n): Promise<void> {\n  try {\n    // Create notification using userId (can be address, email, or privyId)\n    await storage.createNotification({\n      userId,\n      ...notification,\n      read: false,\n    });\n\n    // Try to send via Telegram if user has wallet address\n    try {\n      await sendTelegramNotification(\n        userId,\n        notification.title,\n        notification.message,\n        notification.type\n      );\n    } catch (telegramError) {\n      // Silent fail for Telegram - email users won't have Telegram connected\n      console.log(`[Notification] Telegram not available for user ${userId}`);\n    }\n  } catch (error) {\n    console.error('Failed to send notification:', error);\n  }\n}\n\nexport async function createNotification(data: {\n  userId: string;\n  type: string;\n  title: string;\n  message: string;\n  coinAddress?: string;\n  coinSymbol?: string;\n  amount?: string;\n  transactionHash?: string;\n}) {\n  const [notification] = await db.insert(notifications).values(data).returning();\n  return notification;\n}\n\nexport async function getUserNotifications(userId: string) {\n  return db.query.notifications.findMany({\n    where: eq(notifications.userId, userId),\n    orderBy: [desc(notifications.createdAt)],\n  });\n}\n\nexport async function markNotificationAsRead(notificationId: string) {\n  await db.update(notifications)\n    .set({ read: true })\n    .where(eq(notifications.id, notificationId));\n}\n\nexport async function markAllNotificationsAsRead(userId: string) {\n  await db.update(notifications)\n    .set({ read: true })\n    .where(eq(notifications.userId, userId));\n}","size_bytes":3145},"server/platform-scrapers.ts":{"content":"import axios from \"axios\";\nimport * as cheerio from \"cheerio\";\nimport { type PlatformType } from \"./platform-detector\";\n\nexport interface ScrapedData {\n  url: string;\n  platform: PlatformType;\n  title: string;\n  description?: string;\n  author?: string;\n  publishDate?: string;\n  image?: string;\n  animation_url?: string;\n  type?: string;\n  content?: string;\n  tags?: string[];\n  followers?: number;\n  engagement?: number;\n}\n\nconst ENSEMBLE_API_KEY = \"7eAd2jIty0ouYF7q\";\nconst ENSEMBLE_BASE_URL = \"https://ensembledata.com/apis\";\n\n// Instagram - using EnsembleData API (supports both profiles and posts)\nasync function scrapeInstagramOembed(url: string): Promise<ScrapedData> {\n  try {\n    // Check if it's a post URL\n    const postMatch = url.match(/instagram\\.com\\/(p|reel|tv)\\/([^\\/\\?]+)/);\n    \n    if (postMatch) {\n      // Scrape post\n      const shortcode = postMatch[2];\n\n      const postInfoUrl = `${ENSEMBLE_BASE_URL}/ig/post/info`;\n      const response = await axios.get(postInfoUrl, {\n        params: {\n          shortcode,\n          token: ENSEMBLE_API_KEY,\n        },\n        timeout: 15000,\n      });\n\n      const postData = response.data?.data;\n      if (!postData) throw new Error('No post data found');\n\n      const post = postData.items?.[0] || postData;\n      const owner = post.owner || post.user || {};\n\n      return {\n        url,\n        platform: 'instagram',\n        title: `Instagram Post by @${owner.username || 'user'}`,\n        author: owner.full_name || owner.username || 'Instagram User',\n        description: post.caption?.text || post.edge_media_to_caption?.edges?.[0]?.node?.text || 'Instagram post',\n        image: post.display_url || post.thumbnail_url || post.image_versions2?.candidates?.[0]?.url || '',\n        content: post.caption?.text || post.edge_media_to_caption?.edges?.[0]?.node?.text || '',\n        followers: post.like_count || post.edge_media_preview_like?.count || 0,\n        engagement: post.comment_count || post.edge_media_to_comment?.count || 0,\n      };\n    }\n\n    // Extract username from profile URL\n    const usernameMatch = url.match(/instagram\\.com\\/([^\\/\\?]+)/);\n    if (!usernameMatch) throw new Error('Invalid Instagram URL');\n\n    const username = usernameMatch[1];\n\n    // Get user info using EnsembleData\n    const userInfoUrl = `${ENSEMBLE_BASE_URL}/ig/user/info`;\n    const response = await axios.get(userInfoUrl, {\n      params: {\n        username,\n        token: ENSEMBLE_API_KEY,\n      },\n      timeout: 15000,\n    });\n\n    const userData = response.data?.data;\n    if (!userData) throw new Error('No user data found');\n\n    return {\n      url,\n      platform: 'instagram',\n      title: `Instagram - @${username}`,\n      author: userData.full_name || username,\n      description: userData.biography || `Instagram profile for @${username}`,\n      image: userData.profile_pic_url || '',\n      content: userData.biography || '',\n      followers: userData.follower_count || 0,\n      engagement: userData.media_count || 0,\n    };\n  } catch (error) {\n    console.error('Instagram scraping error:', error);\n    const username = url.match(/instagram\\.com\\/([^\\/\\?]+)/)?.[1] || 'user';\n    return {\n      url,\n      platform: 'instagram',\n      title: `Instagram - @${username}`,\n      author: username,\n      description: `Instagram profile for @${username}`,\n      content: `Profile for @${username}`,\n      followers: 0,\n    };\n  }\n}\n\n// TikTok - using EnsembleData API (supports both profiles and videos)\nasync function scrapeTikTokOembed(url: string): Promise<ScrapedData> {\n  try {\n    // Check if it's a video URL\n    const videoMatch = url.match(/tiktok\\.com\\/@([^\\/\\?]+)\\/video\\/(\\d+)/);\n    \n    if (videoMatch) {\n      // Scrape video\n      const username = videoMatch[1];\n      const videoId = videoMatch[2];\n\n      const videoInfoUrl = `${ENSEMBLE_BASE_URL}/tt/post/info`;\n      const response = await axios.get(videoInfoUrl, {\n        params: {\n          link: url,\n          token: ENSEMBLE_API_KEY,\n        },\n        timeout: 15000,\n      });\n\n      const videoData = response.data?.data;\n      if (!videoData) throw new Error('No video data found');\n\n      const video = videoData.video || videoData.itemInfo?.itemStruct || videoData;\n      const author = video.author || videoData.author || {};\n      const stats = video.stats || videoData.stats || {};\n\n      // Extract video URL for playback\n      const videoUrl = video.video?.downloadAddr || \n                      video.video?.playAddr || \n                      video.downloadAddr ||\n                      video.playAddr ||\n                      '';\n\n      return {\n        url,\n        platform: 'tiktok',\n        title: video.desc || video.title || `TikTok Video by @${username}`,\n        author: author.nickname || author.uniqueId || username,\n        description: video.desc || `TikTok video by @${username}`,\n        image: video.video?.cover || video.cover || author.avatarLarger || '',\n        animation_url: videoUrl,\n        type: 'video',\n        content: video.desc || '',\n        followers: stats.diggCount || stats.playCount || 0,\n        engagement: stats.shareCount || stats.commentCount || 0,\n      };\n    }\n\n    // Extract username from profile URL\n    const usernameMatch = url.match(/tiktok\\.com\\/@([^\\/\\?]+)/);\n    if (!usernameMatch) throw new Error('Invalid TikTok URL');\n\n    const username = usernameMatch[1];\n\n    // Get user info using EnsembleData\n    const userInfoUrl = `${ENSEMBLE_BASE_URL}/tt/user/info`;\n    const response = await axios.get(userInfoUrl, {\n      params: {\n        username,\n        token: ENSEMBLE_API_KEY,\n      },\n      timeout: 15000,\n    });\n\n    const userData = response.data?.data;\n    if (!userData) throw new Error('No user data found');\n\n    const user = userData.user || userData.userInfo || userData;\n    const stats = userData.stats || userData.userInfo?.stats || user.stats || {};\n\n    const followerCount = stats.followerCount || stats.follower_count || user.followerCount || user.follower_count || 0;\n    const videoCount = stats.videoCount || stats.video_count || user.videoCount || user.video_count || 0;\n\n    // Get the best available avatar image\n    const avatarImage = user.avatarLarger || \n                       user.avatarMedium || \n                       user.avatar_larger?.url_list?.[0] || \n                       user.avatar_medium?.url_list?.[0] ||\n                       user.avatar_thumb?.url_list?.[0] || \n                       user.avatarThumb || \n                       '';\n\n    console.log('TikTok profile image URL:', avatarImage);\n\n    return {\n      url,\n      platform: 'tiktok',\n      title: `TikTok - @${username}`,\n      author: user.nickname || user.uniqueId || username,\n      description: user.signature || user.bio || `TikTok profile for @${username}`,\n      image: avatarImage,\n      content: user.signature || user.bio || '',\n      followers: followerCount,\n      engagement: videoCount,\n      type: 'profile', // Explicitly mark as profile to avoid video rendering\n    };\n  } catch (error) {\n    console.error('TikTok scraping error:', error);\n    const username = url.match(/tiktok\\.com\\/@([^\\/\\?]+)/)?.[1] || 'user';\n    return {\n      url,\n      platform: 'tiktok',\n      title: `TikTok - @${username}`,\n      author: username,\n      description: `TikTok profile for @${username}`,\n      content: `Profile for @${username}`,\n      followers: 0,\n      type: 'profile',\n    };\n  }\n}\n\n// YouTube - using EnsembleData API (supports videos, shorts, and channels)\nasync function scrapeYouTube(url: string): Promise<ScrapedData> {\n  try {\n    // Extract video ID from various YouTube URL formats\n    let videoId: string | null = null;\n    \n    // Standard watch URL\n    const watchMatch = url.match(/[?&]v=([^&]+)/);\n    if (watchMatch) videoId = watchMatch[1];\n    \n    // Short URL (youtu.be)\n    const shortMatch = url.match(/youtu\\.be\\/([^?]+)/);\n    if (shortMatch) videoId = shortMatch[1];\n    \n    // Shorts URL\n    const shortsMatch = url.match(/youtube\\.com\\/shorts\\/([^?]+)/);\n    if (shortsMatch) videoId = shortsMatch[1];\n\n    // If it's a video URL, scrape video info\n    if (videoId) {\n      const videoInfoUrl = `${ENSEMBLE_BASE_URL}/yt/video/info`;\n      const response = await axios.get(videoInfoUrl, {\n        params: {\n          id: videoId,\n          token: ENSEMBLE_API_KEY,\n        },\n        timeout: 15000,\n      });\n\n      const videoData = response.data?.data;\n      if (!videoData) throw new Error('No video data found');\n\n      const video = videoData.videoDetails || videoData;\n      const snippet = videoData.snippet || video;\n\n      return {\n        url,\n        platform: 'youtube',\n        title: video.title || snippet.title || 'YouTube Video',\n        author: video.author || snippet.channelTitle || video.ownerChannelName || '',\n        description: video.shortDescription || snippet.description || video.description || '',\n        image: video.thumbnail?.thumbnails?.[0]?.url || snippet.thumbnails?.high?.url || '',\n        content: video.shortDescription || snippet.description || '',\n        followers: parseInt(video.viewCount || snippet.statistics?.viewCount || '0'),\n        engagement: parseInt(video.likeCount || snippet.statistics?.likeCount || '0'),\n      };\n    }\n\n    // Extract channel ID or username from URL\n    const channelMatch = url.match(/youtube\\.com\\/(channel\\/|@|c\\/)([^\\/\\?]+)/);\n    if (!channelMatch) {\n      // Fallback to oEmbed for unknown formats\n      const oembedUrl = `https://www.youtube.com/oembed?url=${encodeURIComponent(url)}&format=json`;\n      const response = await axios.get(oembedUrl, { timeout: 10000 });\n      return {\n        url,\n        platform: 'youtube',\n        title: response.data.title || 'YouTube Video',\n        author: response.data.author_name || '',\n        image: response.data.thumbnail_url || '',\n        description: `YouTube video by ${response.data.author_name}`,\n        content: response.data.title || '',\n      };\n    }\n\n    const channelId = channelMatch[2];\n\n    // Get channel info using EnsembleData\n    const channelInfoUrl = `${ENSEMBLE_BASE_URL}/yt/channel/info`;\n    const response = await axios.get(channelInfoUrl, {\n      params: {\n        id: channelId,\n        token: ENSEMBLE_API_KEY,\n      },\n      timeout: 15000,\n    });\n\n    const channelData = response.data?.data;\n    if (!channelData) throw new Error('No channel data found');\n\n    return {\n      url,\n      platform: 'youtube',\n      title: channelData.title || `YouTube - ${channelId}`,\n      author: channelData.title || channelId,\n      description: channelData.description || `YouTube channel ${channelId}`,\n      image: channelData.avatar?.[0]?.url || '',\n      content: channelData.description || '',\n      followers: channelData.stats?.subscriberCount || 0,\n      engagement: channelData.stats?.videoCount || 0,\n    };\n  } catch (error) {\n    console.error('YouTube scraping error:', error);\n    // Fallback to HTML scraping\n    try {\n      const response = await axios.get(url, {\n        headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' },\n        timeout: 30000,\n      });\n      const $ = cheerio.load(response.data);\n\n      const title = $('meta[property=\"og:title\"]').attr('content') || 'YouTube Content';\n      const description = $('meta[property=\"og:description\"]').attr('content') || '';\n      const author = $('link[itemprop=\"name\"]').attr('content') || '';\n      const image = $('meta[property=\"og:image\"]').attr('content') || '';\n\n      return { url, platform: 'youtube', title, description, author, image, content: description };\n    } catch (fallbackError) {\n      return {\n        url,\n        platform: 'youtube',\n        title: 'YouTube Content',\n        description: 'Unable to fetch details',\n        content: '',\n      };\n    }\n  }\n}\n\n// Twitter/X - using EnsembleData API (supports both profiles and tweets)\nasync function scrapeTwitterNitter(url: string): Promise<ScrapedData> {\n  try {\n    // Check if it's a tweet URL\n    const tweetMatch = url.match(/(?:twitter\\.com|x\\.com)\\/([^\\/\\?]+)\\/status\\/(\\d+)/);\n    \n    if (tweetMatch) {\n      // Scrape tweet\n      const username = tweetMatch[1];\n      const tweetId = tweetMatch[2];\n\n      const tweetInfoUrl = `${ENSEMBLE_BASE_URL}/twitter/tweet/info`;\n      const response = await axios.get(tweetInfoUrl, {\n        params: {\n          id: tweetId,\n          token: ENSEMBLE_API_KEY,\n        },\n        timeout: 15000,\n      });\n\n      const tweetData = response.data?.data;\n      if (!tweetData) throw new Error('No tweet data found');\n\n      const tweet = tweetData.tweet || tweetData;\n      const user = tweet.user || tweet.core?.user_results?.result?.legacy || {};\n\n      return {\n        url,\n        platform: 'twitter',\n        title: `Tweet by @${user.screen_name || username}`,\n        author: user.name || user.screen_name || username,\n        description: tweet.full_text || tweet.text || 'Twitter post',\n        image: tweet.entities?.media?.[0]?.media_url_https || user.profile_image_url_https || '',\n        content: tweet.full_text || tweet.text || '',\n        followers: tweet.favorite_count || tweet.public_metrics?.like_count || 0,\n        engagement: tweet.retweet_count || tweet.public_metrics?.retweet_count || 0,\n      };\n    }\n\n    // Extract username from profile URL\n    const usernameMatch = url.match(/(?:twitter\\.com|x\\.com)\\/([^\\/\\?]+)/);\n    if (!usernameMatch) throw new Error('Invalid Twitter URL');\n\n    const username = usernameMatch[1];\n\n    // Get user info using EnsembleData\n    const userInfoUrl = `${ENSEMBLE_BASE_URL}/twitter/user/info`;\n    const response = await axios.get(userInfoUrl, {\n      params: {\n        username,\n        token: ENSEMBLE_API_KEY,\n      },\n      timeout: 15000,\n    });\n\n    const userData = response.data?.data;\n    if (!userData) throw new Error('No user data found');\n\n    return {\n      url,\n      platform: 'twitter',\n      title: userData.name || `Twitter/X - @${username}`,\n      author: username,\n      description: userData.description || `Twitter profile for @${username}`,\n      image: userData.profile_image_url_https || '',\n      content: userData.description || '',\n      followers: userData.followers_count || 0,\n      engagement: userData.statuses_count || 0,\n    };\n  } catch (error) {\n    console.error('Twitter scraping error:', error);\n    const username = url.match(/(?:twitter\\.com|x\\.com)\\/([^\\/\\?]+)/)?.[1] || 'user';\n    return {\n      url,\n      platform: 'twitter',\n      title: `Twitter/X - @${username}`,\n      author: username,\n      description: `Twitter profile for @${username}`,\n      content: `Profile for @${username}`,\n      followers: 0,\n    };\n  }\n}\n\nasync function scrapeSpotify(url: string): Promise<ScrapedData> {\n  try {\n    const response = await axios.get(url, {\n      headers: { \n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\n        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n        'Accept-Language': 'en-US,en;q=0.5',\n      },\n      timeout: 30000,\n    });\n\n    const $ = cheerio.load(response.data);\n\n    // Try multiple selectors for Spotify metadata\n    const title = $('meta[property=\"og:title\"]').attr('content') || \n                  $('meta[name=\"twitter:title\"]').attr('content') || \n                  $('meta[property=\"twitter:title\"]').attr('content') ||\n                  $('title').text().replace(' - Spotify', '').trim() || \n                  'Spotify Content';\n    \n    const description = $('meta[property=\"og:description\"]').attr('content') || \n                       $('meta[name=\"twitter:description\"]').attr('content') || \n                       $('meta[name=\"description\"]').attr('content') || \n                       $('meta[property=\"twitter:description\"]').attr('content') ||\n                       '';\n    \n    const author = $('meta[name=\"music:musician\"]').attr('content') || \n                   $('meta[property=\"music:creator\"]').attr('content') || \n                   $('meta[name=\"music:artist\"]').attr('content') ||\n                   '';\n    \n    const image = $('meta[property=\"og:image\"]').attr('content') || \n                  $('meta[name=\"twitter:image\"]').attr('content') || \n                  $('meta[property=\"twitter:image\"]').attr('content') ||\n                  '';\n\n    // Try to get audio URL from Spotify embed or meta tags\n    const audioUrl = $('meta[property=\"og:audio\"]').attr('content') || \n                     $('meta[property=\"twitter:player:stream\"]').attr('content') ||\n                     url;\n\n    return { \n      url: audioUrl || url, \n      platform: 'spotify', \n      title, \n      description, \n      author, \n      image, \n      content: description,\n      followers: 0,\n      engagement: 0,\n    };\n  } catch (error) {\n    console.error('Spotify scraping error:', error);\n    \n    // Extract basic info from URL as fallback\n    const urlParts = url.split('/');\n    const type = urlParts[urlParts.length - 2] || 'content';\n    const id = urlParts[urlParts.length - 1]?.split('?')[0] || 'unknown';\n    \n    return {\n      url,\n      platform: 'spotify',\n      title: `Spotify ${type.charAt(0).toUpperCase() + type.slice(1)}`,\n      description: `Spotify ${type} content`,\n      author: '',\n      image: `https://i.scdn.co/image/${id}`,\n      content: `Spotify ${type}`,\n      followers: 0,\n      engagement: 0,\n    };\n  }\n}\n\nasync function scrapeAudioUrl(url: string): Promise<ScrapedData> {\n  // For generic audio URLs, we can only extract basic information.\n  // More detailed metadata would require specific API integrations or advanced analysis.\n  return {\n    url,\n    platform: 'audio',\n    title: 'Audio File',\n    description: 'Direct link to an audio file',\n    author: '',\n    image: '',\n    content: 'Audio content',\n    followers: 0,\n    engagement: 0,\n  };\n}\n\nasync function scrapeMedium(url: string): Promise<ScrapedData> {\n  const response = await axios.get(url, {\n    headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' },\n    timeout: 30000,\n  });\n\n  const $ = cheerio.load(response.data);\n\n  const title = $('meta[property=\"og:title\"]').attr('content') || $('h1').first().text().trim() || 'Medium Article';\n  const description = $('meta[property=\"og:description\"]').attr('content') || '';\n  const author = $('meta[property=\"author\"]').attr('content') || '';\n  const publishDate = $('meta[property=\"article:published_time\"]').attr('content') || '';\n  const image = $('meta[property=\"og:image\"]').attr('content') || '';\n\n  $('script, style, nav, footer, header').remove();\n  const content = $('article').text().trim() || $('main').text().trim();\n  const tags = $('meta[property=\"article:tag\"]').map((_, el) => $(el).attr('content')).get();\n\n  return { url, platform: 'medium', title, description, author, publishDate, image, content: content.substring(0, 10000), tags };\n}\n\nasync function scrapeSubstack(url: string): Promise<ScrapedData> {\n  const response = await axios.get(url, {\n    headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' },\n    timeout: 30000,\n  });\n\n  const $ = cheerio.load(response.data);\n\n  const title = $('meta[property=\"og:title\"]').attr('content') || $('h1').first().text().trim() || 'Substack Post';\n  const description = $('meta[property=\"og:description\"]').attr('content') || '';\n  const author = $('meta[name=\"author\"]').attr('content') || '';\n  const publishDate = $('time').attr('datetime') || '';\n  const image = $('meta[property=\"og:image\"]').attr('content') || '';\n\n  $('script, style, nav, footer, header').remove();\n  const content = $('.body').text().trim() || $('article').text().trim();\n\n  return { url, platform: 'substack', title, description, author, publishDate, image, content: content.substring(0, 10000) };\n}\n\nasync function scrapeGitcoin(url: string): Promise<ScrapedData> {\n  const response = await axios.get(url, {\n    headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' },\n    timeout: 30000,\n  });\n\n  const $ = cheerio.load(response.data);\n\n  const title = $('meta[property=\"og:title\"]').attr('content') || $('h1').first().text().trim() || 'Gitcoin Grant';\n  const description = $('meta[property=\"og:description\"]').attr('content') || '';\n  const image = $('meta[property=\"og:image\"]').attr('content') || '';\n\n  $('script, style').remove();\n  const content = $('.grant-description').text().trim() || $('main').text().trim();\n\n  return { url, platform: 'gitcoin', title, description, image, content: content.substring(0, 10000) };\n}\n\nasync function scrapeGiveth(url: string): Promise<ScrapedData> {\n  const response = await axios.get(url, {\n    headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' },\n    timeout: 30000,\n  });\n\n  const $ = cheerio.load(response.data);\n\n  const title = $('meta[property=\"og:title\"]').attr('content') || $('h1').first().text().trim() || 'Giveth Project';\n  const description = $('meta[property=\"og:description\"]').attr('content') || '';\n  const image = $('meta[property=\"og:image\"]').attr('content') || '';\n\n  $('script, style').remove();\n  const content = $('.project-description').text().trim() || $('main').text().trim();\n\n  return { url, platform: 'giveth', title, description, image, content: content.substring(0, 10000) };\n}\n\nasync function scrapeGitHub(url: string): Promise<ScrapedData> {\n  const response = await axios.get(url, {\n    headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' },\n    timeout: 30000,\n  });\n\n  const $ = cheerio.load(response.data);\n\n  const title = $('meta[property=\"og:title\"]').attr('content') || $('h1').first().text().trim() || 'GitHub Project';\n  const description = $('meta[property=\"og:description\"]').attr('content') || '';\n  const author = $('meta[property=\"profile:username\"]').attr('content') || '';\n  const image = $('meta[property=\"og:image\"]').attr('content') || '';\n\n  $('script, style').remove();\n  const content = $('.markdown-body').text().trim() || $('#readme').text().trim() || $('.repository-content').text().trim();\n\n  return { url, platform: 'github', title, description, author, image, content: content.substring(0, 10000) };\n}\n\nasync function scrapeFarcaster(url: string): Promise<ScrapedData> {\n  const response = await axios.get(url, {\n    headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' },\n    timeout: 30000,\n  });\n\n  const $ = cheerio.load(response.data);\n\n  const title = $('meta[property=\"og:title\"]').attr('content') || $('h1').first().text().trim() || 'Farcaster Channel';\n  const description = $('meta[property=\"og:description\"]').attr('content') || '';\n  const author = $('meta[property=\"profile:username\"]').attr('content') || '';\n  const image = $('meta[property=\"og:image\"]').attr('content') || '';\n\n  $('script, style').remove();\n  const content = $('main').text().trim() || $('.profile').text().trim() || $('body').text().trim();\n\n  return { url, platform: 'farcaster', title, description, author, image, content: content.substring(0, 10000) };\n}\n\nasync function scrapeTwitch(url: string): Promise<ScrapedData> {\n  const response = await axios.get(url, {\n    headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' },\n    timeout: 30000,\n  });\n\n  const $ = cheerio.load(response.data);\n\n  const title = $('meta[property=\"og:title\"]').attr('content') || $('h1').first().text().trim() || 'Twitch Channel';\n  const description = $('meta[property=\"og:description\"]').attr('content') || '';\n  const author = $('meta[property=\"og:site_name\"]').attr('content') || '';\n  const image = $('meta[property=\"og:image\"]').attr('content') || '';\n\n  $('script, style').remove();\n  const content = $('.channel-info-content').text().trim() || $('main').text().trim() || $('body').text().trim();\n\n  return { url, platform: 'twitch', title, description, author, image, content: content.substring(0, 10000) };\n}\n\nasync function scrapeGenericBlog(url: string): Promise<ScrapedData> {\n  const response = await axios.get(url, {\n    headers: { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' },\n    timeout: 30000,\n  });\n\n  const $ = cheerio.load(response.data);\n\n  const title = $('title').text().trim() || $('meta[property=\"og:title\"]').attr('content') || $('h1').first().text().trim() || 'Web Content';\n  const description = $('meta[name=\"description\"]').attr('content') || $('meta[property=\"og:description\"]').attr('content') || '';\n  const author = $('meta[name=\"author\"]').attr('content') || '';\n  const publishDate = $('meta[property=\"article:published_time\"]').attr('content') || $('time').attr('datetime') || '';\n  const image = $('meta[property=\"og:image\"]').attr('content') || $('img').first().attr('src') || '';\n\n  let content = '';\n  const contentSelectors = ['article', '[role=\"main\"]', '.post-content', '.entry-content', '.content', 'main'];\n\n  for (const selector of contentSelectors) {\n    const element = $(selector);\n    if (element.length > 0) {\n      element.find('script, style, nav, footer, header').remove();\n      content = element.text().trim();\n      if (content.length > 100) break;\n    }\n  }\n\n  if (!content || content.length < 100) {\n    $('script, style, nav, footer, header').remove();\n    content = $('body').text().trim();\n  }\n\n  content = content.replace(/\\s+/g, ' ').trim();\n  const tags = $('meta[name=\"keywords\"]').attr('content')?.split(',').map(tag => tag.trim()) || [];\n\n  return { url, platform: 'blog', title, description, author, publishDate, image, content: content.substring(0, 10000), tags };\n}\n\nasync function scrapeEventbrite(url: string): Promise<ScrapedData> {\n  try {\n    const response = await axios.get(url, {\n      timeout: 15000,\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n      },\n    });\n\n    const $ = cheerio.load(response.data);\n    \n    const title = $('h1[class*=\"event-title\"]').text().trim() || \n                  $('meta[property=\"og:title\"]').attr('content') || \n                  $('title').text().replace(' | Eventbrite', '').trim() || \n                  'Eventbrite Event';\n    \n    const description = $('meta[property=\"og:description\"]').attr('content') || \n                       $('meta[name=\"description\"]').attr('content') || \n                       $('div[class*=\"event-description\"]').text().trim() || '';\n    \n    const image = $('meta[property=\"og:image\"]').attr('content') || \n                  $('img[class*=\"event-image\"]').attr('src') || '';\n    \n    const author = $('div[class*=\"organizer\"]').text().trim() || \n                   $('a[class*=\"organizer-link\"]').text().trim() || \n                   'Event Organizer';\n    \n    const publishDate = $('meta[property=\"event:start_time\"]').attr('content') || \n                       $('time[datetime]').attr('datetime') || '';\n\n    return {\n      url,\n      platform: 'eventbrite',\n      title,\n      description,\n      author,\n      publishDate,\n      image,\n      content: description,\n    };\n  } catch (error) {\n    console.error('Eventbrite scraping error:', error);\n    return {\n      url,\n      platform: 'eventbrite',\n      title: 'Eventbrite Event',\n      description: 'Event from Eventbrite',\n      author: 'Event Organizer',\n    };\n  }\n}\n\nasync function scrapeLuma(url: string): Promise<ScrapedData> {\n  try {\n    const response = await axios.get(url, {\n      timeout: 15000,\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n      },\n    });\n\n    const $ = cheerio.load(response.data);\n    \n    const title = $('meta[property=\"og:title\"]').attr('content') || \n                  $('h1').first().text().trim() || \n                  'Luma Event';\n    \n    const description = $('meta[property=\"og:description\"]').attr('content') || \n                       $('meta[name=\"description\"]').attr('content') || '';\n    \n    const image = $('meta[property=\"og:image\"]').attr('content') || '';\n    \n    const author = $('meta[property=\"event:organizer\"]').attr('content') || \n                   'Event Host';\n    \n    const publishDate = $('meta[property=\"event:start_time\"]').attr('content') || '';\n\n    return {\n      url,\n      platform: 'luma',\n      title,\n      description,\n      author,\n      publishDate,\n      image,\n      content: description,\n    };\n  } catch (error) {\n    console.error('Luma scraping error:', error);\n    return {\n      url,\n      platform: 'luma',\n      title: 'Luma Event',\n      description: 'Event from Luma',\n      author: 'Event Host',\n    };\n  }\n}\n\nasync function scrapeMeetup(url: string): Promise<ScrapedData> {\n  try {\n    const response = await axios.get(url, {\n      timeout: 15000,\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n      },\n    });\n\n    const $ = cheerio.load(response.data);\n    \n    const title = $('meta[property=\"og:title\"]').attr('content') || \n                  $('h1').first().text().trim() || \n                  'Meetup Event';\n    \n    const description = $('meta[property=\"og:description\"]').attr('content') || \n                       $('meta[name=\"description\"]').attr('content') || '';\n    \n    const image = $('meta[property=\"og:image\"]').attr('content') || '';\n    \n    const author = $('meta[property=\"event:organizer\"]').attr('content') || \n                   'Meetup Organizer';\n    \n    const publishDate = $('meta[property=\"event:start_time\"]').attr('content') || \n                       $('time[datetime]').attr('datetime') || '';\n\n    return {\n      url,\n      platform: 'meetup',\n      title,\n      description,\n      author,\n      publishDate,\n      image,\n      content: description,\n    };\n  } catch (error) {\n    console.error('Meetup scraping error:', error);\n    return {\n      url,\n      platform: 'meetup',\n      title: 'Meetup Event',\n      description: 'Event from Meetup',\n      author: 'Meetup Organizer',\n    };\n  }\n}\n\nasync function scrapePartiful(url: string): Promise<ScrapedData> {\n  try {\n    const response = await axios.get(url, {\n      timeout: 15000,\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n      },\n    });\n\n    const $ = cheerio.load(response.data);\n    \n    const title = $('meta[property=\"og:title\"]').attr('content') || \n                  $('h1').first().text().trim() || \n                  'Partiful Event';\n    \n    const description = $('meta[property=\"og:description\"]').attr('content') || \n                       $('meta[name=\"description\"]').attr('content') || '';\n    \n    const image = $('meta[property=\"og:image\"]').attr('content') || '';\n    \n    const author = 'Event Host';\n    const publishDate = $('meta[property=\"event:start_time\"]').attr('content') || '';\n\n    return {\n      url,\n      platform: 'partiful',\n      title,\n      description,\n      author,\n      publishDate,\n      image,\n      content: description,\n    };\n  } catch (error) {\n    console.error('Partiful scraping error:', error);\n    return {\n      url,\n      platform: 'partiful',\n      title: 'Partiful Event',\n      description: 'Event from Partiful',\n      author: 'Event Host',\n    };\n  }\n}\n\nexport async function scrapeByPlatform(url: string, platform: PlatformType): Promise<ScrapedData> {\n  try {\n    // Handle Spotify URLs\n    if (platform === 'spotify' || url.includes('spotify.com')) {\n      return scrapeSpotify(url);\n    }\n\n    // Handle generic audio URLs\n    if (platform === 'audio' || url.match(/\\.(mp3|wav|ogg|m4a|aac|flac)$/i)) {\n      return scrapeAudioUrl(url);\n    }\n\n    switch (platform) {\n      case 'youtube':\n        return await scrapeYouTube(url);\n      case 'medium':\n        return await scrapeMedium(url);\n      case 'substack':\n        return await scrapeSubstack(url);\n      case 'gitcoin':\n        return await scrapeGitcoin(url);\n      case 'giveth':\n        return await scrapeGiveth(url);\n      case 'tiktok':\n        return await scrapeTikTokOembed(url);\n      case 'instagram':\n        return await scrapeInstagramOembed(url);\n      case 'twitter':\n        return await scrapeTwitterNitter(url);\n      case 'github':\n        return await scrapeGitHub(url);\n      case 'farcaster':\n        return await scrapeFarcaster(url);\n      case 'twitch':\n        return await scrapeTwitch(url);\n      case 'eventbrite':\n        return await scrapeEventbrite(url);\n      case 'luma':\n        return await scrapeLuma(url);\n      case 'meetup':\n        return await scrapeMeetup(url);\n      case 'partiful':\n        return await scrapePartiful(url);\n      case 'blog':\n      default:\n        return await scrapeGenericBlog(url);\n    }\n  } catch (error) {\n    throw error;\n  }\n}","size_bytes":32826},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/pages/admin.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Loader2, DollarSign, TrendingUp, Users, Coins, Activity, BarChart3, BellRing, Settings, Wallet, EyeOff, Eye, Menu, Plus, Search, Gift, LineChart, Pin, PinOff, LogOut } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { cn } from \"@/lib/utils\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { NotificationTestingPanel } from \"@/components/notification-testing-panel\";\nimport { AdminMessagingPanel } from \"@/components/admin-messaging-panel\";\nimport { AdminMessageComposer } from \"@/components/admin-message-composer\";\nimport {\n  Sheet,\n  SheetTrigger,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport AdminNetwork from \"./admin-network\";\nimport AdminCreate from \"./admin-create\";\nimport { useLocation } from 'wouter';\n\nconst PLATFORM_FEE_ADDRESS = \"0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7\";\n\nexport default function Admin() {\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [activeTab, setActiveTab] = useState('overview');\n  const [notifType, setNotifType] = useState(\"points_earned\");\n  const [notifTitle, setNotifTitle] = useState(\"\");\n  const [notifMessage, setNotifMessage] = useState(\"\");\n  const [targetAddress, setTargetAddress] = useState(\"\");\n  const [mobileOpen, setMobileOpen] = useState(false);\n\n  // Check admin session on mount\n  useEffect(() => {\n    const checkSession = async () => {\n      try {\n        const response = await fetch('/api/admin/session', {\n          credentials: 'include',\n        });\n        const data = await response.json();\n\n        if (!data.authenticated) {\n          toast({\n            title: \"Authentication Required\",\n            description: \"Please log in to access the admin panel\",\n            variant: \"destructive\",\n          });\n          setLocation('/admin-login');\n        }\n      } catch (error) {\n        console.error('Session check failed:', error);\n        setLocation('/admin-login');\n      }\n    };\n\n    checkSession();\n  }, [setLocation, toast]);\n\n  const { data: stats, isLoading: isLoadingStats } = useQuery<any>({\n    queryKey: [\"/api/admin/stats\"],\n  });\n\n  const { data: creators = [], isLoading: isLoadingCreators, refetch: refetchCreators } = useQuery<any[]>({\n    queryKey: [\"/api/creators\"],\n    refetchOnWindowFocus: true,\n    refetchInterval: 30000,\n  });\n\n  const { data: users = [], isLoading: isLoadingUsersTable, refetch: refetchUsers } = useQuery<any[]>({\n    queryKey: [\"/api/users\"],\n    refetchOnWindowFocus: true,\n    refetchInterval: 30000,\n  });\n\n  const { data: coins = [], isLoading: isLoadingCoins } = useQuery<any[]>({\n    queryKey: [\"/api/coins\"],\n  });\n\n  const { data: userRewards = { users: [] }, isLoading: isLoadingRewards } = useQuery<any>({\n    queryKey: [\"/api/admin/user-rewards\"],\n    enabled: activeTab === 'tracking',\n  });\n\n  const { data: feesTracking, isLoading: isLoadingFees } = useQuery<any>({\n    queryKey: [\"/api/admin/fees-tracking\"],\n    enabled: activeTab === 'tracking',\n  });\n\n  const sendNotificationMutation = useMutation({\n    mutationFn: async (data: { type: string; title: string; message: string; address: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/notifications/send-test\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Test Notification Sent\",\n        description: \"Notification has been sent successfully\",\n      });\n      setNotifTitle(\"\");\n      setNotifMessage(\"\");\n      setTargetAddress(\"\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Send Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const hideCoinMutation = useMutation({\n    mutationFn: async (coinAddress: string) => {\n      const response = await apiRequest(\"POST\", `/api/admin/hide-coin/${coinAddress}`, {});\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Coin Hidden\",\n        description: \"The coin has been hidden from the frontend\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/coins\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Action Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const showCoinMutation = useMutation({\n    mutationFn: async (coinAddress: string) => {\n      const response = await apiRequest(\"POST\", `/api/admin/show-coin/${coinAddress}`, {});\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Coin Shown\",\n        description: \"The coin is now visible on the frontend\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/coins\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Action Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSendNotification = () => {\n    if (!notifTitle || !notifMessage) {\n      toast({\n        title: \"Missing Fields\",\n        description: \"Please fill in title and message\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    sendNotificationMutation.mutate({\n      type: notifType,\n      title: notifTitle,\n      message: notifMessage,\n      address: targetAddress || \"all\",\n    });\n  };\n\n  const { data: registryStats, isLoading: isLoadingRegistry } = useQuery<any>({\n    queryKey: [\"/api/admin/registry-stats\"],\n    enabled: activeTab === 'registry',\n    refetchInterval: 30000,\n  });\n\n  const menuItems = [\n    { id: 'overview', icon: BarChart3, label: 'Dashboard' },\n    { id: 'earnings', icon: DollarSign, label: 'Earnings' },\n    { id: 'users', icon: Users, label: 'Creators' },\n    { id: 'coins', icon: Coins, label: 'Coins' },\n    { id: 'create', icon: Plus, label: 'Create' },\n    { id: 'rewards', icon: Gift, label: 'Rewards' },\n    { id: 'tracking', icon: LineChart, label: 'Tracking' },\n    { id: 'registry', icon: Wallet, label: 'Registry' },\n    { id: 'network', icon: Activity, label: 'Network' },\n    { id: 'notifications', icon: BellRing, label: 'Notifications' },\n    { id: 'settings', icon: Settings, label: 'Settings' },\n  ];\n\n  const activeCoins = coins.filter((c: any) => c.status === 'active').length;\n  const pendingCoins = coins.filter((c: any) => c.status === 'pending').length;\n  const hiddenCoins = coins.filter((c: any) => c.hidden === true).length;\n\n  const handleLogout = async () => {\n    try {\n      await apiRequest('POST', '/api/admin/logout', {});\n      toast({ title: 'Logged out', description: 'You have been logged out successfully' });\n      setLocation('/admin-login');\n    } catch (err: any) {\n      toast({ title: 'Logout failed', description: err.message, variant: 'destructive' });\n    }\n  };\n\n  return (\n    <div className=\"flex h-screen bg-background\">\n      {/* Mobile Header */}\n      <div className=\"md:hidden fixed top-0 left-0 right-0 z-50 bg-card border-b border-border h-16 flex items-center justify-between px-4\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center\">\n            <BarChart3 className=\"w-5 h-5 text-primary\" />\n          </div>\n          <div>\n            <h1 className=\"text-sm font-semibold\">Admin Panel</h1>\n            <p className=\"text-xs text-muted-foreground\">Creatorland</p>\n          </div>\n        </div>\n        <Sheet open={mobileOpen} onOpenChange={setMobileOpen}>\n          <SheetTrigger asChild>\n            <Button variant=\"ghost\" size=\"icon\">\n              <Menu className=\"w-5 h-5\" />\n            </Button>\n          </SheetTrigger>\n          <SheetContent side=\"left\" className=\"w-64 p-0\">\n            <div className=\"p-4 border-b\">\n              <SheetTitle className=\"text-sm font-semibold\">Navigation</SheetTitle>\n            </div>\n            <div className=\"p-2\">\n              {menuItems.map((item) => (\n                <button\n                  key={item.id}\n                  onClick={() => {\n                    setActiveTab(item.id);\n                    setMobileOpen(false);\n                  }}\n                  className={cn(\n                    \"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors mb-1\",\n                    activeTab === item.id\n                      ? \"bg-primary text-primary-foreground\"\n                      : \"text-muted-foreground hover:bg-accent hover:text-accent-foreground\"\n                  )}\n                >\n                  <item.icon className=\"w-4 h-4\" />\n                  {item.label}\n                </button>\n              ))}\n            </div>\n          </SheetContent>\n        </Sheet>\n      </div>\n\n      {/* Desktop Sidebar */}\n      <div className=\"hidden md:flex w-64 flex-col border-r border-border bg-card\">\n        {/* Sidebar Header */}\n        <div className=\"p-6 border-b border-border\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center\">\n              <BarChart3 className=\"w-6 h-6 text-primary\" />\n            </div>\n            <div>\n              <h1 className=\"text-base font-semibold\">Admin Panel</h1>\n              <p className=\"text-xs text-muted-foreground\">Creatorland</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Navigation */}\n        <div className=\"flex-1 p-3\">\n          <div className=\"mb-2 px-3 text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n            Main\n          </div>\n          <div className=\"space-y-1\">\n            {menuItems.map((item) => (\n              <button\n                key={item.id}\n                onClick={() => setActiveTab(item.id)}\n                className={cn(\n                  \"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors\",\n                  activeTab === item.id\n                    ? \"bg-primary text-primary-foreground shadow-sm\"\n                    : \"text-muted-foreground hover:bg-accent hover:text-accent-foreground\"\n                )}\n                data-testid={`button-tab-${item.id}`}\n              >\n                <item.icon className=\"w-4 h-4\" />\n                {item.label}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Sidebar Footer */}\n        <div className=\"p-3 border-t border-border\">\n          <Button variant=\"ghost\" size=\"sm\" className=\"w-full justify-start gap-2 text-muted-foreground\" onClick={handleLogout}>\n            <LogOut className=\"w-4 h-4\" />\n            Log out\n          </Button>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        {/* Top Bar */}\n        <div className=\"hidden md:flex h-16 items-center justify-between px-6 border-b border-border bg-card\">\n          <div>\n            <h2 className=\"text-lg font-semibold\">\n              {menuItems.find(item => item.id === activeTab)?.label || 'Dashboard'}\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">Welcome back to your admin dashboard</p>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search...\"\n                className=\"pl-9 w-64 h-9 bg-background\"\n              />\n            </div>\n            <Button\n              size=\"sm\"\n              variant=\"destructive\"\n              className=\"gap-2\"\n              onClick={handleLogout}\n            >\n              <LogOut className=\"w-4 h-4\" />\n              Log out\n            </Button>\n          </div>\n        </div>\n\n        {/* Content Area */}\n        <div className=\"flex-1 overflow-y-auto p-6 mt-16 md:mt-0\">\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n            <TabsList className=\"grid w-full grid-cols-5 md:grid-cols-10\">\n              <TabsTrigger value=\"overview\">Dashboard</TabsTrigger>\n              <TabsTrigger value=\"earnings\">Earnings</TabsTrigger>\n              <TabsTrigger value=\"users\">Creators</TabsTrigger>\n              <TabsTrigger value=\"coins\">Coins</TabsTrigger>\n              <TabsTrigger value=\"create\">Create</TabsTrigger>\n              <TabsTrigger value=\"rewards\">Rewards</TabsTrigger>\n              <TabsTrigger value=\"tracking\">Tracking</TabsTrigger>\n              <TabsTrigger value=\"registry\">Registry</TabsTrigger>\n              <TabsTrigger value=\"notifications\">Notifications</TabsTrigger>\n              <TabsTrigger value=\"settings\">Settings</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"overview\" className=\"mt-6 space-y-6 max-w-7xl\">\n              {/* Stats Grid */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <Card className=\"border-l-4 border-l-blue-500\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">Total Users</p>\n                        <h3 className=\"text-2xl font-bold mt-2\">\n                          {isLoadingUsersTable || isLoadingCreators ? '...' : users.length + creators.length}\n                        </h3>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          {isLoadingUsersTable || isLoadingCreators ? '...' : `${users.length} active + ${creators.length} legacy`}\n                        </p>\n                      </div>\n                      <div className=\"w-12 h-12 rounded-full bg-blue-500/10 flex items-center justify-center\">\n                        <Users className=\"w-6 h-6 text-blue-500\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"border-l-4 border-l-green-500\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">Total Coins</p>\n                        <h3 className=\"text-2xl font-bold mt-2\">\n                          {isLoadingCoins ? '...' : coins.length}\n                        </h3>\n                        <p className=\"text-xs text-muted-foreground mt-1\">Across all creators</p>\n                      </div>\n                      <div className=\"w-12 h-12 rounded-full bg-green-500/10 flex items-center justify-center\">\n                        <Coins className=\"w-6 h-6 text-green-500\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"border-l-4 border-l-purple-500\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">Active Coins</p>\n                        <h3 className=\"text-2xl font-bold mt-2\">{activeCoins}</h3>\n                        <p className=\"text-xs text-muted-foreground mt-1\">{pendingCoins} pending</p>\n                      </div>\n                      <div className=\"w-12 h-12 rounded-full bg-purple-500/10 flex items-center justify-center\">\n                        <Activity className=\"w-6 h-6 text-purple-500\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"border-l-4 border-l-yellow-500\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">24h Volume</p>\n                        <h3 className=\"text-2xl font-bold mt-2\">${stats?.totalVolume || '0.00'}</h3>\n                        <p className=\"text-xs text-muted-foreground mt-1\">Total trading</p>\n                      </div>\n                      <div className=\"w-12 h-12 rounded-full bg-yellow-500/10 flex items-center justify-center\">\n                        <TrendingUp className=\"w-6 h-6 text-yellow-500\" />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Two Column Layout */}\n              <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                {/* Platform Config */}\n                <Card className=\"lg:col-span-2\">\n                  <CardHeader>\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <CardTitle className=\"text-base\">Platform Configuration</CardTitle>\n                        <CardDescription>System settings and addresses</CardDescription>\n                      </div>\n                      <Settings className=\"w-5 h-5 text-muted-foreground\" />\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-4\">\n                      <div>\n                        <Label className=\"text-xs font-medium text-muted-foreground\">Platform Fee Address</Label>\n                        <div className=\"flex items-center gap-2 mt-2 p-3 bg-muted rounded-lg\">\n                          <code className=\"text-xs font-mono flex-1 truncate\">\n                            {PLATFORM_FEE_ADDRESS}\n                          </code>\n                          <a\n                            href={`https://basescan.org/address/${PLATFORM_FEE_ADDRESS}`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"text-primary hover:text-primary/80\"\n                          >\n                            <Wallet className=\"w-4 h-4\" />\n                          </a>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Quick Stats */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-base\">Coin Status</CardTitle>\n                    <CardDescription>Distribution overview</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between p-3 bg-green-500/5 rounded-lg border border-green-500/20\">\n                        <div>\n                          <p className=\"text-xs font-medium text-muted-foreground\">Active</p>\n                          <p className=\"text-lg font-bold text-green-600\">{activeCoins}</p>\n                        </div>\n                        <div className=\"w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center\">\n                          <Activity className=\"w-5 h-5 text-green-600\" />\n                        </div>\n                      </div>\n                      <div className=\"flex items-center justify-between p-3 bg-yellow-500/5 rounded-lg border border-yellow-500/20\">\n                        <div>\n                          <p className=\"text-xs font-medium text-muted-foreground\">Pending</p>\n                          <p className=\"text-lg font-bold text-yellow-600\">{pendingCoins}</p>\n                        </div>\n                        <div className=\"w-10 h-10 rounded-full bg-yellow-500/10 flex items-center justify-center\">\n                          <Loader2 className=\"w-5 h-5 text-yellow-600\" />\n                        </div>\n                      </div>\n                      <div className=\"flex items-center justify-between p-3 bg-red-500/5 rounded-lg border border-red-500/20\">\n                        <div>\n                          <p className=\"text-xs font-medium text-muted-foreground\">Hidden</p>\n                          <p className=\"text-lg font-bold text-red-600\">{hiddenCoins}</p>\n                        </div>\n                        <div className=\"w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center\">\n                          <EyeOff className=\"w-5 h-5 text-red-600\" />\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"earnings\" className=\"mt-6 space-y-6 max-w-7xl\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Platform Earnings</CardTitle>\n                  <CardDescription>Real-time platform revenue and fee tracking</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid gap-6 md:grid-cols-3\">\n                    <div className=\"p-4 border border-border rounded-lg\">\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <div className=\"w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center\">\n                          <DollarSign className=\"w-5 h-5 text-green-500\" />\n                        </div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">Total Earnings</p>\n                      </div>\n                      <p className=\"text-3xl font-bold text-green-500\">\n                        ${stats?.totalEarnings || '0.00'}\n                      </p>\n                    </div>\n                    <div className=\"p-4 border border-border rounded-lg\">\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <div className=\"w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center\">\n                          <Coins className=\"w-5 h-5 text-blue-500\" />\n                        </div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">Platform Fees</p>\n                      </div>\n                      <p className=\"text-3xl font-bold text-blue-500\">\n                        ${stats?.platformFees || '0.00'}\n                      </p>\n                    </div>\n                    <div className=\"p-4 border border-border rounded-lg\">\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <div className=\"w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center\">\n                          <TrendingUp className=\"w-5 h-5 text-purple-500\" />\n                        </div>\n                        <p className=\"text-sm font-medium text-muted-foreground\">Trade Fees</p>\n                      </div>\n                      <p className=\"text-3xl font-bold text-purple-500\">\n                        ${stats?.tradeFees || '0.00'}\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"tracking\" className=\"mt-6 space-y-6 max-w-7xl\">\n              {/* Summary Cards */}\n              <div className=\"grid gap-4 md:grid-cols-3\">\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium\">Total Users Tracked</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{userRewards?.users?.length || 0}</div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">Registered users</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium\">Total Platform Fees</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{feesTracking?.summary?.totalPlatformFees || '0.0000'}</div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">{feesTracking?.summary?.platformFeeCount || 0} transactions</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium\">Total Trade Fees</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{feesTracking?.summary?.totalTradeFees || '0.0000'}</div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">{feesTracking?.summary?.tradeFeeCount || 0} transactions</p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* User Rewards Table */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>User Rewards Breakdown</CardTitle>\n                  <CardDescription>E1XP and Zora rewards per user</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {isLoadingRewards ? (\n                    <div className=\"flex items-center justify-center py-12\">\n                      <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                    </div>\n                  ) : !userRewards?.users || userRewards.users.length === 0 ? (\n                    <div className=\"text-center py-12 text-muted-foreground\">\n                      <Users className=\"w-12 h-12 mx-auto mb-3 opacity-20\" />\n                      <p>No user rewards data available</p>\n                    </div>\n                  ) : (\n                    <ScrollArea className=\"h-[400px]\">\n                      <div className=\"space-y-3\">\n                        {userRewards.users.map((user: any) => (\n                          <div key={user.userId} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                            <div className=\"flex-1\">\n                              <p className=\"font-medium text-sm\">{user.username}</p>\n                              <p className=\"text-xs text-muted-foreground font-mono\">{user.address.slice(0, 10)}...{user.address.slice(-8)}</p>\n                            </div>\n                            <div className=\"flex gap-6 text-right\">\n                              <div>\n                                <p className=\"text-[10px] text-muted-foreground\">Coins</p>\n                                <p className=\"text-xs font-semibold\">{user.totalCoins || 0}</p>\n                              </div>\n                              <div>\n                                <p className=\"text-[10px] text-muted-foreground\">Earnings</p>\n                                <p className=\"text-xs font-semibold text-green-500\">\n                                  ${(parseFloat(user.totalEarnings || '0')).toFixed(2)}\n                                </p>\n                              </div>\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">E1XP</p>\n                                <p className=\"font-semibold\">{user.e1xpRewards?.total || 0}</p>\n                                <p className=\"text-xs text-muted-foreground\">({user.e1xpRewards?.count || 0} rewards)</p>\n                              </div>\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Zora</p>\n                                <p className=\"font-semibold\">{user.zoraRewards?.total || '0.0000'}</p>\n                                <p className=\"text-xs text-muted-foreground\">({user.zoraRewards?.count || 0} rewards)</p>\n                              </div>\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Total Points</p>\n                                <p className=\"font-semibold\">{user.totalPoints || 0}</p>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </ScrollArea>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Fees by Coin */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Fees by Coin</CardTitle>\n                  <CardDescription>Platform and trade fees breakdown per coin</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {isLoadingFees ? (\n                    <div className=\"flex items-center justify-center py-12\">\n                      <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                    </div>\n                  ) : !feesTracking?.feesByCoin || feesTracking.feesByCoin.length === 0 ? (\n                    <div className=\"text-center py-12 text-muted-foreground\">\n                      <Coins className=\"w-12 h-12 mx-auto mb-3 opacity-20\" />\n                      <p>No fee tracking data available</p>\n                    </div>\n                  ) : (\n                    <ScrollArea className=\"h-[300px]\">\n                      <div className=\"space-y-3\">\n                        {feesTracking.feesByCoin.map((coin: any, idx: number) => (\n                          <div key={idx} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                            <div className=\"flex-1\">\n                              <p className=\"font-medium text-sm\">{coin.coinSymbol}</p>\n                              <p className=\"text-xs text-muted-foreground font-mono\">{coin.coinAddress?.slice(0, 10)}...{coin.coinAddress?.slice(-8)}</p>\n                            </div>\n                            <div className=\"flex gap-6 text-right\">\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Platform Fees</p>\n                                <p className=\"font-semibold\">{coin.platformFees?.toFixed(4) || '0.0000'}</p>\n                              </div>\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Trade Fees</p>\n                                <p className=\"font-semibold\">{coin.tradeFees?.toFixed(4) || '0.0000'}</p>\n                              </div>\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Transactions</p>\n                                <p className=\"font-semibold\">{coin.transactionCount || 0}</p>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </ScrollArea>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"users\" className=\"mt-6 space-y-6 max-w-7xl\">\n              {/* Summary Cards */}\n              <div className=\"grid gap-4 md:grid-cols-3\">\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium\">Total Users</CardTitle>\n                    <CardDescription>All registered users</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{users.length + creators.length}</div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">Active + Legacy</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium\">Active Users</CardTitle>\n                    <CardDescription>Privy authentication</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{users.length}</div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">New system</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium\">Legacy Users</CardTitle>\n                    <CardDescription>Old authentication</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{creators.length}</div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">May have duplicates</p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Unified Users Table */}\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <CardTitle>All Users</CardTitle>\n                      <CardDescription>Complete user database (Active + Legacy)</CardDescription>\n                    </div>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        refetchUsers();\n                        refetchCreators();\n                        toast({ title: \"Refreshed\", description: \"User lists updated\" });\n                      }}\n                      data-testid=\"button-refresh-users\"\n                    >\n                      <Activity className=\"w-4 h-4 mr-1\" />\n                      Refresh\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <ScrollArea className=\"h-[600px] pr-4\">\n                    <div className=\"space-y-2\">\n                      {isLoadingUsersTable || isLoadingCreators ? (\n                        <div className=\"flex items-center justify-center py-12\">\n                          <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                        </div>\n                      ) : (\n                        <>\n                          {/* Active Users First - sorted by date */}\n                          {[...users]\n                            .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n                            .map((user: any) => (\n                            <div key={`user-${user.id}`} className=\"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/50 transition-colors\">\n                              <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n                                <Avatar className=\"w-10 h-10 flex-shrink-0\">\n                                  <AvatarImage src={user.avatarUrl} />\n                                  <AvatarFallback className=\"bg-primary/10 text-primary text-xs\">\n                                    {(user.displayName || user.username || 'A').charAt(0).toUpperCase()}\n                                  </AvatarFallback>\n                                </Avatar>\n                                <div className=\"flex-1 min-w-0\">\n                                  <div className=\"flex items-center gap-2 flex-wrap\">\n                                    <p className=\"font-medium text-sm truncate\">{user.displayName || user.username || 'Anonymous'}</p>\n                                    <Badge variant=\"default\" className=\"text-[10px] bg-green-600\">Active</Badge>\n                                    {user.isAdmin === 1 && (\n                                      <Badge variant=\"destructive\" className=\"text-[10px]\">Admin</Badge>\n                                    )}\n                                  </div>\n                                  <div className=\"flex items-center gap-3 mt-1 flex-wrap text-[10px] text-muted-foreground\">\n                                    <span>@{user.username}</span>\n                                    <span className=\"font-mono\">{user.walletAddress?.slice(0, 6)}...{user.walletAddress?.slice(-4)}</span>\n                                    <span>üìÖ {new Date(user.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: 'numeric', minute: '2-digit' })}</span>\n                                    {user.totalConnections > 0 && <span>üë• {user.totalConnections}</span>}\n                                    {user.totalProfileViews > 0 && <span>üëÅÔ∏è {user.totalProfileViews}</span>}\n                                  </div>\n                                </div>\n                              </div>\n                              <div className=\"flex items-center gap-2 flex-shrink-0 ml-3\">\n                                <div className=\"text-right mr-2\">\n                                  <p className=\"text-[10px] text-muted-foreground\">Coins</p>\n                                  <p className=\"text-xs font-semibold\">{user.totalCoins || 0}</p>\n                                </div>\n                                <div className=\"text-right mr-2\">\n                                  <p className=\"text-[10px] text-muted-foreground\">Earnings</p>\n                                  <p className=\"text-xs font-semibold text-green-500\">\n                                    ${(parseFloat(user.totalEarnings || '0')).toFixed(2)}\n                                  </p>\n                                </div>\n                                <div className=\"text-right mr-2\">\n                                  <p className=\"text-[10px] text-muted-foreground\">E1XP</p>\n                                  <p className=\"text-sm font-semibold\">{user.e1xpPoints || 0}</p>\n                                </div>\n                                {!user.isAdmin && (\n                                  <>\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      className=\"h-8 px-2 text-xs\"\n                                      onClick={async () => {\n                                        try {\n                                          await apiRequest('POST', `/api/admin/hide-creator/${user.walletAddress}`, {});\n                                          toast({ title: 'User Hidden', description: `${user.username} has been hidden` });\n                                          queryClient.invalidateQueries({ queryKey: ['/api/users'] });\n                                        } catch (err: any) {\n                                          toast({ title: 'Failed', description: err.message || String(err), variant: 'destructive' });\n                                        }\n                                      }}\n                                    >\n                                      Hide\n                                    </Button>\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"destructive\"\n                                      className=\"h-8 px-2 text-xs\"\n                                      onClick={async () => {\n                                        if (!confirm(`Remove user ${user.username}? This will ban their account.`)) return;\n                                        try {\n                                          await apiRequest('POST', `/api/admin/remove-creator/${user.walletAddress}`, {});\n                                          toast({ title: 'User Removed', description: `${user.username} has been removed` });\n                                          queryClient.invalidateQueries({ queryKey: ['/api/users'] });\n                                        } catch (err: any) {\n                                          toast({ title: 'Failed', description: err.message || String(err), variant: 'destructive' });\n                                        }\n                                      }}\n                                    >\n                                      Remove\n                                    </Button>\n                                  </>\n                                )}\n                              </div>\n                            </div>\n                          ))}\n\n                          {/* Legacy Creators - sorted by date */}\n                          {[...creators]\n                            .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n                            .map((creator: any) => (\n                            <div key={`creator-${creator.id}`} className=\"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/50 transition-colors bg-muted/10\">\n                              <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n                                <Avatar className=\"w-10 h-10 flex-shrink-0\">\n                                  <AvatarImage src={creator.avatar} />\n                                  <AvatarFallback className=\"bg-muted text-muted-foreground text-xs\">\n                                    {(creator.name || 'L').charAt(0).toUpperCase()}\n                                  </AvatarFallback>\n                                </Avatar>\n                                <div className=\"flex-1 min-w-0\">\n                                  <div className=\"flex items-center gap-2 flex-wrap\">\n                                    <p className=\"font-medium text-sm truncate\">{creator.name || 'No Name'}</p>\n                                    <Badge variant=\"secondary\" className=\"text-[10px]\">Legacy</Badge>\n                                    {creator.verified === 'true' && (\n                                      <Badge variant=\"default\" className=\"text-[10px]\">Verified</Badge>\n                                    )}\n                                  </div>\n                                  <div className=\"flex items-center gap-3 mt-1 flex-wrap text-[10px] text-muted-foreground\">\n                                    <span className=\"font-mono\">{creator.address?.slice(0, 6)}...{creator.address?.slice(-4)}</span>\n                                    <span>üìÖ {new Date(creator.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: 'numeric', minute: '2-digit' })}</span>\n                                    {creator.totalCoins && parseInt(creator.totalCoins) > 0 && <span>ü™ô {creator.totalCoins} coins</span>}\n                                    {creator.privyId && <span>üîó Privy</span>}\n                                  </div>\n                                </div>\n                              </div>\n                              <div className=\"flex items-center gap-2 flex-shrink-0 ml-3\">\n                                <div className=\"text-right mr-2\">\n                                  <p className=\"text-[10px] text-muted-foreground\">Coins</p>\n                                  <p className=\"text-xs font-semibold\">{creator.totalCoins || 0}</p>\n                                </div>\n                                <div className=\"text-right mr-2\">\n                                  <p className=\"text-[10px] text-muted-foreground\">Earnings</p>\n                                  <p className=\"text-xs font-semibold text-green-500\">\n                                    ${(parseFloat(creator.totalEarnings || '0')).toFixed(2)}\n                                  </p>\n                                </div>\n                                <div className=\"text-right mr-2\">\n                                  <p className=\"text-[10px] text-muted-foreground\">Points</p>\n                                  <p className=\"text-sm font-semibold\">{creator.points || 0}</p>\n                                </div>\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"ghost\"\n                                  className=\"h-8 px-2 text-xs\"\n                                  onClick={async () => {\n                                    try {\n                                      await apiRequest('POST', `/api/admin/hide-creator/${creator.address}`, {});\n                                      toast({ title: 'Creator Hidden', description: `${creator.name || creator.address} has been hidden` });\n                                      queryClient.invalidateQueries({ queryKey: ['/api/creators'] });\n                                    } catch (err: any) {\n                                      toast({ title: 'Failed', description: err.message || String(err), variant: 'destructive' });\n                                    }\n                                  }}\n                                >\n                                  Hide\n                                </Button>\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"destructive\"\n                                  className=\"h-8 px-2 text-xs\"\n                                  onClick={async () => {\n                                    if (!confirm(`Remove creator ${creator.name || creator.address}? This will ban their account.`)) return;\n                                    try {\n                                      await apiRequest('POST', `/api/admin/remove-creator/${creator.address}`, {});\n                                      toast({ title: 'Creator Removed', description: `${creator.name || creator.address} has been removed` });\n                                      queryClient.invalidateQueries({ queryKey: ['/api/creators'] });\n                                    } catch (err: any) {\n                                      toast({ title: 'Failed', description: err.message || String(err), variant: 'destructive' });\n                                    }\n                                  }}\n                                >\n                                  Remove\n                                </Button>\n                              </div>\n                            </div>\n                          ))}\n\n                          {users.length === 0 && creators.length === 0 && (\n                            <div className=\"text-center py-12 text-muted-foreground\">\n                              <Users className=\"w-12 h-12 mx-auto mb-3 opacity-20\" />\n                              <p>No users found</p>\n                            </div>\n                          )}\n                        </>\n                      )}\n                    </div>\n                  </ScrollArea>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"coins\" className=\"mt-6 space-y-6 max-w-7xl\">\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <CardTitle>Coin Management</CardTitle>\n                      <CardDescription>Manage coin visibility and status</CardDescription>\n                    </div>\n                    <Button size=\"sm\" className=\"gap-2\">\n                      <Plus className=\"w-4 h-4\" />\n                      Add Coin\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <ScrollArea className=\"h-[500px] pr-4\">\n                    <div className=\"space-y-3\">\n                      {isLoadingCoins ? (\n                        <div className=\"flex items-center justify-center py-12\">\n                          <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                        </div>\n                      ) : coins.length === 0 ? (\n                        <div className=\"text-center py-12 text-muted-foreground\">\n                          <Coins className=\"w-12 h-12 mx-auto mb-3 opacity-20\" />\n                          <p>No coins found</p>\n                        </div>\n                      ) : (\n                        coins.map((coin: any) => (\n                          <div key={coin.id} className=\"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-accent/50 transition-colors\">\n                            <div className=\"flex items-center gap-3 flex-1\">\n                              <div className=\"w-10 h-10 rounded-lg bg-muted flex items-center justify-center overflow-hidden border border-border\">\n                                {coin.image ? (\n                                  <img src={coin.image} alt={coin.name} className=\"w-full h-full object-cover\" />\n                                ) : (\n                                  <Coins className=\"w-5 h-5 text-muted-foreground\" />\n                                )}\n                              </div>\n                              <div className=\"flex-1\">\n                                <div className=\"flex items-center gap-2\">\n                                  <p className=\"font-medium text-sm\">{coin.name}</p>\n                                  <p className=\"text-xs text-muted-foreground font-mono\">${coin.symbol}</p>\n                                </div>\n                                {coin.address && (\n                                  <p className=\"text-[10px] text-muted-foreground font-mono\">\n                                    üìç {coin.address.slice(0, 10)}...{coin.address.slice(-8)}\n                                  </p>\n                                )}\n                                <div className=\"flex items-center gap-3 mt-1.5 flex-wrap\">\n                                  <p className=\"text-[10px] text-muted-foreground\">\n                                    üìÖ Created: {new Date(coin.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} at {new Date(coin.createdAt).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}\n                                  </p>\n                                  {coin.registeredAt && (\n                                    <p className=\"text-[10px] text-muted-foreground\">\n                                      ‚õìÔ∏è Registered: {new Date(coin.registeredAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} at {new Date(coin.registeredAt).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}\n                                    </p>\n                                  )}\n                                  {coin.creatorWallet && (\n                                    <p className=\"text-[10px] text-muted-foreground font-mono\">\n                                      üë§ Creator: {coin.creatorWallet.slice(0, 6)}...{coin.creatorWallet.slice(-4)}\n                                    </p>\n                                  )}\n                                  {coin.chainId && (\n                                    <p className=\"text-[10px] text-muted-foreground\">\n                                      üîó Chain ID: {coin.chainId}\n                                    </p>\n                                  )}\n                                  {coin.registryTxHash && (\n                                    <p className=\"text-[10px] text-muted-foreground font-mono\">\n                                      üìú Registry Tx: {coin.registryTxHash.slice(0, 8)}...{coin.registryTxHash.slice(-6)}\n                                    </p>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Badge variant={coin.status === 'active' ? 'default' : 'secondary'} className=\"text-xs\">\n                                {coin.status}\n                              </Badge>\n                              {coin.hidden && (\n                                <Badge variant=\"destructive\" className=\"text-xs\">Hidden</Badge>\n                              )}\n                              {coin.pinOrder && (\n                                <Badge variant=\"default\" className=\"text-xs bg-primary/10 text-primary border-primary/20\">\n                                  <Pin className=\"w-3 h-3 mr-1\" />\n                                  Pinned #{coin.pinOrder}\n                                </Badge>\n                              )}\n                              <Button\n                                size=\"sm\"\n                                variant={coin.pinOrder ? \"outline\" : \"ghost\"}\n                                className={coin.pinOrder ? \"border-primary/20 text-primary hover:bg-primary/10\" : \"hover:bg-accent\"}\n                                onClick={async () => {\n                                  try {\n                                    const action = coin.pinOrder ? 'unpin' : 'pin';\n                                    await apiRequest('POST', `/api/admin/${action}-coin/${coin.address}`, {});\n                                    toast({\n                                      title: coin.pinOrder ? 'Coin Unpinned' : 'Coin Pinned',\n                                      description: coin.pinOrder ? `${coin.symbol} removed from home page` : `${coin.symbol} will appear on home page`\n                                    });\n                                    queryClient.invalidateQueries({ queryKey: ['/api/coins'] });\n                                  } catch (err: any) {\n                                    toast({\n                                      title: 'Failed',\n                                      description: err.message || String(err),\n                                      variant: 'destructive'\n                                    });\n                                  }\n                                }}\n                                title={coin.pinOrder ? 'Unpin from home page' : 'Pin to home page (max 6)'}\n                              >\n                                {coin.pinOrder ? (\n                                  <PinOff className=\"w-4 h-4\" />\n                                ) : (\n                                  <Pin className=\"w-4 h-4\" />\n                                )}\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => coin.hidden ? showCoinMutation.mutate(coin.address) : hideCoinMutation.mutate(coin.address)}\n                                disabled={hideCoinMutation.isPending || showCoinMutation.isPending}\n                                data-testid={`button-toggle-${coin.id}`}\n                              >\n                                {coin.hidden ? <Eye className=\"w-4 h-4\" /> : <EyeOff className=\"w-4 h-4\" />}\n                              </Button>\n                            </div>\n                          </div>\n                        ))\n                      )}\n                    </div>\n                  </ScrollArea>\n\n                  <div className=\"mt-6 pt-6 border-t border-border\">\n                    <h3 className=\"text-sm font-semibold mb-4\">Create New Coin</h3>\n                    <div className=\"grid gap-3 sm:grid-cols-3\">\n                      <Input placeholder=\"Name\" id=\"admin-coin-name\" className=\"h-9\" />\n                      <Input placeholder=\"Symbol\" id=\"admin-coin-symbol\" className=\"h-9\" />\n                      <Input placeholder=\"Creator Address (optional)\" id=\"admin-coin-creator\" className=\"h-9\" />\n                    </div>\n                    <Button\n                      className=\"mt-3 gap-2\"\n                      size=\"sm\"\n                      onClick={async () => {\n                        const name = (document.getElementById('admin-coin-name') as HTMLInputElement).value;\n                        const symbol = (document.getElementById('admin-coin-symbol') as HTMLInputElement).value;\n                        const creator = (document.getElementById('admin-coin-creator') as HTMLInputElement).value;\n                        if (!name || !symbol) {\n                          toast({ title: 'Missing fields', description: 'Name and symbol required', variant: 'destructive' });\n                          return;\n                        }\n                        try {\n                          await apiRequest('POST', '/api/admin/create-coin', { name, symbol, creatorAddress: creator });\n                          toast({ title: 'Coin created', description: 'Coin created successfully' });\n                          queryClient.invalidateQueries({ queryKey: ['/api/coins'] });\n                        } catch (err: any) {\n                          toast({ title: 'Create failed', description: err.message || String(err), variant: 'destructive' });\n                        }\n                      }}\n                    >\n                      <Plus className=\"w-4 h-4\" />\n                      Create Coin\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"create\" className=\"mt-6 space-y-6 max-w-4xl\">\n              <AdminCreate />\n            </TabsContent>\n\n            <TabsContent value=\"rewards\" className=\"mt-6 space-y-6 max-w-4xl\">\n              <Card className=\"border-none shadow-sm\">\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center\">\n                      <Gift className=\"w-5 h-5 text-primary\" />\n                    </div>\n                    <div>\n                      <CardTitle className=\"text-lg\">E1XP Rewards</CardTitle>\n                      <CardDescription>Gift E1XP points to users</CardDescription>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"grid gap-3 sm:grid-cols-2\">\n                      <div>\n                        <Label htmlFor=\"gift-recipients\" className=\"text-sm font-medium\">Recipient Address</Label>\n                        <Input\n                          id=\"gift-recipients\"\n                          placeholder=\"0x... or comma-separated\"\n                          className=\"mt-1.5 h-9\"\n                          data-testid=\"input-gift-recipients\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"gift-amount\" className=\"text-sm font-medium\">Amount</Label>\n                        <Input\n                          id=\"gift-amount\"\n                          placeholder=\"10\"\n                          type=\"number\"\n                          defaultValue=\"10\"\n                          className=\"mt-1.5 h-9\"\n                          data-testid=\"input-gift-amount\"\n                        />\n                      </div>\n                    </div>\n                    <div>\n                      <Label htmlFor=\"gift-reason\" className=\"text-sm font-medium\">Reason (optional)</Label>\n                      <Textarea\n                        id=\"gift-reason\"\n                        placeholder=\"Why are you gifting E1XP?\"\n                        rows={3}\n                        className=\"mt-1.5\"\n                        data-testid=\"input-gift-reason\"\n                      />\n                    </div>\n                    <div className=\"flex items-center gap-2 p-3 bg-muted/50 rounded-lg\">\n                      <input\n                        id=\"gift-all\"\n                        type=\"checkbox\"\n                        className=\"rounded h-4 w-4\"\n                        data-testid=\"checkbox-gift-all\"\n                      />\n                      <Label htmlFor=\"gift-all\" className=\"text-sm cursor-pointer font-normal\">\n                        Send to all registered users\n                      </Label>\n                    </div>\n                    <Button onClick={async () => {\n                      const recipientsRaw = (document.getElementById('gift-recipients') as HTMLInputElement).value;\n                      const amount = (document.getElementById('gift-amount') as HTMLInputElement).value;\n                      const reason = (document.getElementById('gift-reason') as HTMLTextAreaElement).value;\n                      const sendAll = (document.getElementById('gift-all') as HTMLInputElement).checked;\n\n                      if (!sendAll && !recipientsRaw) {\n                        toast({ title: 'Missing fields', description: 'Recipients or \"Send to all\" required', variant: 'destructive' });\n                        return;\n                      }\n                      if (!amount) {\n                        toast({ title: 'Missing fields', description: 'Amount required', variant: 'destructive' });\n                        return;\n                      }\n\n                      const payload: any = { amount, reason };\n                      if (sendAll) {\n                        payload.all = true;\n                      } else {\n                        payload.recipients = recipientsRaw.split(',').map(s => s.trim()).filter(Boolean);\n                      }\n\n                      try {\n                        const response = await apiRequest('POST', '/api/admin/gift-e1xp', payload);\n                        const result = await response.json();\n                        toast({\n                          title: 'E1XP Gifts Sent Successfully',\n                          description: sendAll\n                            ? `Sent ${amount} E1XP to all ${result.recipients || 0} users`\n                            : `Sent ${amount} E1XP to ${result.recipients || 0} recipients`\n                        });\n\n                        (document.getElementById('gift-recipients') as HTMLInputElement).value = '';\n                        (document.getElementById('gift-amount') as HTMLInputElement).value = '10';\n                        (document.getElementById('gift-reason') as HTMLTextAreaElement).value = '';\n                        (document.getElementById('gift-all') as HTMLInputElement).checked = false;\n                      } catch (err: any) {\n                        toast({ title: 'Send failed', description: err.message || String(err), variant: 'destructive' });\n                      }\n                    }} className=\"w-full gap-2\" data-testid=\"button-send-gift\">\n                      <Gift className=\"w-4 h-4\" />\n                      Send E1XP Gift\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"border-none shadow-sm\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-base\">Quick Actions</CardTitle>\n                  <CardDescription>Common reward amounts</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-2\">\n                    {[10, 50, 100, 500].map(amt => (\n                      <Button\n                        key={amt}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"h-16 flex flex-col gap-1\"\n                        onClick={() => {\n                          (document.getElementById('gift-amount') as HTMLInputElement).value = amt.toString();\n                        }}\n                        data-testid={`button-quick-${amt}`}\n                      >\n                        <Gift className=\"w-4 h-4 text-primary\" />\n                        <span className=\"font-semibold\">{amt} E1XP</span>\n                      </Button>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"tracking\" className=\"mt-6 space-y-6 max-w-7xl\">\n              {/* Summary Cards */}\n              <div className=\"grid gap-4 md:grid-cols-3\">\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium\">Total Users Tracked</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{userRewards?.users?.length || 0}</div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">Registered users</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium\">Total Platform Fees</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{feesTracking?.summary?.totalPlatformFees || '0.0000'}</div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">{feesTracking?.summary?.platformFeeCount || 0} transactions</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-sm font-medium\">Total Trade Fees</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\">{feesTracking?.summary?.totalTradeFees || '0.0000'}</div>\n                    <p className=\"text-xs text-muted-foreground mt-1\">{feesTracking?.summary?.tradeFeeCount || 0} transactions</p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* User Rewards Table */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>User Rewards Breakdown</CardTitle>\n                  <CardDescription>E1XP and Zora rewards per user</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {isLoadingRewards ? (\n                    <div className=\"flex items-center justify-center py-12\">\n                      <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                    </div>\n                  ) : !userRewards?.users || userRewards.users.length === 0 ? (\n                    <div className=\"text-center py-12 text-muted-foreground\">\n                      <Users className=\"w-12 h-12 mx-auto mb-3 opacity-20\" />\n                      <p>No user rewards data available</p>\n                    </div>\n                  ) : (\n                    <ScrollArea className=\"h-[400px]\">\n                      <div className=\"space-y-3\">\n                        {userRewards.users.map((user: any) => (\n                          <div key={user.userId} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                            <div className=\"flex-1\">\n                              <p className=\"font-medium text-sm\">{user.username}</p>\n                              <p className=\"text-xs text-muted-foreground font-mono\">{user.address.slice(0, 10)}...{user.address.slice(-8)}</p>\n                            </div>\n                            <div className=\"flex gap-6 text-right\">\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">E1XP</p>\n                                <p className=\"font-semibold\">{user.e1xpRewards?.total || 0}</p>\n                                <p className=\"text-xs text-muted-foreground\">({user.e1xpRewards?.count || 0} rewards)</p>\n                              </div>\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Zora</p>\n                                <p className=\"font-semibold\">{user.zoraRewards?.total || '0.0000'}</p>\n                                <p className=\"text-xs text-muted-foreground\">({user.zoraRewards?.count || 0} rewards)</p>\n                              </div>\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Total Points</p>\n                                <p className=\"font-semibold\">{user.totalPoints || 0}</p>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </ScrollArea>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Fees by Coin */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Fees by Coin</CardTitle>\n                  <CardDescription>Platform and trade fees breakdown per coin</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {isLoadingFees ? (\n                    <div className=\"flex items-center justify-center py-12\">\n                      <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                    </div>\n                  ) : !feesTracking?.feesByCoin || feesTracking.feesByCoin.length === 0 ? (\n                    <div className=\"text-center py-12 text-muted-foreground\">\n                      <Coins className=\"w-12 h-12 mx-auto mb-3 opacity-20\" />\n                      <p>No fee tracking data available</p>\n                    </div>\n                  ) : (\n                    <ScrollArea className=\"h-[300px]\">\n                      <div className=\"space-y-3\">\n                        {feesTracking.feesByCoin.map((coin: any, idx: number) => (\n                          <div key={idx} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                            <div className=\"flex-1\">\n                              <p className=\"font-medium text-sm\">{coin.coinSymbol}</p>\n                              <p className=\"text-xs text-muted-foreground font-mono\">{coin.coinAddress?.slice(0, 10)}...{coin.coinAddress?.slice(-8)}</p>\n                            </div>\n                            <div className=\"flex gap-6 text-right\">\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Platform Fees</p>\n                                <p className=\"font-semibold\">{coin.platformFees?.toFixed(4) || '0.0000'}</p>\n                              </div>\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Trade Fees</p>\n                                <p className=\"font-semibold\">{coin.tradeFees?.toFixed(4) || '0.0000'}</p>\n                              </div>\n                              <div>\n                                <p className=\"text-xs text-muted-foreground\">Transactions</p>\n                                <p className=\"font-semibold\">{coin.transactionCount || 0}</p>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </ScrollArea>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"notifications\" className=\"mt-6 space-y-6 max-w-4xl\">\n              <AdminMessageComposer />\n\n              <Card className=\"border-none shadow-sm\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-lg\">Test Notifications</CardTitle>\n                  <CardDescription>Send test notifications to users</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div>\n                    <Label htmlFor=\"notif-type\" className=\"text-sm font-medium\">Notification Type</Label>\n                    <Select value={notifType} onValueChange={setNotifType}>\n                      <SelectTrigger id=\"notif-type\" data-testid=\"select-notif-type\" className=\"mt-1.5 h-9\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"points_earned\">Points Earned</SelectItem>\n                        <SelectItem value=\"trade_completed\">Trade Completed</SelectItem>\n                        <SelectItem value=\"milestone_reached\">Milestone Reached</SelectItem>\n                        <SelectItem value=\"new_follower\">New Follower</SelectItem>\n                        <SelectItem value=\"system_alert\">System Alert</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"notif-title\" className=\"text-sm font-medium\">Title</Label>\n                    <Input\n                      id=\"notif-title\"\n                      value={notifTitle}\n                      onChange={(e) => setNotifTitle(e.target.value)}\n                      placeholder=\"Enter notification title\"\n                      data-testid=\"input-notif-title\"\n                      className=\"mt-1.5 h-9\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"notif-message\" className=\"text-sm font-medium\">Message</Label>\n                    <Textarea\n                      id=\"notif-message\"\n                      value={notifMessage}\n                      onChange={(e) => setNotifMessage(e.target.value)}\n                      placeholder=\"Enter notification message\"\n                      rows={3}\n                      data-testid=\"input-notif-message\"\n                      className=\"mt-1.5\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"target-address\" className=\"text-sm font-medium\">Target Address</Label>\n                    <Input\n                      id=\"target-address\"\n                      value={targetAddress}\n                      onChange={(e) => setTargetAddress(e.target.value)}\n                      placeholder=\"0x... or leave empty for all\"\n                      data-testid=\"input-target-address\"\n                      className=\"mt-1.5 h-9\"\n                    />\n                    <p className=\"text-xs text-muted-foreground mt-1.5\">Leave empty to send to all users</p>\n                  </div>\n\n                  <Button\n                    onClick={handleSendNotification}\n                    disabled={sendNotificationMutation.isPending}\n                    className=\"w-full gap-2\"\n                    data-testid=\"button-send-notification\"\n                  >\n                    {sendNotificationMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"w-4 h-4 animate-spin\" />\n                        Sending...\n                      </>\n                    ) : (\n                      <>\n                        <BellRing className=\"w-4 h-4\" />\n                        Send Test Notification\n                      </>\n                    )}\n                  </Button>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"settings\" className=\"mt-6 space-y-6 max-w-4xl\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Platform Settings</CardTitle>\n                  <CardDescription>Configure platform-wide settings and notifications</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <NotificationTestingPanel />\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"messaging\" className=\"mt-6 space-y-6 max-w-4xl\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>User Messaging</CardTitle>\n                  <CardDescription>Send real-time messages to users via Socket.io</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <AdminMessagingPanel />\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"registry\" className=\"mt-6 space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>On-Chain Registry</CardTitle>\n                  <CardDescription>\n                    CoinRegistry deployed on Base Mainnet - tracks all platform coins on-chain\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {isLoadingRegistry ? (\n                    <div className=\"flex items-center justify-center py-12\">\n                      <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                    </div>\n                  ) : !registryStats ? (\n                    <div className=\"text-center py-12 text-muted-foreground\">\n                      <Wallet className=\"w-12 h-12 mx-auto mb-3 opacity-20\" />\n                      <p>Registry not configured</p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-6\">\n                      {/* Contract Info */}\n                      <div className=\"p-4 bg-muted rounded-lg space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-sm text-muted-foreground\">Contract Address</span>\n                          <a\n                            href={`https://basescan.org/address/${registryStats.contractAddress}`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"text-sm font-mono hover:underline\"\n                            data-testid=\"link-registry-contract\"\n                          >\n                            {registryStats.contractAddress?.slice(0, 8)}...{registryStats.contractAddress?.slice(-6)}\n                          </a>\n                        </div>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-sm text-muted-foreground\">Network</span>\n                          <span className=\"text-sm font-medium\">Base Mainnet</span>\n                        </div>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-sm text-muted-foreground\">Platform Wallet</span>\n                          <span className=\"text-sm font-mono\">\n                            {registryStats.platformWallet?.slice(0, 8)}...{registryStats.platformWallet?.slice(-6)}\n                          </span>\n                        </div>\n                      </div>\n\n                      {/* Stats Grid */}\n                      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                        <Card>\n                          <CardHeader className=\"pb-2\">\n                            <CardDescription className=\"text-xs\">Total Registered</CardDescription>\n                            <CardTitle className=\"text-2xl\">{registryStats.totalOnChain || 0}</CardTitle>\n                          </CardHeader>\n                        </Card>\n                        <Card>\n                          <CardHeader className=\"pb-2\">\n                            <CardDescription className=\"text-xs\">Pending</CardDescription>\n                            <CardTitle className=\"text-2xl\">{registryStats.pending || 0}</CardTitle>\n                          </CardHeader>\n                        </Card>\n                        <Card>\n                          <CardHeader className=\"pb-2\">\n                            <CardDescription className=\"text-xs\">Registering</CardDescription>\n                            <CardTitle className=\"text-2xl\">{registryStats.registering || 0}</CardTitle>\n                          </CardHeader>\n                        </Card>\n                        <Card>\n                          <CardHeader className=\"pb-2\">\n                            <CardDescription className=\"text-xs\">Failed</CardDescription>\n                            <CardTitle className=\"text-2xl\">{registryStats.failed || 0}</CardTitle>\n                          </CardHeader>\n                        </Card>\n                      </div>\n\n                      {/* Recent Registrations */}\n                      <Card>\n                        <CardHeader>\n                          <CardTitle>Recent On-Chain Registrations</CardTitle>\n                          <CardDescription>Latest coins registered on-chain</CardDescription>\n                        </CardHeader>\n                        <CardContent>\n                          {!registryStats.recentRegistrations || registryStats.recentRegistrations.length === 0 ? (\n                            <div className=\"text-center py-8 text-muted-foreground\">\n                              <p className=\"text-sm\">No registrations yet</p>\n                            </div>\n                          ) : (\n                            <ScrollArea className=\"h-[400px]\">\n                              <div className=\"space-y-3\">\n                                {registryStats.recentRegistrations.map((coin: any) => (\n                                  <div key={coin.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                                    <div className=\"flex-1\">\n                                      <p className=\"font-medium text-sm\">{coin.symbol}</p>\n                                      <p className=\"text-xs text-muted-foreground\">{coin.name}</p>\n                                      <p className=\"text-xs text-muted-foreground font-mono mt-1\">\n                                        {coin.address?.slice(0, 12)}...{coin.address?.slice(-10)}\n                                      </p>\n                                    </div>\n                                    <div className=\"text-right space-y-1\">\n                                      <Badge variant={coin.registryStatus === 'registered' ? 'default' : 'secondary'} className=\"text-xs\">\n                                        {coin.registryStatus}\n                                      </Badge>\n                                      {coin.registryTxHash && (\n                                        <a\n                                          href={`https://basescan.org/tx/${coin.registryTxHash}`}\n                                          target=\"_blank\"\n                                          rel=\"noopener noreferrer\"\n                                          className=\"block text-xs text-primary hover:underline\"\n                                          data-testid={`link-tx-${coin.id}`}\n                                        >\n                                          View TX\n                                        </a>\n                                      )}\n                                      {coin.registeredAt && (\n                                        <p className=\"text-xs text-muted-foreground\">\n                                          {new Date(coin.registeredAt).toLocaleDateString()}\n                                        </p>\n                                      )}\n                                    </div>\n                                  </div>\n                                ))}\n                              </div>\n                            </ScrollArea>\n                          )}\n                        </CardContent>\n                      </Card>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"network\" className=\"mt-6\">\n              <AdminNetwork />\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":84476},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/product-tour.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport Joyride, { CallBackProps, STATUS, Step } from \"react-joyride\";\nimport { useLocation } from \"wouter\";\nimport { motion } from \"framer-motion\";\nimport {\n  Sparkles,\n  Search,\n  TrendingUp,\n  Coins,\n  Plus,\n  Gift,\n  User,\n  Rocket,\n  Eye,\n} from \"lucide-react\";\n\ninterface ProductTourProps {\n  onComplete?: () => void;\n}\n\n// Animated Icon Component\nfunction AnimatedIcon({\n  icon: Icon,\n  className = \"\",\n}: {\n  icon: any;\n  className?: string;\n}) {\n  return (\n    <motion.div\n      animate={{\n        scale: [1, 1.2, 1],\n        rotate: [0, 5, -5, 0],\n      }}\n      transition={{\n        duration: 2,\n        repeat: Infinity,\n        ease: \"easeInOut\",\n      }}\n      className={className}\n    >\n      <Icon className=\"w-6 h-6 md:w-8 md:h-8\" />\n    </motion.div>\n  );\n}\n\n// Compact Tour Content Component\nfunction TourContent({\n  icon: Icon,\n  emoji,\n  title,\n  description,\n}: {\n  icon?: any;\n  emoji?: string;\n  title: string;\n  description: string;\n}) {\n  return (\n    <div className=\"flex gap-2 md:gap-3 items-start\">\n      <div className=\"flex-shrink-0 mt-0.5\">\n        {Icon ? (\n          <AnimatedIcon icon={Icon} className=\"text-primary\" />\n        ) : emoji ? (\n          <motion.span\n            className=\"text-2xl md:text-3xl\"\n            animate={{\n              scale: [1, 1.15, 1],\n            }}\n            transition={{\n              duration: 1.5,\n              repeat: Infinity,\n              ease: \"easeInOut\",\n            }}\n          >\n            {emoji}\n          </motion.span>\n        ) : null}\n      </div>\n      <div className=\"space-y-0.5 md:space-y-1 flex-1 min-w-0\">\n        <h3 className=\"text-sm md:text-base font-bold leading-tight\">\n          {title}\n        </h3>\n        <p className=\"text-xs md:text-sm text-muted-foreground leading-snug\">\n          {description}\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport function ProductTour({ onComplete }: ProductTourProps) {\n  const [location] = useLocation();\n  const [run, setRun] = useState(false);\n  const [stepIndex, setStepIndex] = useState(0);\n\n  useEffect(() => {\n    const hasSeenTour = localStorage.getItem(\"hasSeenProductTour\");\n    if (!hasSeenTour && location === \"/\") {\n      // Delay to ensure DOM elements are mounted\n      setTimeout(() => setRun(true), 800);\n    }\n  }, [location]);\n\n  const steps: Step[] = [\n    {\n      target: \"body\",\n      content: (\n        <div className=\"space-y-2 md:space-y-3\">\n          <div className=\"flex items-center gap-2\">\n            <motion.span\n              className=\"text-2xl md:text-3xl\"\n              animate={{\n                rotate: [0, 14, -8, 14, -4, 10, 0],\n                scale: [1, 1.1, 1],\n              }}\n              transition={{\n                duration: 1.2,\n                repeat: Infinity,\n                repeatDelay: 1,\n              }}\n            >\n              üëã\n            </motion.span>\n            <h2 className=\"text-lg md:text-xl font-bold\">Welcome Every1!</h2>\n          </div>\n          <p className=\"text-xs md:text-sm text-muted-foreground leading-snug\">\n            Let's take a quick tour of the key features, help you get started\n            and make the most of the platform!\n          </p>\n        </div>\n      ),\n      placement: \"center\",\n      disableBeacon: true,\n    },\n    {\n      target: \".top-creators-stories, [data-tour='top-creators']\",\n      content: (\n        <TourContent\n          emoji=\"‚≠ê\"\n          title=\"Top Creators Stories\"\n          description=\"Discover top creators and their latest updates. Tap on a creator to view their profile, earnings and coins!\"\n        />\n      ),\n      placement: \"bottom\",\n    },\n    {\n      target: \"[data-testid='header-search']\",\n      content: (\n        <TourContent\n          icon={Search}\n          title=\"Quick Search\"\n          description=\"Find creators, channel coins, and projects instantly. Just start typing to explore!\"\n        />\n      ),\n      placement: \"bottom\",\n    },\n    {\n      target: \"[data-tour='trending-coins']\",\n      content: (\n        <TourContent\n          icon={TrendingUp}\n          title=\"Trending Coins\"\n          description=\"Click any coin to see details and start trading to support your favorite creators channels and content!\"\n        />\n      ),\n      placement: \"bottom\",\n      disableBeacon: true,\n    },\n    {\n      target: \"[data-testid='link-create']\",\n      content: (\n        <TourContent\n          icon={Plus}\n          title=\"Create Your Coin\"\n          description=\"Turn your channel or content into a tradeable coin! Import from URL or upload your own media to get started.\"\n        />\n      ),\n      placement: \"bottom\",\n    },\n    {\n      target: \"[data-testid='link-points']\",\n      content: (\n        <TourContent\n          icon={Gift}\n          title=\"E1XP Rewards\"\n          description=\"Earn points for daily logins, trading, creating coins, and more! Redeem points for exclusive rewards.\"\n        />\n      ),\n      placement: \"bottom\",\n    },\n    {\n      target: \"[data-testid='link-profile']\",\n      content: (\n        <TourContent\n          icon={User}\n          title=\"Your Profile\"\n          description=\"Manage your profile, view your coins, track earnings, and showcase your achievements to the community!\"\n        />\n      ),\n      placement: \"bottom\",\n    },\n    {\n      target: \"[data-testid='button-login']\",\n      content: (\n        <TourContent\n          icon={Rocket}\n          title=\"Ready to Start?\"\n          description=\"Login to unlock all features including creating coins, trading, earning E1XP points, and building your portfolio!\"\n        />\n      ),\n      placement: \"bottom-end\",\n    },\n  ];\n\n  const handleJoyrideCallback = (data: CallBackProps) => {\n    const { status, action, index, type } = data;\n\n    if ([STATUS.FINISHED, STATUS.SKIPPED].includes(status as any)) {\n      setRun(false);\n      localStorage.setItem(\"hasSeenProductTour\", \"true\");\n      onComplete?.();\n      return;\n    }\n\n    // Update step index when step changes\n    if (type === \"step:after\") {\n      // Move to next step on 'next' action, prev step on 'prev' action\n      if (action === \"next\" && index < steps.length - 1) {\n        setStepIndex(index + 1);\n      } else if (action === \"prev\" && index > 0) {\n        setStepIndex(index - 1);\n      }\n    }\n  };\n\n  return (\n    <Joyride\n      steps={steps}\n      run={run}\n      stepIndex={stepIndex}\n      continuous\n      showProgress\n      showSkipButton\n      scrollToFirstStep\n      scrollOffset={100}\n      disableScrolling={false}\n      disableOverlayClose\n      spotlightClicks={false}\n      callback={handleJoyrideCallback}\n      floaterProps={{\n        disableAnimation: false,\n      }}\n      styles={{\n        options: {\n          primaryColor: \"hsl(var(--primary))\",\n          textColor: \"hsl(var(--foreground))\",\n          backgroundColor: \"hsl(var(--background))\",\n          arrowColor: \"hsl(var(--background))\",\n          overlayColor: \"rgba(0, 0, 0, 0.6)\",\n          zIndex: 10000,\n        },\n        tooltip: {\n          borderRadius: \"16px\",\n          padding: \"12px 16px\",\n          maxWidth: \"320px\",\n          boxShadow: \"0 10px 40px rgba(0, 0, 0, 0.2)\",\n        },\n        tooltipContent: {\n          padding: \"0\",\n        },\n        tooltipContainer: {\n          textAlign: \"left\",\n        },\n        spotlight: {\n          borderRadius: \"12px\",\n          transition: \"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)\",\n        },\n        overlay: {\n          transition: \"opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1)\",\n        },\n        buttonNext: {\n          backgroundColor: \"hsl(var(--primary))\",\n          color: \"#000000\",\n          borderRadius: \"8px\",\n          padding: \"6px 16px\",\n          fontSize: \"13px\",\n          fontWeight: \"600\",\n          transition: \"all 0.2s\",\n        },\n        buttonBack: {\n          color: \"hsl(var(--muted-foreground))\",\n          marginRight: \"8px\",\n          fontSize: \"13px\",\n          padding: \"6px 12px\",\n        },\n        buttonSkip: {\n          color: \"hsl(var(--muted-foreground))\",\n          fontSize: \"13px\",\n          padding: \"6px 12px\",\n        },\n        buttonClose: {\n          color: \"hsl(var(--muted-foreground))\",\n          padding: \"4px\",\n        },\n      }}\n      locale={{\n        back: \"Back\",\n        close: \"Close\",\n        last: \"Let's Go!\",\n        next: \"Next\",\n        skip: \"Skip\",\n      }}\n    />\n  );\n}\n","size_bytes":8394},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/creator-card.tsx":{"content":"import { Link } from \"wouter\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport type { User } from \"@shared/schema\";\n\ninterface CreatorCardProps {\n  creator: User;\n  onConnect?: () => void;\n  isConnected?: boolean;\n}\n\nexport function CreatorCard({ creator, onConnect, isConnected }: CreatorCardProps) {\n  const avatarUrl = creator.avatarUrl || \"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\";\n\n  return (\n    <Card\n      className=\"p-6 hover-elevate active-elevate-2 transition-all duration-200\"\n      data-testid={`card-creator-${creator.id}`}\n    >\n      <div className=\"flex flex-col items-center text-center gap-4\">\n        <Link href={`/profile/${creator.id}`}>\n          <Avatar className=\"h-20 w-20 ring-2 ring-primary ring-offset-2 ring-offset-background cursor-pointer\">\n            <AvatarImage src={avatarUrl} />\n            <AvatarFallback className=\"bg-primary text-primary-foreground text-lg font-bold\">\n              {creator.displayName?.charAt(0) || creator.username.charAt(0).toUpperCase()}\n            </AvatarFallback>\n          </Avatar>\n        </Link>\n\n        <div className=\"space-y-2 w-full\">\n          <Link href={`/profile/${creator.id}`}>\n            <h3\n              className=\"font-bold text-lg hover:text-primary transition-colors cursor-pointer\"\n              data-testid={`text-creator-name-${creator.id}`}\n            >\n              {creator.displayName || creator.username}\n            </h3>\n          </Link>\n\n          {creator.bio && (\n            <p className=\"text-sm text-muted-foreground line-clamp-2\">\n              {creator.bio}\n            </p>\n          )}\n\n          {creator.categories && creator.categories.length > 0 && (\n            <div className=\"flex flex-wrap gap-1 justify-center\">\n              {creator.categories.slice(0, 2).map((category) => (\n                <Badge\n                  key={category}\n                  variant=\"secondary\"\n                  className=\"text-xs\"\n                  data-testid={`badge-category-${category}`}\n                >\n                  {category}\n                </Badge>\n              ))}\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-2 gap-4 pt-2 text-sm\">\n            <div>\n              <div className=\"font-bold text-foreground\" data-testid={`text-connections-${creator.id}`}>\n                {creator.totalConnections?.toLocaleString() || 0}\n              </div>\n              <div className=\"text-muted-foreground text-xs\">Connections</div>\n            </div>\n            <div>\n              <div className=\"font-bold text-foreground\" data-testid={`text-views-${creator.id}`}>\n                {creator.totalProfileViews?.toLocaleString() || 0}\n              </div>\n              <div className=\"text-muted-foreground text-xs\">Views</div>\n            </div>\n          </div>\n        </div>\n\n        {onConnect && (\n          <Button\n            onClick={onConnect}\n            variant={isConnected ? \"secondary\" : \"default\"}\n            size=\"sm\"\n            className=\"w-full\"\n            data-testid={`button-connect-${creator.id}`}\n          >\n            {isConnected ? \"Connected\" : \"Connect\"}\n          </Button>\n        )}\n      </div>\n    </Card>\n  );\n}","size_bytes":3370},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer utilities {\n  .scrollbar-hide {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n  }\n  .scrollbar-hide::-webkit-scrollbar {\n    display: none;\n  }\n}\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 240 3% 98%;\n\n  --foreground: 240 10% 10%;\n\n  --border: 240 6% 90%;\n\n  --card: 240 4% 96%;\n\n  --card-foreground: 240 10% 12%;\n\n  --card-border: 240 6% 88%;\n\n  --sidebar: 240 5% 94%;\n\n  --sidebar-foreground: 240 10% 15%;\n\n  --sidebar-border: 0 0% 0%;\n\n  --sidebar-primary: 89 95% 79%;\n\n  --sidebar-primary-foreground: 240 10% 10%;\n\n  --sidebar-accent: 240 8% 88%;\n\n  --sidebar-accent-foreground: 240 10% 15%;\n\n  --sidebar-ring: 89 95% 79%;\n\n  --popover: 240 5% 92%;\n\n  --popover-foreground: 240 10% 15%;\n\n  --popover-border: 240 6% 84%;\n\n  --primary: 89 95% 79%;\n\n  --primary-foreground: 240 10% 10%;\n\n  --secondary: 240 8% 86%;\n\n  --secondary-foreground: 240 10% 15%;\n\n  --muted: 240 6% 88%;\n\n  --muted-foreground: 240 8% 35%;\n\n  --accent: 314 83% 57%;\n\n  --accent-foreground: 0 0% 100%;\n\n  --destructive: 0 84% 60%;\n\n  --destructive-foreground: 0 0% 100%;\n\n  --input: 240 8% 70%;\n  --ring: 89 95% 79%;\n  --chart-1: 89 95% 40%;\n  --chart-2: 314 83% 35%;\n  --chart-3: 270 30% 35%;\n  --chart-4: 142 76% 35%;\n  --chart-5: 25 95% 40%;\n\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 2px 0px 0px hsl(240 8% 15% / 0.02);\n  --shadow-xs: 0px 2px 0px 0px hsl(240 8% 15% / 0.03);\n  --shadow-sm: 0px 2px 0px 0px hsl(240 8% 15% / 0.04), 0px 1px 2px -1px hsl(240 8% 15% / 0.05);\n  --shadow: 0px 2px 0px 0px hsl(240 8% 15% / 0.05), 0px 1px 2px -1px hsl(240 8% 15% / 0.06);\n  --shadow-md: 0px 2px 0px 0px hsl(240 8% 15% / 0.06), 0px 2px 4px -1px hsl(240 8% 15% / 0.07);\n  --shadow-lg: 0px 2px 0px 0px hsl(240 8% 15% / 0.08), 0px 4px 6px -1px hsl(240 8% 15% / 0.09);\n  --shadow-xl: 0px 2px 0px 0px hsl(240 8% 15% / 0.10), 0px 8px 10px -1px hsl(240 8% 15% / 0.11);\n  --shadow-2xl: 0px 2px 0px 0px hsl(240 8% 15% / 0.12);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 0 0% 6%;\n  --foreground: 0 0% 98%;\n  --card: 0 0% 9%;\n  --card-foreground: 0 0% 98%;\n  --card-border: 0 0% 14%;\n  --popover: 0 0% 9%;\n  --popover-foreground: 0 0% 98%;\n  --popover-border: 0 0% 18%;\n  --primary: 68 78% 66%;\n  --primary-foreground: 0 0% 0%;\n  --secondary: 0 0% 14%;\n  --secondary-foreground: 0 0% 98%;\n  --muted: 0 0% 14%;\n  --muted-foreground: 0 0% 63%;\n  --accent: 68 78% 66%;\n  --accent-foreground: 0 0% 0%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 98%;\n  --border: 0 0% 18%;\n  --input: 0 0% 14%;\n  --ring: 68 78% 66%;\n  --sidebar: 0 0% 6%;\n  --sidebar-foreground: 0 0% 98%;\n  --sidebar-primary: 68 78% 66%;\n  --sidebar-primary-foreground: 0 0% 0%;\n  --sidebar-accent: 0 0% 14%;\n  --sidebar-accent-foreground: 0 0% 98%;\n  --sidebar-border: 0 0% 18%;\n  --sidebar-ring: 68 78% 66%;\n\n  --chart-1: 68 78% 66%;\n  --chart-2: 314 83% 57%;\n  --chart-3: 200 50% 65%;\n  --chart-4: 142 76% 56%;\n  --chart-5: 25 95% 63%;\n\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.20);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.25);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.30), 0px 1px 2px -1px hsl(0 0% 0% / 0.35);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.35), 0px 1px 2px -1px hsl(0 0% 0% / 0.40);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.40), 0px 2px 4px -1px hsl(0 0% 0% / 0.45);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.45), 0px 4px 6px -1px hsl(0 0% 0% / 0.50);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.50), 0px 8px 10px -1px hsl(0 0% 0% / 0.55);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.60);\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply antialiased bg-background text-foreground;\n    font-family: 'Poppins Rounded', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n    overflow-y: scroll;\n  }\n\n  /* Hide scrollbar globally */\n  ::-webkit-scrollbar {\n    width: 0px;\n    background: transparent;\n  }\n\n  * {\n    scrollbar-width: none;\n    -ms-overflow-style: none;\n  }\n}\n\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: -1;\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: 999;\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n\n  /* Hide scrollbars */\n  .scrollbar-hide::-webkit-scrollbar {\n    display: none;\n  }\n\n  .scrollbar-hide {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n  }\n\n  .gradient-text {\n    background: linear-gradient(135deg, hsl(68 78% 66%), hsl(75 70% 60%));\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n  }\n\n  .glass-card {\n    background: rgba(0, 0, 0, 0.6);\n    backdrop-filter: blur(20px);\n    border: 1px solid rgba(255, 255, 255, 0.05);\n  }\n\n  .coin-card {\n    @apply bg-gradient-to-br from-muted/5 to-muted/10 backdrop-blur-sm border border-border/50 rounded-xl transition-all duration-300 hover:border-primary/50 hover:shadow-lg hover:shadow-primary/10;\n  }\n\n  /* Platform icon colors */\n  .platform-icon-youtube { color: #FF0000 !important; }\n  .platform-icon-farcaster { color: #8a63d2 !important; }\n  .platform-icon-gitcoin { color: #02E2AC !important; }\n  .platform-icon-spotify { color: #1DB954 !important; }\n  .platform-icon-tiktok { color: #000000 !important; }\n  .platform-icon-instagram { color: #e6683c !important; }\n  .platform-icon-medium { color: #000000 !important; }\n  .platform-icon-twitter { color: #1DA1F2 !important; }\n  \n  .light .platform-icon-tiktok { color: #EE1D52 !important; }\n  .light .platform-icon-medium { color: #00ab6c !important; }\n  .light .platform-icon-twitter { color: #000000 !important; }\n}","size_bytes":11432},"client/src/lib/pinata.ts":{"content":"export async function uploadToIPFS(metadata: any): Promise<string> {\n  const PINATA_JWT = import.meta.env.VITE_PINATA_JWT;\n\n  console.log(\"PINATA_JWT available:\", !!PINATA_JWT);\n  console.log(\"Environment variables:\", {\n    VITE_PINATA_JWT: !!import.meta.env.VITE_PINATA_JWT,\n    VITE_PINATA_API_KEY: !!import.meta.env.VITE_PINATA_API_KEY,\n    VITE_NEXT_PUBLIC_GATEWAY_URL: !!import.meta.env.VITE_NEXT_PUBLIC_GATEWAY_URL\n  });\n\n  if (!PINATA_JWT) {\n    throw new Error(\"PINATA_JWT not configured. Please ensure VITE_PINATA_JWT is set in your environment variables and accessible to the client.\");\n  }\n\n  try {\n    const response = await fetch(\"https://api.pinata.cloud/pinning/pinJSONToIPFS\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${PINATA_JWT}`,\n      },\n      body: JSON.stringify({\n        pinataContent: metadata,\n        pinataMetadata: {\n          name: `${metadata.title || 'coin'}-metadata`,\n        },\n      }),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(`Pinata upload failed: ${response.statusText} - ${JSON.stringify(errorData)}`);\n    }\n\n    const data = await response.json();\n    \n    // Use ipfs:// protocol for Zora contract compatibility\n    // The Zora contract expects native IPFS URIs, not HTTP gateway URLs\n    return `ipfs://${data.IpfsHash}`;\n  } catch (error) {\n    console.error(\"IPFS upload error:\", error);\n    if (error instanceof Error) {\n      throw error;\n    }\n    throw new Error(\"Failed to upload metadata to IPFS\");\n  }\n}\n\nexport async function uploadToPinata(file: File): Promise<string> {\n  const PINATA_JWT = import.meta.env.VITE_PINATA_JWT;\n\n  if (!PINATA_JWT) {\n    throw new Error(\"PINATA_JWT not configured\");\n  }\n\n  try {\n    const formData = new FormData();\n    formData.append('file', file);\n    formData.append('pinataMetadata', JSON.stringify({\n      name: file.name,\n    }));\n\n    const response = await fetch(\"https://api.pinata.cloud/pinning/pinFileToIPFS\", {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${PINATA_JWT}`,\n      },\n      body: formData,\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(`Pinata file upload failed: ${response.statusText} - ${JSON.stringify(errorData)}`);\n    }\n\n    const data = await response.json();\n    return data.IpfsHash;\n  } catch (error) {\n    console.error(\"Pinata file upload error:\", error);\n    if (error instanceof Error) {\n      throw error;\n    }\n    throw new Error(\"Failed to upload file to Pinata\");\n  }\n}","size_bytes":2656},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/url-input-form.tsx":{"content":"import { useState } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2, Link as LinkIcon } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface URLInputFormProps {\n  onScraped: (data: any) => void;\n}\n\nexport default function URLInputForm({ onScraped }: URLInputFormProps) {\n  const [url, setUrl] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!url.trim()) {\n      toast({\n        title: \"URL required\",\n        description: \"Please enter a valid URL\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const response = await fetch(\"/api/scrape\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ url: url.trim() }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to scrape URL\");\n      }\n\n      const scrapedData = await response.json();\n      onScraped(scrapedData);\n      setUrl(\"\");\n      \n      toast({\n        title: \"Content imported!\",\n        description: \"Review your content and create your coin\",\n      });\n    } catch (error) {\n      console.error(\"Scraping error:\", error);\n      toast({\n        title: \"Import failed\",\n        description: error instanceof Error ? error.message : \"Failed to import content from URL\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-xl mx-auto\">\n      <div className=\"bg-card border border-border/50 rounded-3xl p-8\">\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          <div className=\"space-y-2\">\n            <div className=\"relative\">\n              <LinkIcon className=\"absolute left-5 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground pointer-events-none z-10\" />\n              <div className=\"bg-muted/30 dark:bg-muted/20 rounded-2xl p-1 border border-border/30\">\n                <Input\n                  type=\"url\"\n                  value={url}\n                  onChange={(e) => setUrl(e.target.value)}\n                  placeholder=\"https://youtube.com/watch?v=...\"\n                  className=\"bg-transparent border-0 h-12 pl-14 pr-4 focus-visible:ring-0 focus-visible:ring-offset-0 text-base\"\n                  disabled={isLoading}\n                  data-testid=\"input-url\"\n                />\n              </div>\n            </div>\n            <p className=\"text-xs text-muted-foreground px-2\">\n              Supports YouTube, Spotify, Medium, Substack, X/Twitter, Instagram, TikTok, and more\n            </p>\n          </div>\n\n          <Button\n            type=\"submit\"\n            disabled={isLoading || !url.trim()}\n            className=\"w-full h-12 bg-gradient-to-r from-primary to-primary hover:from-primary/100 hover:to-primary/90 text-primary-foreground font-semibold rounded-2xl transition-all\"\n            data-testid=\"button-import\"\n          >\n            {isLoading ? (\n              <>\n                <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\n                Importing...\n              </>\n            ) : (\n              <>\n                <LinkIcon className=\"w-5 h-5 mr-2\" />\n                Import Content\n              </>\n            )}\n          </Button>\n        </form>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3549},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"13rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3.5rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! group-data-[collapsible=icon]:justify-center [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>img]:size-4 [&>img]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21925},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/pages/docs.tsx":{"content":"\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { BookOpen, Coins, Users, TrendingUp, Shield, Zap, MessageSquare, Trophy } from \"lucide-react\";\n\nexport default function Docs() {\n  return (\n    <div className=\"container max-w-4xl mx-auto px-4 py-8 space-y-8\">\n      <div className=\"flex items-center gap-3\">\n        <BookOpen className=\"h-8 w-8 text-primary\" />\n        <h1 className=\"text-2xl font-bold\">Documentation</h1>\n      </div>\n\n      <p className=\"text-lg text-muted-foreground\">\n        Complete guide to using Every1.fun - create coins, trade, earn rewards, and build your creator community on Base blockchain.\n      </p>\n\n      <div className=\"space-y-6\">\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Zap className=\"h-5 w-5 text-primary\" />\n              <CardTitle>Getting Started</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-muted-foreground\">\n            <p>\n              <strong>Step 1: Sign Up</strong> - Click \"Login\" and either sign up with your email (we'll create a smart wallet for you) or connect your existing crypto wallet (MetaMask, Coinbase Wallet, etc.).\n            </p>\n            <p>\n              <strong>Step 2: Explore</strong> - Browse trending creator coins on the home page, discover new creators in the Creators section, or search for specific content.\n            </p>\n            <p>\n              <strong>Step 3: Claim Your First Reward</strong> - Click the E1XP icon to claim your daily login reward and start building your streak!\n            </p>\n            <p>\n              <strong>Step 4: Get Some ETH</strong> - To trade coins, you'll need ETH on Base network. If signing up with email, your smart wallet address can receive ETH from exchanges or other wallets.\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Coins className=\"h-5 w-5 text-primary\" />\n              <CardTitle>Creating Your Coin</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-muted-foreground\">\n            <p>\n              Navigate to the <strong>Create</strong> page to launch your own creator coin. You have two options:\n            </p>\n            <p>\n              <strong>Upload Content:</strong> Upload an image or video directly. We'll store it on IPFS for permanent, decentralized hosting via Pinata.\n            </p>\n            <p>\n              <strong>Import from URL:</strong> Paste a link to your content from platforms like YouTube, Instagram, Twitter, or any website. We'll automatically fetch metadata and create a beautiful preview.\n            </p>\n            <p>\n              <strong>Fill in Details:</strong> Add your coin name (e.g., \"MySong\"), symbol (e.g., \"SONG\"), and description. These appear on your coin's trading page.\n            </p>\n            <p>\n              <strong>Deploy:</strong> Click create and approve the transaction. Your coin will be deployed on Base blockchain using Zora's creator coin protocol. You can start sharing it immediately!\n            </p>\n            <p className=\"text-sm italic\">\n              Note: Coin creation requires a small amount of ETH for gas fees. As the creator, you'll earn a percentage of all trading fees for your coin.\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5 text-primary\" />\n              <CardTitle>Trading Coins</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-muted-foreground\">\n            <p>\n              <strong>Finding Coins:</strong> Browse the home page for trending coins, explore all coins in the Coins section, or visit creator profiles to see their coins.\n            </p>\n            <p>\n              <strong>Buying Coins:</strong> Click any coin card to open the trading modal. Select \"Buy\", enter the amount of ETH you want to spend, and confirm. The price updates in real-time based on the bonding curve.\n            </p>\n            <p>\n              <strong>Selling Coins:</strong> Visit your profile to see coins you own. Click on a coin, select \"Sell\", enter the amount to sell, and confirm. You'll receive ETH based on the current market price.\n            </p>\n            <p>\n              <strong>Understanding Prices:</strong> Coins use a bonding curve - each purchase increases the price slightly, each sale decreases it. Early buyers can benefit from price appreciation as the coin gains popularity.\n            </p>\n            <p>\n              <strong>Portfolio Tracking:</strong> Your profile shows all coins you own, their current value, and your profit/loss. Track your holdings and see how your investments perform over time.\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Trophy className=\"h-5 w-5 text-primary\" />\n              <CardTitle>E1XP Points & Rewards</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-muted-foreground\">\n            <p>\n              <strong>Daily Login Rewards:</strong> Claim E1XP points every day by clicking the E1XP icon in the navigation. The more consecutive days you log in, the higher your streak multiplier!\n            </p>\n            <p>\n              <strong>Streak System:</strong> Build your streak by logging in daily. Your streak multiplier increases your E1XP earnings. Miss a day and your streak resets, so stay consistent!\n            </p>\n            <p>\n              <strong>Earning Points:</strong> You earn E1XP through daily logins, maintaining streaks, trading activity, and community engagement. Points track your platform participation.\n            </p>\n            <p>\n              <strong>Leaderboards:</strong> Check the Points page to see top earners and compare your progress with other community members. Compete for the highest streak and most points!\n            </p>\n            <p className=\"text-sm italic\">\n              Pro tip: Enable notifications to get reminders for your daily reward and never break your streak!\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <MessageSquare className=\"h-5 w-5 text-primary\" />\n              <CardTitle>Messaging & Community</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-muted-foreground\">\n            <p>\n              <strong>Direct Messaging:</strong> Click the message icon on any user's profile to start a private conversation. We use XMTP protocol for decentralized, encrypted messaging.\n            </p>\n            <p>\n              <strong>Inbox:</strong> Access all your messages from the Inbox page. See unread count in the navigation and never miss important messages from other creators or collectors.\n            </p>\n            <p>\n              <strong>Notifications:</strong> Enable push notifications to get alerted about new messages, coin launches, trading activity, and daily reward reminders. Stay connected even when away.\n            </p>\n            <p>\n              <strong>Following Creators:</strong> Connect with your favorite creators, follow their profiles, and get notified when they launch new coins or content.\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5 text-primary\" />\n              <CardTitle>Profile & Identity</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-muted-foreground\">\n            <p>\n              <strong>Your Profile:</strong> Customize your profile with a username, bio, and profile picture. Share your wallet address or profile link with others.\n            </p>\n            <p>\n              <strong>Portfolio View:</strong> See all coins you've created and coins you own. Track your earnings as a creator and monitor your investment performance.\n            </p>\n            <p>\n              <strong>Wallet Management:</strong> View your connected wallet address. If you signed up with email, you have a smart wallet that can receive ETH and tokens just like any other wallet.\n            </p>\n            <p>\n              <strong>Earnings Withdrawal:</strong> As a creator, withdraw your accumulated trading fees anytime. Your earnings are always available and belong to you.\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <Shield className=\"h-5 w-5 text-primary\" />\n              <CardTitle>Security & Best Practices</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-muted-foreground\">\n            <p>\n              <strong>Smart Wallets:</strong> If you signed up with email, we created a smart wallet for you using Privy. This wallet is secured by your email - only you can access it. Consider exporting the private key and backing it up securely.\n            </p>\n            <p>\n              <strong>External Wallets:</strong> If using MetaMask or other wallets, we never have access to your private keys. Always verify transaction details before approving.\n            </p>\n            <p>\n              <strong>Content Rights:</strong> Only upload content you own or have rights to use. Respect copyright and intellectual property laws.\n            </p>\n            <p>\n              <strong>Trading Safely:</strong> Do your research before buying coins. Check the creator's profile, content quality, and community engagement. Never invest more than you can afford to lose.\n            </p>\n            <p>\n              <strong>Scam Awareness:</strong> Be cautious of too-good-to-be-true offers. We'll never ask for your private keys or recovery phrase. Always verify URLs and official channels.\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center gap-2\">\n              <BookOpen className=\"h-5 w-5 text-primary\" />\n              <CardTitle>Technical Details</CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-muted-foreground\">\n            <p>\n              <strong>Blockchain:</strong> Every1.fun is built on Base, an Ethereum Layer 2 network offering fast transactions with low fees while maintaining Ethereum's security.\n            </p>\n            <p>\n              <strong>Smart Contracts:</strong> All creator coins are deployed using Zora's audited and battle-tested creator coin protocol. This ensures security and standardization.\n            </p>\n            <p>\n              <strong>Storage:</strong> Content is stored on IPFS via Pinata for decentralized, permanent hosting. Your content remains accessible independently of our platform.\n            </p>\n            <p>\n              <strong>Authentication:</strong> We use Privy for wallet abstraction, allowing email login while maintaining full self-custody. Your keys, your coins.\n            </p>\n            <p>\n              <strong>Messaging:</strong> XMTP protocol powers our messaging system, providing decentralized, encrypted communication between users.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":11886},"drizzle.config.ts":{"content":"import { config } from 'dotenv';\nimport { defineConfig } from \"drizzle-kit\";\n\n// Load environment variables from .env file\nconfig();\n\n// Use direct connection for migrations (DATABASE_DIRECT_URL)\n// Use pooler connection for runtime queries (DATABASE_URL)\nconst databaseUrl = process.env.DATABASE_DIRECT_URL || process.env.DATABASE_URL || process.env.REPLIT_DB_URL;\n\nif (!databaseUrl) {\n  throw new Error(\"DATABASE_URL not found. Please add PostgreSQL from the Tools panel or set DATABASE_URL in Secrets.\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: databaseUrl,\n  },\n});\n","size_bytes":671},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/lib/theme-provider\";\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={() => setTheme(theme === \"dark\" ? \"light\" : \"dark\")}\n      data-testid=\"button-theme-toggle\"\n      className=\"hover-elevate active-elevate-2\"\n    >\n      {theme === \"dark\" ? (\n        <Sun className=\"h-5 w-5\" />\n      ) : (\n        <Moon className=\"h-5 w-5\" />\n      )}\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}\n","size_bytes":637},"client/src/pages/home.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { CreatorCard } from \"@/components/creator-card\";\nimport { CoinCard } from \"@/components/coin-card\";\nimport { TopCreatorsStories } from \"@/components/top-creators-stories\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Sparkles,\n  TrendingUp,\n  Music,\n  Palette,\n  Gamepad2,\n  Code,\n  Shirt,\n  Dumbbell,\n  GraduationCap,\n  Tv,\n  Globe,\n  ChevronLeft,\n  ChevronRight,\n  Coins,\n  PenTool,\n  Heart,\n  Search,\n  PlusCircle,\n  User,\n  Users,\n} from \"lucide-react\";\nimport {\n  SiYoutube,\n  SiTiktok,\n  SiInstagram,\n  SiMedium,\n  SiX,\n} from \"react-icons/si\";\nimport type { User as UserType } from \"@shared/schema\";\nimport { useState, useMemo, useRef } from \"react\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport TradeModalMobile from \"@/components/trade-modal-mobile\";\nimport { useLocation } from \"wouter\";\nimport { createAvatar } from \"@dicebear/core\";\nimport { avataaars } from \"@dicebear/collection\";\nimport { getMostValuableCreatorCoins } from \"@zoralabs/coins-sdk\";\nimport { useEffect } from \"react\";\nimport { updateOGMeta } from \"@/lib/og-meta\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\n\ntype Coin = {\n  id: string;\n  name: string;\n  symbol: string;\n  address: string;\n  image?: string;\n  marketCap?: string;\n  volume24h?: string;\n  holders?: number;\n  creator?: string;\n  createdAt?: string;\n  category?: string;\n  platform?: string;\n  creator_wallet?: string;\n  metadata?: any;\n};\n\nexport default function Home() {\n  // Fetch trending creators from Zora for the stories section\n  const { data: zoraCreators } = useQuery({\n    queryKey: [\"/api/zora/creators/most-valuable\"],\n    queryFn: async () => {\n      const response = await getMostValuableCreatorCoins({ count: 20 });\n      const creators =\n        response.data?.exploreList?.edges?.map((edge: any) => {\n          const coin = edge.node;\n          return {\n            id: coin.creatorAddress || coin.address,\n            address: coin.creatorAddress || coin.address,\n            username: coin.symbol || \"creator\",\n            displayName: coin.name || \"Creator\",\n            bio: coin.description || \"\",\n            avatarUrl:\n              coin.mediaContent?.previewImage?.medium ||\n              coin.mediaContent?.previewImage?.small ||\n              createAvatar(avataaars, {\n                seed: coin.creatorAddress,\n                size: 56,\n              }).toDataUri(),\n            e1xpPoints: Math.floor(parseFloat(coin.marketCap || \"0\") * 100),\n          };\n        }) || [];\n      return creators;\n    },\n    refetchInterval: 30000,\n  });\n\n  const trendingCreators = zoraCreators || [];\n\n  const { data: featuredProjects, isLoading: loadingProjects } = useQuery({\n    queryKey: [\"/api/projects/featured\"],\n  });\n\n  // Fetch pinned coins from platform\n  const { data: pinnedCoinsData, isLoading: loadingPinnedCoins } = useQuery({\n    queryKey: [\"/api/coins/pinned\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/coins/pinned?_=\" + Date.now());\n      if (!response.ok) throw new Error(\"Failed to fetch pinned coins\");\n      return response.json();\n    },\n    staleTime: 0,\n    refetchOnMount: true,\n  });\n\n  // Fetch trending coins from Zora\n  const { data: zoraCoinsData, isLoading: loadingZoraCoins } = useQuery({\n    queryKey: [\"/api/zora/coins/top-volume\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/zora/coins/top-volume?count=30\");\n      if (!response.ok) throw new Error(\"Failed to fetch Zora coins\");\n      return response.json();\n    },\n  });\n\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\n  const [coinMarketCaps, setCoinMarketCaps] = useState<Record<string, string>>(\n    {},\n  );\n  const [coinVolumes, setCoinVolumes] = useState<Record<string, string>>({});\n  const [coinHolders, setCoinHolders] = useState<Record<string, number>>({});\n  const [selectedCoin, setSelectedCoin] = useState<Coin | null>(null);\n  const [isTradeModalOpen, setIsTradeModalOpen] = useState(false);\n  const isMobile = useIsMobile();\n  const [, setLocation] = useLocation();\n\n  // Custom icon components for platforms not in lucide-react\n  const FarcasterIcon = ({ className }: { className?: string }) => (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path d=\"M20.5 4h-17A1.5 1.5 0 002 5.5v13A1.5 1.5 0 003.5 20h17a1.5 1.5 0 001.5-1.5v-13A1.5 1.5 0 0020.5 4zm-8.53 11.94c-2.11 0-3.82-1.71-3.82-3.82s1.71-3.82 3.82-3.82 3.82 1.71 3.82 3.82-1.71 3.82-3.82 3.82z\" />\n    </svg>\n  );\n\n  const GitcoinIcon = ({ className }: { className?: string }) => (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"currentColor\">\n      <path d=\"M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z\" />\n      <path d=\"M12 6c-3.309 0-6 2.691-6 6s2.691 6 6 6 6-2.691 6-6-2.691-6-6-6zm0 10c-2.206 0-4-1.794-4-4s1.794-4 4-4 4 1.794 4 4-1.794 4-4 4z\" />\n    </svg>\n  );\n\n  const KarmaIcon = ({ className }: { className?: string }) => (\n    <Heart className={className} />\n  );\n\n  const categories = [\n    { id: \"all\", label: \"All\", Icon: Globe },\n    { id: \"farcaster\", label: \"Farcaster\", Icon: FarcasterIcon },\n    { id: \"gitcoin\", label: \"Gitcoin\", Icon: GitcoinIcon },\n    { id: \"karmagap\", label: \"KarmaGap\", Icon: KarmaIcon },\n    { id: \"publicgoods\", label: \"Public Goods\", Icon: Coins },\n    { id: \"music\", label: \"Music\", Icon: Music },\n    { id: \"tiktok\", label: \"TikTok\", Icon: SiTiktok },\n    { id: \"instagram\", label: \"Instagram\", Icon: SiInstagram },\n    { id: \"medium\", label: \"Medium\", Icon: SiMedium },\n    { id: \"giveth\", label: \"Giveth\", Icon: Coins },\n    { id: \"twitter\", label: \"Twitter\", Icon: SiX },\n    { id: \"blog\", label: \"Blog\", Icon: PenTool },\n  ];\n\n  // Transform pinned coins data (max 6)\n  const pinnedCoins: Coin[] = useMemo(() => {\n    if (!pinnedCoinsData || loadingPinnedCoins) return [];\n\n    const rawCoins = Array.isArray(pinnedCoinsData) ? pinnedCoinsData : [];\n\n    return rawCoins.slice(0, 6).map((coin: any) => ({\n      id: coin.id || coin.address,\n      name: coin.name || \"Unnamed Coin\",\n      symbol: coin.symbol || \"???\",\n      address: coin.address,\n      image: coin.image,\n      marketCap: coin.market_cap || coin.marketCap || \"0\",\n      volume24h: coin.volume_24h || coin.volume24h || \"0\",\n      holders: coin.holders || 0,\n      creator: coin.creator_wallet || coin.creatorWallet || coin.creator,\n      createdAt: coin.created_at || coin.createdAt,\n      category: \"Platform\",\n      platform: \"platform\",\n      creator_wallet: coin.creator_wallet || coin.creatorWallet || coin.creator,\n      metadata: coin,\n    }));\n  }, [pinnedCoinsData, loadingPinnedCoins]);\n\n  // Transform Zora coins data to match our Coin type\n  const zoraCoins: Coin[] = useMemo(() => {\n    if (!zoraCoinsData?.coins) return [];\n\n    return zoraCoinsData.coins.map((coin: any) => ({\n      id: coin.id || coin.address,\n      name: coin.name || \"Unnamed Coin\",\n      symbol: coin.symbol || \"???\",\n      address: coin.address,\n      image:\n        coin.mediaContent?.previewImage?.medium ||\n        coin.mediaContent?.previewImage?.small,\n      marketCap: coin.marketCap ? parseFloat(coin.marketCap).toFixed(2) : \"0\",\n      volume24h: coin.volume24h ? parseFloat(coin.volume24h).toFixed(2) : \"0\",\n      holders: coin.uniqueHolders || 0,\n      creator: coin.creatorAddress,\n      createdAt: coin.createdAt,\n      category: \"zora\",\n      platform: \"zora\",\n      creator_wallet: coin.creatorAddress,\n      metadata: coin,\n    }));\n  }, [zoraCoinsData]);\n\n  // Combine pinned coins first, then Zora coins (limit total to 12)\n  const displayCoins: Coin[] = useMemo(() => {\n    const combined = [...pinnedCoins, ...zoraCoins];\n    return combined.slice(0, 12);\n  }, [pinnedCoins, zoraCoins]);\n\n  const filteredCreators = useMemo(() => {\n    if (!trendingCreators) return [];\n    if (selectedCategory === \"all\") return trendingCreators;\n    return trendingCreators.filter((creator) =>\n      creator.categories?.includes(selectedCategory),\n    );\n  }, [trendingCreators, selectedCategory]);\n\n  const scroll = (direction: \"left\" | \"right\") => {\n    if (scrollContainerRef.current) {\n      const scrollAmount = direction === \"left\" ? -400 : 400;\n      scrollContainerRef.current.scrollBy({\n        left: scrollAmount,\n        behavior: \"smooth\",\n      });\n    }\n  };\n\n  const openTradeModal = (coin: Coin) => {\n    if (isMobile) {\n      setSelectedCoin(coin);\n      setIsTradeModalOpen(true);\n    } else {\n      setLocation(`/coin/${coin.address}`);\n    }\n  };\n\n  // Check for referral code in URL\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const refCode = urlParams.get('ref');\n\n    if (refCode) {\n      // Fetch OG meta for this referral\n      fetch(`/api/og-meta/referral/${encodeURIComponent(refCode)}`)\n        .then(res => res.json())\n        .then(meta => {\n          updateOGMeta({\n            title: meta.title,\n            description: meta.description,\n            image: meta.image,\n            url: meta.url,\n          });\n        })\n        .catch(err => console.error('Failed to load referral OG meta:', err));\n    }\n  }, []);\n\n  const renderMobileNav = () => (\n    <nav className=\"fixed bottom-0 left-0 right-0 bg-background border-t border-border p-3 z-50 md:hidden\">\n      <div className=\"flex justify-around items-center\">\n        <button\n          onClick={() => setLocation(\"/\")}\n          className=\"flex flex-col items-center text-foreground/70 hover:text-foreground\"\n        >\n          <Sparkles className=\"w-6 h-6\" />\n          <span className=\"text-xs font-medium\">Explore</span>\n        </button>\n        <button\n          onClick={() => setLocation(\"/search\")}\n          className=\"flex flex-col items-center text-foreground/70 hover:text-foreground\"\n        >\n          <Search className=\"w-6 h-6\" />\n          <span className=\"text-xs font-medium\">Search</span>\n        </button>\n        <button\n          onClick={() => setLocation(\"/create\")}\n          className=\"flex flex-col items-center text-foreground/70 hover:text-foreground\"\n        >\n          <PlusCircle className=\"w-6 h-6\" />\n          <span className=\"text-xs font-medium\">Create</span>\n        </button>\n        <button\n          onClick={() => setLocation(\"/creators\")}\n          className=\"flex flex-col items-center text-foreground/70 hover:text-foreground\"\n        >\n          <div className=\"relative\">\n            <Users className=\"w-6 h-6\" />\n            <div className=\"absolute -top-1 -right-1 bg-red-500 text-white rounded-full h-4 min-w-4 px-1 flex items-center justify-center text-[8px] font-bold\">\n              New\n            </div>\n          </div>\n          <span className=\"text-xs font-medium\">Creators</span>\n        </button>\n        <button\n          onClick={() => setLocation(\"/profile\")}\n          className=\"flex flex-col items-center text-foreground/70 hover:text-foreground\"\n        >\n          <User className=\"w-6 h-6\" />\n          <span className=\"text-xs font-medium\">Profile</span>\n        </button>\n      </div>\n    </nav>\n  );\n\n\n  return (\n    <div className=\"container max-w-5xl mx-auto px-4 py-8 space-y-4\">\n      {/* Instagram Stories Section */}\n      <section className=\"space-y-3\">\n        {!zoraCreators ? (\n          <div className=\"flex gap-3 overflow-x-auto pb-2\">\n            {[...Array(10)].map((_, i) => (\n              <div key={i} className=\"flex-shrink-0\">\n                <div className=\"w-16 h-16 rounded-full bg-muted animate-pulse\" />\n              </div>\n            ))}\n          </div>\n        ) : trendingCreators.length === 0 ? (\n          <div className=\"text-center py-6 text-muted-foreground\">\n            <p className=\"text-sm\">\n              No creators available yet. Be the first to create!\n            </p>\n          </div>\n        ) : (\n          <TopCreatorsStories creators={trendingCreators} limit={10} />\n        )}\n      </section>\n\n      {/* Trending Coins */}\n      <section className=\"space-y-4 -mt-2 md:mt-0\" data-tour=\"trending-coins\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-1\"></div>\n        </div>\n\n        {/* Discover heading - Mobile only */}\n      <div className=\"md:hidden\">\n        <h2 className=\"text-lg font-semibold text-foreground mb-4\">Discover</h2>\n      </div>\n\n      {/* Coins Grid */}\n      {(loadingZoraCoins || loadingPinnedCoins) ? (\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-1\">\n            {[...Array(12)].map((_, i) => (\n              <div\n                key={i}\n                className=\"h-64 bg-card rounded-2xl animate-pulse\"\n                data-testid=\"skeleton-coin-card\"\n              />\n            ))}\n          </div>\n        ) : displayCoins.length > 0 ? (\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-1\">\n            {displayCoins.map((coin: Coin) => (\n              <CoinCard\n                key={coin.id || coin.address}\n                coin={coin}\n                onClick={() => openTradeModal(coin)}\n              />\n            ))}\n          </div>\n        ) : (\n          <div className=\"text-center py-12\">\n            <p className=\"text-muted-foreground\">\n              No coins available at the moment\n            </p>\n          </div>\n        )}\n      </section>\n\n      {selectedCoin && isMobile && (\n        <TradeModalMobile\n          coin={selectedCoin}\n          open={isTradeModalOpen}\n          onOpenChange={setIsTradeModalOpen}\n        />\n      )}\n      {isMobile && renderMobileNav()}\n    </div>\n  );\n}","size_bytes":13803},"types/web-push.d.ts":{"content":"declare module 'web-push';\n","size_bytes":27},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/pages/faq.tsx":{"content":"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport { HelpCircle } from \"lucide-react\";\n\nexport default function FAQ() {\n  return (\n    <div className=\"container max-w-4xl mx-auto px-4 py-8 space-y-8\">\n      <div className=\"flex items-center gap-3\">\n        <HelpCircle className=\"h-8 w-8 text-primary\" />\n        <h1 className=\"text-2xl items-center font-bold\">\n          Frequently Asked Questions\n        </h1>\n      </div>\n\n      <p className=\"text-lg items-center text-muted-foreground\">\n        Everything you need to know about Every1.fun\n      </p>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>General Questions</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            <AccordionItem value=\"item-1\">\n              <AccordionTrigger>What is Every1.fun?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Every1.fun is a decentralized creator economy platform where you can create and trade creator coins, share content, connect with other creators, and earn E1XP points through engagement. Built on Base blockchain using Zora protocol, we make it easy for anyone to participate in the creator economy.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-2\">\n              <AccordionTrigger>\n                Do I need cryptocurrency to use this platform?\n              </AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Not necessarily! You can sign up with just an email address and we'll create a smart wallet for you automatically. However, to trade coins, you'll need some ETH on Base network for transaction fees. You can also connect your existing wallet like MetaMask or Coinbase Wallet.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-3\">\n              <AccordionTrigger>Is this platform free to use?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Yes! Creating an account, browsing content, and earning E1XP points is completely free. When you create or trade coins, you'll pay blockchain transaction fees (gas fees) which go to the Base network. We're working on gasless transactions to make it even easier.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-4\">\n              <AccordionTrigger>How do I get started?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Simply click the \"Login\" button and sign up with your email or connect your crypto wallet. Once logged in, you can explore creators, create your own coin, upload content, and start earning E1XP points. Don't forget to claim your daily login reward!\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-5\">\n              <AccordionTrigger>What is E1XP?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                E1XP is our platform points system that rewards you for daily engagement. Earn points by logging in daily, maintaining streaks, trading coins, and participating in the community. Build up your streak to multiply your rewards!\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Creator Coins & Trading</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            <AccordionItem value=\"item-6\">\n              <AccordionTrigger>How do I create my own coin?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Go to the Create page and upload or link to your content (image, video, URL). Fill in your coin details like name, symbol, and description. Your coin will be deployed on Base blockchain using Zora's creator coin protocol. You can share it with your community immediately!\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-7\">\n              <AccordionTrigger>How do coin prices work?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Coin prices follow a bonding curve model - as more people buy a coin, the price increases. When people sell, the price may decrease. This creates fair price discovery based on supply and demand. Early supporters can benefit as coins gain popularity.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-8\">\n              <AccordionTrigger>Can I sell my coins anytime?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Yes! You can buy or sell coins at any time through the trading interface. Simply click on a coin card, select Buy or Sell, enter the amount in ETH, and confirm the transaction. Your balance will update immediately.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-9\">\n              <AccordionTrigger>What content can I upload?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                You can upload images, videos, or link to external content. We support various platforms and automatically fetch metadata. Content is stored on IPFS through Pinata for decentralized, permanent storage. Make sure you own the rights to any content you upload.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-10\">\n              <AccordionTrigger>\n                Do creators earn from their coins?\n              </AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Yes! As the creator, you earn a percentage of trading fees whenever people buy and sell your coins. This creates a sustainable revenue stream that grows with your community's engagement. You can withdraw your earnings anytime from your profile.\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Features & Community</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            <AccordionItem value=\"item-11\">\n              <AccordionTrigger>Can I message other users?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Yes! We use the XMTP protocol for decentralized, encrypted messaging. Click the message icon on any user's profile to start a conversation. Your messages are private and stored on the decentralized XMTP network.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-12\">\n              <AccordionTrigger>How do daily streaks work?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Log in daily to build your streak! Each consecutive day increases your E1XP multiplier. The longer your streak, the more points you earn. Miss a day and your streak resets, so stay consistent to maximize rewards.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-13\">\n              <AccordionTrigger>What are notifications for?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Get notified about new coin launches, trending creators, trading activity, messages, and daily reward reminders. Enable push notifications in your browser to stay updated even when you're not on the platform.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-14\">\n              <AccordionTrigger>Is there a mobile app?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Our web app is fully responsive and works great on mobile browsers! We also have Telegram bot integration for notifications and updates. Just use your mobile browser to access the full platform experience.\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Safety & Support</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            <AccordionItem value=\"item-15\">\n              <AccordionTrigger>Is my wallet safe?</AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Absolutely! We use Privy for secure authentication. If you sign up with email, we create a smart wallet that only you control. For external wallets, we never have access to your private keys. All transactions require your explicit approval.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-16\">\n              <AccordionTrigger>\n                What blockchain is this built on?\n              </AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                We're built on Base, an Ethereum Layer 2 network. This means fast, cheap transactions while maintaining the security of Ethereum. All coins are created using Zora's battle-tested creator coin protocol.\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-17\">\n              <AccordionTrigger>\n                What if I have a problem or question?\n              </AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                You can reach out through our Telegram community, use the in-app messaging to contact support, or check our comprehensive documentation. We're here to help with any issues or questions you might have!\n              </AccordionContent>\n            </AccordionItem>\n\n            <AccordionItem value=\"item-18\">\n              <AccordionTrigger>\n                Are there risks to trading creator coins?\n              </AccordionTrigger>\n              <AccordionContent className=\"text-muted-foreground\">\n                Yes, like any investment, trading creator coins carries risk. Coin values can fluctuate significantly. Only invest what you can afford to lose, do your research on creators before buying their coins, and remember that past performance doesn't guarantee future results.\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":11085},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/lib/geckoterminal.ts":{"content":"const GECKOTERMINAL_API_BASE = \"https://api.geckoterminal.com/api/v2\";\n\nexport interface GeckoTerminalPool {\n  id: string;\n  type: string;\n  attributes: {\n    address: string;\n    name: string;\n    base_token_price_usd: string;\n    quote_token_price_usd: string;\n    pool_created_at: string;\n    fdv_usd: string;\n    market_cap_usd: string;\n    price_change_percentage: {\n      h1: string;\n      h24: string;\n    };\n    transactions: {\n      h1: {\n        buys: number;\n        sells: number;\n      };\n      h24: {\n        buys: number;\n        sells: number;\n      };\n    };\n    volume_usd: {\n      h1: string;\n      h24: string;\n    };\n    reserve_in_usd: string;\n  };\n  relationships?: {\n    base_token?: { data: { id: string; type: string } };\n    quote_token?: { data: { id: string; type: string } };\n    dex?: { data: { id: string; type: string } };\n  };\n}\n\nexport interface GeckoTerminalOHLCV {\n  data: {\n    id: string;\n    type: string;\n    attributes: {\n      ohlcv_list: Array<[number, number, number, number, number, number]>; // [timestamp, open, high, low, close, volume]\n    };\n  };\n  meta?: {\n    base: {\n      address: string;\n      name: string;\n      symbol: string;\n      coingecko_coin_id: string | null;\n    };\n  };\n}\n\nexport interface GeckoTerminalTokenPools {\n  data: GeckoTerminalPool[];\n  included?: Array<{\n    id: string;\n    type: string;\n    attributes: {\n      address?: string;\n      name?: string;\n      symbol?: string;\n      image_url?: string;\n    };\n  }>;\n}\n\n/**\n * Search for pools by token address\n */\nexport async function getTokenPools(\n  network: string,\n  tokenAddress: string,\n  page = 1\n): Promise<GeckoTerminalTokenPools> {\n  const response = await fetch(\n    `${GECKOTERMINAL_API_BASE}/networks/${network}/tokens/${tokenAddress}/pools?page=${page}`\n  );\n  \n  if (!response.ok) {\n    throw new Error(`GeckoTerminal API error: ${response.statusText}`);\n  }\n  \n  return response.json();\n}\n\n/**\n * Get specific pool data\n */\nexport async function getPool(\n  network: string,\n  poolAddress: string,\n  includeTokens = true\n): Promise<{ data: GeckoTerminalPool; included?: any[] }> {\n  const params = includeTokens ? \"?include=base_token,quote_token\" : \"\";\n  const response = await fetch(\n    `${GECKOTERMINAL_API_BASE}/networks/${network}/pools/${poolAddress}${params}`\n  );\n  \n  if (!response.ok) {\n    throw new Error(`GeckoTerminal API error: ${response.statusText}`);\n  }\n  \n  return response.json();\n}\n\n/**\n * Get OHLCV (candlestick) data for a pool\n */\nexport async function getPoolOHLCV(\n  network: string,\n  poolAddress: string,\n  timeframe: \"day\" | \"hour\" | \"minute\" = \"hour\",\n  aggregate = 1,\n  limit = 100,\n  currency: \"usd\" | \"token\" = \"usd\",\n  token: \"base\" | \"quote\" = \"base\"\n): Promise<GeckoTerminalOHLCV> {\n  const response = await fetch(\n    `${GECKOTERMINAL_API_BASE}/networks/${network}/pools/${poolAddress}/ohlcv/${timeframe}?aggregate=${aggregate}&limit=${limit}&currency=${currency}&token=${token}`\n  );\n  \n  if (!response.ok) {\n    throw new Error(`GeckoTerminal API error: ${response.statusText}`);\n  }\n  \n  return response.json();\n}\n\n/**\n * Get multiple pools data in one call\n */\nexport async function getMultiplePools(\n  network: string,\n  poolAddresses: string[]\n): Promise<{ data: GeckoTerminalPool[] }> {\n  const addresses = poolAddresses.join(\",\");\n  const response = await fetch(\n    `${GECKOTERMINAL_API_BASE}/networks/${network}/pools/multi/${addresses}`\n  );\n  \n  if (!response.ok) {\n    throw new Error(`GeckoTerminal API error: ${response.statusText}`);\n  }\n  \n  return response.json();\n}\n\n/**\n * Search for a pool by token address and return the top pool\n */\nexport async function findTopPoolForToken(\n  network: string,\n  tokenAddress: string\n): Promise<GeckoTerminalPool | null> {\n  try {\n    const result = await getTokenPools(network, tokenAddress, 1);\n    \n    if (result.data && result.data.length > 0) {\n      return result.data[0];\n    }\n    \n    return null;\n  } catch (error) {\n    console.error(\"Error finding pool for token:\", error);\n    return null;\n  }\n}\n\n/**\n * Format OHLCV data for use with recharts\n */\nexport function formatOHLCVForChart(ohlcvData: GeckoTerminalOHLCV): Array<{\n  time: string;\n  open: number;\n  high: number;\n  low: number;\n  close: number;\n  volume: number;\n  timestamp: number;\n}> {\n  if (!ohlcvData.data?.attributes?.ohlcv_list) {\n    return [];\n  }\n\n  return ohlcvData.data.attributes.ohlcv_list\n    .filter((row) => row && row.length === 6)\n    .map(([timestamp, open, high, low, close, volume]) => {\n      const date = new Date(Number(timestamp) * 1000);\n      const timeStr = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n      \n      return {\n        time: timeStr,\n        open: parseFloat(Number(open).toFixed(8)),\n        high: parseFloat(Number(high).toFixed(8)),\n        low: parseFloat(Number(low).toFixed(8)),\n        close: parseFloat(Number(close).toFixed(8)),\n        volume: parseFloat(Number(volume).toFixed(2)),\n        timestamp: Number(timestamp),\n      };\n    });\n}\n\n/**\n * Get trending pools for a network\n */\nexport async function getTrendingPools(\n  network: string,\n  page = 1\n): Promise<{ data: GeckoTerminalPool[] }> {\n  const response = await fetch(\n    `${GECKOTERMINAL_API_BASE}/networks/${network}/trending_pools?page=${page}`\n  );\n  \n  if (!response.ok) {\n    throw new Error(`GeckoTerminal API error: ${response.statusText}`);\n  }\n  \n  return response.json();\n}\n\n/**\n * Get recent trades for a pool\n */\nexport async function getPoolTrades(\n  network: string,\n  poolAddress: string\n): Promise<any> {\n  const response = await fetch(\n    `${GECKOTERMINAL_API_BASE}/networks/${network}/pools/${poolAddress}/trades`\n  );\n  \n  if (!response.ok) {\n    throw new Error(`GeckoTerminal API error: ${response.statusText}`);\n  }\n  \n  return response.json();\n}\n","size_bytes":5823},"server/seed.ts":{"content":"import { db } from \"./db\";\nimport { users, projects, coins, groups, loginStreaks } from \"@shared/schema\";\n\nasync function seed() {\n  console.log(\"üå± Seeding database...\");\n\n  try {\n    // Create sample users/creators\n    const creators = await db.insert(users).values([\n      {\n        username: \"maria_bator\",\n        displayName: \"Maria Bator\",\n        email: \"maria@example.com\",\n        bio: \"Creative director and choreographer who teaches dance internationally. I craft unique brand experiences through fashion.\",\n        location: \"Los Angeles, CA\",\n        avatarUrl: \"https://api.dicebear.com/7.x/avataaars/svg?seed=maria\",\n        creatorType: \"content_creator\",\n        categories: [\"Dance\", \"Fashion\", \"Creative\"],\n        totalConnections: 18356,\n        totalProfileViews: 23400,\n        totalEarnings: \"2500.50\",\n        socialAccounts: {\n          instagram: \"mariabator\",\n          tiktok: \"mariabator\",\n        },\n      },\n      {\n        username: \"hanna_baptista\",\n        displayName: \"Hanna Baptista\",\n        email: \"hanna@example.com\",\n        bio: \"Hi! I'm an artistic creative director and choreographer who launches dance internationally.\",\n        location: \"Los Angeles, CA\",\n        avatarUrl: \"https://api.dicebear.com/7.x/avataaars/svg?seed=hanna\",\n        creatorType: \"content_creator\",\n        categories: [\"Art\", \"Dance\"],\n        totalConnections: 18346,\n        totalProfileViews: 15200,\n        totalEarnings: \"1800.00\",\n      },\n      {\n        username: \"desiree_baptiste\",\n        displayName: \"Desiree Baptiste\",\n        email: \"desiree@example.com\",\n        bio: \"21-25 years old crypto enthusiast and content creator\",\n        location: \"New York, NY\",\n        avatarUrl: \"https://api.dicebear.com/7.x/avataaars/svg?seed=desiree\",\n        creatorType: \"public_goods_builder\",\n        categories: [\"Tech\", \"Crypto\"],\n        totalConnections: 12450,\n        totalProfileViews: 18900,\n        totalEarnings: \"3200.75\",\n      },\n      {\n        username: \"chris_smolinski\",\n        displayName: \"Chris Smolinski\",\n        email: \"chris@example.com\",\n        bio: \"Tech creator building Web3 tools\",\n        location: \"San Francisco, CA\",\n        avatarUrl: \"https://api.dicebear.com/7.x/avataaars/svg?seed=chris\",\n        creatorType: \"public_goods_builder\",\n        categories: [\"Tech\", \"Web3\"],\n        totalConnections: 8920,\n        totalProfileViews: 12300,\n        totalEarnings: \"1500.00\",\n      },\n      {\n        username: \"anne_burgess\",\n        displayName: \"Anne Burgess\",\n        email: \"anne@example.com\",\n        bio: \"Indie musician and producer\",\n        location: \"Nashville, TN\",\n        avatarUrl: \"https://api.dicebear.com/7.x/avataaars/svg?seed=anne\",\n        creatorType: \"content_creator\",\n        categories: [\"Music\", \"Art\"],\n        totalConnections: 15600,\n        totalProfileViews: 28700,\n        totalEarnings: \"4100.25\",\n      },\n      {\n        username: \"kaleb_oyola\",\n        displayName: \"Kaleb Oyola\",\n        email: \"kaleb@example.com\",\n        bio: \"Gaming content creator and streamer\",\n        location: \"Austin, TX\",\n        avatarUrl: \"https://api.dicebear.com/7.x/avataaars/svg?seed=kaleb\",\n        creatorType: \"content_creator\",\n        categories: [\"Gaming\", \"Entertainment\"],\n        totalConnections: 25400,\n        totalProfileViews: 45600,\n        totalEarnings: \"6800.50\",\n      },\n      {\n        username: \"aidan_quinn\",\n        displayName: \"Aidan Quinn\",\n        email: \"aidan@example.com\",\n        bio: \"Fitness coach and wellness advocate\",\n        location: \"Miami, FL\",\n        avatarUrl: \"https://api.dicebear.com/7.x/avataaars/svg?seed=aidan\",\n        creatorType: \"content_creator\",\n        categories: [\"Fitness\", \"Wellness\"],\n        totalConnections: 19800,\n        totalProfileViews: 32100,\n        totalEarnings: \"3900.00\",\n      },\n      {\n        username: \"brandon_wesley\",\n        displayName: \"Brandon Wesley\",\n        email: \"brandon@example.com\",\n        bio: \"Open source developer\",\n        location: \"Seattle, WA\",\n        avatarUrl: \"https://api.dicebear.com/7.x/avataaars/svg?seed=brandon\",\n        creatorType: \"public_goods_builder\",\n        categories: [\"Tech\", \"Open Source\"],\n        totalConnections: 7200,\n        totalProfileViews: 9800,\n        totalEarnings: \"1200.00\",\n      },\n    ]).returning();\n\n    console.log(`‚úÖ Created ${creators.length} creators`);\n\n    // Create sample projects\n    const sampleProjects = await db.insert(projects).values([\n      {\n        userId: creators[0].id,\n        title: \"Tommy Hilfiger Campaign\",\n        description: \"Inspired by Andy Warhol's Factory, the fall 2025 campaign from Tommy Hilfiger takes on a creative spirit. The meeting of music, fashion, and art unites with coed stars and exclusive icons alike.\",\n        category: \"Fashion\",\n        thumbnailUrl: \"https://images.unsplash.com/photo-1523381210434-271e8be1f52b?w=800&h=600&fit=crop\",\n        totalViews: 1200,\n        totalInteractions: 320,\n        isMinted: true,\n      },\n      {\n        userId: creators[1].id,\n        title: \"Modern Dance Choreography\",\n        description: \"A unique contemporary dance piece exploring themes of identity and movement\",\n        category: \"Dance\",\n        thumbnailUrl: \"https://images.unsplash.com/photo-1518834107812-67b0b7c58434?w=800&h=600&fit=crop\",\n        totalViews: 890,\n        totalInteractions: 210,\n        isMinted: false,\n      },\n      {\n        userId: creators[4].id,\n        title: \"Midnight Sessions EP\",\n        description: \"An indie electronic album recorded late at night in Nashville\",\n        category: \"Music\",\n        thumbnailUrl: \"https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=800&h=600&fit=crop\",\n        totalViews: 2400,\n        totalInteractions: 680,\n        isMinted: true,\n      },\n      {\n        userId: creators[5].id,\n        title: \"Epic Gaming Moments 2024\",\n        description: \"Compilation of the best gaming moments from my stream\",\n        category: \"Gaming\",\n        thumbnailUrl: \"https://images.unsplash.com/photo-1511512578047-dfb367046420?w=800&h=600&fit=crop\",\n        totalViews: 5600,\n        totalInteractions: 1200,\n        isMinted: true,\n      },\n    ]).returning();\n\n    console.log(`‚úÖ Created ${sampleProjects.length} projects`);\n\n    // Create sample groups\n    const sampleGroups = await db.insert(groups).values([\n      {\n        name: \"East Side Creators\",\n        description: \"A community of creators from the East Coast collaborating on projects\",\n        category: \"Creative\",\n        memberCount: 234,\n        isPrivate: false,\n        createdBy: creators[0].id,\n      },\n      {\n        name: \"Web3 Builders\",\n        description: \"Building the future of decentralized applications\",\n        category: \"Tech\",\n        memberCount: 567,\n        isPrivate: false,\n        createdBy: creators[2].id,\n      },\n      {\n        name: \"Indie Musicians\",\n        description: \"Independent musicians supporting each other\",\n        category: \"Music\",\n        memberCount: 890,\n        isPrivate: false,\n        createdBy: creators[4].id,\n      },\n    ]).returning();\n\n    console.log(`‚úÖ Created ${sampleGroups.length} groups`);\n\n    // Create sample coins for minted projects\n    const mintedProjects = sampleProjects.filter(p => p.isMinted);\n    if (mintedProjects.length > 0) {\n      const sampleCoins = await db.insert(coins).values(\n        mintedProjects.map((project, index) => ({\n          userId: project.userId,\n          projectId: project.id,\n          contractAddress: `0x${Math.random().toString(16).substring(2, 42)}`,\n          name: project.title,\n          symbol: `COIN${index + 1}`,\n          totalSupply: \"1000000\",\n          currentPrice: (Math.random() * 10 + 1).toFixed(2),\n          marketCap: (Math.random() * 100000 + 10000).toFixed(2),\n          volume24h: (Math.random() * 50000 + 5000).toFixed(2),\n          priceChange24h: (Math.random() * 20 - 10).toFixed(2),\n        }))\n      ).returning();\n\n      console.log(`‚úÖ Created ${sampleCoins.length} coins`);\n    }\n\n    console.log(\"‚ú® Database seeded successfully!\");\n  } catch (error) {\n    console.error(\"‚ùå Error seeding database:\", error);\n    throw error;\n  }\n}\n\nseed()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error(error);\n    process.exit(1);\n  });\n","size_bytes":8324},"client/src/lib/og-meta.ts":{"content":"\nexport function updateOGMeta(data: {\n  title: string;\n  description: string;\n  image?: string;\n  url?: string;\n}) {\n  // Update title\n  document.title = data.title;\n  \n  // Update OG tags\n  const setMetaTag = (property: string, content: string) => {\n    let tag = document.querySelector(`meta[property=\"${property}\"]`) as HTMLMetaElement;\n    if (!tag) {\n      tag = document.createElement('meta');\n      tag.setAttribute('property', property);\n      document.head.appendChild(tag);\n    }\n    tag.content = content;\n  };\n\n  setMetaTag('og:title', data.title);\n  setMetaTag('og:description', data.description);\n  setMetaTag('twitter:title', data.title);\n  setMetaTag('twitter:description', data.description);\n  \n  if (data.image) {\n    setMetaTag('og:image', data.image);\n    setMetaTag('twitter:image', data.image);\n  }\n  \n  if (data.url) {\n    setMetaTag('og:url', data.url);\n    setMetaTag('twitter:url', data.url);\n  }\n}\n","size_bytes":925},"server/platform-detector.ts":{"content":"export type PlatformType = \n  | 'youtube'\n  | 'spotify'\n  | 'medium'\n  | 'substack'\n  | 'gitcoin'\n  | 'giveth'\n  | 'tiktok'\n  | 'instagram'\n  | 'twitter'\n  | 'github'\n  | 'farcaster'\n  | 'twitch'\n  | 'blog'\n  | 'audio'\n  | 'eventbrite'\n  | 'luma'\n  | 'meetup'\n  | 'partiful';\n\nexport interface PlatformInfo {\n  type: PlatformType;\n  name: string;\n  id?: string;\n}\n\nexport function detectPlatform(url: string): PlatformInfo {\n  try {\n    const urlObj = new URL(url);\n    const hostname = urlObj.hostname.toLowerCase();\n    const pathname = urlObj.pathname;\n\n    // YouTube (videos, channels, and short URLs)\n    if (hostname.includes('youtube.com') || hostname === 'youtu.be') {\n      const isVideo = pathname.includes('/watch') || hostname === 'youtu.be';\n      const isShort = pathname.includes('/shorts/');\n      const match = pathname.match(/\\/(channel|c|user|@)\\/([^\\/]+)/);\n      \n      return {\n        type: 'youtube',\n        name: isVideo ? 'YouTube Video' : isShort ? 'YouTube Short' : 'YouTube',\n        id: match ? match[2] : undefined\n      };\n    }\n\n    // Spotify\n    if (hostname.includes('spotify.com')) {\n      const match = pathname.match(/\\/(track|album|artist|playlist)\\/([^\\/\\?]+)/);\n      return {\n        type: 'spotify',\n        name: 'Spotify',\n        id: match ? match[2] : undefined\n      };\n    }\n\n    // Audio URL detection\n    if (/\\.(mp3|wav|ogg|m4a|aac|flac)$/i.test(url)) {\n      return { type: 'audio', name: 'Audio File' };\n    }\n\n    // Medium\n    if (hostname.includes('medium.com') || hostname.endsWith('.medium.com')) {\n      return { type: 'medium', name: 'Medium' };\n    }\n\n    // Substack\n    if (hostname.includes('substack.com')) {\n      return { type: 'substack', name: 'Substack' };\n    }\n\n    // Gitcoin\n    if (hostname.includes('gitcoin.co') || hostname.includes('grants.gitcoin.co')) {\n      return { type: 'gitcoin', name: 'Gitcoin' };\n    }\n\n    // Giveth\n    if (hostname.includes('giveth.io')) {\n      return { type: 'giveth', name: 'Giveth' };\n    }\n\n    // TikTok (both profile and video URLs)\n    if (hostname.includes('tiktok.com')) {\n      const isVideo = pathname.includes('/video/');\n      return { \n        type: 'tiktok', \n        name: isVideo ? 'TikTok Video' : 'TikTok' \n      };\n    }\n\n    // Instagram (both profile and post URLs)\n    if (hostname.includes('instagram.com')) {\n      const isPost = pathname.includes('/p/') || pathname.includes('/reel/') || pathname.includes('/tv/');\n      return { \n        type: 'instagram', \n        name: isPost ? 'Instagram Post' : 'Instagram' \n      };\n    }\n\n    // Twitter/X (both profile and tweet URLs)\n    if (hostname.includes('twitter.com') || hostname === 'x.com') {\n      const isTweet = pathname.includes('/status/');\n      return { \n        type: 'twitter', \n        name: isTweet ? 'Tweet' : 'Twitter/X' \n      };\n    }\n\n    // GitHub\n    if (hostname.includes('github.com')) {\n      return { type: 'github', name: 'GitHub' };\n    }\n\n    // Farcaster\n    if (hostname.includes('warpcast.com') || hostname.includes('farcaster.xyz')) {\n      return { type: 'farcaster', name: 'Farcaster' };\n    }\n\n    // Twitch\n    if (hostname.includes('twitch.tv')) {\n      return { type: 'twitch', name: 'Twitch' };\n    }\n\n    // Eventbrite\n    if (hostname.includes('eventbrite.com') || hostname.includes('eventbrite.co')) {\n      return { type: 'eventbrite', name: 'Eventbrite Event' };\n    }\n\n    // Luma (lu.ma)\n    if (hostname.includes('lu.ma') || hostname.includes('luma.')) {\n      return { type: 'luma', name: 'Luma Event' };\n    }\n\n    // Meetup\n    if (hostname.includes('meetup.com')) {\n      return { type: 'meetup', name: 'Meetup Event' };\n    }\n\n    // Partiful\n    if (hostname.includes('partiful.com')) {\n      return { type: 'partiful', name: 'Partiful Event' };\n    }\n\n    // Default to generic blog\n    return { type: 'blog', name: 'Blog/Article' };\n\n  } catch (error) {\n    // If URL parsing fails, treat as a generic blog/article\n    if (/\\.(mp3|wav|ogg|m4a|aac|flac)$/i.test(url)) {\n      return { type: 'audio', name: 'Audio File' };\n    }\n    return { type: 'blog', name: 'Blog/Article' };\n  }\n}\n\nexport const SUPPORTED_PLATFORMS = [\n  { type: 'youtube', name: 'YouTube', example: 'https://youtube.com/@channelname' },\n  { type: 'spotify', name: 'Spotify', example: 'https://open.spotify.com/track/...' },\n  { type: 'audio', name: 'Audio File', example: 'https://example.com/audio.mp3' },\n  { type: 'medium', name: 'Medium', example: 'https://medium.com/@author/article' },\n  { type: 'substack', name: 'Substack', example: 'https://example.substack.com/p/article' },\n  { type: 'gitcoin', name: 'Gitcoin Grants', example: 'https://grants.gitcoin.co/...' },\n  { type: 'giveth', name: 'Giveth', example: 'https://giveth.io/project/...' },\n  { type: 'tiktok', name: 'TikTok', example: 'https://tiktok.com/@username' },\n  { type: 'instagram', name: 'Instagram', example: 'https://instagram.com/username' },\n  { type: 'twitter', name: 'Twitter/X', example: 'https://twitter.com/username' },\n  { type: 'github', name: 'GitHub', example: 'https://github.com/username/project' },\n  { type: 'farcaster', name: 'Farcaster', example: 'https://warpcast.com/username' },\n  { type: 'twitch', name: 'Twitch', example: 'https://twitch.tv/username' },\n  { type: 'eventbrite', name: 'Eventbrite', example: 'https://eventbrite.com/e/event-name-12345' },\n  { type: 'luma', name: 'Luma', example: 'https://lu.ma/event-name' },\n  { type: 'meetup', name: 'Meetup', example: 'https://meetup.com/group-name/events/12345' },\n  { type: 'partiful', name: 'Partiful', example: 'https://partiful.com/e/event-id' },\n  { type: 'blog', name: 'Personal Blogs & News', example: 'https://example.com/article' },\n] as const;","size_bytes":5717},"server/mock-auth.ts":{"content":"// Mock authentication middleware\n// TODO: Replace with Privy authentication integration\n// For now, using a seeded user as the mock current user\n\nimport { storage } from \"./storage\";\n\nlet mockCurrentUserId: string | null = null;\n\nexport async function initMockAuth() {\n  // Get the first user from the database as our mock current user\n  let retries = 3;\n  let lastError;\n  \n  while (retries > 0) {\n    try {\n      const users = await storage.getTrendingCreators(1);\n      if (users.length > 0) {\n        mockCurrentUserId = users[0].id;\n        console.log(`üîê Mock auth initialized with user: ${users[0].username} (${mockCurrentUserId})`);\n        return;\n      }\n      break;\n    } catch (error) {\n      lastError = error;\n      retries--;\n      if (retries > 0) {\n        console.log(`‚ö†Ô∏è Database connection failed, retrying... (${retries} attempts left)`);\n        await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds before retry\n      }\n    }\n  }\n  \n  if (lastError) {\n    console.error('‚ùå Failed to initialize mock auth after multiple attempts:', lastError);\n    throw lastError;\n  }\n}\n\nexport function getMockCurrentUserId(): string {\n  if (!mockCurrentUserId) {\n    throw new Error(\"Mock auth not initialized\");\n  }\n  return mockCurrentUserId;\n}\n\nexport function setMockCurrentUserId(userId: string) {\n  mockCurrentUserId = userId;\n}\n\n// Alias exports for compatibility\nexport function getCurrentUserId(): string {\n  return getMockCurrentUserId();\n}\n\nexport function setCurrentUserId(userId: string): void {\n  setMockCurrentUserId(userId);\n}\n","size_bytes":1583},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"server/index.ts":{"content":"declare global {\n  var telegramBotInitialized: boolean | undefined;\n  var isShuttingDown: boolean | undefined;\n}\n\n\n// ensure environment files are loaded. Load base .env first, then\n// allow .env.development to override when running in development.\nimport dotenv from 'dotenv';\nimport path from 'path';\n\n// Always load base .env if present so users can keep DATABASE_URL there.\ndotenv.config({ path: path.resolve(process.cwd(), '.env') });\n\n// If running in development, also load (and allow) .env.development to override values.\nif (process.env.NODE_ENV === 'development') {\n  dotenv.config({ path: path.resolve(process.cwd(), '.env.development'), override: true });\n}\n\n// Database URL should come from Replit Secrets or local .env files.\nif (!process.env.DATABASE_URL) {\n  console.error('DATABASE_URL not found. Make sure Replit PostgreSQL database is provisioned or set DATABASE_URL in .env/.env.development.');\n}\n\n// Verify Supabase credentials\nif (!process.env.VITE_SUPABASE_URL || !process.env.VITE_SUPABASE_ANON_KEY) {\n  console.error('‚ö†Ô∏è Missing Supabase credentials. Please set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your environment.');\n}\n\nimport express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport { registerRoutes } from \"./routes\";\nimport { storage } from \"./supabase-storage\";\nimport { createE1XPRouter } from './routes/e1xp';\n// import { autoMigrateOnStartup } from \"./migrate-old-data\"; // Disabled - uses direct DB connection\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { initTelegramBot } from \"./telegram-bot\";\nimport { ActivityTrackerCron } from \"./activity-tracker-cron\";\nimport { base } from \"viem/chains\";\n\nconst app = express();\n\n// Session configuration for admin\napp.use(session({\n  secret: process.env.SESSION_SECRET || 'creatorland-admin-secret-key-2024',\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    secure: process.env.NODE_ENV === 'production',\n    httpOnly: true,\n    maxAge: 24 * 60 * 60 * 1000 // 24 hours\n  }\n}));\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  // Initialize Socket.io\n  const { initializeSocketServer } = await import('./socket-server');\n  const io = initializeSocketServer(server);\n  \n  // Pass Socket.io to admin routes\n  const { setSocketIO } = await import('./routes/admin');\n  setSocketIO(io);\n\n  // Initialize Telegram bot (only once)\n  if (!global.telegramBotInitialized && !global.isShuttingDown) {\n    try {\n      await initTelegramBot();\n      global.telegramBotInitialized = true;\n      console.log('‚úÖ Telegram bot initialized and marked as global');\n    } catch (error) {\n      console.error('Failed to initialize Telegram bot:', error);\n      global.telegramBotInitialized = false;\n    }\n  } else if (global.telegramBotInitialized) {\n    console.log('‚ÑπÔ∏è  Telegram bot already initialized globally, skipping...');\n  }\n\n  // Start trending notifications\n  const { startTrendingNotifications } = await import('./trending-notifications');\n  startTrendingNotifications();\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n\n  // Run automatic migration on startup\n  // Disabled - uses direct database connection instead of Supabase SDK\n  // try {\n  //   await autoMigrateOnStartup();\n  // } catch (error) {\n  //   console.error(\"Failed to run auto migration:\", error);\n  // }\n\n  // Initialize and start activity tracker cron job\n  const activityTrackerCron = new ActivityTrackerCron(storage, base.id);\n  activityTrackerCron.start();\n  log(`Activity tracker cron started with schedule: ${activityTrackerCron.getSchedule()}`);\n\n  // Initialize and start notification cron jobs\n  const { scheduleNotificationJobs } = await import('./notification-cron');\n  scheduleNotificationJobs();\n\n  // Schedule reward reminder cron job (runs daily at 10 AM)\n  const cron = await import('node-cron');\n  const { sendUnclaimedRewardReminders } = await import('./reward-reminder-cron');\n  cron.schedule('0 10 * * *', async () => {\n    console.log('üîî Running daily reward reminder job...');\n    await sendUnclaimedRewardReminders();\n  });\n  console.log('‚úÖ Reward reminder cron job scheduled (daily at 10 AM)');\n\n  // Start streak reminder cron service\n  const { startStreakReminderCron } = await import('./streak-reminder-cron');\n  startStreakReminderCron();\n  console.log('‚úÖ Streak reminder cron started (runs at 9 AM, 3 PM, and 9 PM daily)');\n\n  // Start registry cron service (on-chain coin registration)\n  const { startRegistryCron } = await import('./cron/registryCron');\n  await startRegistryCron();\n\n  // Graceful shutdown\n  const shutdown = async (signal: string) => {\n    if (global.isShuttingDown) {\n      console.log('Already shutting down, please wait...');\n      return;\n    }\n    \n    global.isShuttingDown = true;\n    console.log(`\\n${signal} received, shutting down gracefully...`);\n    \n    try {\n      const { stopTelegramBot } = await import('./telegram-bot');\n      await stopTelegramBot();\n      global.telegramBotInitialized = false;\n      \n      activityTrackerCron.stop();\n      \n      console.log('‚úÖ All services stopped successfully');\n    } catch (error) {\n      console.error('Error during shutdown:', error);\n    } finally {\n      process.exit(0);\n    }\n  };\n\n  process.on('SIGINT', () => shutdown('SIGINT'));\n  process.on('SIGTERM', () => shutdown('SIGTERM'));\n  process.on('SIGHUP', () => shutdown('SIGHUP'));\n})();","size_bytes":7064},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/lib/navigation.ts":{"content":"import { Path } from 'wouter';\n\n/**\n * Safe navigation utility to prevent [object Object] URLs\n * @param setLocation The setLocation function from useLocation\n * @param path The path to navigate to\n * @param params Optional query parameters\n * @param hash Optional URL hash fragment\n */\nexport function safeNavigate(\n  setLocation: (to: Path) => void, \n  path: string | { pathname: string; search?: string; hash?: string } | undefined,\n  params?: Record<string, string | undefined>,\n  hash?: string\n) {\n  // Handle undefined path\n  if (!path) {\n    console.error('Navigation path is undefined');\n    return;\n  }\n\n  // Convert path object to string\n  let finalPath: string;\n  if (typeof path === 'object') {\n    finalPath = path.pathname;\n    // Add existing search params if any\n    if (path.search) {\n      finalPath += path.search;\n    }\n    // Add existing hash if any\n    if (path.hash) {\n      finalPath += path.hash;\n    }\n  } else {\n    finalPath = String(path);\n  }\n\n  // Ensure we start with a forward slash\n  if (!finalPath.startsWith('/')) {\n    finalPath = '/' + finalPath;\n  }\n\n  // If there are query params, add them to the URL\n  if (params && Object.keys(params).length > 0) {\n    const searchParams = new URLSearchParams();\n    Object.entries(params).forEach(([key, value]) => {\n      if (value !== undefined && value !== null) {\n        searchParams.append(key, String(value));\n      }\n    });\n    const queryString = searchParams.toString();\n    if (queryString) {\n      // If path already has search params, append with &, otherwise use ?\n      finalPath += finalPath.includes('?') ? '&' : '?';\n      finalPath += queryString;\n    }\n  }\n\n  // Add hash fragment if provided\n  if (hash) {\n    finalPath += `#${hash.replace(/^#/, '')}`;\n  }\n\n  // Final validation\n  try {\n    // Validate the URL is well-formed\n    new URL(finalPath, window.location.origin);\n    // Navigate\n    setLocation(finalPath);\n  } catch (error) {\n    console.error('Invalid navigation path:', finalPath, error);\n  }\n}","size_bytes":2010},"client/src/lib/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState | undefined>(undefined);\n\nexport function ThemeProvider({ children, defaultTheme = \"dark\" }: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(\"theme\") as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  return (\n    <ThemeProviderContext.Provider value={{ theme, setTheme }}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n  if (!context) throw new Error(\"useTheme must be used within ThemeProvider\");\n  return context;\n};\n","size_bytes":1086},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/notification-testing-panel.tsx":{"content":"\nimport { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Bell, Send, Zap } from \"lucide-react\";\n\nexport function NotificationTestingPanel() {\n  const [testUserId, setTestUserId] = useState(\"\");\n  const [notificationType, setNotificationType] = useState(\"streak\");\n  const [triggerType, setTriggerType] = useState(\"daily_streak_reminders\");\n  const { toast } = useToast();\n\n  const testNotificationMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(\"/api/admin/test-notification\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          userId: testUserId,\n          type: notificationType,\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to send test notification\");\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"‚úÖ Test Notification Sent\",\n        description: data.message,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"‚ùå Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const triggerNotificationMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(\"/api/admin/trigger-notification\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          type: triggerType,\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to trigger notifications\");\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"‚úÖ Notifications Triggered\",\n        description: data.message,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"‚ùå Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bell className=\"h-5 w-5\" />\n            Test Individual Notification\n          </CardTitle>\n          <CardDescription>\n            Send a test notification to a specific user\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"test-user-id\">User Address</Label>\n            <Input\n              id=\"test-user-id\"\n              placeholder=\"0x...\"\n              value={testUserId}\n              onChange={(e) => setTestUserId(e.target.value)}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"notification-type\">Notification Type</Label>\n            <Select value={notificationType} onValueChange={setNotificationType}>\n              <SelectTrigger id=\"notification-type\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"streak\">Daily Login Streak</SelectItem>\n                <SelectItem value=\"reminder\">E1XP Claim Reminder</SelectItem>\n                <SelectItem value=\"referral\">Referral Bonus</SelectItem>\n                <SelectItem value=\"trade\">New Trade</SelectItem>\n                <SelectItem value=\"points\">E1XP Points Earned</SelectItem>\n                <SelectItem value=\"follower\">New Follower</SelectItem>\n                <SelectItem value=\"milestone\">Milestone Reached</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <Button\n            onClick={() => testNotificationMutation.mutate()}\n            disabled={!testUserId || testNotificationMutation.isPending}\n            className=\"w-full\"\n          >\n            <Send className=\"h-4 w-4 mr-2\" />\n            {testNotificationMutation.isPending ? \"Sending...\" : \"Send Test Notification\"}\n          </Button>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Zap className=\"h-5 w-5\" />\n            Trigger Mass Notifications\n          </CardTitle>\n          <CardDescription>\n            Trigger notifications to all eligible users\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"trigger-type\">Trigger Type</Label>\n            <Select value={triggerType} onValueChange={setTriggerType}>\n              <SelectTrigger id=\"trigger-type\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"daily_streak_reminders\">Daily Streak Reminders</SelectItem>\n                <SelectItem value=\"new_creators_suggestions\">New Creators Suggestions</SelectItem>\n                <SelectItem value=\"new_coins\">New Coins Promotion</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <Button\n            onClick={() => triggerNotificationMutation.mutate()}\n            disabled={triggerNotificationMutation.isPending}\n            className=\"w-full\"\n            variant=\"secondary\"\n          >\n            <Zap className=\"h-4 w-4 mr-2\" />\n            {triggerNotificationMutation.isPending ? \"Triggering...\" : \"Trigger Notifications\"}\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":5979},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/app-layout.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { useEffect } from \"react\";\nimport {\n  Home,\n  TrendingUp,\n  Users,\n  MessageCircle,\n  Settings,\n  Search,\n  Flame,\n  ShoppingBag,\n  Sparkles,\n  User, // Added User icon\n  LogOut,\n  ChevronLeft,\n  ChevronRight,\n  Compass,\n  BookOpen,\n  HelpCircle,\n  Menu,\n  X,\n  PlusCircle,\n  MessageSquare,\n  Zap, // Imported Zap icon\n} from \"lucide-react\";\nimport { ThemeToggle } from \"./theme-toggle\";\nimport { NotificationBell } from \"./notification-bell\";\nimport { UserMenu } from \"./user-menu\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"./ui/avatar\";\nimport { socketClient } from \"@/lib/socket-client\";\nimport { useCallback } from \"react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarHeader,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarProvider,\n  SidebarTrigger,\n  useSidebar,\n  SidebarGroup,\n  SidebarGroupLabel,\n  SidebarGroupContent,\n} from \"./ui/sidebar\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"./ui/dropdown-menu\";\nimport { Button } from \"./ui/button\";\nimport { Separator } from \"./ui/separator\";\nimport { Sheet, SheetContent, SheetTrigger } from \"./ui/sheet\";\nimport { Badge } from \"./ui/badge\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\n\n// Custom SVG icon components\nconst CompassIcon = ({ className }: { className?: string }) => (\n  <svg\n    width=\"19\"\n    height=\"19\"\n    viewBox=\"0 0 19 19\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    className={className}\n  >\n    <path\n      d=\"M13.5825 0.396566L4.5525 3.39657C-1.5175 5.42657 -1.5175 8.73657 4.5525 10.7566L7.2325 11.6466L8.1225 14.3266C10.1425 20.3966 13.4625 20.3966 15.4825 14.3266L18.4925 5.30657C19.8325 1.25657 17.6325 -0.953434 13.5825 0.396566ZM13.9025 5.77657L10.1025 9.59657C9.9525 9.74657 9.7625 9.81657 9.5725 9.81657C9.3825 9.81657 9.1925 9.74657 9.0425 9.59657C8.7525 9.30657 8.7525 8.82657 9.0425 8.53657L12.8425 4.71657C13.1325 4.42657 13.6125 4.42657 13.9025 4.71657C14.1925 5.00657 14.1925 5.48657 13.9025 5.77657Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nconst UsersIcon = ({ className }: { className?: string }) => (\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    className={className}\n  >\n    <path\n      d=\"M9 2C6.38 2 4.25 4.13 4.25 6.75C4.25 9.32 6.26 11.4 8.88 11.49C8.96 11.48 9.04 11.48 9.1 11.49C9.12 11.49 9.13 11.49 9.15 11.49C9.16 11.49 9.16 11.49 9.17 11.49C11.73 11.4 13.74 9.32 13.75 6.75C13.75 4.13 11.62 2 9 2Z\"\n      fill=\"currentColor\"\n    />\n    <path\n      d=\"M14.08 14.15C11.29 12.29 6.73996 12.29 3.92996 14.15C2.65996 15 1.95996 16.15 1.95996 17.38C1.95996 18.61 2.65996 19.75 3.91996 20.59C5.31996 21.53 7.15996 22 8.99996 22C10.84 22 12.68 21.53 14.08 20.59C15.34 19.74 16.04 18.6 16.04 17.36C16.03 16.13 15.34 14.99 14.08 14.15Z\"\n      fill=\"currentColor\"\n    />\n    <path\n      d=\"M19.99 7.34C20.15 9.28 18.77 10.98 16.86 11.21C16.85 11.21 16.85 11.21 16.84 11.21H16.81C16.75 11.21 16.69 11.21 16.64 11.23C15.67 11.28 14.78 10.97 14.11 10.4C15.14 9.48 15.73 8.1 15.61 6.6C15.54 5.79 15.26 5.05 14.84 4.42C15.22 4.23 15.66 4.11 16.11 4.07C18.07 3.90 19.82 5.36 19.99 7.34Z\"\n      fill=\"currentColor\"\n    />\n    <path\n      d=\"M21.99 16.59C21.91 17.56 21.29 18.4 20.25 18.97C19.25 19.52 17.99 19.78 16.74 19.75C17.46 19.1 17.88 18.29 17.96 17.43C18.06 16.19 17.47 15 16.29 14.05C15.62 13.52 14.84 13.1 13.99 12.79C16.2 12.15 18.98 12.58 20.69 13.96C21.61 14.7 22.08 15.63 21.99 16.59Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nconst SearchIcon = ({ className }: { className?: string }) => (\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    className={className}\n  >\n    <path\n      d=\"M23.3183 20.0568L21.0303 17.7688C22.223 15.9675 22.9289 13.8012 22.9289 11.4645C22.9289 5.1359 17.793 0 11.4644 0C5.13588 0 0 5.1359 0 11.4645C0 17.7931 5.13588 22.929 11.4644 22.929C13.8011 22.929 15.9431 22.2231 17.7687 21.0304L20.0567 23.3185C20.5192 23.7809 21.1033 24 21.7119 24C22.3204 24 22.9045 23.7809 23.367 23.3185C24.2189 22.4422 24.2189 20.9817 23.3183 20.0568Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nconst CreateIcon = ({ className }: { className?: string }) => (\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    className={className}\n  >\n    <path\n      d=\"M16.19 2H7.81C4.17 2 2 4.17 2 7.81V16.18C2 19.83 4.17 22 7.81 22H16.18C19.82 22 21.99 19.83 21.99 16.19V7.81C22 4.17 19.83 2 16.19 2ZM16 12.75H12.75V16C12.75 16.41 12.41 16.75 12 16.75C11.59 16.75 11.25 16.41 11.25 16V12.75H8C7.59 12.75 7.25 12.41 7.25 12C7.25 11.59 7.59 11.25 8 11.25H11.25V8C11.25 7.59 11.59 7.25 12 7.25C12.41 7.25 12.75 7.59 12.75 8V11.25H16C16.41 11.25 16.75 11.59 16.75 12C16.75 12.41 16.41 12.75 16 12.75Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nconst MessageIcon = ({ className }: { className?: string }) => (\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    className={className}\n  >\n    <path\n      d=\"M19.5 8C20.8807 8 22 6.88071 22 5.5C22 4.11929 20.8807 3 19.5 3C18.1193 3 17 4.11929 17 5.5C17 6.88071 18.1193 8 19.5 8Z\"\n      fill=\"currentColor\"\n    />\n    <path\n      d=\"M20.72 9.31C20.02 9.53 19.25 9.57 18.45 9.37C17.11 9.02 16.02 7.95 15.65 6.61C15.47 5.96 15.46 5.32 15.57 4.74C15.7 4.1 15.25 3.5 14.61 3.5H7C4 3.5 2 5 2 8.5V15.5C2 19 4 20.5 7 20.5H17C20 20.5 22 19 22 15.5V10.26C22 9.6 21.36 9.1 20.72 9.31ZM15.52 11.15L14.34 12.09C13.68 12.62 12.84 12.88 12 12.88C11.16 12.88 10.31 12.62 9.66 12.09L6.53 9.59C6.21 9.33 6.16 8.85 6.41 8.53C6.67 8.21 7.14 8.15 7.46 8.41L10.59 10.91C11.35 11.52 12.64 11.52 13.4 10.91L14.58 9.97C14.9 9.71 15.38 9.76 15.63 10.09C15.89 10.41 15.84 10.89 15.52 11.15Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nconst FlameIcon = ({ className }: { className?: string }) => (\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    className={className}\n  >\n    <path\n      d=\"M12.62 2.21C12.46 2.07 12.24 2 12 2C11.76 2 11.54 2.07 11.38 2.21C11.14 2.42 6 6.9 6 12.5C6 16.64 9.36 20 13.5 20C14.06 20 14.61 19.94 15.13 19.82C14.42 19.28 13.76 18.64 13.18 17.91C12.79 18.01 12.38 18.06 11.96 18.05C9.2 18.05 6.96 15.81 6.96 13.05C6.96 9.43 10.16 6.23 12 4.39C13.84 6.23 17.04 9.43 17.04 13.05C17.04 13.55 16.97 14.03 16.85 14.5C17.63 15.17 18.5 15.71 19.43 16.1C19.8 15.3 20 14.41 20 13.5C20 6.9 14.86 2.42 12.62 2.21Z\"\n      fill=\"currentColor\"\n    />\n    <path\n      d=\"M17.5 22C19.9853 22 22 19.9853 22 17.5C22 15.0147 19.9853 13 17.5 13C15.0147 13 13 15.0147 13 17.5C13 19.9853 15.0147 22 17.5 22Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nconst DocsIcon = ({ className }: { className?: string }) => (\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    className={className}\n  >\n    <path\n      d=\"M21 7V17C21 20 19.5 22 16 22H8C4.5 22 3 20 3 17V7C3 4 4.5 2 8 2H16C19.5 2 21 4 21 7Z\"\n      fill=\"currentColor\"\n    />\n    <path\n      d=\"M14.5 4.5V6.5C14.5 7.6 15.4 8.5 16.5 8.5H18.5\"\n      fill=\"currentColor\"\n    />\n    <path\n      d=\"M8 13H12\"\n      stroke=\"white\"\n      strokeWidth=\"1.5\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n    <path\n      d=\"M8 17H16\"\n      stroke=\"white\"\n      strokeWidth=\"1.5\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    />\n  </svg>\n);\n\nconst FAQIcon = ({ className }: { className?: string }) => (\n  <svg\n    width=\"24\"\n    height=\"24\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    className={className}\n  >\n    <path\n      d=\"M12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM11.25 8C11.25 7.59 11.59 7.25 12 7.25C12.96 7.25 13.75 8.04 13.75 9C13.75 9.64 13.42 10.22 12.89 10.54C12.48 10.79 12.25 11.24 12.25 11.71V12C12.25 12.41 11.91 12.75 11.5 12.75C11.09 12.75 10.75 12.41 10.75 12V11.71C10.75 10.71 11.29 9.79 12.17 9.29C12.41 9.15 12.25 9.08 12.25 9C12.25 8.86 12.14 8.75 12 8.75C11.59 8.75 11.25 8.41 11.25 8ZM12.92 16.38C12.87 16.51 12.8 16.61 12.71 16.71C12.61 16.8 12.51 16.87 12.38 16.92C12.26 16.97 12.13 17 12 17C11.87 17 11.74 16.97 11.62 16.92C11.49 16.87 11.39 16.8 11.29 16.71C11.2 16.61 11.13 16.51 11.08 16.38C11.03 16.26 11 16.13 11 16C11 15.87 11.03 15.74 11.08 15.62C11.13 15.49 11.2 15.39 11.29 15.29C11.39 15.2 11.49 15.13 11.62 15.08C11.86 14.98 12.14 14.98 12.38 15.08C12.51 15.13 12.61 15.2 12.71 15.29C12.8 15.39 12.87 15.49 12.92 15.62C12.97 15.74 13 15.87 13 16C13 16.13 12.97 16.26 12.92 16.38Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nconst publicNavigationItems = [\n  {\n    icon: CompassIcon,\n    label: \"Explore\",\n    path: \"/\",\n  },\n  {\n    icon: UsersIcon,\n    label: \"Creators\",\n    path: \"/creators\",\n  },\n  {\n    icon: SearchIcon,\n    label: \"Search\",\n    path: \"/search\",\n  },\n  {\n    icon: CreateIcon,\n    label: \"Create\",\n    path: \"/create\",\n  },\n];\n\nconst authenticatedNavigationItems = [\n  {\n    icon: CompassIcon,\n    label: \"Explore\",\n    path: \"/\",\n  },\n  {\n    icon: UsersIcon,\n    label: \"Creators\",\n    path: \"/creators\",\n  },\n  {\n    icon: SearchIcon,\n    label: \"Search\",\n    path: \"/search\",\n  },\n  {\n    icon: MessageIcon,\n    label: \"Inbox\",\n    path: \"/inbox\",\n    showBadge: true, // Enable badge for inbox\n  },\n  {\n    icon: FlameIcon,\n    label: \"Streaks\",\n    path: \"/streaks\",\n  },\n  {\n    icon: CreateIcon,\n    label: \"Create\",\n    path: \"/create\",\n  },\n  {\n    icon: User, // Added Profile icon\n    label: \"Profile\",\n    path: \"/profile\",\n  },\n];\n\nexport function AppLayout({ children }: { children: React.ReactNode }) {\n  const [location, setLocation] = useLocation(); // Added setLocation\n  const { authenticated, user, logout, login, getAccessToken } = usePrivy();\n  const isAdminRoute = location.startsWith(\"/admin\");\n  const navigationItems = authenticated\n    ? authenticatedNavigationItems\n    : publicNavigationItems;\n  const isMobile = useIsMobile();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const [unreadMessageCount, setUnreadMessageCount] = useState(0);\n\n  // Fetch coins count\n  const { data: coinsData } = useQuery({\n    queryKey: [\"/api/zora/coins/top-volume\"],\n  });\n\n  // Fetch creators count\n  const { data: creatorsData } = useQuery({\n    queryKey: [\"/api/creators\"],\n  });\n\n  // Fetch creator profile for mobile footer avatar\n  const privyId = user?.id;\n  const { data: creatorData } = useQuery({\n    queryKey: ['/api/creators/privy', privyId],\n    enabled: !!privyId && authenticated,\n  });\n\n  const coinsCount = (coinsData as any)?.coins?.length || 0;\n  const creatorsCount = (creatorsData as any)?.length || 0;\n\n  // Fetch unread message count\n  const fetchUnreadMessages = useCallback(async () => {\n    if (!authenticated || !user) {\n      setUnreadMessageCount(0);\n      return;\n    }\n\n    try {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {};\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(\"/api/messages/unread-count\", {\n        credentials: \"include\",\n        headers,\n        cache: 'no-store'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        console.log('[AppLayout] Unread message count:', data.count);\n        setUnreadMessageCount(data.count || 0);\n      }\n    } catch (error) {\n      console.error(\"[AppLayout] Failed to fetch unread message count:\", error);\n    }\n  }, [authenticated, user, getAccessToken]);\n\n  // Socket.IO integration for real-time unread message count\n  useEffect(() => {\n    if (!authenticated || !user) {\n      setUnreadMessageCount(0);\n      return;\n    }\n\n    // Fetch initial unread count\n    fetchUnreadMessages();\n\n    // Connect to Socket.IO\n    const userId = user.wallet?.address || user.id;\n    socketClient.connect(userId);\n\n    // Listen for new messages to refresh count\n    const handleNewMessage = () => {\n      fetchUnreadMessages();\n    };\n\n    // Listen for conversation updates to refresh count\n    const handleConversationUpdated = () => {\n      fetchUnreadMessages();\n    };\n\n    socketClient.on('new_message', handleNewMessage);\n    socketClient.on('conversation_updated', handleConversationUpdated);\n\n    // Refresh count periodically\n    const interval = setInterval(fetchUnreadMessages, 30000); // Every 30 seconds\n\n    return () => {\n      socketClient.off('new_message', handleNewMessage);\n      socketClient.off('conversation_updated', handleConversationUpdated);\n      clearInterval(interval);\n    };\n  }, [authenticated, user, fetchUnreadMessages]);\n\n  const handleLogin = () => {\n    try {\n      login();\n    } catch (error) {\n      console.error(\"Login error:\", error);\n    }\n  };\n\n  // Get badge count for menu items\n  const getMenuBadgeCount = (path: string) => {\n    if (path === \"/\") return coinsCount;\n    if (path === \"/creators\") return creatorsCount;\n    if (path === \"/inbox\") return unreadMessageCount;\n    return null;\n  };\n\n  return (\n    <SidebarProvider defaultOpen={true}>\n      <div className=\"flex min-h-screen w-full bg-background pb-16 md:pb-0\">\n        {/* Sidebar - Hidden on mobile */}\n        {!isAdminRoute && (\n          <Sidebar\n            collapsible=\"icon\"\n            className=\"border-r border-transparent hidden md:flex\"\n          >\n            <SidebarHeader className=\"border-b border-border p-4\">\n              <Link href=\"/\" className=\"flex items-center gap-3\">\n                <img \n                  src=\"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\" \n                  alt=\"E1\" \n                  className=\"h-8 w-auto group-data-[collapsible=icon]:h-6\"\n                />\n              </Link>\n            </SidebarHeader>\n\n            <SidebarContent className=\"p-2\">\n              {/* General Section */}\n              <div className=\"mb-6\">\n                <SidebarGroup>\n                  <SidebarGroupLabel>General</SidebarGroupLabel>\n                  <SidebarGroupContent>\n                    <SidebarMenu>\n                      {navigationItems.map((item) => {\n                        const isActive = location === item.path;\n                        const badgeCount = getMenuBadgeCount(item.path);\n                        return (\n                          <SidebarMenuItem key={item.path}>\n                            <SidebarMenuButton\n                              asChild\n                              isActive={isActive}\n                              tooltip={item.label}\n                              className=\"h-10 relative\"\n                            >\n                              <Link href={item.path}>\n                                <item.icon className=\"h-4 w-4 shrink-0\" />\n                                <span className=\"group-data-[collapsible=icon]:hidden\">\n                                  {item.label}\n                                </span>\n                                {badgeCount && badgeCount > 0 && (\n                                  <>\n                                    {/* Badge when sidebar is expanded */}\n                                    <span className=\"absolute right-2 top-1/2 -translate-y-1/2 bg-destructive text-destructive-foreground rounded-full h-5 min-w-5 px-1.5 flex items-center justify-center text-[10px] font-bold group-data-[collapsible=icon]:hidden\">\n                                      {badgeCount > 99 ? \"99+\" : badgeCount}\n                                    </span>\n                                    {/* Badge when sidebar is collapsed (icon mode) */}\n                                    <span className=\"hidden group-data-[collapsible=icon]:flex absolute top-0 right-0 bg-destructive text-destructive-foreground rounded-full h-3 min-w-3 px-0.5 items-center justify-center text-[8px] font-bold leading-none z-10\">\n                                      {badgeCount > 9 ? \"9+\" : badgeCount}\n                                    </span>\n                                  </>\n                                )}\n                              </Link>\n                            </SidebarMenuButton>\n                          </SidebarMenuItem>\n                        );\n                      })}\n                    </SidebarMenu>\n                  </SidebarGroupContent>\n                </SidebarGroup>\n              </div>\n\n              {/* Profile Section - Only for authenticated users */}\n              {authenticated && (\n                <div className=\"mb-6\">\n                  <SidebarGroup>\n                    <SidebarGroupLabel>Profile</SidebarGroupLabel>\n                    <SidebarGroupContent>\n                      <SidebarMenu>\n                        <SidebarMenuItem>\n                          <SidebarMenuButton\n                            asChild\n                            isActive={location === \"/points\"}\n                            tooltip=\"E1XP Points\"\n                            className=\"h-10\"\n                          >\n                            <Link href=\"/points\" data-testid=\"link-points\">\n                              <Zap className=\"h-4 w-4 shrink-0\" />\n                              <span className=\"group-data-[collapsible=icon]:hidden\">\n                                E1XP Points\n                              </span>\n                            </Link>\n                          </SidebarMenuButton>\n                        </SidebarMenuItem>\n                        <SidebarMenuItem>\n                          <SidebarMenuButton\n                            asChild\n                            isActive={location === \"/referrals\"}\n                            tooltip=\"Referrals\"\n                            className=\"h-10\"\n                          >\n                            <Link href=\"/referrals\" data-testid=\"link-referrals\">\n                              <Users className=\"h-4 w-4 shrink-0\" />\n                              <span className=\"group-data-[collapsible=icon]:hidden\">\n                                Referrals\n                              </span>\n                            </Link>\n                          </SidebarMenuButton>\n                        </SidebarMenuItem>\n                      </SidebarMenu>\n                    </SidebarGroupContent>\n                  </SidebarGroup>\n                </div>\n              )}\n\n              {/* Resources Section */}\n              <SidebarGroup>\n                <SidebarGroupLabel>Resources</SidebarGroupLabel>\n                <SidebarGroupContent>\n                  <SidebarMenu>\n                    <SidebarMenuItem>\n                      <SidebarMenuButton asChild tooltip=\"FAQ\" className=\"h-10\">\n                        <Link href=\"/faq\">\n                          <FAQIcon className=\"h-4 w-4 shrink-0\" />\n                          <span className=\"group-data-[collapsible=icon]:hidden\">\n                            FAQ\n                          </span>\n                        </Link>\n                      </SidebarMenuButton>\n                    </SidebarMenuItem>\n                    <SidebarMenuItem>\n                      <SidebarMenuButton\n                        asChild\n                        tooltip=\"Docs\"\n                        className=\"h-10\"\n                      >\n                        <Link href=\"/docs\">\n                          <DocsIcon className=\"h-4 w-4 shrink-0\" />\n                          <span className=\"group-data-[collapsible=icon]:hidden\">\n                            Docs\n                          </span>\n                        </Link>\n                      </SidebarMenuButton>\n                    </SidebarMenuItem>\n                  </SidebarMenu>\n                </SidebarGroupContent>\n              </SidebarGroup>\n            </SidebarContent>\n\n            <SidebarFooter className=\"border-t border-border p-2\">\n              <div className=\"flex items-center gap-2 px-2 group-data-[collapsible=icon]:justify-center\">\n                <ThemeToggle />\n              </div>\n            </SidebarFooter>\n          </Sidebar>\n        )}\n\n        {/* Main Content Area */}\n        <SidebarInset className=\"flex flex-col w-full\">\n          {/* Top Navigation - Desktop (hidden on admin routes) */}\n          {!isAdminRoute && (\n            <header className=\"sticky top-0 z-50 border-b border-transparent bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/80\">\n              <div className=\"flex h-16 items-center justify-between px-4 w-full gap-4\">\n                {/* Desktop Sidebar Trigger - Positioned at left edge */}\n                <div className=\"hidden md:flex\">\n                  <SidebarTrigger />\n                </div>\n\n                {/* Mobile Logo */}\n                <Link href=\"/\" className=\"flex md:hidden items-center gap-2\">\n                  <div className=\"flex h-8 w-8 items-center justify-center rounded-lg bg-primary text-primary-foreground\">\n                    <Sparkles className=\"h-4 w-4\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <h1 className=\"text-sm font-bold tracking-tight\">\n                      creat8<span className=\"text-primary\">*</span>\n                    </h1>\n                  </div>\n                </Link>\n\n                {/* Search Bar and Stats - Grouped Together and Centered */}\n                <div className=\"hidden lg:flex items-center gap-1 flex-1 justify-center max-w-5xl mx-auto\">\n                  {/* Search Bar */}\n                  <div className=\"flex-1 max-w-md\" data-testid=\"header-search\">\n                    <div className=\"relative\">\n                      <SearchIcon className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 opacity-50\" />\n                      <Link href=\"/search\">\n                        <input\n                          type=\"text\"\n                          placeholder=\"Search creators, coins...\"\n                          className=\"w-full h-9 pl-9 pr-4 rounded-lg border border-input bg-background text-sm focus:outline-none focus:ring-1 focus:ring-ring\"\n                          readOnly\n                        />\n                      </Link>\n                    </div>\n                  </div>\n\n                  {/* Stats Buttons */}\n                  <Button variant=\"outline\" size=\"sm\" className=\"h-9\">\n                    <TrendingUp className=\"h-4 w-4 mr-1.5 text-green-500\" />\n                    <span className=\"text-xs font-semibold\">MC: $2.5M</span>\n                  </Button>\n                  <Button variant=\"outline\" size=\"sm\" className=\"h-9\">\n                    <Sparkles className=\"h-4 w-4 mr-1.5 text-primary\" />\n                    <span className=\"text-xs font-semibold\">Coins: 1,2k</span>\n                  </Button>\n                </div>\n\n                {/* Right Section */}\n                <div className=\"flex items-center gap-3\">\n                  <ThemeToggle />\n                  <NotificationBell />\n                  {authenticated ? (\n                    <>\n                      <Link href=\"/create\">\n                        <Button\n                          variant=\"default\"\n                          size=\"sm\"\n                          className=\"hidden md:flex bg-gradient-to-r from-purple-400 via-pink-400 to-blue-300 hover:from-purple-500 hover:via-pink-500 hover:to-blue-400 text-black font-semibold border-0 transition-all\"\n                          data-testid=\"link-create\"\n                        >\n                          <PlusCircle className=\"mr-2 h-4 w-4\" />\n                          Create\n                        </Button>\n                      </Link>\n                      <UserMenu />\n                    </>\n                  ) : (\n                    <>\n                      <Button\n                        onClick={handleLogin}\n                        variant=\"default\"\n                        size=\"sm\"\n                        className=\"hidden md:flex bg-gradient-to-r from-purple-400 via-pink-400 to-blue-300 text-black font-semibold rounded-lg border-0 hover:opacity-90\"\n                        data-testid=\"button-login\"\n                      >\n                        Signin\n                      </Button>\n                    </>\n                  )}\n                </div>\n              </div>\n            </header>\n          )}\n\n          {/* Mobile Header */}\n          <div className=\"md:hidden fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-sm border-b border-transparent\">\n            <div className=\"flex items-center justify-between h-14 px-4\">\n              <Link href=\"/\">\n                <img src=\"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\" alt=\"E1\" className=\"h-8 w-auto\" />\n              </Link>\n              <div className=\"flex items-center gap-2\">\n                {authenticated ? (\n                  <>\n                    <Link href=\"/inbox\">\n                      <Button variant=\"ghost\" size=\"icon\" className=\"relative\">\n                        <MessageIcon className=\"h-5 w-5\" />\n                        {unreadMessageCount > 0 && (\n                          <span className=\"absolute -top-0.5 -right-0.5 bg-destructive text-destructive-foreground rounded-full h-4 min-w-4 px-1 flex items-center justify-center text-[10px] font-bold\">\n                            {unreadMessageCount > 9 ? \"9+\" : unreadMessageCount}\n                          </span>\n                        )}\n                      </Button>\n                    </Link>\n                    <NotificationBell />\n                    <ThemeToggle />\n                    <UserMenu />\n                  </>\n                ) : (\n                  <>\n                    <ThemeToggle />\n                    <Button\n                      onClick={handleLogin}\n                      variant=\"default\"\n                      size=\"sm\"\n                      className=\"bg-gradient-to-r from-purple-200 via-pink-400 to-blue-300 text-black font-semibold border-0 rounded-lg hover:opacity-90\"\n                      data-testid=\"button-mobile-login\"\n                    >\n                      Signin\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Page Content */}\n          <main className=\"flex-1 overflow-auto\">{children}</main>\n        </SidebarInset>\n\n        {/* Mobile Bottom Navigation - Compact design */}\n        {!isAdminRoute && (\n          <div className=\"fixed bottom-0 left-0 right-0 z-50 md:hidden\">\n            <div className=\"bg-card/95 backdrop-blur-xl border-t border-transparent\">\n              <div className=\"flex items-center justify-around h-16 px-1\">\n                <Link href=\"/\">\n                  <div\n                    className={`flex flex-col items-center gap-1 px-2 py-2 rounded-lg transition-all relative ${\n                      location === \"/\"\n                        ? \"text-primary\"\n                        : \"text-muted-foreground active:opacity-70\"\n                    }`}\n                  >\n                    <div className=\"relative\">\n                      <CompassIcon className=\"h-5 w-5\" />\n                      {coinsCount > 0 && (\n                        <div className=\"absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full h-4 min-w-4 px-1 flex items-center justify-center text-[8px] font-bold\">\n                          {coinsCount > 99 ? \"99+\" : coinsCount}\n                        </div>\n                      )}\n                    </div>\n                    <span className=\"text-[10px] font-medium\">Explore</span>\n                  </div>\n                </Link>\n\n                <Link href=\"/search\">\n                  <div\n                    className={`flex flex-col items-center gap-1 px-2 py-2 rounded-lg transition-all ${\n                      location === \"/search\"\n                        ? \"text-primary\"\n                        : \"text-muted-foreground active:opacity-70\"\n                    }`}\n                  >\n                    <SearchIcon className=\"h-5 w-5\" />\n                    <span className=\"text-[10px] font-medium\">Search</span>\n                  </div>\n                </Link>\n\n                <Link href=\"/create\" data-testid=\"link-create-mobile\">\n                  <div\n                    className={`flex flex-col items-center gap-1 px-2 py-2 rounded-lg transition-all ${\n                      location === \"/create\"\n                        ? \"text-primary\"\n                        : \"text-muted-foreground active:opacity-70\"\n                    }`}\n                  >\n                    <CreateIcon className=\"h-5 w-5\" />\n                    <span className=\"text-[10px] font-medium\">Create</span>\n                  </div>\n                </Link>\n\n                <Link href=\"/creators\">\n                  <div\n                    className={`flex flex-col items-center gap-1 px-2 py-2 rounded-lg transition-all relative ${\n                      location === \"/creators\"\n                        ? \"text-primary\"\n                        : \"text-muted-foreground active:opacity-70\"\n                    }`}\n                  >\n                    <div className=\"relative\">\n                      <UsersIcon className=\"h-5 w-5\" />\n                      {creatorsCount > 0 && (\n                        <div className=\"absolute -top-1 -right-1 bg-red-500 text-white rounded-full h-4 min-w-4 px-1 flex items-center justify-center text-[8px] font-bold\">\n                          {creatorsCount > 99 ? \"99+\" : creatorsCount}\n                        </div>\n                      )}\n                    </div>\n                    <span className=\"text-[10px] font-medium\">Creators</span>\n                  </div>\n                </Link>\n\n                <Link href=\"/profile\">\n                  <div\n                    className={`flex flex-col items-center gap-1 px-2 py-2 rounded-lg transition-all ${\n                      location === \"/profile\"\n                        ? \"text-primary\"\n                        : \"text-muted-foreground active:opacity-70\"\n                    }`}\n                  >\n                    {authenticated && (creatorData as any)?.avatar ? (\n                      <Avatar className=\"h-5 w-5\">\n                        <AvatarImage src={(creatorData as any).avatar} alt=\"Profile\" />\n                        <AvatarFallback className=\"bg-gradient-to-br from-purple-400 to-pink-400\">\n                          <User className=\"h-3 w-3 text-white\" />\n                        </AvatarFallback>\n                      </Avatar>\n                    ) : (\n                      <img \n                        src=\"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\" \n                        alt=\"Profile\" \n                        className=\"h-5 w-5 rounded-full object-cover\"\n                      />\n                    )}\n                    <span className=\"text-[10px] font-medium\">Profile</span>\n                  </div>\n                </Link>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </SidebarProvider>\n  );\n}","size_bytes":31338},"client/src/pages/search.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { CreatorCard } from \"@/components/creator-card\";\nimport { CoinCard } from \"@/components/coin-card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Search as SearchIcon, Filter, X, TrendingUp, Sparkles } from \"lucide-react\";\nimport type { User } from \"@shared/schema\";\n\nexport default function Search() {\n  const [location] = useLocation();\n  const urlParams = new URLSearchParams(window.location.search);\n  const [searchQuery, setSearchQuery] = useState(urlParams.get('q') || \"\");\n\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const query = params.get('q');\n    if (query) {\n      setSearchQuery(query);\n    }\n  }, [location]);\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"all\");\n  const [selectedLocation, setSelectedLocation] = useState<string>(\"all\");\n  const [sortBy, setSortBy] = useState<string>(\"connections\");\n\n  const { data: creators, isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/creators\", { search: searchQuery, category: selectedCategory, location: selectedLocation, sortBy }],\n  });\n\n  // Fetch suggested coins when there's no search query\n  const showSuggestions = !searchQuery && selectedCategory === \"all\" && selectedLocation === \"all\" && sortBy === \"connections\";\n  \n  const { data: topGainersData } = useQuery<{ coins: any[] }>({\n    queryKey: [\"/api/zora/coins/top-gainers?count=6\"],\n  });\n\n  const { data: newCoinsData } = useQuery<{ coins: any[] }>({\n    queryKey: [\"/api/zora/coins/new?count=6\"],\n  });\n\n  const categories = [\n    \"All Categories\",\n    \"Music\",\n    \"Art\",\n    \"Gaming\",\n    \"Tech\",\n    \"Fashion\",\n    \"Fitness\",\n    \"Education\",\n    \"Entertainment\",\n  ];\n\n  const handleClearFilters = () => {\n    setSelectedCategory(\"all\");\n    setSelectedLocation(\"all\");\n    setSortBy(\"connections\");\n    setSearchQuery(\"\");\n  };\n\n  return (\n    <div className=\"container max-w-5xl mx-auto px-3 md:px-4 py-3 md:py-8 space-y-3 md:space-y-8\">\n      {/* Search Bar */}\n      <div className=\"relative\">\n        <SearchIcon className=\"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 md:h-5 md:w-5 text-muted-foreground\" />\n        <Input\n          type=\"search\"\n          placeholder=\"Search creators, categories, locations...\"\n          value={searchQuery}\n          onChange={(e) => setSearchQuery(e.target.value)}\n          className=\"pl-8 md:pl-10 h-9 md:h-12 text-sm md:text-base\"\n          data-testid=\"input-search\"\n        />\n      </div>\n\n      {/* Filters */}\n      <div className=\"flex flex-col md:flex-row gap-2 md:gap-4 items-start md:items-center justify-between\">\n        <div className=\"flex flex-wrap gap-1.5 md:gap-3 flex-1\">\n          <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n            <SelectTrigger className=\"w-[110px] md:w-[180px] h-8 md:h-9 text-xs md:text-sm\" data-testid=\"select-category\">\n              <SelectValue placeholder=\"Category\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Categories</SelectItem>\n              <SelectItem value=\"music\">Music</SelectItem>\n              <SelectItem value=\"art\">Art</SelectItem>\n              <SelectItem value=\"gaming\">Gaming</SelectItem>\n              <SelectItem value=\"tech\">Tech</SelectItem>\n              <SelectItem value=\"fashion\">Fashion</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Select value={selectedLocation} onValueChange={setSelectedLocation}>\n            <SelectTrigger className=\"w-[110px] md:w-[180px] h-8 md:h-9 text-xs md:text-sm\" data-testid=\"select-location\">\n              <SelectValue placeholder=\"Location\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Locations</SelectItem>\n              <SelectItem value=\"us\">United States</SelectItem>\n              <SelectItem value=\"uk\">United Kingdom</SelectItem>\n              <SelectItem value=\"global\">Global</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Select value={sortBy} onValueChange={setSortBy}>\n            <SelectTrigger className=\"w-[110px] md:w-[180px] h-8 md:h-9 text-xs md:text-sm\" data-testid=\"select-sort\">\n              <SelectValue placeholder=\"Sort by\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"connections\">Most Connections</SelectItem>\n              <SelectItem value=\"views\">Most Views</SelectItem>\n              <SelectItem value=\"earnings\">Top Earnings</SelectItem>\n              <SelectItem value=\"recent\">Recently Joined</SelectItem>\n            </SelectContent>\n          </Select>\n\n          {(selectedCategory !== \"all\" || selectedLocation !== \"all\" || sortBy !== \"connections\") && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleClearFilters}\n              className=\"h-8 md:h-9 text-xs md:text-sm px-2 md:px-4\"\n              data-testid=\"button-clear-filters\"\n            >\n              <X className=\"h-3 w-3 md:h-4 md:w-4 mr-1\" />\n              Clear\n            </Button>\n          )}\n        </div>\n\n        <Badge variant=\"secondary\" className=\"text-xs md:text-sm px-2 py-0.5\">\n          {creators?.length || 0} found\n        </Badge>\n      </div>\n\n      {/* Trending Categories */}\n      <div className=\"space-y-1.5 md:space-y-3\">\n        <h3 className=\"text-xs md:text-sm font-medium text-muted-foreground\">Trending</h3>\n        <div className=\"flex flex-wrap gap-1.5 md:gap-2\">\n          {categories.slice(1, 6).map((category) => (\n            <Badge\n              key={category}\n              variant=\"outline\"\n              className=\"cursor-pointer hover-elevate transition-all text-xs py-0.5 px-2\"\n              onClick={() => setSelectedCategory(category.toLowerCase())}\n              data-testid={`badge-trending-${category.toLowerCase()}`}\n            >\n              {category}\n            </Badge>\n          ))}\n        </div>\n      </div>\n\n      {/* Coin Suggestions - Only show when no search/filters active */}\n      {showSuggestions && (\n        <div className=\"space-y-3 md:space-y-4\">\n          {/* Top Gainers */}\n          {topGainersData?.coins && topGainersData.coins.length > 0 && (\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-1.5\">\n                <TrendingUp className=\"h-3.5 w-3.5 md:h-4 md:w-4 text-green-500\" />\n                <h3 className=\"text-xs md:text-sm font-semibold\">Top Gainers</h3>\n              </div>\n              <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 md:gap-3\">\n                {topGainersData.coins.map((coin: any) => (\n                  <CoinCard\n                    key={coin.id || coin.address}\n                    coin={{\n                      id: coin.id || coin.address,\n                      name: coin.name || \"Unnamed Coin\",\n                      symbol: coin.symbol || \"???\",\n                      address: coin.address,\n                      image: coin.mediaContent?.previewImage?.medium || coin.mediaContent?.previewImage?.small,\n                      marketCap: coin.marketCap ? (Math.ceil(parseFloat(coin.marketCap) * 100) / 100).toFixed(2) : \"0\",\n                      volume24h: coin.volume24h ? (Math.ceil(parseFloat(coin.volume24h) * 100) / 100).toFixed(2) : \"0\",\n                      holders: coin.uniqueHolders || 0,\n                      creator: coin.creatorAddress,\n                      createdAt: coin.createdAt,\n                      category: \"zora\",\n                      platform: \"zora\",\n                    }}\n                    onClick={() => window.location.href = `/coin/${coin.address}`}\n                    data-testid={`coin-card-top-gainer-${coin.address}`}\n                  />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Recently Added */}\n          {newCoinsData?.coins && newCoinsData.coins.length > 0 && (\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-1.5\">\n                <Sparkles className=\"h-3.5 w-3.5 md:h-4 md:w-4 text-purple-500\" />\n                <h3 className=\"text-xs md:text-sm font-semibold\">Recently Added</h3>\n              </div>\n              <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 md:gap-3\">\n                {newCoinsData.coins.map((coin: any) => (\n                  <CoinCard\n                    key={coin.id || coin.address}\n                    coin={{\n                      id: coin.id || coin.address,\n                      name: coin.name || \"Unnamed Coin\",\n                      symbol: coin.symbol || \"???\",\n                      address: coin.address,\n                      image: coin.mediaContent?.previewImage?.medium || coin.mediaContent?.previewImage?.small,\n                      marketCap: coin.marketCap ? (Math.ceil(parseFloat(coin.marketCap) * 100) / 100).toFixed(2) : \"0\",\n                      volume24h: coin.volume24h ? (Math.ceil(parseFloat(coin.volume24h) * 100) / 100).toFixed(2) : \"0\",\n                      holders: coin.uniqueHolders || 0,\n                      creator: coin.creatorAddress,\n                      createdAt: coin.createdAt,\n                      category: \"zora\",\n                      platform: \"zora\",\n                    }}\n                    onClick={() => window.location.href = `/coin/${coin.address}`}\n                    data-testid={`coin-card-new-${coin.address}`}\n                  />\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Results Grid */}\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-6\">\n          {[...Array(12)].map((_, i) => (\n            <div\n              key={i}\n              className=\"h-80 bg-card rounded-2xl animate-pulse\"\n              data-testid=\"skeleton-creator-card\"\n            />\n          ))}\n        </div>\n      ) : creators && creators.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-6\">\n          {creators.map((creator) => (\n            <CreatorCard key={creator.id} creator={creator} />\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-16\">\n          <Filter className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n          <h3 className=\"text-lg font-semibold mb-2\">No creators found</h3>\n          <p className=\"text-muted-foreground\">\n            Try adjusting your filters or search query\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":10966},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\n// Use the Supabase-backed storage implementation which includes notifications, push subscriptions, and moderation\nimport { storage } from \"./supabase-storage\";\nimport { createAdminRouter } from \"./routes/admin\";\nimport registryRouter from \"./routes/registry\";\nimport { registerAdminRegistryRoutes } from \"./routes/admin-registry\";\nimport { serveStatic } from \"./vite\";\nimport {\n  insertScrapedContentSchema,\n  insertCoinSchema,\n  updateCoinSchema,\n  insertCommentSchema,\n  insertNotificationSchema,\n  insertFollowSchema,\n  insertReferralSchema,\n  users,\n  referrals,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and } from \"drizzle-orm\";\nimport { awardPoints as rewardPoints, POINTS_REWARDS } from \"./points\";\nimport axios from \"axios\";\nimport { detectPlatform } from \"./platform-detector\";\nimport { scrapeByPlatform } from \"./platform-scrapers\";\nimport { migrateOldData } from \"./migrate-old-data\";\nimport { sendTelegramNotification } from \"./telegram-bot\";\nimport { RegistryService } from \"./registry-service\";\nimport { ActivityTrackerService } from \"./activity-tracker-service\";\nimport { base } from \"viem/chains\";\nimport { handleFileUpload } from \"./upload-handler\"; // Import the upload handler\nimport { walletAuthMiddleware, type AuthenticatedRequest } from \"./privy-middleware\";\n\n// Placeholder functions for OG meta generation (implement these based on your needs)\nconst generateProfileOGMeta = (creator: any, baseUrl: string) => ({\n  title: `${creator.name || 'User'} on CoinIT`,\n  description: creator.bio || 'Check out this creator on CoinIT!',\n  image: creator.avatar || `${baseUrl}/default-avatar.png`,\n  url: `${baseUrl}/profile/${creator.address}`,\n});\n\nconst generateCoinOGMeta = (coin: any, baseUrl: string) => ({\n  title: `${coin.name} (${coin.symbol})`,\n  description: coin.description || `Discover ${coin.name} (${coin.symbol}) on CoinIT.`,\n  image: coin.image || `${baseUrl}/default-coin-image.png`,\n  url: `${baseUrl}/coins/${coin.address}`,\n});\n\nconst generateProjectOGMeta = (project: any, baseUrl: string) => ({\n  title: project.name,\n  description: project.description || `Learn more about ${project.name}.`,\n  image: project.image || `${baseUrl}/default-project-image.png`,\n  url: `${baseUrl}/projects/${project.id}`,\n});\n\nconst generateReferralOGMeta = (creator: any, baseUrl: string) => ({\n  title: `${creator.name || 'User'} invited you to CoinIT!`,\n  description: `Join CoinIT and start your crypto journey! Use referral code ${creator.referralCode}.`,\n  image: creator.avatar || `${baseUrl}/default-referral-banner.png`,\n  url: `${baseUrl}/?ref=${creator.referralCode}`,\n});\n\n// Helper function to award points to a user\nasync function awardPoints(\n  userId: string,\n  amount: number,\n  type: string,\n  title: string,\n  metadata?: Record<string, any>,\n): Promise<void> {\n  const creator = await storage.getCreatorByAddress(userId);\n  if (!creator) {\n    console.error(`[awardPoints] Creator not found for user: ${userId}`);\n    return;\n  }\n\n  // Update creator's points\n  const currentPoints = parseInt(creator.points || \"0\");\n  const newPoints = (currentPoints + amount).toString();\n  await storage.updateCreator(creator.id, { points: newPoints });\n\n  // Create an E1XP reward record\n  await storage.createE1xpReward({\n    userId: userId,\n    amount: amount.toString(),\n    type: type,\n    title: title,\n    message: title, // Using title as message for simplicity here\n    metadata: metadata || {},\n  });\n\n  // Create an in-app notification\n  await storage.createNotification({\n    userId: userId,\n    type: \"reward\",\n    title: title,\n    message: `You earned ${amount} E1XP!`,\n    amount: amount.toString(),\n    read: false,\n  });\n}\n\n// Helper function to get referral code from username/name\nasync function generateReferralCode(address: string): Promise<string> {\n  const creator = await storage.getCreatorByAddress(address);\n\n  if (creator?.name) {\n    // Use username/name as referral code\n    await storage.updateCreator(creator.id, {\n      referralCode: creator.name\n    });\n    return creator.name;\n  }\n\n  // Fallback to shortened address if no name\n  const code = address.slice(0, 8);\n  if (creator) {\n    await storage.updateCreator(creator.id, {\n      referralCode: code\n    });\n  }\n  return code;\n}\n\n// Helper function to sync or create a creator profile\nexport async function syncCreatorProfile(privyId: string, address: string | null, email: string | null) {\n  console.log('[syncCreatorProfile] Syncing creator:', { privyId, address, email });\n\n  // First, check if creator exists by privyId\n  let creator = await storage.getCreatorByPrivyId(privyId);\n\n  if (creator) {\n    console.log('[syncCreatorProfile] Found existing creator by privyId:', creator.id);\n    // Update existing creator with latest address if changed\n    const updates: any = {};\n    if (address && address !== creator.address) {\n      updates.address = address;\n    }\n    if (Object.keys(updates).length > 0) {\n      creator = await storage.updateCreator(creator.id, updates);\n      console.log('[syncCreatorProfile] Updated creator with new address');\n    }\n    return creator;\n  }\n\n  // If not found by privyId, check by address (legacy creators)\n  if (address) {\n    creator = await storage.getCreatorByAddress(address);\n    if (creator) {\n      console.log('[syncCreatorProfile] Found legacy creator by address, backfilling privyId');\n      // Backfill privyId for legacy creator\n      creator = await storage.updateCreator(creator.id, { privyId });\n      return creator;\n    }\n  }\n\n  // Generate a default username for email users\n  const { getDefaultUsername } = await import(\"./username-generator\");\n  const defaultUsername = getDefaultUsername(email, privyId);\n\n  console.log('[syncCreatorProfile] Creating new creator with username:', defaultUsername);\n\n  // Create new creator with privyId (address can be null for email users)\n  const creatorData = {\n    privyId,\n    address: address || null,\n    email: email || null,\n    name: defaultUsername,\n    bio: null,\n    avatar: null,\n    walletAddress: null,\n    verified: \"false\",\n    totalCoins: \"0\",\n    totalVolume: \"0\",\n    followers: \"0\",\n    referralCode: defaultUsername, // Use generated username as referral code\n    points: \"100\", // Welcome bonus\n  };\n\n  creator = await storage.createCreator(creatorData);\n  console.log('[syncCreatorProfile] Successfully created new creator:', creator.id, 'with email:', email);\n\n  // Also create user record for email users (for modern user tracking)\n  if (email && !address) {\n    try {\n      await storage.createUser({\n        privyId,\n        email,\n        username: defaultUsername,\n        displayName: defaultUsername,\n        e1xpPoints: 100,\n      });\n      console.log('[syncCreatorProfile] Created user record for email user:', email);\n    } catch (userError) {\n      console.warn('[syncCreatorProfile] Could not create user record:', userError);\n    }\n  }\n\n  // Send welcome notification and E1XP reward\n  try {\n    const userId = creator.address || creator.id;\n    const welcomePoints = 100;\n\n    // Create welcome notification\n    await storage.createNotification({\n      userId: userId,\n      type: 'reward',\n      title: 'üéÅ Welcome to Every1.fun!',\n      message: `You earned ${welcomePoints} E1XP as a welcome bonus! Come back daily to earn more points and build your streak! üî•`,\n      amount: welcomePoints.toString(),\n      read: false,\n    });\n\n    // Create E1XP reward record\n    await storage.createE1xpReward({\n      userId: userId,\n      amount: welcomePoints.toString(),\n      type: 'welcome',\n      title: 'üéâ Welcome Bonus!',\n      message: `Welcome to Every1.fun! You've earned ${welcomePoints} E1XP to get started!`,\n      metadata: { \n        isWelcomeBonus: true,\n        timestamp: new Date().toISOString()\n      },\n    });\n\n    // Send real-time notification via Socket.IO if user is connected\n    const { emitNotificationToUser } = await import('./socket-server');\n    emitNotificationToUser(userId, {\n      type: 'reward',\n      title: 'üéÅ Welcome to Every1.fun!',\n      message: `You earned ${welcomePoints} E1XP as a welcome bonus!`,\n      amount: welcomePoints.toString(),\n    });\n\n    // Send Telegram notification if address available\n    if (address) {\n      try {\n        await sendTelegramNotification(\n          address,\n          'üéÅ Welcome to Every1.fun!',\n          `Welcome! You've earned ${welcomePoints} E1XP points to get started. Come back daily to earn more points and build your streak! üî•`,\n          'reward'\n        );\n      } catch (telegramError) {\n        console.warn('[syncCreatorProfile] Failed to send Telegram welcome notification:', telegramError);\n      }\n    }\n\n    console.log(`[syncCreatorProfile] Sent welcome notification and ${welcomePoints} E1XP to new user ${userId}`);\n  } catch (notificationError) {\n    console.error('[syncCreatorProfile] Failed to send welcome notifications:', notificationError);\n    // Don't fail the whole request if notifications fail\n  }\n\n  return creator;\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // GeckoTerminal API endpoints\n  app.get(\n    \"/api/geckoterminal/pools/:network/:tokenAddress\",\n    async (req, res) => {\n      try {\n        const { network, tokenAddress } = req.params;\n        const page = parseInt((req.query.page as string) || \"1\");\n\n        const response = await axios.get(\n          `https://api.geckoterminal.com/api/v2/networks/${network}/tokens/${tokenAddress}/pools`,\n          { params: { page } },\n        );\n\n        res.json(response.data);\n      } catch (error) {\n        console.error(\"GeckoTerminal pool search error:\", error);\n        res\n          .status(500)\n          .json({ error: \"Failed to fetch pool data from GeckoTerminal\" });\n      }\n    },\n  );\n\n  app.get(\"/api/geckoterminal/pool/:network/:poolAddress\", async (req, res) => {\n    try {\n      const { network, poolAddress } = req.params;\n      const include = (req.query.include as string) || \"base_token,quote_token\";\n\n      const response = await axios.get(\n        `https://api.geckoterminal.com/api/v2/networks/${network}/pools/${poolAddress}`,\n        { params: { include } },\n      );\n\n      res.json(response.data);\n    } catch (error) {\n      console.error(\"GeckoTerminal pool data error:\", error);\n      res\n        .status(500)\n        .json({ error: \"Failed to fetch pool details from GeckoTerminal\" });\n    }\n  });\n\n  app.get(\n    \"/api/geckoterminal/ohlcv/:network/:poolAddress/:timeframe\",\n    async (req, res) => {\n      try {\n        const { network, poolAddress, timeframe } = req.params;\n        const {\n          aggregate = \"1\",\n          limit = \"100\",\n          currency = \"usd\",\n          token = \"base\",\n        } = req.query;\n\n        const response = await axios.get(\n          `https://api.geckoterminal.com/api/v2/networks/${network}/pools/${poolAddress}/ohlcv/${timeframe}`,\n          { params: { aggregate, limit, currency, token } },\n        );\n\n        res.json(response.data);\n      } catch (error) {\n        console.error(\"GeckoTerminal OHLCV data error:\", error);\n        res\n          .status(500)\n          .json({ error: \"Failed to fetch chart data from GeckoTerminal\" });\n      }\n    },\n  );\n\n  // File upload endpoint\n  app.post(\"/api/upload\", handleFileUpload);\n\n  // Create scraped content endpoint (for direct content creation)\n  app.post(\"/api/scraped-content\", async (req, res) => {\n    try {\n      const validatedData = insertScrapedContentSchema.parse(req.body);\n      const stored = await storage.createScrapedContent(validatedData);\n      res.json(stored);\n    } catch (error) {\n      console.error(\"Create scraped content error:\", error);\n      res.status(400).json({\n        error: \"Invalid scraped content data\",\n        details: error instanceof Error ? error.message : String(error),\n      });\n    }\n  });\n\n  // Scrape URL endpoint\n  app.post(\"/api/scrape\", async (req, res) => {\n    try {\n      const { url } = req.body;\n\n      if (!url) {\n        return res.status(400).json({ error: \"URL is required\" });\n      }\n\n      // Validate URL\n      try {\n        new URL(url);\n      } catch {\n        return res.status(400).json({ error: \"Invalid URL format\" });\n      }\n\n      // Detect platform\n      const platformInfo = detectPlatform(url);\n\n      // Scrape content using platform-specific logic\n      const scrapedData = await scrapeByPlatform(url, platformInfo.type);\n\n      // Validate and store\n      const validatedData = insertScrapedContentSchema.parse(scrapedData);\n      const stored = await storage.createScrapedContent(validatedData);\n\n      res.json(stored);\n    } catch (error) {\n      console.error(\"Scraping error:\", error);\n\n      if (axios.isAxiosError(error)) {\n        if (error.code === \"ECONNABORTED\") {\n          return res.status(408).json({\n            error: \"Request timeout - the page took too long to load\",\n          });\n        }\n        if (error.response?.status === 404) {\n          return res.status(404).json({\n            error: \"Page not found - please check the URL is correct\",\n          });\n        }\n        if (error.response?.status === 403) {\n          return res.status(403).json({\n            error: \"Access forbidden - this platform blocks automated access\",\n          });\n        }\n        if (error.response?.status === 429) {\n          return res.status(429).json({\n            error:\n              \"Rate limit exceeded - Instagram and TikTok often block scrapers. Try YouTube, Medium, or blog URLs instead.\",\n          });\n        }\n      }\n\n      res.status(500).json({\n        error:\n          \"Failed to scrape content - some platforms block automated access. Try a different URL or platform.\",\n      });\n    }\n  });\n\n  // Get all coins\n  app.get(\"/api/coins\", async (req, res) => {\n    try {\n      const coins = await storage.getAllCoins();\n\n      // Add platform detection to each coin based on available fields\n      const coinsWithPlatform = coins.map((coin) => {\n        let platform = \"all\";\n\n        // Check multiple sources for URL\n        const urls = [coin.image, coin.description, coin.name]\n          .filter(Boolean)\n          .join(\" \")\n          .toLowerCase();\n\n        if (urls.includes(\"youtube.com\") || urls.includes(\"youtu.be\")) {\n          platform = \"youtube\";\n        } else if (\n          urls.includes(\"warpcast.com\") ||\n          urls.includes(\"farcaster\")\n        ) {\n          platform = \"farcaster\";\n        } else if (urls.includes(\"gitcoin.co\")) {\n          platform = \"gitcoin\";\n        } else if (\n          urls.includes(\"spotify.com\") ||\n          urls.includes(\"open.spotify\")\n        ) {\n          platform = \"spotify\";\n        } else if (urls.includes(\"tiktok.com\")) {\n          platform = \"tiktok\";\n        } else if (urls.includes(\"instagram.com\")) {\n          platform = \"instagram\";\n        } else if (urls.includes(\"medium.com\")) {\n          platform = \"medium\";\n        } else if (urls.includes(\"giveth.io\")) {\n          platform = \"giveth\";\n        } else if (urls.includes(\"twitter.com\") || urls.includes(\"x.com\")) {\n          platform = \"twitter\";\n        } else if (\n          urls.includes(\"blog\") ||\n          urls.includes(\"wordpress\") ||\n          urls.includes(\"blogspot\")\n        ) {\n          platform = \"blog\";\n        }\n\n        return {\n          ...coin,\n          platform,\n        };\n      });\n\n      res.json(coinsWithPlatform);\n    } catch (error: any) {\n      console.error(\"Error fetching coins:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get pinned coins (ordered by pin_order)\n  app.get(\"/api/coins/pinned\", async (req, res) => {\n    try {\n      const pinnedCoins = await storage.getPinnedCoins();\n      res.json(pinnedCoins || []);\n    } catch (error: any) {\n      console.error(\"Error fetching pinned coins:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get coins by creator\n  app.get(\"/api/coins/creator/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const coins = await storage.getCoinsByCreator(address);\n      res.json(coins);\n    } catch (error) {\n      console.error(\"Get creator coins error:\", error);\n      res.status(500).json({ error: \"Failed to fetch creator coins\" });\n    }\n  });\n\n  // Create coin\n  app.post(\"/api/coins\", async (req, res) => {\n    try {\n      console.log(\"üì• Received coin data:\", JSON.stringify(req.body, null, 2));\n      const validatedData = insertCoinSchema.parse(req.body);\n      console.log(\"‚úÖ Validation passed:\", JSON.stringify(validatedData, null, 2));\n      const coin = await storage.createCoin(validatedData);\n\n      // Auto-create or update creator (only if creator address exists)\n      const creatorAddress = validatedData.creatorWallet;\n      if (!creatorAddress) {\n        return res.status(400).json({ error: \"Creator address is required\" });\n      }\n\n      let creator = await storage.getCreatorByAddress(creatorAddress);\n      if (!creator) {\n        // Create new creator with referral code (will be set when they set username)\n        creator = await storage.createCreator({\n          address: creatorAddress,\n          totalCoins: \"1\",\n          totalVolume: \"0\",\n          followers: \"0\",\n          referralCode: null,\n        });\n      } else {\n        // Update existing creator's coin count\n        const newTotalCoins = (parseInt(creator.totalCoins) + 1).toString();\n        await storage.updateCreator(creator.id, {\n          totalCoins: newTotalCoins,\n        });\n      }\n\n      // Create in-app notification for coin creation (optional - don't fail if this errors)\n      try {\n        await storage.createNotification({\n          userId: creatorAddress,\n          type: \"coin_created\",\n          title: \"ü™ô Coin Created Successfully!\",\n          message: `Your coin \"${coin.name}\" (${coin.symbol}) has been created${coin.address ? \" and is now live on the blockchain!\" : \"!\"}`,\n          coinAddress: coin.address,\n          coinSymbol: coin.symbol,\n          read: false,\n        });\n      } catch (error) {\n        console.warn(\"Failed to create notification:\", error);\n      }\n\n      // Notify creator about successful coin creation (optional)\n      try {\n        const { notificationService } = await import(\"./notification-service\");\n        await notificationService.notifyCoinCreated(creatorAddress, coin);\n      } catch (error) {\n        console.warn(\"Failed to send notification service:\", error);\n      }\n\n      // Award E1XP for coin creation (optional - don't fail if table doesn't exist)\n      try {\n        const e1xpAmount = 100; // Base reward for creating a coin\n        await storage.createE1xpReward({\n          userId: creatorAddress,\n          amount: e1xpAmount.toString(),\n          type: \"coin_creation\",\n          title: \"üéâ Coin Created!\",\n          message: `Congratulations! You earned ${e1xpAmount} E1XP for creating ${coin.name} (${coin.symbol})! üöÄ`,\n          metadata: {\n            coinId: coin.id,\n            coinAddress: coin.address,\n            coinSymbol: coin.symbol,\n            coinName: coin.name,\n          },\n        });\n\n        // Send notification about the claimable reward\n        await storage.createNotification({\n          userId: creatorAddress,\n          type: \"reward\",\n          title: \"üéÅ E1XP Reward Available!\",\n          message: `You have ${e1xpAmount} E1XP waiting to be claimed for creating ${coin.symbol}! Claim it now in the Points page.`,\n          amount: e1xpAmount.toString(),\n          coinAddress: coin.address,\n          coinSymbol: coin.symbol,\n          read: false,\n        });\n      } catch (error) {\n        console.warn(\"Failed to create E1XP reward (table may not exist):\", error);\n      }\n\n      // Record on-chain if coin has been deployed (has address)\n      if (coin.address && coin.status === \"active\") {\n        try {\n          const { activityTrackerService } = await import(\n            \"./activity-tracker.js\"\n          );\n          const txHash = await activityTrackerService.recordCoinCreation(\n            coin.address as `0x${string}`,\n            creatorAddress as `0x${string}`,\n            coin.image || \"\",\n            coin.name,\n            coin.symbol,\n          );\n\n          if (txHash) {\n            console.log(`‚úÖ Coin ${coin.symbol} recorded on-chain: ${txHash}`);\n          }\n        } catch (error) {\n          console.error(\"Failed to record coin creation on-chain:\", error);\n          // Don't fail the request if on-chain recording fails\n        }\n      }\n\n      // Send Telegram notification for coin creation (optional)\n      try {\n        await sendTelegramNotification(\n          creatorAddress,\n          \"New Coin Created! ü™ô\",\n          `Your coin \"${coin.name}\" (${coin.symbol}) has been created successfully!${coin.address ? \"\\n\\nAddress: \" + coin.address : \"\"}`,\n          \"coin_created\",\n          coin,\n          undefined, // Stats will be fetched if coin has an address\n        );\n      } catch (error) {\n        console.warn(\"Failed to send Telegram notification:\", error);\n      }\n\n      res.json(coin);\n    } catch (error) {\n      console.error(\"‚ùå Create coin error:\", error);\n      \n      // Better error handling for Zod validation errors\n      if (error && typeof error === 'object' && 'issues' in error) {\n        const zodError = error as any;\n        console.error(\"Validation issues:\", JSON.stringify(zodError.issues, null, 2));\n        return res.status(400).json({\n          error: \"Invalid coin data\",\n          details: zodError.issues,\n        });\n      }\n      \n      const errorMessage =\n        error instanceof Error ? error.message : String(error);\n      return res.status(400).json({\n        error: \"Invalid coin data\",\n        details: errorMessage,\n      });\n    }\n  });\n\n  // Update coin\n  app.patch(\"/api/coins/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const validatedData = updateCoinSchema.parse(req.body);\n      const coin = await storage.updateCoin(id, validatedData);\n      if (!coin) {\n        return res.status(404).json({ error: \"Coin not found\" });\n      }\n\n      // Create in-app notification when coin becomes active\n      if (\n        validatedData.status === \"active\" &&\n        validatedData.address &&\n        coin.creatorWallet\n      ) {\n        await storage.createNotification({\n          userId: coin.creatorWallet,\n          type: \"coin_created\",\n          title: \"üöÄ Coin Deployed Successfully!\",\n          message: `Your coin \"${coin.name}\" (${coin.symbol}) is now live on the blockchain! Address: ${validatedData.address}`,\n          coinAddress: validatedData.address,\n          coinSymbol: coin.symbol,\n          read: false,\n        });\n\n        // Also send Telegram notification\n        await sendTelegramNotification(\n          coin.creatorWallet,\n          \"ü™ô Coin Deployed Successfully!\",\n          `Your coin \"${coin.name}\" (${coin.symbol}) is now live on the blockchain!\\n\\nAddress: ${validatedData.address}\\n\\nüöÄ Start trading now!`,\n          \"coin_created\",\n          coin,\n          undefined, // Stats will be fetched if needed\n        );\n\n        // Award E1XP for successful deployment\n        const deploymentReward = 50; // Bonus for deployment\n        await storage.createE1xpReward({\n          userId: coin.creatorWallet,\n          amount: deploymentReward.toString(),\n          type: \"coin_creation\",\n          title: \"üöÄ Coin Deployed!\",\n          message: `Amazing! Your coin ${coin.symbol} is now live on the blockchain! You earned ${deploymentReward} E1XP bonus! üíé`,\n          metadata: {\n            coinId: coin.id,\n            coinAddress: validatedData.address,\n            coinSymbol: coin.symbol,\n            coinName: coin.name,\n          },\n        });\n\n        // Send notification about deployment reward\n        await storage.createNotification({\n          userId: coin.creatorWallet,\n          type: \"reward\",\n          title: \"üéÅ Deployment Bonus!\",\n          message: `You have ${deploymentReward} E1XP waiting for deploying ${coin.symbol} on-chain! Claim it now.`,\n          amount: deploymentReward.toString(),\n          coinAddress: validatedData.address,\n          coinSymbol: coin.symbol,\n          read: false,\n        });\n      }\n\n      res.json(coin);\n    } catch (error) {\n      console.error(\"Update coin error:\", error);\n      res.status(400).json({ error: \"Invalid update data\" });\n    }\n  });\n\n  // Get coin by address\n  app.get(\"/api/coins/address/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const coin = await storage.getCoinByAddress(address);\n      if (!coin) {\n        return res.status(404).json({ error: \"Coin not found\" });\n      }\n      res.json(coin);\n    } catch (error) {\n      console.error(\"Get coin error:\", error);\n      res.status(500).json({ error: \"Failed to fetch coin\" });\n    }\n  });\n\n  // Migrate old data endpoint\n  app.post(\"/api/migrate\", async (_req, res) => {\n    try {\n      const coinsResult = await migrateOldData();\n      const { migrateOldRewards } = await import(\"./migrate-old-data\");\n      const rewardsResult = await migrateOldRewards();\n\n      res.json({\n        coins: coinsResult,\n        rewards: rewardsResult,\n        summary: {\n          totalMigrated: coinsResult.count + rewardsResult.count,\n          coinsCount: coinsResult.count,\n          rewardsCount: rewardsResult.count,\n        },\n      });\n    } catch (error) {\n      console.error(\"Migration error:\", error);\n      res.status(500).json({ error: \"Migration failed\" });\n    }\n  });\n\n  // Broadcast all existing coins to Telegram\n  app.post(\"/api/telegram/broadcast-coins\", async (_req, res) => {\n    try {\n      const coins = await storage.getAllCoins();\n\n      if (coins.length === 0) {\n        return res.json({\n          success: true,\n          message: \"No coins to broadcast\",\n          broadcasted: 0,\n        });\n      }\n\n      // Broadcast coins one by one with professional formatting\n      let successCount = 0;\n      const errors: string[] = [];\n\n      for (const coin of coins) {\n        try {\n          // Only broadcast coins that have addresses (deployed coins)\n          if (coin.address && coin.creatorWallet) {\n            await sendTelegramNotification(\n              coin.creatorWallet,\n              \"New Coin Created\",\n              \"\",\n              \"coin_created\",\n              coin,\n              undefined,\n            );\n            successCount++;\n\n            // Add a small delay between broadcasts to avoid rate limiting\n            await new Promise((resolve) => setTimeout(resolve, 500));\n          }\n        } catch (error) {\n          const errorMsg =\n            error instanceof Error ? error.message : String(error);\n          errors.push(`${coin.name}: ${errorMsg}`);\n          console.error(`Failed to broadcast coin ${coin.name}:`, error);\n        }\n      }\n\n      res.json({\n        success: true,\n        message: `Broadcasted ${successCount} out of ${coins.length} coins`,\n        broadcasted: successCount,\n        total: coins.length,\n        errors: errors.length > 0 ? errors : undefined,\n      });\n    } catch (error) {\n      console.error(\"Broadcast error:\", error);\n      res.status(500).json({ error: \"Broadcast failed\" });\n    }\n  });\n\n  // Create reward endpoint (for tracking platform and trade fees)\n  app.post(\"/api/rewards\", async (req, res) => {\n    try {\n      const validatedData = insertReferralSchema.parse(req.body); // Assuming reward schema is similar to referral for now, adjust if different\n\n      const {\n        type,\n        coinAddress,\n        coinSymbol,\n        transactionHash,\n        rewardAmount,\n        recipientAddress,\n        traderAddress,\n      } = validatedData;\n\n      if (\n        !type ||\n        !coinAddress ||\n        !coinSymbol ||\n        !transactionHash ||\n        !rewardAmount ||\n        !recipientAddress\n      ) {\n        return res\n          .status(400)\n          .json({ error: \"Missing required reward fields\" });\n      }\n\n      const reward = await storage.createReward({\n        type,\n        coinAddress,\n        coinSymbol,\n        transactionHash,\n        rewardAmount,\n        rewardCurrency: \"ZORA\", // Default currency, adjust if needed\n        recipientAddress,\n      });\n\n      // Record fees on-chain if activity tracker is configured\n      if (traderAddress) {\n        const { activityTrackerService } = await import(\n          \"./activity-tracker.js\"\n        );\n\n        // Calculate creator and platform fees based on type\n        const rewardAmountBigInt = BigInt(rewardAmount);\n        let creatorFee = 0n;\n        let platformFee = 0n;\n\n        if (type === \"platform\") {\n          platformFee = rewardAmountBigInt;\n        } else if (type === \"trade\") {\n          creatorFee = rewardAmountBigInt;\n        }\n\n        // Record to blockchain\n        await activityTrackerService.recordFees(\n          coinAddress as `0x${string}`,\n          traderAddress as `0x${string}`,\n          creatorFee,\n          platformFee,\n        );\n      }\n\n      // Send earnings notification to creator (for trade fees only, not platform)\n      if (type === \"trade\" && recipientAddress) {\n        // Use notification service for randomized earnings messages\n        const { notificationService } = await import(\"./notification-service\");\n        await notificationService.notifyUserEarnings(recipientAddress, reward);\n\n        // Also send trade notification\n        const amount = (parseFloat(reward.rewardAmount) / 1e18).toFixed(4);\n        await notificationService.notifyNewTrade(\n          recipientAddress,\n          reward.coinSymbol,\n          'buy',\n          `${amount} ${reward.rewardCurrency}`\n        );\n      }\n\n      res.json(reward);\n    } catch (error) {\n      console.error(\"Create reward error:\", error);\n      res.status(500).json({ error: \"Failed to create reward\" });\n    }\n  });\n\n  // Get all rewards\n  app.get(\"/api/rewards\", async (_req, res) => {\n    try {\n      const rewards = await storage.getAllRewards();\n      res.json(rewards);\n    } catch (error) {\n      console.error(\"Get rewards error:\", error);\n      res.status(500).json({ error: \"Failed to fetch rewards\" });\n    }\n  });\n\n  // Get rewards by coin\n  app.get(\"/api/rewards/coin/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const rewards = await storage.getRewardsByCoin(address);\n      res.json(rewards);\n    } catch (error) {\n      console.error(\"Get coin rewards error:\", error);\n      res.status(500).json({ error: \"Failed to fetch coin rewards\" });\n    }\n  });\n\n  // Check coin's platform referral status and earnings\n  app.get(\"/api/rewards/coin/:address/status\", async (req, res) => {\n    try {\n      const { address } = req.params;\n\n      // Get coin info\n      const coin = await storage.getCoinByAddress(address);\n      if (!coin) {\n        return res.status(404).json({ error: \"Coin not found\" });\n      }\n\n      // Get all rewards for this coin\n      const rewards = await storage.getRewardsByCoin(address);\n\n      // Calculate earnings\n      const platformFees = rewards\n        .filter((r) => r.type === \"platform\")\n        .reduce((sum, r) => sum + parseFloat(r.rewardAmount) / 1e18, 0);\n\n      const tradeFees = rewards\n        .filter((r) => r.type === \"trade\")\n        .reduce((sum, r) => sum + parseFloat(r.rewardAmount) / 1e18, 0);\n\n      const totalEarnings = platformFees + tradeFees;\n\n      // Check if platform referral was likely set (has platform rewards)\n      const hasPlatformReferral = rewards.some((r) => r.type === \"platform\");\n\n      res.json({\n        coinAddress: address,\n        coinSymbol: coin.symbol,\n        coinName: coin.name,\n        status: coin.status,\n        hasPlatformReferral,\n        platformReferralAddress: hasPlatformReferral\n          ? rewards.find((r) => r.type === \"platform\")?.recipientAddress\n          : null,\n        earnings: {\n          total: totalEarnings,\n          platform: platformFees,\n          trade: tradeFees,\n          currency: \"ZORA\",\n        },\n        rewardsCount: {\n          total: rewards.length,\n          platform: rewards.filter((r) => r.type === \"platform\").length,\n          trade: rewards.filter((r) => r.type === \"trade\").length,\n        },\n        firstReward: rewards.length > 0 ? rewards.length - 1 : null,\n        lastReward: rewards.length > 0 ? rewards[0].createdAt : null,\n      });\n    } catch (error) {\n      console.error(\"Get coin status error:\", error);\n      res.status(500).json({ error: \"Failed to fetch coin status\" });\n    }\n  });\n\n  // Get rewards by recipient\n  app.get(\"/api/rewards/recipient/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const rewards = await storage.getRewardsByRecipient(address);\n      res.json(rewards);\n    } catch (error) {\n      console.error(\"Get recipient rewards error:\", error);\n      res.status(500).json({ error: \"Failed to fetch recipient rewards\" });\n    }\n  });\n\n  // Record a new reward (duplicate endpoint - should be consolidated)\n  app.post(\"/api/rewards/record\", async (req, res) => {\n    try {\n      const rewardData = {\n        type: req.body.type, // 'platform' or 'trade'\n        coinAddress: req.body.coinAddress,\n        coinSymbol: req.body.coinSymbol,\n        transactionHash: req.body.transactionHash,\n        rewardAmount: req.body.rewardAmount, // In wei as string\n        rewardCurrency: req.body.rewardCurrency || \"ZORA\",\n        recipientAddress: req.body.recipientAddress,\n      };\n\n      const reward = await storage.createReward(rewardData);\n\n      // Send earnings notification if it's a trade reward\n      if (rewardData.type === \"trade\" && rewardData.recipientAddress) {\n        const { notificationService } = await import(\"./notification-service\");\n        await notificationService.notifyUserEarnings(\n          rewardData.recipientAddress,\n          reward,\n        );\n\n        // Also send trade notification\n        const amount = (parseFloat(reward.rewardAmount) / 1e18).toFixed(4);\n        await notificationService.notifyNewTrade(\n          rewardData.recipientAddress,\n          reward.coinSymbol,\n          'buy',\n          `${amount} ${reward.rewardCurrency}`\n        );\n      }\n\n      res.json(reward);\n    } catch (error) {\n      console.error(\"Create reward error:\", error);\n      res.status(400).json({ error: \"Invalid reward data\" });\n    }\n  });\n\n  // Get all users with earnings stats\n  app.get(\"/api/users\", async (_req, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      const coins = await storage.getAllCoins();\n      const rewards = await storage.getAllRewards();\n\n      // Calculate stats for each user\n      const usersWithStats = users.map(user => {\n        const userAddress = user.walletAddress?.toLowerCase();\n\n        // Count coins created by this user\n        const userCoins = coins.filter(coin => \n          coin.creatorWallet?.toLowerCase() === userAddress\n        );\n\n        // Calculate total earnings from rewards\n        const userRewards = rewards.filter(reward => \n          reward.recipientAddress?.toLowerCase() === userAddress\n        );\n\n        const totalEarnings = userRewards.reduce((sum, reward) => {\n          const amount = parseFloat(reward.rewardAmount || '0') / 1e18;\n          return sum + amount;\n        }, 0);\n\n        return {\n          ...user,\n          totalCoins: userCoins.length,\n          totalEarnings: totalEarnings.toFixed(4),\n        };\n      });\n\n      res.json(usersWithStats);\n    } catch (error) {\n      console.error(\"Get users error:\", error);\n      res.status(500).json({ error: \"Failed to fetch users\" });\n    }\n  });\n\n  // Get all creators with earnings stats\n  app.get(\"/api/creators\", async (_req, res) => {\n    try {\n      const creators = await storage.getAllCreators();\n      const coins = await storage.getAllCoins();\n      const rewards = await storage.getAllRewards();\n\n      // Get follower/following counts and earnings for each creator\n      const creatorsWithCounts = await Promise.all(\n        creators.map(async (creator) => {\n          const followers = await storage.getFollowers(creator.address);\n          const following = await storage.getFollowing(creator.address);\n\n          const creatorAddress = creator.address?.toLowerCase();\n\n          // Count coins created by this creator\n          const creatorCoins = coins.filter(coin => \n            coin.creatorWallet?.toLowerCase() === creatorAddress\n          );\n\n          // Calculate total earnings from rewards\n          const creatorRewards = rewards.filter(reward => \n            reward.recipientAddress?.toLowerCase() === creatorAddress\n          );\n\n          const totalEarnings = creatorRewards.reduce((sum, reward) => {\n            const amount = parseFloat(reward.rewardAmount || '0') / 1e18;\n            return sum + amount;\n          }, 0);\n\n          return {\n            ...creator,\n            followerCount: followers.length,\n            followingCount: following.length,\n            totalCoins: creatorCoins.length,\n            totalEarnings: totalEarnings.toFixed(4),\n          };\n        })\n      );\n\n      res.json(creatorsWithCounts);\n    } catch (error) {\n      console.error(\"Get creators error:\", error);\n      res.status(500).json({ error: \"Failed to fetch creators\" });\n    }\n  });\n\n  // Get top creators\n  app.get(\"/api/creators/top\", async (req, res) => {\n    try {\n      const creators = await storage.getTopCreators();\n      res.json(creators);\n    } catch (error) {\n      console.error(\"Get top creators error:\", error);\n      res.status(500).json({ error: \"Failed to fetch top creators\" });\n    }\n  });\n\n  // Get creator by Privy ID\n  app.get(\"/api/creators/privy/:privyId\", async (req, res) => {\n    try {\n      const { privyId } = req.params;\n\n      if (!privyId) {\n        return res.status(400).json({ error: \"Privy ID is required\" });\n      }\n\n      const creator = await storage.getCreatorByPrivyId(privyId);\n\n      if (!creator) {\n        return res.status(404).json({ error: \"Creator not found\" });\n      }\n\n      res.json(creator);\n    } catch (error) {\n      console.error(\"Error fetching creator by privyId:\", error);\n      res.status(500).json({ error: \"Failed to fetch creator\" });\n    }\n  });\n\n  // Get creator by address (kept for backwards compatibility)\n  app.get(\"/api/creators/address/:address\", async (req, res) => {\n    const { address } = req.params;\n    try {\n      const creator = await storage.getCreatorByAddress(address);\n      if (!creator) {\n        return res.status(404).json({ error: \"Creator not found\" });\n      }\n      res.json(creator);\n    } catch (error: any) {\n      console.error(\"Error fetching creator:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get creator by username\n  app.get(\"/api/creators/username/:username\", async (req, res) => {\n    const { username } = req.params;\n    try {\n      const creators = await storage.getAllCreators();\n      const creator = creators.find(\n        (c) => c.name?.toLowerCase() === username.toLowerCase(),\n      );\n      if (!creator) {\n        return res.status(404).json({ error: \"Creator not found\" });\n      }\n      res.json(creator);\n    } catch (error: any) {\n      console.error(\"Error fetching creator:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get admin stats\n  app.get(\"/api/admin/stats\", async (req, res) => {\n    try {\n      const coins = await storage.getAllCoins();\n      const creators = await storage.getAllCreators();\n      const rewards = await storage.getAllRewards();\n\n      // Calculate total coins\n      const totalCoins = coins.length;\n\n      // Calculate total volume from all creator trading activity\n      const totalVolume = creators.reduce((sum, creator) => {\n        const volume = parseFloat(creator.totalVolume || '0');\n        return sum + volume;\n      }, 0);\n\n      // Market cap calculation\n      // Note: Accurate market cap requires fetching live (price √ó circulating supply)\n      // for each coin from Zora API. For now, using totalVolume as an approximation\n      // since volume represents actual value transacted on the platform.\n      // Future enhancement: integrate per-coin market cap aggregation from Zora SDK\n      const totalMarketCap = totalVolume;\n\n      // Calculate total earnings from rewards\n      const totalEarnings = rewards.reduce((sum, reward) => {\n        const amount = parseFloat(reward.rewardAmount || '0') / 1e18;\n        return sum + amount;\n      }, 0);\n\n      // Calculate platform fees and trade fees\n      // Platform fees use type 'platform', trade fees use type 'trade'\n      const platformFees = rewards\n        .filter(r => r.type === 'platform')\n        .reduce((sum, reward) => {\n          const amount = parseFloat(reward.rewardAmount || '0') / 1e18;\n          return sum + amount;\n        }, 0);\n\n      const tradeFees = rewards\n        .filter(r => r.type === 'trade')\n        .reduce((sum, reward) => {\n          const amount = parseFloat(reward.rewardAmount || '0') / 1e18;\n          return sum + amount;\n        }, 0);\n\n      res.json({\n        totalCoins,\n        totalMarketCap: totalMarketCap.toFixed(2),\n        totalVolume: totalVolume.toFixed(2),\n        totalEarnings: totalEarnings.toFixed(4),\n        platformFees: platformFees.toFixed(4),\n        tradeFees: tradeFees.toFixed(4),\n      });\n    } catch (error) {\n      console.error(\"Get admin stats error:\", error);\n      res.status(500).json({ error: \"Failed to fetch admin stats\" });\n    }\n  });\n\n  // Sync creator profile on login (Privy ID-based with legacy support)\n  app.post(\"/api/creators/sync\", async (req, res) => {\n    try {\n      const { privyId, address, email } = req.body;\n\n      if (!privyId) {\n        console.error('[Creator Sync] Missing Privy ID');\n        return res.status(400).json({ error: \"Privy ID is required\" });\n      }\n\n      console.log('[Creator Sync] Syncing creator:', { privyId, address, email });\n\n      // First, check if creator exists by privyId\n      let creator = await storage.getCreatorByPrivyId(privyId);\n\n      if (creator) {\n        console.log('[Creator Sync] Found existing creator by privyId:', creator.id);\n        // Update existing creator with latest address/email if changed (but preserve walletAddress!)\n        const updates: any = {};\n        if (address && address !== creator.address) {\n          updates.address = address;\n        }\n        if (email && email !== creator.email) {\n          updates.email = email;\n        }\n        if (Object.keys(updates).length > 0) {\n          creator = await storage.updateCreator(creator.id, updates);\n          console.log('[Creator Sync] Updated creator with new address/email');\n        }\n        return res.json(creator);\n      }\n\n      // If not found by privyId, check by address (legacy creators)\n      if (address) {\n        creator = await storage.getCreatorByAddress(address);\n        if (creator) {\n          console.log('[Creator Sync] Found legacy creator by address, backfilling privyId');\n          // Backfill privyId for legacy creator (preserve existing walletAddress!)\n          creator = await storage.updateCreator(creator.id, { privyId });\n          return res.json(creator);\n        }\n      }\n\n      // Generate a default username for email users\n      const { getDefaultUsername } = await import(\"./username-generator\");\n      const defaultUsername = getDefaultUsername(email, privyId);\n\n      console.log('[Creator Sync] Creating new creator with username:', defaultUsername);\n\n      // Create new creator with privyId (address can be null for email users)\n      const creatorData = {\n        privyId,\n        address: address || null, // Allow null for email-only users\n        email: email || null, // Store email for email-only users\n        name: defaultUsername, // Auto-generate username for email users\n        bio: null,\n        avatar: null,\n        walletAddress: null, // No payout address for email users initially\n        verified: \"false\",\n        totalCoins: \"0\",\n        totalVolume: \"0\",\n        followers: \"0\",\n        referralCode: defaultUsername, // Use generated username as referral code\n        points: \"100\", // Welcome bonus\n      };\n\n      creator = await storage.createCreator(creatorData);\n      console.log('[Creator Sync] Successfully created new creator:', creator.id, 'with email:', email);\n\n      // Send welcome notification and E1XP reward\n      try {\n        const userId = creator.address || creator.id;\n        const welcomePoints = 100;\n\n        // Create welcome notification\n        await storage.createNotification({\n          userId: userId,\n          type: 'reward',\n          title: 'üéÅ Welcome to Every1.fun!',\n          message: `You earned ${welcomePoints} E1XP as a welcome bonus! Come back daily to earn more points and build your streak! üî•`,\n          amount: welcomePoints.toString(),\n          read: false,\n        });\n\n        // Create E1XP reward record\n        await storage.createE1xpReward({\n          userId: userId,\n          amount: welcomePoints.toString(),\n          type: 'welcome',\n          title: 'üéâ Welcome Bonus!',\n          message: `Welcome to Every1.fun! You've earned ${welcomePoints} E1XP to get started!`,\n          metadata: { \n            isWelcomeBonus: true,\n            timestamp: new Date().toISOString()\n          },\n        });\n\n        // Send real-time notification via Socket.IO if user is connected\n        const { emitNotificationToUser } = await import('./socket-server');\n        emitNotificationToUser(userId, {\n          type: 'reward',\n          title: 'üéÅ Welcome to Every1.fun!',\n          message: `You earned ${welcomePoints} E1XP as a welcome bonus!`,\n          amount: welcomePoints.toString(),\n        });\n\n        // Send Telegram notification if address available\n        if (address) {\n          try {\n            await sendTelegramNotification(\n              address,\n              'üéÅ Welcome to Every1.fun!',\n              `Welcome! You've earned ${welcomePoints} E1XP points to get started. Come back daily to earn more points and build your streak! üî•`,\n              'reward'\n            );\n          } catch (telegramError) {\n            console.warn('[Creator Sync] Failed to send Telegram welcome notification:', telegramError);\n          }\n        }\n\n        console.log(`[Creator Sync] Sent welcome notification and ${welcomePoints} E1XP to new user ${userId}`);\n      } catch (notificationError) {\n        console.error('[Creator Sync] Failed to send welcome notifications:', notificationError);\n        // Don't fail the whole request if notifications fail\n      }\n\n      res.json(creator);\n    } catch (error) {\n      console.error(\"[Creator Sync] Error:\", error);\n      res.status(500).json({\n        error: \"Failed to sync creator profile\",\n        details: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Create or update creator (legacy, kept for backwards compatibility)\n  app.post(\"/api/creators\", async (req, res) => {\n    try {\n      const { address } = req.body;\n\n      // Check if creator already exists\n      const existingCreator = await storage.getCreatorByAddress(address);\n      if (existingCreator) {\n        return res.json(existingCreator);\n      }\n\n      // Create new creator with username as referral code\n      const referralCode = await generateReferralCode(\n        req.body.address,\n      );\n      const creatorData = {\n        address: req.body.address,\n        name: req.body.name || null,\n        bio: req.body.bio || null,\n        avatar: req.body.avatar || null,\n        verified: req.body.verified || \"false\",\n        totalCoins: req.body.totalCoins || \"0\",\n        totalVolume: req.body.totalVolume || \"0\",\n        followers: req.body.followers || \"0\",\n        referralCode: referralCode,\n        points: \"0\", // Initialize points\n      };\n\n      const creator = await storage.createCreator(creatorData);\n      res.json(creator);\n    } catch (error) {\n      console.error(\"Create creator error:\", error);\n      res.status(400).json({ error: \"Invalid creator data\" });\n    }\n  });\n\n  // Update creator profile\n  app.patch(\"/api/creators/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const updates = req.body;\n\n      console.log('[Update Creator] Updating creator:', { id, updates });\n\n      const creator = await storage.updateCreator(id, updates);\n\n      if (!creator) {\n        console.error('[Update Creator] Creator not found:', id);\n        return res.status(404).json({ error: \"Creator not found\" });\n      }\n\n      // Update referral code if name was changed - ONLY for wallet users\n      // Email-only users keep their auto-generated referral code for uniqueness\n      if (updates.name !== undefined && creator && creator.address) {\n        const newReferralCode = await generateReferralCode(creator.address);\n        await storage.updateCreator(id, {\n          referralCode: newReferralCode\n        });\n        console.log('[Update Creator] Updated referral code for creator:', creator.id, 'to', newReferralCode);\n      }\n\n      console.log('[Update Creator] Successfully updated creator:', creator.id);\n      res.json(creator);\n    } catch (error) {\n      console.error(\"[Update Creator] Error:\", error);\n      res.status(500).json({ \n        error: \"Failed to update creator\",\n        details: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Get all comments\n  app.get(\"/api/comments\", async (_req, res) => {\n    try {\n      const comments = await storage.getAllComments();\n      res.json(comments);\n    } catch (error) {\n      console.error(\"Get comments error:\", error);\n      res.status(500).json({ error: \"Failed to fetch comments\" });\n    }\n  });\n\n  // Get comments by coin address\n  app.get(\"/api/comments/coin/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const comments = await storage.getCommentsByCoin(address);\n      res.json(comments);\n    } catch (error) {\n      console.error(\"Get coin comments error:\", error);\n      res.status(500).json({ error: \"Failed to fetch coin comments\" });\n    }\n  });\n\n  // Create a comment\n  app.post(\"/api/comments\", async (req, res) => {\n    try {\n      const validatedData = insertCommentSchema.parse(req.body);\n      const comment = await storage.createComment(validatedData);\n      res.json(comment);\n    } catch (error) {\n      console.error(\"Create comment error:\", error);\n      res.status(400).json({ error: \"Invalid comment data\" });\n    }\n  });\n\n  // Get notifications for user\n  app.get(\"/api/notifications/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const notifications = await storage.getNotificationsByUser(userId);\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Get notifications error:\", error);\n      res.status(500).json({ error: \"Failed to fetch notifications\" });\n    }\n  });\n\n  // Get unread notifications for user\n  app.get(\"/api/notifications/:userId/unread\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const notifications = await storage.getUnreadNotificationsByUser(userId);\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Get unread notifications error:\", error);\n      res.status(500).json({ error: \"Failed to fetch unread notifications\" });\n    }\n  });\n\n  // Create notification\n  app.post(\"/api/notifications\", async (req, res) => {\n    try {\n      const validatedData = insertNotificationSchema.parse(req.body);\n      const notification = await storage.createNotification(validatedData);\n\n      // Send Telegram notification if available\n      await sendTelegramNotification(\n        notification.userId,\n        notification.title,\n        notification.message,\n        notification.type,\n      );\n\n      res.json(notification);\n    } catch (error) {\n      console.error(\"Create notification error:\", error);\n      res.status(400).json({ error: \"Invalid notification data\" });\n    }\n  });\n\n  // Mark notification as read\n  app.patch(\"/api/notifications/:id/read\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const notification = await storage.markNotificationAsRead(id);\n      if (!notification) {\n        return res.status(404).json({ error: \"Notification not found\" });\n      }\n      res.json(notification);\n    } catch (error) {\n      console.error(\"Mark notification read error:\", error);\n      res.status(500).json({ error: \"Failed to mark notification as read\" });\n    }\n  });\n\n  // Mark all notifications as read\n  app.patch(\"/api/notifications/:userId/read-all\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      await storage.markAllNotificationsAsRead(userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Mark all notifications read error:\", error);\n      res\n        .status(500)\n        .json({ error: \"Failed to mark all notifications as read\" });\n    }\n  });\n\n  // Delete notification\n  app.delete(\"/api/notifications/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteNotification(id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Notification not found\" });\n      }\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Delete notification error:\", error);\n      res.status(500).json({ error: \"Failed to delete notification\" });\n    }\n  });\n\n  // Registry endpoints for onchain verification\n  const registryService = new RegistryService(base.id);\n\n  // Activity Tracker endpoints for grant verification\n  const activityTrackerService = new ActivityTrackerService(base.id);\n\n  // Manually trigger batch registration of unregistered coins\n  app.post(\"/api/registry/sync\", async (_req, res) => {\n    try {\n      const coins = await storage.getAllCoins();\n      const unregisteredCoins = coins.filter(\n        (coin) =>\n          coin.address && coin.status === \"active\" && !coin.registryTxHash,\n      );\n\n      if (unregisteredCoins.length === 0) {\n        return res.json({\n          message: \"No coins to register\",\n          registered: 0,\n        });\n      }\n\n      const txHash =\n        await registryService.registerCoinsBatch(unregisteredCoins);\n\n      if (txHash) {\n        const now = new Date();\n        for (const coin of unregisteredCoins) {\n          const metadataHash = registryService.generateMetadataHash(coin);\n          await storage.updateCoin(coin.id, {\n            registryTxHash: txHash,\n            metadataHash,\n            registeredAt: now,\n          });\n        }\n\n        return res.json({\n          success: true,\n          transactionHash: txHash,\n          registered: unregisteredCoins.length,\n        });\n      } else {\n        return res.status(500).json({\n          error: \"Failed to register coins batch\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Registry sync error:\", error);\n      res.status(500).json({ error: \"Failed to sync registry\" });\n    }\n  });\n\n  // Get registry statistics\n  app.get(\"/api/registry/stats\", async (_req, res) => {\n    try {\n      const totalRegistered = await registryService.getTotalCoinsRegistered();\n      const allCoins = await storage.getAllCoins();\n      const registeredInDb = allCoins.filter((c) => c.registryTxHash).length;\n      const pendingRegistration = allCoins.filter(\n        (c) => c.address && c.status === \"active\" && !c.registryTxHash,\n      ).length;\n\n      res.json({\n        totalOnchain: totalRegistered,\n        totalInDb: allCoins.length,\n        registeredInDb,\n        pendingRegistration,\n      });\n    } catch (error) {\n      console.error(\"Registry stats error:\", error);\n      res.status(500).json({ error: \"Failed to fetch registry stats\" });\n    }\n  });\n\n  // Manually trigger batch recording of unrecorded coins to activity tracker\n  app.post(\"/api/activity-tracker/sync\", async (_req, res) => {\n    try {\n      const coins = await storage.getAllCoins();\n      const unrecordedCoins = coins.filter(\n        (coin) =>\n          coin.address &&\n          coin.status === \"active\" &&\n          !coin.activityTrackerTxHash,\n      );\n\n      if (unrecordedCoins.length === 0) {\n        return res.json({\n          success: true,\n          message: \"No coins to record on activity tracker\",\n          recorded: 0,\n          alreadyRegistered: 0,\n        });\n      }\n\n      // Ensure all coins have a createdAt timestamp\n      for (const coin of unrecordedCoins) {\n        if (!coin.createdAt) {\n          // Set a reasonable past date for coins without creation dates\n          const fallbackDate = new Date(\"2025-01-01T00:00:00Z\");\n          await storage.updateCoin(coin.id, {\n            createdAt: fallbackDate,\n          });\n          coin.createdAt = fallbackDate;\n          console.log(\n            `‚úÖ Set fallback createdAt for ${coin.symbol}: ${fallbackDate.toISOString()}`,\n          );\n        }\n      }\n\n      const results =\n        await activityTrackerService.recordCoinBatch(unrecordedCoins);\n\n      const now = new Date();\n      let newlyRecorded = 0;\n      let alreadyRegistered = 0;\n      const failedCoins: string[] = [];\n\n      for (const [coinId, txHash] of results.entries()) {\n        await storage.updateCoin(coinId, {\n          activityTrackerTxHash: txHash,\n          activityTrackerRecordedAt: now,\n        });\n\n        // Check if this was already registered (txHash equals coin address)\n        const coin = unrecordedCoins.find((c) => c.id === coinId);\n        if (coin && txHash === coin.address) {\n          alreadyRegistered++;\n        } else {\n          newlyRecorded++;\n        }\n      }\n\n      // Track failed coins\n      for (const coin of unrecordedCoins) {\n        if (!results.has(coin.id)) {\n          failedCoins.push(`${coin.symbol} (${coin.address})`);\n        }\n      }\n\n      const response: any = {\n        success: true,\n        message: `Processed ${unrecordedCoins.length} coins: ${newlyRecorded} newly recorded, ${alreadyRegistered} already on-chain, ${failedCoins.length} failed`,\n        recorded: newlyRecorded,\n        alreadyRegistered: alreadyRegistered,\n        failed: failedCoins.length,\n        total: unrecordedCoins.length,\n        transactionHashes: Array.from(results.values()).filter(\n          (h) => h.startsWith(\"0x\") && h.length > 42,\n        ),\n      };\n\n      if (failedCoins.length > 0) {\n        response.failedCoins = failedCoins;\n        response.troubleshooting = [\n          \"Check console logs for detailed error messages\",\n          \"Verify PLATFORM_PRIVATE_KEY has sufficient ETH for gas\",\n          \"Ensure VITE_ACTIVITY_TRACKER_ADDRESS is correct\",\n          \"Some coins may already be registered on-chain\",\n        ];\n      }\n\n      return res.json(response);\n    } catch (error) {\n      console.error(\"Activity tracker sync error:\", error);\n      res.status(500).json({ error: \"Failed to sync activity tracker\" });\n    }\n  });\n\n  // Get activity tracker statistics\n  app.get(\"/api/activity-tracker/stats\", async (_req, res) => {\n    try {\n      const allCoins = await storage.getAllCoins();\n      const recordedInDb = allCoins.filter(\n        (c) => c.activityTrackerTxHash,\n      ).length;\n      const pendingRecording = allCoins.filter(\n        (c) => c.address && c.status === \"active\" && !c.activityTrackerTxHash,\n      ).length;\n\n      res.json({\n        totalInDb: allCoins.length,\n        recordedInDb,\n        pendingRecording,\n      });\n    } catch (error) {\n      console.error(\"Activity tracker stats error:\", error);\n      res.status(500).json({ error: \"Failed to fetch activity tracker stats\" });\n    }\n  });\n\n  // Broadcast all existing coins to Telegram\n  app.post(\"/api/telegram/broadcast-coins\", async (_req, res) => {\n    try {\n      const { broadcastExistingCoins } = await import(\"./telegram-bot\");\n      const coins = await storage.getAllCoins();\n      await broadcastExistingCoins(coins);\n\n      res.json({\n        success: true,\n        message: `Broadcasting ${coins.length} coins to connected Telegram users`,\n      });\n    } catch (error) {\n      console.error(\"Telegram broadcast error:\", error);\n      res.status(500).json({ error: \"Failed to broadcast coins\" });\n    }\n  });\n\n  // Verify if a coin is registered onchain\n  app.get(\"/api/registry/verify/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const isRegistered = await registryService.isPlatformCoin(address);\n\n      const coin = await storage.getCoinByAddress(address);\n\n      res.json({\n        address,\n        isRegistered,\n        registryTxHash: coin?.registryTxHash || null,\n        registeredAt: coin?.registeredAt || null,\n      });\n    } catch (error) {\n      console.error(\"Registry verify error:\", error);\n      res.status(500).json({ error: \"Failed to verify coin\" });\n    }\n  });\n\n  // Get creator coin count from registry\n  app.get(\"/api/registry/creator/:address/count\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const count = await registryService.getCreatorCoinCount(address);\n\n      res.json({\n        creator: address,\n        onchainCoinCount: count,\n      });\n    } catch (error) {\n      console.error(\"Registry creator count error:\", error);\n      res.status(500).json({ error: \"Failed to fetch creator coin count\" });\n    }\n  });\n\n  // ===== FOLLOW/UNFOLLOW ENDPOINTS =====\n\n  // Follow a user\n  app.post(\"/api/follows\", async (req, res) => {\n    try {\n      const validatedData = insertFollowSchema.parse(req.body);\n\n      // Check if already following\n      const isFollowing = await storage.isFollowing(\n        validatedData.followerAddress,\n        validatedData.followingAddress,\n      );\n      if (isFollowing) {\n        return res.status(400).json({ error: \"Already following this user\" });\n      }\n\n      const follow = await storage.createFollow(validatedData);\n\n      // Update follower count for the followed user\n      const creator = await storage.getCreatorByAddress(\n        validatedData.followingAddress,\n      );\n      if (creator) {\n        const currentFollowers = parseInt(creator.followers || \"0\");\n        await storage.updateCreator(creator.id, {\n          followers: (currentFollowers + 1).toString(),\n        });\n      }\n\n      res.json(follow);\n    } catch (error) {\n      console.error(\"Create follow error:\", error);\n      res.status(400).json({ error: \"Failed to follow user\" });\n    }\n  });\n\n  // Unfollow a user\n  app.delete(\n    \"/api/follows/:followerAddress/:followingAddress\",\n    async (req, res) => {\n      try {\n        const { followerAddress, followingAddress } = req.params;\n        const deleted = await storage.deleteFollow(\n          followerAddress,\n          followingAddress,\n        );\n\n        if (deleted) {\n          // Update follower count for the unfollowed user\n          const creator = await storage.getCreatorByAddress(followingAddress);\n          if (creator) {\n            const currentFollowers = parseInt(creator.followers || \"0\");\n            await storage.updateCreator(creator.id, {\n              followers: Math.max(0, currentFollowers - 1).toString(),\n            });\n          }\n        }\n\n        res.json({ success: deleted });\n      } catch (error) {\n        console.error(\"Delete follow error:\", error);\n        res.status(500).json({ error: \"Failed to unfollow user\" });\n      }\n    },\n  );\n\n  // Check if following\n  app.get(\n    \"/api/follows/check/:followerAddress/:followingAddress\",\n    async (req, res) => {\n      try {\n        const { followerAddress, followingAddress } = req.params;\n        const isFollowing = await storage.isFollowing(\n          followerAddress,\n          followingAddress,\n        );\n        res.json({ isFollowing });\n      } catch (error) {\n        console.error(\"Check follow error:\", error);\n        res.status(500).json({ error: \"Failed to check follow status\" });\n      }\n    },\n  );\n\n  // Get followers of a user\n  app.get(\"/api/follows/followers/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n\n      // Check if user exists first\n      const user = await storage.getCreatorByAddress(address);\n      if (!user) {\n        return res.json([]); // Return empty array instead of error\n      }\n\n      const followers = await storage.getFollowers(address);\n      res.json(followers || []);\n    } catch (error) {\n      console.error(\"Get followers error:\", error);\n      res.json([]); // Return empty array on error\n    }\n  });\n\n  // Get users that a user is following\n  app.get(\"/api/follows/following/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n\n      // Check if user exists first\n      const user = await storage.getCreatorByAddress(address);\n      if (!user) {\n        return res.json([]); // Return empty array instead of error\n      }\n\n      const following = await storage.getFollowing(address);\n      res.json(following || []);\n    } catch (error) {\n      console.error(\"Get following error:\", error);\n      res.json([]); // Return empty array on error\n    }\n  });\n\n  // ===== REFERRAL ENDPOINTS =====\n\n  // Generate referral link\n  app.post(\"/api/referrals/generate\", async (req, res) => {\n    try {\n      const { address, privyId } = req.body;\n\n      if (!address && !privyId) {\n        return res.status(400).json({ error: \"Address or Privy ID is required\" });\n      }\n\n      // Get or create user - support both email and wallet users\n      let user = privyId\n        ? await storage.getUserByPrivyId(privyId)\n        : address\n        ? await storage.getUserByAddress(address)\n        : null;\n\n      if (!user) {\n        return res.status(404).json({ error: \"User not found. Please create an account first.\" });\n      }\n\n      // Generate or get referral code based on user ID\n      const referralCode = await generateReferralCode(user.id);\n\n      // Update if referral code changed or is null\n      if (!user.referralCode || user.referralCode !== referralCode) {\n        const [updated] = await db\n          .update(users)\n          .set({ referralCode })\n          .where(eq(users.id, user.id))\n          .returning();\n        if (updated) {\n          user = updated;\n        }\n      }\n\n      // Ensure we have a valid referral code\n      const finalReferralCode = user.referralCode || referralCode;\n\n      // Use the actual host from the request\n      const host = req.get(\"host\") || \"localhost:5000\";\n      const protocol = req.get(\"x-forwarded-proto\") || req.protocol || \"http\";\n      const referralLink = `${protocol}://${host}/?ref=${finalReferralCode}`;\n\n      console.log(`Generated referral link for user ${user.id}: ${referralLink}`);\n\n      res.json({\n        referralCode: finalReferralCode,\n        referralLink,\n      });\n    } catch (error) {\n      console.error(\"Generate referral error:\", error);\n      res.status(500).json({ error: \"Failed to generate referral link\" });\n    }\n  });\n\n  // Apply referral (when a new user signs up with a referral code)\n  app.post(\"/api/referrals/apply\", async (req, res) => {\n    try {\n      const { referralCode, referredUserId, referredAddress, referredPrivyId } = req.body;\n\n      if (!referralCode) {\n        return res.status(400).json({ error: \"Referral code is required\" });\n      }\n\n      if (!referredUserId && !referredAddress && !referredPrivyId) {\n        return res.status(400).json({ error: \"Referred user identifier is required\" });\n      }\n\n      // Find referrer by referral code (from users table)\n      const referrer = await storage.getUserByReferralCode(referralCode);\n      if (!referrer) {\n        return res.status(400).json({ error: \"Invalid referral code\" });\n      }\n\n      // Find referred user\n      let referredUser = referredUserId\n        ? await storage.getUserById(referredUserId)\n        : referredPrivyId\n        ? await storage.getUserByPrivyId(referredPrivyId)\n        : referredAddress\n        ? await storage.getUserByAddress(referredAddress)\n        : null;\n\n      if (!referredUser) {\n        return res.status(400).json({ error: \"Referred user not found\" });\n      }\n\n      // Check if user is trying to refer themselves\n      if (referrer.id === referredUser.id) {\n        return res.status(400).json({ error: \"Cannot refer yourself\" });\n      }\n\n      // Check if referral already exists\n      const [existingReferral] = await db\n        .select()\n        .from(referrals)\n        .where(\n          and(\n            eq(referrals.referrerId, referrer.id),\n            eq(referrals.referredUserId, referredUser.id)\n          )\n        )\n        .limit(1);\n\n      if (existingReferral) {\n        return res.status(400).json({ error: \"Referral already exists\" });\n      }\n\n      // Create referral record\n      const [newReferral] = await db\n        .insert(referrals)\n        .values({\n          referrerId: referrer.id,\n          referredUserId: referredUser.id,\n          status: 'pending',\n          totalPointsEarned: 0,\n          hasTradedOrCreated: false,\n        })\n        .returning();\n\n      // Award signup bonus to referrer\n      const pointsToAdd = POINTS_REWARDS.REFERRAL_SIGNUP;\n      await rewardPoints(\n        referrer.id,\n        pointsToAdd,\n        \"referral\",\n        `New referral signup! ${referredUser.username || referredUser.email || 'User'} joined using your link!`,\n        { referredUserId: referredUser.id }\n      );\n\n      const referredName = referredUser.displayName || referredUser.username || referredUser.email?.split('@')[0] || 'New user';\n      const referrerName = referrer.displayName || referrer.username || referrer.email?.split('@')[0] || 'Referrer';\n\n      // Send notification to REFERRER (they earned points)\n      await storage.createNotification({\n        userId: referrer.id,\n        type: \"reward\",\n        title: \"Referral Successful! üéâ\",\n        message: `${referredName} joined using your referral link! You earned ${pointsToAdd} E1XP points.`,\n        read: false,\n      });\n\n      // Send Telegram notification to referrer (if they have a wallet)\n      if (referrer.walletAddress) {\n        await sendTelegramNotification(\n          referrer.walletAddress,\n          \"Referral Successful! üéâ\",\n          `${referredName} joined using your referral link! You earned ${pointsToAdd} E1XP points.`,\n          \"reward\",\n        );\n      }\n\n      // Send notification to REFERRED USER (welcoming them)\n      await storage.createNotification({\n        userId: referredUser.id,\n        type: \"reward\",\n        title: \"Welcome to Every1.fun! üöÄ\",\n        message: `You joined via ${referrerName}'s referral link. Start creating and trading coins now!`,\n        read: false,\n      });\n\n      // Send Telegram notification to referred user (if they have a wallet)\n      if (referredUser.walletAddress) {\n        await sendTelegramNotification(\n          referredUser.walletAddress,\n          \"Welcome to Every1.fun! üöÄ\",\n          `You joined via ${referrerName}'s referral link. Start creating and trading coins now!`,\n          \"reward\",\n        );\n      }\n\n      res.json({\n        success: true,\n        referral: newReferral,\n        pointsEarned: pointsToAdd,\n      });\n    } catch (error) {\n      console.error(\"Apply referral error:\", error);\n      res.status(500).json({ error: \"Failed to apply referral\" });\n    }\n  });\n\n  // Get referrals by referrer\n  app.get(\"/api/referrals/referrer/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const referrals = await storage.getReferralsByReferrer(address);\n      res.json(referrals);\n    } catch (error) {\n      console.error(\"Get referrals error:\", error);\n      res.status(500).json({ error: \"Failed to get referrals\" });\n    }\n  });\n\n  // Get referrals by code\n  app.get(\"/api/referrals/code/:code\", async (req, res) => {\n    try {\n      const { code } = req.params;\n      const referrals = await storage.getReferralsByCode(code);\n      res.json(referrals);\n    } catch (error) {\n      console.error(\"Get referrals by code error:\", error);\n      res.status(500).json({ error: \"Failed to get referrals\" });\n    }\n  });\n\n  // Get referral stats for a user\n  app.get(\"/api/referrals/stats/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const referrals = await storage.getReferralsByReferrer(address);\n      const creator = await storage.getCreatorByAddress(address);\n\n      const totalPoints = parseInt(creator?.points || \"0\");\n      const totalReferrals = referrals.length;\n\n      res.json({\n        totalPoints,\n        totalReferrals,\n        referrals,\n      });\n    } catch (error) {\n      console.error(\"Get referral stats error:\", error);\n      res.status(500).json({ error: \"Failed to get referral stats\" });\n    }\n  });\n\n  // Push notification subscription\n  app.post(\"/api/push-subscriptions\", async (req, res) => {\n    try {\n      const { userAddress, subscription } = req.body;\n\n      if (!userAddress || !subscription) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      // Store subscription in database\n      await storage.createPushSubscription({\n        userAddress,\n        subscription: JSON.stringify(subscription),\n        endpoint: subscription.endpoint,\n      });\n\n      res.json({ success: true, message: \"Push subscription saved\" });\n    } catch (error) {\n      console.error(\"Push subscription error:\", error);\n      res.status(500).json({ error: \"Failed to save push subscription\" });\n    }\n  });\n\n  // Register admin router (provides /api/admin/* endpoints)\n  try {\n    const adminRouter = createAdminRouter(storage as any);\n    app.use('/api/admin', adminRouter);\n    registerAdminRegistryRoutes(app);\n  } catch (err) {\n    console.warn('Failed to register admin router:', err);\n  }\n\n  // Register registry router (provides /api/registry/* endpoints)\n  app.use('/api', registryRouter);\n\n  // ===== E1XP REWARDS ENDPOINTS =====\n\n  // Note: All E1XP endpoints are handled by the E1XP router in routes/e1xp.ts\n  // Including: /api/e1xp/status, /api/e1xp/claim-daily, /api/e1xp/rewards/*, etc.\n\n  // ===== PUSH NOTIFICATION ENDPOINTS =====\n\n  // Subscribe to push notifications\n  app.post(\"/api/push/subscribe\", async (req, res) => {\n    try {\n      const { userId, subscription } = req.body;\n\n      if (!userId || !subscription) {\n        return res.status(400).json({ error: \"Missing userId or subscription\" });\n      }\n\n      await storage.createPushSubscription({\n        userId,\n        endpoint: subscription.endpoint,\n        p256dhKey: subscription.keys.p256dh,\n        authKey: subscription.keys.auth,\n      });\n\n      res.json({ success: true, message: \"Push subscription saved\" });\n    } catch (error) {\n      console.error(\"Push subscribe error:\", error);\n      res.status(500).json({ error: \"Failed to save push subscription\" });\n    }\n  });\n\n  // Unsubscribe from push notifications\n  app.post(\"/api/push/unsubscribe\", async (req, res) => {\n    try {\n      const { userId, endpoint } = req.body;\n\n      if (!userId || !endpoint) {\n        return res.status(400).json({ error: \"Missing userId or endpoint\" });\n      }\n\n      await storage.deletePushSubscription(userId, endpoint);\n\n      res.json({ success: true, message: \"Push subscription removed\" });\n    } catch (error) {\n      console.error(\"Push unsubscribe error:\", error);\n      res.status(500).json({ error: \"Failed to remove push subscription\" });\n    }\n  });\n\n  // Get login streak for a user\n  app.get(\"/api/login-streak/:identifier\", async (req, res) => {\n    try {\n      const { identifier } = req.params;\n      const loginStreak = await storage.getLoginStreak(identifier);\n      res.json(loginStreak);\n    } catch (error) {\n      console.error(\"Get login streak error:\", error);\n      res.status(500).json({ error: \"Failed to get login streak\" });\n    }\n  });\n\n  // Check for unclaimed daily points and send reminder\n  app.post(\"/api/login-streak/check-unclaimed\", async (req, res) => {\n    try {\n      const { address } = req.body;\n\n      if (!address) {\n        return res.status(400).json({ error: \"Address is required\" });\n      }\n\n      const today = new Date().toISOString().split(\"T\")[0];\n      const loginStreak = await storage.getLoginStreak(address);\n\n      // If no streak exists, user hasn't claimed their first points\n      if (!loginStreak) {\n        await storage.createNotification({\n          userId: address,\n          type: \"reward\",\n          title: \"üéÅ Claim Your Welcome Bonus!\",\n          message:\n            \"You have 10 points waiting for you! Visit the app to claim your first daily login bonus and start your streak.\",\n          amount: \"10\",\n          read: false,\n        });\n\n        await sendTelegramNotification(\n          address,\n          \"üéÅ Claim Your Welcome Bonus!\",\n          \"You have 10 points waiting! Visit the app to claim your first daily login bonus and start your streak üî•\",\n          \"reward\",\n        );\n\n        return res.json({\n          hasUnclaimed: true,\n          pointsAvailable: 10,\n          isFirstTime: true,\n        });\n      }\n\n      // If last login was not today, user has unclaimed points\n      if (loginStreak.lastLoginDate !== today) {\n        const lastLogin = new Date(loginStreak.lastLoginDate || today);\n        const todayDate = new Date(today);\n        const daysDiff = Math.floor(\n          (todayDate.getTime() - lastLogin.getTime()) / (1000 * 60 * 60 * 24),\n        );\n\n        let currentStreak = parseInt(loginStreak.currentStreak || \"0\");\n        let pointsAvailable = 10;\n        let streakStatus = \"\";\n\n        if (daysDiff === 1) {\n          // Can continue streak\n          const nextStreak = currentStreak + 1;\n          pointsAvailable = 10 + Math.min(Math.floor(nextStreak / 7) * 5, 50);\n          streakStatus = `Continue your ${currentStreak} day streak`;\n        } else {\n          // Streak will reset\n          pointsAvailable = 10;\n          streakStatus = `Your ${currentStreak} day streak will reset`;\n        }\n\n        await storage.createNotification({\n          userId: address,\n          type: \"reward\",\n          title: \"üî• Daily Points Available!\",\n          message: `${streakStatus}! Claim ${pointsAvailable} points now by visiting the app. Don't miss out!`,\n          amount: pointsAvailable.toString(),\n          read: false,\n        });\n\n        await sendTelegramNotification(\n          address,\n          \"üî• Daily Points Available!\",\n          `${streakStatus}! Claim ${pointsAvailable} points now üéÅ`,\n          \"reward\",\n        );\n\n        return res.json({\n          hasUnclaimed: true,\n          pointsAvailable,\n          currentStreak,\n          willReset: daysDiff > 1,\n        });\n      }\n\n      res.json({ hasUnclaimed: false });\n    } catch (error) {\n      console.error(\"Check unclaimed error:\", error);\n      res.status(500).json({ error: \"Failed to check unclaimed points\" });\n    }\n  });\n\n  // Check and record daily login\n  app.post(\"/api/login-streak/check-in\", async (req, res) => {\n    try {\n      const { address, privyId } = req.body;\n\n      if (!privyId && !address) {\n        return res.status(400).json({ error: \"Either privyId or address is required\" });\n      }\n\n      // Get or create creator\n      let creator;\n      if (privyId) {\n        creator = await storage.getCreatorByPrivyId(privyId);\n        if (!creator && address) {\n          creator = await storage.getCreatorByAddress(address);\n        }\n\n        // If still no creator, create one for email users\n        if (!creator) {\n          console.log('Creating new creator for privyId:', privyId);\n          const { getDefaultUsername } = await import(\"./username-generator\");\n          const defaultUsername = getDefaultUsername(req.body.email, privyId);\n\n          creator = await storage.createCreator({\n            privyId,\n            address: address || null,\n            name: defaultUsername,\n            points: \"0\",\n          } as any);\n        }\n      } else if (address) {\n        creator = await storage.getCreatorByAddress(address);\n        if (!creator) {\n          creator = await storage.createCreator({\n            address,\n            name: `${address.slice(0, 6)}...${address.slice(-4)}`,\n            points: \"0\",\n          } as any);\n        }\n      }\n\n      if (!creator) {\n        return res.status(500).json({ error: \"Failed to create creator profile\" });\n      }\n\n      // Use creator's address for wallet users, or use a unique identifier for email users\n      // For email users without address, use privyId or id\n      const userId = creator.address && !creator.address.startsWith('email_')\n        ? creator.address\n        : creator.privyId || creator.id;\n\n      const result = await storage.checkInStreak(userId);\n\n      // Create welcome notification for first-time users\n      if (result.isFirstLogin) {\n        const welcomeNotification = {\n          userId,\n          type: 'reward',\n          title: 'üéâ Welcome to creatorland!',\n          message: `You've earned ${result.pointsEarned} E1XP as a welcome bonus! Start creating coins, and earning more rewards.`,\n          amount: result.pointsEarned.toString(),\n          read: false,\n        };\n        await storage.createNotification(welcomeNotification);\n\n        // Emit real-time notification via Socket.IO\n        const { emitNotificationToUser } = await import('./socket-server');\n        emitNotificationToUser(userId, welcomeNotification);\n      } else if (result.currentStreak > 1) {\n        // Create notification for streak achievement\n        const streakNotification = {\n          userId,\n          type: 'streak',\n          title: `üî• ${result.currentStreak} Day Streak!`,\n          message: `Amazing! You've earned ${result.pointsEarned} E1XP for your ${result.currentStreak} day streak! Keep it going! üí™`,\n          amount: result.pointsEarned.toString(),\n          read: false,\n        };\n        await storage.createNotification(streakNotification);\n\n        // Emit real-time notification via Socket.IO\n        const { emitNotificationToUser } = await import('./socket-server');\n        emitNotificationToUser(userId, streakNotification);\n      }\n\n      res.json({\n        ...result,\n        isFirstLogin: result.isFirstLogin || false,\n        pointsEarned: result.pointsEarned || 0,\n        alreadyCheckedIn: false // Explicitly set to false for successful check-ins\n      });\n    } catch (error: any) {\n      console.error(\"Login streak check-in error:\", error);\n      if (error.message && error.message.includes(\"already checked in\")) {\n        return res.status(200).json({ \n          alreadyCheckedIn: true,\n          error: error.message,\n          currentStreak: 0, // Return 0 for streak and points if already checked in\n          pointsEarned: 0\n        });\n      }\n      res.status(500).json({ error: \"Failed to check in\" });\n    }\n  });\n\n  // Get activity events from blockchain\n  app.get(\"/api/blockchain/activity-events\", async (req, res) => {\n    try {\n      const { activityTrackerService } = await import(\"./activity-tracker.js\");\n      const fromBlock = req.query.fromBlock\n        ? BigInt(req.query.fromBlock as string)\n        : 0n;\n      const events = await activityTrackerService.getActivityEvents(fromBlock);\n\n      res.json({\n        success: true,\n        events: events.map((log) => ({\n          blockNumber: log.blockNumber?.toString(),\n          transactionHash: log.transactionHash,\n          args: log.args,\n        })),\n      });\n    } catch (error) {\n      console.error(\"Get activity events error:\", error);\n      res.status(500).json({ error: \"Failed to get activity events\" });\n    }\n  });\n\n  // Blockchain metrics endpoints\n  app.get(\"/api/blockchain/platform-stats\", async (_req, res) => {\n    try {\n      const { activityTrackerService } = await import(\"./activity-tracker.js\");\n      const stats = await activityTrackerService.getPlatformStats();\n\n      if (!stats) {\n        return res.json({\n          totalCoins: 0,\n          totalPlatformFees: \"0\",\n          totalCreatorFees: \"0\",\n          totalVolume: \"0\",\n          totalCreators: 0,\n        });\n      }\n\n      res.json({\n        totalCoins: stats.totalCoins.toString(),\n        totalPlatformFees: stats.totalPlatformFees.toString(),\n        totalCreatorFees: stats.totalCreatorFees.toString(),\n        totalVolume: stats.totalVolume.toString(),\n        totalCreators: stats.totalCreators.toString(),\n      });\n    } catch (error) {\n      console.error(\"Get platform stats error:\", error);\n      res.status(500).json({ error: \"Failed to get platform stats\" });\n    }\n  });\n\n  app.get(\"/api/blockchain/coin-metrics/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const { activityTrackerService } = await import(\"./activity-tracker.js\");\n      const metrics = await activityTrackerService.getCoinMetrics(\n        address as `0x${string}`,\n      );\n\n      if (!metrics) {\n        return res.json({\n          totalCreatorFees: \"0\",\n          totalPlatformFees: \"0\",\n          currentMarketCap: \"0\",\n          totalVolume: \"0\",\n          tradeCount: \"0\",\n          lastUpdated: \"0\",\n        });\n      }\n\n      res.json({\n        totalCreatorFees: metrics.totalCreatorFees.toString(),\n        totalPlatformFees: metrics.totalPlatformFees.toString(),\n        currentMarketCap: metrics.currentMarketCap.toString(),\n        totalVolume: metrics.totalVolume.toString(),\n        tradeCount: metrics.tradeCount.toString(),\n        lastUpdated: metrics.lastUpdated.toString(),\n      });\n    } catch (error) {\n      console.error(\"Get coin metrics error:\", error);\n      res.status(500).json({ error: \"Failed to get coin metrics\" });\n    }\n  });\n\n  app.get(\"/api/blockchain/creator-stats/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const { activityTrackerService } = await import(\"./activity-tracker.js\");\n      const stats = await activityTrackerService.getCreatorStats(\n        address as `0x${string}`,\n      );\n\n      if (!stats) {\n        return res.json({\n          coinsCreated: \"0\",\n          totalFeesEarned: \"0\",\n        });\n      }\n\n      res.json({\n        coinsCreated: stats.coinsCreated.toString(),\n        totalFeesEarned: stats.totalFeesEarned.toString(),\n      });\n    } catch (error) {\n      console.error(\"Get creator stats error:\", error);\n      res.status(500).json({ error: \"Failed to get creator stats\" });\n    }\n  });\n\n  // === NOTIFICATION SERVICE ENDPOINTS ===\n\n  // Send test notification\n  app.post(\"/api/notifications/send-test\", async (req, res) => {\n    try {\n      const { type, title, message, address } = req.body;\n\n      // Validate required fields\n      if (!type || !title || !message) {\n        return res.status(400).json({\n          error: \"Missing required fields: type, title, and message are required\"\n        });\n      }\n\n      let notificationCount = 0;\n\n      if (address === \"all\") {\n        // Send to all users\n        try {\n          const creators = await storage.getAllCreators();\n\n          for (const creator of creators) {\n            try {\n              await storage.createNotification({\n                userId: creator.address,\n                type: type,\n                title: title,\n                message: message,\n                read: false,\n              });\n              notificationCount++;\n\n              // Try to send Telegram notification, but don't fail if it errors\n              try {\n                await sendTelegramNotification(creator.address, title, message, type);\n              } catch (telegramError) {\n                console.error(`Telegram notification failed for ${creator.address}:`, telegramError);\n              }\n            } catch (notifError) {\n              console.error(`Failed to create notification for ${creator.address}:`, notifError);\n            }\n          }\n        } catch (dbError) {\n          console.error(\"Database error fetching creators:\", dbError);\n          return res.status(500).json({\n            error: \"Database connection failed. Please check your database configuration.\",\n            details: dbError instanceof Error ? dbError.message : String(dbError)\n          });\n        }\n      } else if (address) {\n        // Send to specific user\n        try {\n          await storage.createNotification({\n            userId: address,\n            type: type,\n            title: title,\n            message: message,\n            read: false,\n          });\n          notificationCount++;\n\n          // Try to send Telegram notification, but don't fail if it errors\n          try {\n            await sendTelegramNotification(address, title, message, type);\n          } catch (telegramError) {\n            console.error(`Telegram notification failed for ${address}:`, telegramError);\n          }\n        } catch (dbError) {\n          console.error(\"Database error creating notification:\", dbError);\n          return res.status(500).json({\n            error: \"Database connection failed. Please check your database configuration.\",\n            details: dbError instanceof Error ? dbError.message : String(dbError)\n          });\n        }\n      } else {\n        return res.status(400).json({\n          error: \"Missing address field. Provide a specific address or 'all' to send to all users.\"\n        });\n      }\n\n      res.json({\n        success: true,\n        message: `Test notification sent successfully to ${notificationCount} user(s)`\n      });\n    } catch (error) {\n      console.error(\"Send test notification error:\", error);\n      res.status(500).json({\n        error: \"Failed to send test notification\",\n        details: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Send all periodic notifications (top creators, earners, coins, points, trades)\n  app.post(\"/api/notifications/send-all\", async (_req, res) => {\n    try {\n      const { notificationService } = await import(\"./notification-service\");\n      await notificationService.sendAllPeriodicNotifications();\n      res.json({ success: true, message: \"All periodic notifications sent\" });\n    } catch (error) {\n      console.error(\"Send all notifications error:\", error);\n      res.status(500).json({ error: \"Failed to send notifications\" });\n    }\n  });\n\n  // Send top creators notification\n  app.post(\"/api/notifications/top-creators\", async (_req, res) => {\n    try {\n      const { notificationService } = await import(\"./notification-service\");\n      await notificationService.sendTopCreatorsNotification();\n      res.json({ success: true, message: \"Top creators notification sent\" });\n    } catch (error) {\n      console.error(\"Send top creators notification error:\", error);\n      res\n        .status(500)\n        .json({ error: \"Failed to send notification\" });\n    }\n  });\n\n  // Send top earners notification (with optional time period)\n  app.post(\"/api/notifications/top-earners\", async (req, res) => {\n    try {\n      const hours = parseInt(req.body.hours) || undefined; // 10, 24, 72, etc.\n      const { notificationService } = await import(\"./notification-service\");\n      await notificationService.sendTopEarnersNotification(hours);\n      res.json({\n        success: true,\n        message: `Top earners notification sent${hours ? ` for ${hours}h` : \"\"}`,\n      });\n    } catch (error) {\n      console.error(\"Send top earners notification error:\", error);\n      res\n        .status(500)\n        .json({ error: \"Failed to send notification\" });\n    }\n  });\n\n  // Send top coins notification\n  app.post(\"/api/notifications/top-coins\", async (_req, res) => {\n    try {\n      const { notificationService } = await import(\"./notification-service\");\n      await notificationService.sendTopCoinsNotification();\n      res.json({ success: true, message: \"Top coins notification sent\" });\n    } catch (error) {\n      console.error(\"Send top coins notification error:\", error);\n      res.status(500).json({ error: \"Failed to send notification\" });\n    }\n  });\n\n  // Send trending coins notification\n  app.post(\"/api/notifications/trending-coins\", async (_req, res) => {\n    try {\n      const { checkAndNotifyTrendingCoins } = await import(\n        \"./trending-notifications\"\n      );\n      await checkAndNotifyTrendingCoins();\n      res.json({ success: true, message: \"Trending coins notification sent\" });\n    } catch (error) {\n      console.error(\"Send trending coins notification error:\", error);\n      res\n        .status(500)\n        .json({ error: \"Failed to send trending coins notification\" });\n    }\n  });\n\n  // Send recent trades notification\n  app.post(\"/api/notifications/recent-trades\", async (_req, res) => {\n    try {\n      const { notificationService } = await import(\"./notification-service\");\n      await notificationService.sendRecentTradesNotification();\n      res.json({ success: true, message: \"Recent trades notification sent\" });\n    } catch (error) {\n      console.error(\"Send recent trades notification error:\", error);\n      res\n        .status(500)\n        .json({ error: \"Failed to send recent trades notification\" });\n    }\n  });\n\n  // Remind users about unclaimed daily points\n  app.post(\"/api/notifications/remind-unclaimed-points\", async (_req, res) => {\n    try {\n      const creators = await storage.getAllCreators();\n      const today = new Date().toISOString().split(\"T\")[0];\n      let reminderCount = 0;\n\n      for (const creator of creators) {\n        const loginStreak = await storage.getLoginStreak(creator.address);\n\n        if (!loginStreak || loginStreak.lastLoginDate !== today) {\n          const pointsAvailable = loginStreak\n            ? 10 +\n              Math.min(\n                Math.floor(\n                  (parseInt(loginStreak.currentStreak || \"0\") + 1) / 7,\n                ) * 5,\n                50,\n              )\n            : 10;\n\n          await storage.createNotification({\n            userId: creator.address,\n            type: \"reward\",\n            title: \"üéÅ Don't Forget Your Daily E1XP!\",\n            message: `You have ${pointsAvailable} E1XP points waiting to be claimed! Visit the app now to keep your streak alive.`,\n            amount: pointsAvailable.toString(),\n            read: false,\n          });\n          reminderCount++;\n        }\n      }\n\n      res.json({\n        success: true,\n        message: `Sent ${reminderCount} unclaimed points reminders`,\n      });\n    } catch (error) {\n      console.error(\"Send unclaimed points reminder error:\", error);\n      res\n        .status(500)\n        .json({ error: \"Failed to send unclaimed points reminders\" });\n    }\n  });\n\n  // Warn users about streak reset\n  app.post(\"/api/notifications/remind-streak-reset\", async (_req, res) => {\n    try {\n      const creators = await storage.getAllCreators();\n      const today = new Date().toISOString().split(\"T\")[0];\n      let warningCount = 0;\n\n      for (const creator of creators) {\n        const loginStreak = await storage.getLoginStreak(creator.address);\n\n        if (loginStreak && loginStreak.lastLoginDate !== today) {\n          const lastLogin = new Date(loginStreak.lastLoginDate);\n          const todayDate = new Date(today);\n          const daysDiff = Math.floor(\n            (todayDate.getTime() - lastLogin.getTime()) / (1000 * 60 * 60 * 24),\n          );\n\n          if (\n            daysDiff === 1 &&\n            parseInt(loginStreak.currentStreak || \"0\") > 3\n          ) {\n            await storage.createNotification({\n              userId: creator.address,\n              type: \"reward\",\n              title: \"‚ö†Ô∏è Your Streak Is About To Reset!\",\n              message: `Your ${loginStreak.currentStreak} day streak will reset at midnight! Claim your daily E1XP now to keep it going.`,\n              read: false,\n            });\n            warningCount++;\n          }\n        }\n      }\n\n      res.json({\n        success: true,\n        message: `Sent ${warningCount} streak reset warnings`,\n      });\n    } catch (error) {\n      console.error(\"Send streak reset warning error:\", error);\n      res.status(500).json({ error: \"Failed to send streak reset warnings\" });\n    }\n  });\n\n  // Welcome new users\n  app.post(\"/api/notifications/welcome-new-users\", async (_req, res) => {\n    try {\n      const creators = await storage.getAllCreators();\n      let welcomeCount = 0;\n\n      for (const creator of creators) {\n        const loginStreak = await storage.getLoginStreak(creator.address);\n\n        if (!loginStreak) {\n          await storage.createNotification({\n            userId: creator.address,\n            type: \"reward\",\n            title: \"üéâ Welcome to the Platform!\",\n            message:\n              \"Claim your 10 E1XP welcome bonus now! Start your daily login streak and earn even more points.\",\n            amount: \"10\",\n            read: false,\n          });\n          welcomeCount++;\n        }\n      }\n\n      res.json({\n        success: true,\n        message: `Sent ${welcomeCount} welcome notifications`,\n      });\n    } catch (error) {\n      console.error(\"Send welcome notifications error:\", error);\n      res.status(500).json({ error: \"Failed to send welcome notifications\" });\n    }\n  });\n\n  // Promote new coins\n  app.post(\"/api/notifications/promote-new-coins\", async (_req, res) => {\n    try {\n      const coins = await storage.getAllCoins();\n      const recentCoins = coins\n        .filter((c) => c.status === \"active\" && c.address)\n        .sort(\n          (a, b) =>\n            new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime(),\n        )\n        .slice(0, 5);\n\n      if (recentCoins.length === 0) {\n        return res.json({ success: true, message: \"No new coins to promote\" });\n      }\n\n      const creators = await storage.getAllCreators();\n      let notificationCount = 0;\n\n      for (const creator of creators) {\n        const coinsList = recentCoins.map((c) => c.symbol).join(\", \");\n\n        await storage.createNotification({\n          userId: creator.address,\n          type: \"coin_created\",\n          title: \"üöÄ Fresh Coins Just Dropped!\",\n          message: `Check out these new coins: ${coinsList}. Trade early and earn rewards!`,\n          read: false,\n        });\n        notificationCount++;\n      }\n\n      res.json({\n        success: true,\n        message: `Promoted ${recentCoins.length} coins to ${notificationCount} users`,\n      });\n    } catch (error) {\n      console.error(\"Promote new coins error:\", error);\n      res.status(500).json({ error: \"Failed to promote new coins\" });\n    }\n  });\n\n  // Get current user session and ensure creator exists\n  app.get(\"/api/auth/session\", async (req, res) => {\n    if (req.session?.user) {\n      res.json({ authenticated: true, user: req.session.user });\n    } else {\n      res.json({ authenticated: false });\n    }\n  });\n\n  // Endpoint to ensure user exists in database after Privy auth\n  app.post(\"/api/auth/ensure-user\", async (req, res) => {\n    try {\n      const { address, username } = req.body;\n\n      if (!address) {\n        return res.status(400).json({ error: 'Address is required' });\n      }\n\n      let creator = await storage.getCreatorByAddress(address);\n      const isNewUser = !creator;\n\n      if (!creator) {\n        // Auto-create creator for new authenticated user\n        creator = await storage.createCreator({\n          address: address,\n          name: username || null,\n          bio: null,\n          avatar: null,\n          verified: \"false\",\n          totalCoins: \"0\",\n          totalVolume: \"0\",\n          followers: \"0\",\n          points: \"100\", // Welcome bonus\n        } as any);\n        console.log(`[AUTH] Created creator record for new user: ${address}`);\n\n        // Send welcome notification with E1XP bonus\n        try {\n          await storage.createNotification({\n            userId: address,\n            type: 'reward',\n            title: 'üéâ Welcome to Every1Fun!',\n            message: 'You received 100 E1XP as a welcome bonus! Start creating coins to earn more.',\n            amount: '100',\n            read: false,\n          } as any);\n        } catch (notifError) {\n          console.error(`[AUTH] Failed to send welcome notification:`, notifError);\n        }\n\n        // Create initial login streak\n        try {\n          const today = new Date().toISOString().split('T')[0];\n          await storage.createLoginStreak({\n            userId: address,\n            currentStreak: \"1\",\n            longestStreak: \"1\",\n            lastLoginDate: today,\n            totalPoints: \"10\",\n            loginDates: [today],\n          } as any);\n        } catch (streakError) {\n          console.error(`[AUTH] Failed to create login streak:`, streakError);\n        }\n      }\n\n      res.json({ success: true, isNewUser, creator });\n    } catch (error) {\n      console.error('[AUTH] Error ensuring user exists:', error);\n      res.status(500).json({ error: 'Failed to ensure user exists' });\n    }\n  });\n\n  // OG Meta endpoint\n  app.get(\"/api/og-meta/:type/:id\", async (req, res) => {\n    try {\n      const { type, id } = req.params;\n      const baseUrl = `${req.protocol}://${req.get(\"host\")}`;\n\n      let meta;\n      switch (type) {\n        case \"profile\": {\n          const creator = await storage.getCreatorById(id);\n          if (!creator) return res.status(404).json({ error: \"Creator not found\" });\n          meta = generateProfileOGMeta(creator, baseUrl);\n          break;\n        }\n        case \"coin\": {\n          const coin = await storage.getCoinById(id);\n          if (!coin) return res.status(404).json({ error: \"Coin not found\" });\n          meta = generateCoinOGMeta(coin, baseUrl);\n          break;\n        }\n        case \"project\": {\n          const project = await storage.getProjectById(id);\n          if (!project) return res.status(404).json({ error: \"Project not found\" });\n          meta = generateProjectOGMeta(project, baseUrl);\n          break;\n        }\n        case \"referral\": {\n          // id is the referral code\n          const creator = await storage.getCreatorByReferralCode(id);\n          if (!creator) return res.status(404).json({ error: \"Referral code not found\" });\n          meta = generateReferralOGMeta(creator, baseUrl);\n          break;\n        }\n        default:\n          return res.status(400).json({ error: \"Invalid type\" });\n      }\n\n      res.json(meta);\n    } catch (error) {\n      console.error(\"OG meta error:\", error);\n      res.status(500).json({ error: \"Failed to generate OG meta\" });\n    }\n  });\n\n  // Admin routes - these will be handled by the catch-all route below\n  // No need for specific handlers, the React app routing will handle these paths\n\n  // ===== COMMENT REACTIONS =====\n  app.post(\"/api/comments/:commentId/reactions\", walletAuthMiddleware, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { commentId } = req.params;\n      const { emoji } = req.body;\n      const userAddress = req.userAddress;\n\n      if (!userAddress) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const reaction = await storage.addCommentReaction({\n        commentId,\n        userAddress,\n        emoji,\n      });\n\n      res.json(reaction);\n    } catch (error: any) {\n      console.error(\"Error adding comment reaction:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/comments/:commentId/reactions/:emoji\", walletAuthMiddleware, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { commentId, emoji } = req.params;\n      const userAddress = req.userAddress;\n\n      if (!userAddress) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      await storage.removeCommentReaction(commentId, userAddress, emoji);\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Error removing comment reaction:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/comments/:commentId/reactions\", async (req, res) => {\n    try {\n      const { commentId } = req.params;\n      const reactions = await storage.getCommentReactions(commentId);\n      res.json(reactions);\n    } catch (error: any) {\n      console.error(\"Error fetching comment reactions:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ===== USER BADGES =====\n  app.get(\"/api/users/:userId/badges\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const badges = await storage.getUserBadges(userId);\n      res.json(badges);\n    } catch (error: any) {\n      console.error(\"Error fetching user badges:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ===== TRADE HISTORY =====\n  app.post(\"/api/trades\", walletAuthMiddleware, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userAddress = req.userAddress;\n      if (!userAddress) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const trade = await storage.recordTrade({\n        userAddress,\n        ...req.body,\n      });\n\n      res.json(trade);\n    } catch (error: any) {\n      console.error(\"Error recording trade:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/trades/user/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const limit = parseInt(req.query.limit as string) || 50;\n      const trades = await storage.getUserTradeHistory(address, limit);\n      res.json(trades);\n    } catch (error: any) {\n      console.error(\"Error fetching user trade history:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/trades/coin/:address\", async (req, res) => {\n    try {\n      const { address } = req.params;\n      const limit = parseInt(req.query.limit as string) || 50;\n      const trades = await storage.getCoinTradeHistory(address, limit);\n      res.json(trades);\n    } catch (error: any) {\n      console.error(\"Error fetching coin trade history:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ===== CREATOR STORIES =====\n  app.post(\"/api/stories\", walletAuthMiddleware, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userAddress = req.userAddress;\n      if (!userAddress) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const story = await storage.createStory({\n        creatorAddress: userAddress,\n        ...req.body,\n      });\n\n      res.json(story);\n    } catch (error: any) {\n      console.error(\"Error creating story:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/stories\", async (req, res) => {\n    try {\n      const { creator } = req.query;\n      const stories = await storage.getActiveStories(creator as string | undefined);\n      res.json(stories);\n    } catch (error: any) {\n      console.error(\"Error fetching stories:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/stories/:storyId/view\", walletAuthMiddleware, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { storyId } = req.params;\n      const userAddress = req.userAddress;\n\n      if (!userAddress) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      await storage.recordStoryView(storyId, userAddress);\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Error recording story view:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/stories/:storyId/views\", async (req, res) => {\n    try {\n      const { storyId } = req.params;\n      const views = await storage.getStoryViews(storyId);\n      res.json(views);\n    } catch (error: any) {\n      console.error(\"Error fetching story views:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ===== SEARCH HISTORY & AUTOCOMPLETE =====\n  app.post(\"/api/search\", async (req, res) => {\n    try {\n      const search = await storage.recordSearch(req.body);\n      res.json(search);\n    } catch (error: any) {\n      console.error(\"Error recording search:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/search/popular\", async (req, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 10;\n      const searches = await storage.getPopularSearches(limit);\n      res.json(searches);\n    } catch (error: any) {\n      console.error(\"Error fetching popular searches:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/search/history\", walletAuthMiddleware, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userAddress = req.userAddress;\n      if (!userAddress) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const limit = parseInt(req.query.limit as string) || 20;\n      const history = await storage.getUserSearchHistory(userAddress, limit);\n      res.json(history);\n    } catch (error: any) {\n      console.error(\"Error fetching search history:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ===== MESSAGING ENDPOINTS =====\n  app.get(\"/api/messages/unread-count\", walletAuthMiddleware, async (req: AuthenticatedRequest, res) => {\n    try {\n      const userAddress = req.userAddress;\n      if (!userAddress) {\n        return res.json({ count: 0 });\n      }\n\n      // Get all conversations to count total unread messages\n      const conversations = await storage.getUserConversations(userAddress.toLowerCase());\n      let totalUnread = 0;\n\n      for (const conv of conversations) {\n        const unreadCount = await storage.getUnreadMessageCount(userAddress.toLowerCase(), conv.otherUserId);\n        totalUnread += unreadCount;\n      }\n\n      res.json({ count: totalUnread });\n    } catch (error: any) {\n      console.error(\"Error fetching unread message count:\", error);\n      res.status(500).json({ error: error.message, count: 0 });\n    }\n  });\n\n  // Register E1XP routes\n  const { createE1XPRouter } = await import('./routes/e1xp');\n  app.use('/api/e1xp', createE1XPRouter(storage as any));\n\n  // Register Zora explore routes\n  const { registerZoraExploreRoutes } = await import('./routes/zora-explore');\n  registerZoraExploreRoutes(app);\n\n  const httpServer = createServer(app);\n  return httpServer;\n}","size_bytes":110394},"server/activity-tracker-service.ts":{"content":"import { createPublicClient, createWalletClient, http, Hash } from \"viem\";\nimport { base, baseSepolia } from \"viem/chains\";\nimport { privateKeyToAccount } from \"viem/accounts\";\nimport type { Coin } from \"@shared/schema\";\n\nconst ACTIVITY_TRACKER_ADDRESS = process.env.VITE_ACTIVITY_TRACKER_ADDRESS || \"0x0000000000000000000000000000000000000000\";\n\nconst ACTIVITY_TRACKER_ABI = [\n  {\n    inputs: [\n      { name: \"coin\", type: \"address\" },\n      { name: \"creator\", type: \"address\" },\n      { name: \"contentUrl\", type: \"string\" },\n      { name: \"coinName\", type: \"string\" },\n      { name: \"coinSymbol\", type: \"string\" },\n      { name: \"createdAtTimestamp\", type: \"uint256\" }\n    ],\n    name: \"recordCoinCreation\",\n    outputs: [{ name: \"activityId\", type: \"bytes32\" }],\n    stateMutability: \"nonpayable\",\n    type: \"function\"\n  },\n  {\n    inputs: [{ name: \"coinAddress\", type: \"address\" }],\n    name: \"isRegisteredCoin\",\n    outputs: [{ name: \"\", type: \"bool\" }],\n    stateMutability: \"view\",\n    type: \"function\"\n  }\n] as const;\n\nexport class ActivityTrackerService {\n  private publicClient: any;\n  private walletClient: any;\n  private chainId: number;\n\n  constructor(chainId: number = base.id) {\n    this.chainId = chainId;\n    const chain = chainId === baseSepolia.id ? baseSepolia : base;\n\n    const alchemyApiKey = process.env.VITE_ALCHEMY_API_KEY || \"o3VW3WRXrsXXMRX3l7jZxLUqhWyZzXBy\";\n    const rpcUrl = `https://base-mainnet.g.alchemy.com/v2/${alchemyApiKey}`;\n\n    this.publicClient = createPublicClient({\n      chain,\n      transport: http(rpcUrl),\n    });\n\n    const privateKey = process.env.PLATFORM_PRIVATE_KEY;\n    if (privateKey) {\n      const account = privateKeyToAccount(privateKey as `0x${string}`);\n      this.walletClient = createWalletClient({\n        account,\n        chain,\n        transport: http(rpcUrl),\n      });\n    }\n  }\n\n  async recordCoinBatch(coins: Coin[]): Promise<Map<number, Hash>> {\n    const results = new Map<number, Hash>();\n\n    if (!this.walletClient) {\n      console.error(\"‚ùå Wallet client not configured. Set PLATFORM_PRIVATE_KEY environment variable.\");\n      return results;\n    }\n\n    if (!ACTIVITY_TRACKER_ADDRESS || ACTIVITY_TRACKER_ADDRESS === \"0x0000000000000000000000000000000000000000\") {\n      console.error(\"‚ùå Activity tracker address not configured. Set VITE_ACTIVITY_TRACKER_ADDRESS environment variable.\");\n      return results;\n    }\n\n    if (coins.length === 0) {\n      console.log(\"‚ÑπÔ∏è No coins to record on activity tracker\");\n      return results;\n    }\n\n    try {\n      console.log(`üìä Checking ${coins.length} coins for activity tracker recording...`);\n\n      let alreadyRegisteredCount = 0;\n      let recordedCount = 0;\n      let failedCount = 0;\n      const unrecordedCoins: Coin[] = []; // To store coins that are not yet registered\n\n      // Check registration status and filter out already registered coins\n      for (const coin of coins) {\n        if (!coin.address) {\n          console.warn(`‚ö†Ô∏è Skipping coin ${coin.id} - no address`);\n          failedCount++;\n          continue;\n        }\n\n        if (!coin.creator_wallet) {\n          console.warn(`‚ö†Ô∏è Skipping coin ${coin.id} - no creator wallet`);\n          failedCount++;\n          continue;\n        }\n\n        try {\n          const isRegistered = await this.publicClient.readContract({\n            address: ACTIVITY_TRACKER_ADDRESS as `0x${string}`,\n            abi: ACTIVITY_TRACKER_ABI,\n            functionName: 'isRegisteredCoin',\n            args: [coin.address as `0x${string}`],\n          });\n\n          if (isRegistered) {\n            console.log(`‚úÖ ${coin.symbol} (${coin.address}) is already registered on-chain`);\n            alreadyRegisteredCount++;\n            // Mark as recorded in our DB by returning the coin address as a pseudo-hash\n            results.set(coin.id, coin.address as Hash);\n          } else {\n            unrecordedCoins.push(coin);\n          }\n        } catch (error: any) {\n          console.error(`‚ùå Error checking registration status for ${coin.symbol} (${coin.address}):`, error.message || error);\n          failedCount++;\n        }\n      }\n\n      // Record each unrecorded coin individually\n      for (const coin of unrecordedCoins) {\n        try {\n        // Validate required fields\n        if (!coin.address || !coin.creator_wallet || !coin.name || !coin.symbol) {\n          console.error(`‚ùå Missing required fields for coin ${coin.symbol || 'unknown'}`);\n          console.error(`   Address: ${coin.address}, Creator: ${coin.creator_wallet}`);\n          console.error(`   Name: ${coin.name}, Symbol: ${coin.symbol}`);\n          failedCount++;\n          continue;\n        }\n\n        console.log(`üîÑ Recording ${coin.symbol} (${coin.address})...`);\n        \n        // Get the createdAt timestamp or use current time as fallback\n        const createdAtTimestamp = coin.createdAt \n          ? BigInt(Math.floor(new Date(coin.createdAt).getTime() / 1000))\n          : BigInt(Math.floor(Date.now() / 1000));\n\n        const txHash = await this.publicClient.simulateContract({\n          address: ACTIVITY_TRACKER_ADDRESS as `0x${string}`,\n          abi: ACTIVITY_TRACKER_ABI,\n          functionName: 'recordCoinCreation',\n          args: [\n            coin.address as `0x${string}`,\n            coin.creator_wallet as `0x${string}`,\n            coin.ipfsUri || coin.image || '',\n            coin.name,\n            coin.symbol,\n            createdAtTimestamp\n          ],\n          account: this.walletClient.account,\n        });\n\n        const hash = await this.walletClient.writeContract(txHash.request);\n        console.log(`üì§ Activity tracker transaction sent for ${coin.symbol}: ${hash}`);\n\n        const receipt = await this.publicClient.waitForTransactionReceipt({\n          hash,\n          confirmations: 1\n        });\n\n        if (receipt.status === 'success') {\n          results.set(coin.id, hash);\n          recordedCount++;\n          console.log(`‚úÖ Successfully recorded ${coin.symbol} on activity tracker with tx: ${hash}`);\n        } else {\n          console.error(`‚ùå Activity tracker transaction failed for ${coin.symbol}`);\n          failedCount++;\n        }\n        } catch (error: any) {\n          console.error(`‚ùå Error recording individual coin ${coin.symbol}:`, error.message || error);\n          failedCount++;\n        }\n      }\n\n      console.log(`üìä Activity Tracker Sync Summary:`);\n      console.log(`  ‚úÖ Already registered: ${alreadyRegisteredCount}`);\n      console.log(`  üÜï Newly recorded: ${recordedCount}`);\n      console.log(`  ‚ùå Failed: ${failedCount}`);\n      console.log(`  üìù Total processed: ${coins.length}`);\n\n      return results;\n    } catch (error: any) {\n      console.error(`‚ùå Error recording coins to activity tracker:`, error.message || error);\n      console.error(`   Failed coins: ${failedCount}/${unrecordedCoins.length}`);\n      console.error(`   Results collected: ${results.size}`);\n\n      // Don't throw - return partial results instead\n      return results;\n    }\n  }\n\n  async recordSingleCoin(coin: Coin): Promise<Hash | null> {\n    const results = await this.recordCoinBatch([coin]);\n    return results.get(coin.id) || null;\n  }\n}","size_bytes":7196},"shared/platform-config.ts":{"content":"export type PlatformCategory = \n  | 'gitcoin'\n  | 'youtube'\n  | 'behance'\n  | 'github'\n  | 'twitter'\n  | 'farcaster'\n  | 'lens'\n  | 'discord'\n  | 'telegram'\n  | 'devpost'\n  | 'dribbble'\n  | 'medium'\n  | 'other';\n\nexport interface PlatformInfo {\n  category: PlatformCategory;\n  icon: string;\n  color: string;\n}\n\nexport const PLATFORM_CONFIGS: Record<PlatformCategory, PlatformInfo> = {\n  gitcoin: {\n    category: 'gitcoin',\n    icon: 'üéØ',\n    color: '#0E76FD'\n  },\n  youtube: {\n    category: 'youtube',\n    icon: '‚ñ∂Ô∏è',\n    color: '#FF0000'\n  },\n  behance: {\n    category: 'behance',\n    icon: 'üé®',\n    color: '#053EFF'\n  },\n  github: {\n    category: 'github',\n    icon: 'üíª',\n    color: '#171515'\n  },\n  twitter: {\n    category: 'twitter',\n    icon: 'üê¶',\n    color: '#1DA1F2'\n  },\n  farcaster: {\n    category: 'farcaster',\n    icon: 'üì°',\n    color: '#855DCD'\n  },\n  lens: {\n    category: 'lens',\n    icon: 'üåø',\n    color: '#00501E'\n  },\n  discord: {\n    category: 'discord',\n    icon: 'üí¨',\n    color: '#5865F2'\n  },\n  telegram: {\n    category: 'telegram',\n    icon: 'üì¨',\n    color: '#26A5E4'\n  },\n  devpost: {\n    category: 'devpost',\n    icon: 'üöÄ',\n    color: '#003E54'\n  },\n  dribbble: {\n    category: 'dribbble',\n    icon: 'üèÄ',\n    color: '#EA4C89'\n  },\n  medium: {\n    category: 'medium',\n    icon: 'üìù',\n    color: '#000000'\n  },\n  other: {\n    category: 'other',\n    icon: 'üîó',\n    color: '#6B7280'\n  }\n};","size_bytes":1448},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n  accessToken?: string | null,\n): Promise<Response> {\n  const headers: Record<string, string> = data ? { \"Content-Type\": \"application/json\" } : {};\n  \n  if (accessToken) {\n    headers.Authorization = `Bearer ${accessToken}`;\n  }\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1538},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"server/routes/zora-explore.ts":{"content":"\nimport { Router } from \"express\";\nimport {\n  getCoinsTopGainers,\n  getCoinsTopVolume24h,\n  getCoinsMostValuable,\n  getCoinsNew,\n  getCreatorCoins,\n  getMostValuableCreatorCoins,\n} from \"@zoralabs/coins-sdk\";\n\nexport function registerZoraExploreRoutes(app: Router) {\n  // Get top gaining coins from Zora\n  app.get(\"/api/zora/coins/top-gainers\", async (req, res) => {\n    try {\n      const count = parseInt(req.query.count as string) || 20;\n      const after = req.query.after as string | undefined;\n\n      const response = await getCoinsTopGainers({ count, after });\n      const coins = response.data?.exploreList?.edges?.map((edge: any) => edge.node) || [];\n      const pageInfo = response.data?.exploreList?.pageInfo;\n\n      res.json({ coins, pageInfo });\n    } catch (error: any) {\n      console.error(\"Error fetching top gainers from Zora:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch top gainers\" });\n    }\n  });\n\n  // Get top volume coins from Zora\n  app.get(\"/api/zora/coins/top-volume\", async (req, res) => {\n    try {\n      const count = parseInt(req.query.count as string) || 20;\n      const after = req.query.after as string | undefined;\n\n      const response = await getCoinsTopVolume24h({ count, after });\n      const coins = response.data?.exploreList?.edges?.map((edge: any) => edge.node) || [];\n      const pageInfo = response.data?.exploreList?.pageInfo;\n\n      res.json({ coins, pageInfo });\n    } catch (error: any) {\n      console.error(\"Error fetching top volume from Zora:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch top volume coins\" });\n    }\n  });\n\n  // Get most valuable coins from Zora\n  app.get(\"/api/zora/coins/most-valuable\", async (req, res) => {\n    try {\n      const count = parseInt(req.query.count as string) || 20;\n      const after = req.query.after as string | undefined;\n\n      const response = await getCoinsMostValuable({ count, after });\n      const coins = response.data?.exploreList?.edges?.map((edge: any) => edge.node) || [];\n      const pageInfo = response.data?.exploreList?.pageInfo;\n\n      res.json({ coins, pageInfo });\n    } catch (error: any) {\n      console.error(\"Error fetching most valuable from Zora:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch most valuable coins\" });\n    }\n  });\n\n  // Get new coins from Zora\n  app.get(\"/api/zora/coins/new\", async (req, res) => {\n    try {\n      const count = parseInt(req.query.count as string) || 20;\n      const after = req.query.after as string | undefined;\n\n      const response = await getCoinsNew({ count, after });\n      const coins = response.data?.exploreList?.edges?.map((edge: any) => edge.node) || [];\n      const pageInfo = response.data?.exploreList?.pageInfo;\n\n      res.json({ coins, pageInfo });\n    } catch (error: any) {\n      console.error(\"Error fetching new coins from Zora:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch new coins\" });\n    }\n  });\n\n  // Get creator coins from Zora\n  app.get(\"/api/zora/creators/coins\", async (req, res) => {\n    try {\n      const count = parseInt(req.query.count as string) || 20;\n      const after = req.query.after as string | undefined;\n\n      const response = await getCreatorCoins({ count, after });\n      const coins = response.data?.exploreList?.edges?.map((edge: any) => edge.node) || [];\n      const pageInfo = response.data?.exploreList?.pageInfo;\n\n      res.json({ coins, pageInfo });\n    } catch (error: any) {\n      console.error(\"Error fetching creator coins from Zora:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch creator coins\" });\n    }\n  });\n\n  // Get most valuable creator coins from Zora\n  app.get(\"/api/zora/creators/most-valuable\", async (req, res) => {\n    try {\n      const count = parseInt(req.query.count as string) || 20;\n      const after = req.query.after as string | undefined;\n\n      const response = await getMostValuableCreatorCoins({ count, after });\n      const coins = response.data?.exploreList?.edges?.map((edge: any) => edge.node) || [];\n      const pageInfo = response.data?.exploreList?.pageInfo;\n\n      res.json({ coins, pageInfo });\n    } catch (error: any) {\n      console.error(\"Error fetching most valuable creator coins from Zora:\", error);\n      res.status(500).json({ error: error.message || \"Failed to fetch most valuable creator coins\" });\n    }\n  });\n}\n","size_bytes":4433},"server/activity-tracker-cron.ts":{"content":"import cron, { ScheduledTask } from 'node-cron';\nimport { ActivityTrackerService } from './activity-tracker-service';\nimport type { IStorage } from './storage';\n\nexport class ActivityTrackerCron {\n  private cronJob: ScheduledTask | null = null;\n  private activityTrackerService: ActivityTrackerService;\n  private storage: IStorage;\n  private schedule: string;\n\n  constructor(storage: IStorage, chainId?: number) {\n    this.storage = storage;\n    this.activityTrackerService = new ActivityTrackerService(chainId);\n    \n    // Default: run every hour at minute 0\n    // Can be configured via ACTIVITY_TRACKER_CRON_SCHEDULE env var\n    // Format: \"minute hour day month weekday\"\n    // Examples:\n    // - \"0 * * * *\" = every hour at minute 0\n    // - \"0 */2 * * *\" = every 2 hours\n    // - \"0 0 * * *\" = daily at midnight\n    this.schedule = process.env.ACTIVITY_TRACKER_CRON_SCHEDULE || '0 * * * *';\n  }\n\n  start(): void {\n    if (this.cronJob) {\n      console.log('‚è∞ Activity tracker cron job is already running');\n      return;\n    }\n\n    console.log(`‚è∞ Starting activity tracker cron job with schedule: ${this.schedule}`);\n    \n    this.cronJob = cron.schedule(this.schedule, async () => {\n      await this.runSync();\n    });\n\n    console.log('‚úÖ Activity tracker cron job started successfully');\n  }\n\n  stop(): void {\n    if (this.cronJob) {\n      this.cronJob.stop();\n      this.cronJob = null;\n      console.log('üõë Activity tracker cron job stopped');\n    }\n  }\n\n  async runSync(): Promise<void> {\n    try {\n      console.log('üîÑ [CRON] Running scheduled activity tracker sync...');\n      \n      const coins = await this.storage.getAllCoins();\n      const unrecordedCoins = coins.filter(\n        coin => coin.address && coin.status === 'active' && !coin.activityTrackerTxHash\n      );\n\n      if (unrecordedCoins.length === 0) {\n        console.log('‚úÖ [CRON] No coins to record on activity tracker');\n        return;\n      }\n\n      console.log(`üìä [CRON] Found ${unrecordedCoins.length} unrecorded coins to sync`);\n\n      const results = await this.activityTrackerService.recordCoinBatch(unrecordedCoins);\n\n      if (results.size > 0) {\n        const now = new Date();\n        for (const [coinId, txHash] of results.entries()) {\n          await this.storage.updateCoin(coinId, {\n            activityTrackerTxHash: txHash,\n            activityTrackerRecordedAt: now,\n          });\n        }\n\n        console.log(`‚úÖ [CRON] Successfully recorded ${results.size} coins on-chain`);\n        console.log(`üìù [CRON] Transaction hashes: ${Array.from(results.values()).join(', ')}`);\n      } else {\n        console.error('‚ùå [CRON] Failed to record coins on activity tracker');\n      }\n    } catch (error) {\n      console.error('‚ùå [CRON] Activity tracker sync error:', error);\n    }\n  }\n\n  getSchedule(): string {\n    return this.schedule;\n  }\n\n  isRunning(): boolean {\n    return this.cronJob !== null;\n  }\n}\n","size_bytes":2924},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/pages/inbox.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card } from \"@/components/ui/card\";\nimport { Send, Loader2, MessageSquare, ArrowLeft, Search, X, Edit } from \"lucide-react\";\nimport { socketClient, type Message, type Conversation } from \"@/lib/socket-client\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\n\nexport default function Inbox() {\n  const { user, authenticated } = usePrivy();\n  const isMobile = useIsMobile();\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [messageInput, setMessageInput] = useState(\"\");\n  const [isLoadingConversations, setIsLoadingConversations] = useState(true); // To replace isConnecting\n  const [isSending, setIsSending] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const [showComposeDialog, setShowComposeDialog] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [newMessageContent, setNewMessageContent] = useState(\"\");\n\n  const { data: creators } = useQuery<any[]>({\n    queryKey: [\"/api/creators\"],\n  });\n\n  const creatorMap = new Map(creators?.map(c => [c.address?.toLowerCase(), c]) || []);\n\n  const filteredCreators = creators?.filter(creator => {\n    if (!searchQuery.trim()) return true;\n    const query = searchQuery.toLowerCase();\n    const username = creator.username?.toLowerCase() || \"\";\n    const address = creator.address?.toLowerCase() || \"\";\n    const privyId = creator.privyId?.toLowerCase() || \"\";\n    return username.includes(query) || address.includes(query) || privyId.includes(query);\n  }).filter(creator => {\n    // Exclude current user by comparing both address and privyId\n    const currentUserId = user?.wallet?.address?.toLowerCase() || user?.id;\n    return creator.address?.toLowerCase() !== currentUserId && \n           creator.privyId?.toLowerCase() !== currentUserId;\n  }) || [];\n\n  useEffect(() => {\n    if (!authenticated || !user) {\n      setIsLoadingConversations(false);\n      return;\n    }\n\n    // Use wallet address if available, otherwise use Privy ID\n    // For email users, prefix with 'email_' to match server-side ID format\n    let userId = user.wallet?.address?.toLowerCase();\n    if (!userId) {\n      userId = user.email ? `email_${user.id}` : user.id;\n    }\n\n    console.log('[Inbox] Connecting socket with userId:', userId);\n\n    // Connect to Socket.io\n    socketClient.connect(userId);\n    setIsLoadingConversations(false);\n\n    // Listen for conversations\n    socketClient.on('conversations', (convos: Conversation[]) => {\n      setConversations(convos);\n      setIsLoadingConversations(false); // Ensure loading is false after receiving conversations\n    });\n\n    // Listen for conversation loaded\n    socketClient.on('conversation_loaded', (data: { conversation: Conversation; messages: Message[] }) => {\n      setMessages(data.messages);\n      setSelectedConversation(data.conversation);\n      setIsLoadingConversations(false); // Ensure loading is false\n\n      // Update conversations list if this was a new conversation\n      setConversations(prev => {\n        const exists = prev.some(c => c.id === data.conversation.id);\n        if (exists) {\n          return prev.map(c => c.id === data.conversation.id ? data.conversation : c);\n        }\n        return [data.conversation, ...prev].sort((a, b) => \n          new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()\n        );\n      });\n    });\n\n    // Listen for new messages\n    socketClient.on('new_message', (message: Message) => {\n      if (selectedConversation && message.conversationId === selectedConversation.id) {\n        setMessages(prev => [...prev, message]);\n        socketClient.markAsRead(selectedConversation.id);\n      }\n      // Refresh conversations to update last message\n      socketClient.getConversations();\n    });\n\n    // Listen for message sent\n    socketClient.on('message_sent', (message: Message) => {\n      setMessages(prev => [...prev, message]);\n      setIsSending(false);\n      setMessageInput(\"\");\n    });\n\n    // Listen for conversation updates\n    socketClient.on('conversation_updated', (conversation: Conversation) => {\n      setConversations(prev => {\n        const index = prev.findIndex(c => c.id === conversation.id);\n        if (index >= 0) {\n          const updated = [...prev];\n          updated[index] = conversation;\n          return updated.sort((a, b) => \n            new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()\n          );\n        }\n        // If the conversation is new and not in the list, add it\n        return [conversation, ...prev].sort((a, b) => \n          new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()\n        );\n      });\n    });\n\n    // Request conversations\n    socketClient.getConversations();\n\n    return () => {\n      socketClient.disconnect();\n    };\n  }, [authenticated, user?.wallet?.address, selectedConversation]); // Added selectedConversation to dependency array\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const handleSelectConversation = (conversation: Conversation) => {\n    if (!user) return;\n\n    setSelectedConversation(conversation);\n\n    // Use wallet address if available, otherwise use Privy ID with email prefix\n    let currentUserId = user.wallet?.address?.toLowerCase();\n    if (!currentUserId) {\n      currentUserId = user.email ? `email_${user.id}` : user.id;\n    }\n\n    const otherParticipantAddress = conversation.participants.find(p => p !== currentUserId);\n\n    if (otherParticipantAddress) {\n      console.log('[Inbox] Loading conversation with:', otherParticipantAddress);\n      socketClient.getConversation(otherParticipantAddress);\n      socketClient.markAsRead(conversation.id);\n    }\n  };\n\n  const handleSendMessage = () => {\n    if (!messageInput.trim() || !selectedConversation || !user) return;\n\n    // Use wallet address if available, otherwise use Privy ID with email prefix\n    let currentUserId = user.wallet?.address?.toLowerCase();\n    if (!currentUserId) {\n      currentUserId = user.email ? `email_${user.id}` : user.id;\n    }\n\n    const recipientId = selectedConversation.participants.find(\n      p => p !== currentUserId\n    );\n\n    if (!recipientId) return;\n\n    console.log('[Inbox] Sending message to:', recipientId);\n    setIsSending(true);\n    socketClient.sendMessage(recipientId, messageInput.trim());\n  };\n\n  const handleStartConversation = (recipientAddress: string) => {\n    if (!recipientAddress || !user) return;\n\n    // Use wallet address if available, otherwise use Privy ID\n    const currentUserId = user.wallet?.address?.toLowerCase() || user.id;\n\n    // Check if conversation already exists\n    const existingConversation = conversations.find(conv =>\n      conv.participants.includes(recipientAddress.toLowerCase())\n    );\n\n    if (existingConversation) {\n      handleSelectConversation(existingConversation);\n      setShowComposeDialog(false);\n      setSearchQuery(\"\");\n    } else {\n      // Create new conversation by requesting it\n      socketClient.getConversation(recipientAddress.toLowerCase());\n\n      // Create temporary conversation to show in UI immediately\n      const tempConversation: Conversation = {\n        id: `temp-${Date.now()}`,\n        participants: [currentUserId, recipientAddress.toLowerCase()],\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n        lastMessage: null,\n        unreadCount: 0,\n      };\n\n      setSelectedConversation(tempConversation);\n      setMessages([]);\n      setShowComposeDialog(false);\n      setSearchQuery(\"\");\n    }\n  };\n\n  const getOtherParticipant = (conversation: Conversation) => {\n    if (!user) return { address: \"Unknown\", username: null, avatar: null };\n\n    // Use wallet address if available, otherwise use Privy ID\n    const currentUserId = user.wallet?.address?.toLowerCase() || user.id;\n    const otherAddress = conversation.participants.find(p => p !== currentUserId);\n\n    // Provide a fallback with at least an address if creator data is missing\n    return creatorMap.get(otherAddress || \"\") || { address: otherAddress || \"Unknown\", username: null, avatar: null };\n  };\n\n  const getUnreadCount = (conversation: Conversation) => {\n    // Return the unread count from the conversation object\n    return conversation.unreadCount || 0;\n  };\n\n\n  if (!authenticated) {\n    return (\n      <div className=\"container max-w-5xl mx-auto px-4 py-8\">\n        <Card className=\"p-12 text-center\">\n          <h2 className=\"text-2xl font-bold mb-4\">Connect Your Wallet</h2>\n          <p className=\"text-muted-foreground\">Please connect your wallet to access messaging</p>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isLoadingConversations) {\n    return (\n      <div className=\"h-[calc(100vh-4rem)] flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Loader2 className=\"h-8 w-8 animate-spin mx-auto mb-4\" />\n          <p className=\"text-muted-foreground\">Loading messages...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`${isMobile ? 'h-screen' : 'h-[calc(100vh-4rem)]'} flex flex-col max-w-5xl mx-auto`}>\n      <div className=\"px-4 py-4 border-b bg-card/95 backdrop-blur-sm sticky top-0 z-10\">\n        <div className=\"flex items-center justify-between\">\n          <h1 className=\"text-xl md:text-2xl font-bold\">Messages</h1>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setShowComposeDialog(true)}\n            className=\"h-9 w-9\"\n          >\n            <Edit className=\"h-5 w-5\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex-1 flex overflow-hidden\">\n        <div className={`${isMobile ? 'w-full' : 'w-full lg:w-80'} border-r flex flex-col bg-card`}>\n\n          <div className=\"flex-1 overflow-y-auto\">\n            {conversations.length === 0 ? (\n              <div className=\"p-8 text-center text-muted-foreground\">\n                <MessageSquare className=\"h-12 w-12 mx-auto mb-4 opacity-20\" />\n                <p className=\"text-sm\">No conversations yet</p>\n              </div>\n            ) : (\n              conversations.map((conversation) => {\n                const other = getOtherParticipant(conversation);\n                const unreadCount = getUnreadCount(conversation); // Use the refined getUnreadCount\n                const participantAvatar = other.avatar || \"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\";\n\n                return (\n                  <div\n                    key={conversation.id}\n                    onClick={() => handleSelectConversation(conversation)}\n                    className={`p-4 border-b cursor-pointer hover:bg-accent/50 transition-colors ${\n                      selectedConversation?.id === conversation.id ? 'bg-accent' : ''\n                    }`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <Avatar className=\"h-12 w-12\">\n                        <AvatarImage src={participantAvatar} />\n                        <AvatarFallback>\n                          {other.username?.[0]?.toUpperCase() || other.address?.slice(2, 4).toUpperCase()}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center justify-between gap-2\">\n                          <p className=\"font-medium truncate\">\n                            {other.username || `${other.address?.slice(0, 6)}...${other.address?.slice(-4)}`}\n                          </p>\n                          {/* Display unread count if available and greater than 0 */}\n                          {(conversation.unreadCount || 0) > 0 && ( \n                            <Badge variant=\"destructive\" className=\"h-5 px-2\">\n                              {conversation.unreadCount}\n                            </Badge>\n                          )}\n                        </div>\n                        {conversation.lastMessage && (\n                          <p className=\"text-sm text-muted-foreground truncate\">\n                            {conversation.lastMessage.content}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                );\n              })\n            )}\n          </div>\n        </div>\n\n        {(!isMobile || selectedConversation) && (\n          <div className=\"flex-1 flex flex-col\">\n            {selectedConversation ? (\n              <>\n                <div className=\"px-4 py-3 border-b bg-card/95 backdrop-blur-sm sticky top-0 z-10\">\n                  <div className=\"flex items-center gap-3\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => setSelectedConversation(null)}\n                      className=\"h-9 w-9 lg:hidden\" // Show back button only on mobile\n                    >\n                      <ArrowLeft className=\"h-5 w-5\" />\n                    </Button>\n                    <Avatar className=\"h-10 w-10\">\n                      <AvatarImage src={getOtherParticipant(selectedConversation).avatar || \"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\"} />\n                      <AvatarFallback>\n                        {getOtherParticipant(selectedConversation).username?.[0]?.toUpperCase() || \n                         getOtherParticipant(selectedConversation).address?.slice(2, 4).toUpperCase()}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div>\n                      <p className=\"font-medium\">\n                        {getOtherParticipant(selectedConversation).username || \n                         `${getOtherParticipant(selectedConversation).address?.slice(0, 6)}...${getOtherParticipant(selectedConversation).address?.slice(-4)}`}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n                  {messages.map((message) => {\n                    // Use wallet address if available, otherwise use Privy ID\n                    const currentUserId = user?.wallet?.address?.toLowerCase() || user?.id;\n                    const isOwnMessage = message.senderId === currentUserId;\n                    return (\n                      <div\n                        key={message.id}\n                        className={`flex ${isOwnMessage ? 'justify-end' : 'justify-start'}`}\n                      >\n                        <div\n                          className={`max-w-[70%] rounded-2xl px-4 py-2 ${\n                            isOwnMessage\n                              ? 'bg-primary text-primary-foreground'\n                              : 'bg-muted'\n                          }`}\n                        >\n                          <p className=\"text-sm break-words\">{message.content}</p>\n                          <p className={`text-xs mt-1 ${isOwnMessage ? 'text-primary-foreground/70' : 'text-muted-foreground'}`}>\n                            {new Date(message.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                          </p>\n                        </div>\n                      </div>\n                    );\n                  })}\n                  <div ref={messagesEndRef} />\n                </div>\n\n                <div className=\"p-4 border-t bg-card/95 backdrop-blur-sm sticky bottom-0 z-10\">\n                  <div className=\"flex gap-2\">\n                    <Input\n                      placeholder=\"Type a message...\"\n                      value={messageInput}\n                      onChange={(e) => setMessageInput(e.target.value)}\n                      onKeyPress={(e) => e.key === 'Enter' && !e.shiftKey && handleSendMessage()}\n                      className=\"flex-1\"\n                      disabled={isSending}\n                    />\n                    <Button \n                      onClick={handleSendMessage}\n                      disabled={!messageInput.trim() || isSending}\n                      size=\"icon\"\n                    >\n                      {isSending ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <Send className=\"h-4 w-4\" />\n                      )}\n                    </Button>\n                  </div>\n                </div>\n              </>\n            ) : (\n              <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">\n                <div className=\"text-center\">\n                  <div className=\"mb-4 flex justify-center\">\n                    <div className=\"h-20 w-20 rounded-full bg-accent flex items-center justify-center\">\n                      <Send className=\"h-10 w-10 text-muted-foreground\" />\n                    </div>\n                  </div>\n                  <h3 className=\"text-lg font-semibold mb-2\">No conversation selected</h3>\n                  <p className=\"text-sm\">Select a conversation from the list to start messaging</p>\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      <Dialog open={showComposeDialog} onOpenChange={setShowComposeDialog}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>New Message</DialogTitle>\n            <DialogDescription>\n              Search for a user to start a conversation\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search by username or address...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-9\"\n              />\n              {searchQuery && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => setSearchQuery(\"\")}\n                  className=\"absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              )}\n            </div>\n\n            <div className=\"max-h-[400px] overflow-y-auto space-y-2\">\n              {filteredCreators.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <p className=\"text-sm\">\n                    {searchQuery ? \"No users found\" : \"Search for users to message\"}\n                  </p>\n                </div>\n              ) : (\n                filteredCreators.map((creator) => (\n                  <div\n                    key={creator.id}\n                    onClick={() => handleStartConversation(creator.address)}\n                    className=\"p-3 border rounded-lg cursor-pointer hover:bg-accent/50 transition-colors\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <Avatar className=\"h-10 w-10\">\n                        <AvatarImage src={creator.avatar || \"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\"} />\n                        <AvatarFallback>\n                          {creator.username?.[0]?.toUpperCase() || creator.address?.slice(2, 4).toUpperCase()}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-medium truncate\">\n                          {creator.username || `${creator.address?.slice(0, 6)}...${creator.address?.slice(-4)}`}\n                        </p>\n                        {creator.username && (\n                          <p className=\"text-xs text-muted-foreground truncate\">\n                            {creator.address?.slice(0, 6)}...{creator.address?.slice(-4)}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":20951},"server/trending-notifications.ts":{"content":"import { storage } from \"./storage\";\nimport { getCoin } from \"@zoralabs/coins-sdk\";\nimport { base } from \"viem/chains\";\nimport { sendTelegramNotification } from \"./telegram-bot\";\n\n// Assuming TRENDING_CHECK_INTERVAL is defined elsewhere, e.g., in a config file or constants.\n// For this example, let's define it here.\nconst TRENDING_CHECK_INTERVAL = 2 * 60 * 60 * 1000; // 2 hours\n\ninterface TrendingCoin {\n  coinId: string;\n  coinAddress: string;\n  coinSymbol: string;\n  coinName: string;\n  creatorAddress: string;\n  earnings24h: number;\n  volume24h: number;\n  holders: number;\n}\n\n// Function to check for trending coins and send notifications\nexport async function checkAndNotifyTrendingCoins() {\n  try {\n    const coins = await storage.getAllCoins();\n    const trendingCoins: TrendingCoin[] = [];\n\n    // Fetch stats for all active coins\n    for (const coin of coins) {\n      if (!coin.address || coin.status !== 'active') continue;\n\n      try {\n        const response = await getCoin({\n          collectionAddress: coin.address as `0x${string}`,\n          chainId: base.id,\n        });\n\n        const coinData = response.data?.zora20Token;\n        if (!coinData) continue;\n\n        const volume24h = parseFloat(coinData.volume24h || '0');\n        const holders = coinData.uniqueHolders || 0;\n        const earnings24h = volume24h * 0.005; // 0.5% of volume\n\n        // Check if coin is trending (high earnings or volume)\n        // Lower thresholds for more active notifications\n        if (earnings24h >= 1 || volume24h >= 10 || holders >= 5) {\n          trendingCoins.push({\n            coinId: coin.id,\n            coinAddress: coin.address,\n            coinSymbol: coin.symbol,\n            coinName: coin.name,\n            creatorAddress: coin.creator_wallet || '',\n            earnings24h,\n            volume24h,\n            holders,\n          });\n        }\n      } catch (error: any) {\n        // Suppress WebSocket/realtime errors\n        if (!error?.message?.includes('realtime') && !error?.message?.includes('ENOTFOUND')) {\n          console.error(`Error fetching stats for ${coin.symbol}:`, error?.message || error);\n        }\n      }\n    }\n\n    // Sort by earnings\n    trendingCoins.sort((a, b) => b.earnings24h - a.earnings24h);\n\n    // Notify about top trending coins (top 3)\n    const topTrending = trendingCoins.slice(0, 3);\n\n    for (const trending of topTrending) {\n      // Get all users to notify (random selection)\n      const creators = await storage.getAllCreators();\n      const usersToNotify = creators\n        .filter(c => c.address.toLowerCase() !== trending.creatorAddress.toLowerCase())\n        .sort(() => Math.random() - 0.5)\n        .slice(0, Math.min(5, creators.length)); // Notify up to 5 random users\n\n      for (const user of usersToNotify) {\n        // Create notification\n        await storage.createNotification({\n          userId: user.address,\n          type: 'trending',\n          title: 'üî• Trending Coin Alert!',\n          message: `${trending.coinName} (${trending.coinSymbol}) is trending! $${trending.earnings24h.toFixed(2)} earned in 24h with ${trending.holders} holders. Check it out!`,\n          coinAddress: trending.coinAddress,\n          coinSymbol: trending.coinSymbol,\n          read: false,\n        });\n\n        // Send Telegram notification\n        await sendTelegramNotification(\n          user.address,\n          'üî• Trending Coin Alert!',\n          `${trending.coinName} (${trending.coinSymbol}) is trending! $${trending.earnings24h.toFixed(2)} earned in 24h with ${trending.holders} holders. Check it out!`,\n          'trending',\n          { address: trending.coinAddress, symbol: trending.coinSymbol, name: trending.coinName },\n          { earnings24h: trending.earnings24h, volume24h: trending.volume24h, holders: trending.holders }\n        );\n      }\n    }\n\n    // Notify creators about their own coin performance\n    for (const trending of topTrending) {\n      if (!trending.creatorAddress) continue;\n\n      await storage.createNotification({\n        userId: trending.creatorAddress,\n        type: 'performance',\n        title: 'üíé Your Coin is Performing Great!',\n        message: `${trending.coinName} (${trending.coinSymbol}) earned $${trending.earnings24h.toFixed(2)} in the last 24h! Share it to reach more holders.`,\n        coinAddress: trending.coinAddress,\n        coinSymbol: trending.coinSymbol,\n        read: false,\n      });\n\n      await sendTelegramNotification(\n        trending.creatorAddress,\n        'üíé Your Coin is Performing Great!',\n        `${trending.coinName} (${trending.coinSymbol}) earned $${trending.earnings24h.toFixed(2)} in the last 24h! Share it to reach more holders.`,\n        'performance',\n        { address: trending.coinAddress, symbol: trending.coinSymbol, name: trending.coinName },\n        { earnings24h: trending.earnings24h, volume24h: trending.volume24h, holders: trending.holders }\n      );\n    }\n\n    console.log(`‚úÖ Sent trending notifications for ${topTrending.length} coins`);\n  } catch (error: any) {\n    // Suppress WebSocket/realtime connection errors\n    if (!error?.message?.includes('realtime') && !error?.message?.includes('ENOTFOUND') && !error?.message?.includes('WebSocket')) {\n      console.error('Error in trending notifications:', error?.message || error);\n    }\n  }\n}\n\n// Run every 2 hours\nexport function startTrendingNotifications() {\n  // Run immediately on startup with delay to allow app to fully initialize\n  setTimeout(() => {\n    checkAndNotifyTrendingCoins().catch(error => {\n      console.error('Error in trending notifications (startup):', error.message || error);\n      // Don't crash the app if trending notifications fail\n    });\n  }, 10000); // Wait 10 seconds before first run\n\n  // Then run every 2 hours\n  setInterval(() => {\n    checkAndNotifyTrendingCoins().catch(error => {\n      console.error('Error in trending notifications (interval):', error.message || error);\n      // Don't crash the app if trending notifications fail\n    });\n  }, TRENDING_CHECK_INTERVAL);\n\n  console.log('‚úÖ Trending notifications service scheduled (runs every 2 hours)');\n}","size_bytes":6114},"server/upload-handler.ts":{"content":"import { Request, Response } from \"express\";\nimport formidable from \"formidable\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport sharp from 'sharp';\n\nconst PINATA_JWT = process.env.VITE_PINATA_JWT;\nconst PINATA_API_KEY = process.env.VITE_PINATA_API_KEY;\nconst PINATA_SECRET_KEY = process.env.VITE_PINATA_SECRET_KEY;\n\nexport async function handleFileUpload(req: Request, res: Response) {\n  if (!PINATA_JWT && (!PINATA_API_KEY || !PINATA_SECRET_KEY)) {\n    return res.status(500).json({\n      error: \"Pinata credentials not configured\"\n    });\n  }\n\n  const form = formidable({\n    maxFileSize: 100 * 1024 * 1024, // 100MB\n    keepExtensions: true,\n  });\n\n  form.parse(req, async (err, fields, files) => {\n    if (err) {\n      console.error(\"File parse error:\", err);\n      return res.status(400).json({ error: \"Failed to parse file upload\" });\n    }\n\n    const file = Array.isArray(files.file) ? files.file[0] : files.file;\n\n    if (!file) {\n      return res.status(400).json({ error: \"No file uploaded\" });\n    }\n\n    try {\n      // Read file\n      let fileBuffer = fs.readFileSync(file.filepath);\n      const fileName = file.originalFilename || `upload-${Date.now()}`;\n      let fileMimeType = file.mimetype || 'application/octet-stream';\n\n      // Compress images aggressively before upload\n      if (fileMimeType.startsWith('image/') && fileBuffer.length > 500 * 1024) {\n        try {\n          const compressedBuffer = await sharp(fileBuffer)\n            .resize(1920, 1920, {\n              fit: 'inside',\n              withoutEnlargement: true\n            })\n            .jpeg({\n              quality: 80,\n              progressive: true\n            })\n            .toBuffer();\n\n          fileBuffer = compressedBuffer;\n          fileMimeType = 'image/jpeg'; // Ensure mimetype is updated after compression\n        } catch (compressionError) {\n          console.warn('Image compression failed, using original:', compressionError);\n          // If compression fails, we continue with the original buffer and mimetype\n        }\n      }\n\n\n      // Upload to Pinata\n      const formData = new FormData();\n      const blob = new Blob([fileBuffer], { type: fileMimeType });\n      formData.append('file', blob, fileName);\n\n      const pinataMetadata = JSON.stringify({\n        name: fileName,\n      });\n      formData.append('pinataMetadata', pinataMetadata);\n\n      const uploadResponse = await fetch(\n        'https://api.pinata.cloud/pinning/pinFileToIPFS',\n        {\n          method: 'POST',\n          headers: PINATA_JWT\n            ? { 'Authorization': `Bearer ${PINATA_JWT}` }\n            : {\n                'pinata_api_key': PINATA_API_KEY!,\n                'pinata_secret_api_key': PINATA_SECRET_KEY!,\n              },\n          body: formData,\n        }\n      );\n\n      if (!uploadResponse.ok) {\n        const errorText = await uploadResponse.text();\n        console.error(\"Pinata upload error:\", errorText);\n        throw new Error(`Pinata upload failed: ${errorText}`);\n      }\n\n      const result = await uploadResponse.json();\n      const ipfsHash = result.IpfsHash;\n      const gatewayUrl = process.env.NEXT_PUBLIC_GATEWAY_URL || 'https://gateway.pinata.cloud';\n      const url = `${gatewayUrl}/ipfs/${ipfsHash}`;\n\n      // Clean up temp file\n      fs.unlinkSync(file.filepath);\n\n      // Get user-provided metadata (formidable can return arrays or strings)\n      const getFieldValue = (field: any): string => {\n        if (Array.isArray(field)) return field[0] || '';\n        return field || '';\n      };\n\n      const title = getFieldValue(fields.title) || fileName;\n      const description = getFieldValue(fields.description) || '';\n      const author = getFieldValue(fields.author) || '';\n      const fileType = fileMimeType.split('/')[0] || 'file';\n\n      // Return upload data directly - no scraping needed for uploads\n      // For video/audio files, set animation_url per EIP-7572 standard\n      const isVideo = fileMimeType.startsWith('video/');\n      const isAudio = fileMimeType.startsWith('audio/');\n      const isImage = fileMimeType.startsWith('image/');\n\n      const uploadData = {\n        url: url,\n        title: title,\n        description: description,\n        image: isImage ? url : '', // Default to empty if not an image\n        animation_url: (isVideo || isAudio) ? url : undefined,\n        author: author,\n        publishDate: new Date().toISOString(),\n        content: description,\n        platform: 'upload',\n        type: fileType,\n      };\n\n      console.log('Sending upload response:', { ipfsHash, url, uploadData });\n\n      res.json({\n        success: true,\n        ipfsHash,\n        url,\n        fileName,\n        uploadData,\n      });\n    } catch (error) {\n      console.error(\"Upload error:\", error);\n\n      // Clean up temp file on error\n      try {\n        fs.unlinkSync(file.filepath);\n      } catch {}\n\n      res.status(500).json({\n        error: \"Failed to upload file to IPFS\",\n        details: error instanceof Error ? error.message : String(error),\n      });\n    }\n  });\n}","size_bytes":5030},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-2xl\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3846},"server/og-meta.ts":{"content":"\nimport type { User, Coin, Project } from \"@shared/schema\";\n\nexport interface OGMetaData {\n  title: string;\n  description: string;\n  image: string;\n  url: string;\n  type: string;\n}\n\nexport function generateProfileOGMeta(user: User, baseUrl: string): OGMetaData {\n  return {\n    title: `${user.displayName || user.username} | Every1.fun`,\n    description: `${user.bio || `Check out ${user.displayName || user.username}'s profile on Every1.fun`} ‚Ä¢ ${user.e1xpPoints || 0} E1XP Points`,\n    image: user.avatarUrl || `${baseUrl}/api/og/profile/${user.id}`,\n    url: `${baseUrl}/profile/${user.id}`,\n    type: \"profile\",\n  };\n}\n\nexport function generateCoinOGMeta(coin: Coin, baseUrl: string): OGMetaData {\n  return {\n    title: `${coin.name} (${coin.symbol}) | Every1.fun`,\n    description: coin.description || `Trade ${coin.symbol} on Every1.fun - Creator Coins Platform`,\n    image: coin.image || `${baseUrl}/api/og/coin/${coin.id}`,\n    url: `${baseUrl}/coin/${coin.id}`,\n    type: \"website\",\n  };\n}\n\nexport function generateProjectOGMeta(project: Project, baseUrl: string): OGMetaData {\n  return {\n    title: `${project.title} | Every1.fun`,\n    description: project.description || `Check out this amazing project on Every1.fun`,\n    image: project.thumbnailUrl || `${baseUrl}/api/og/project/${project.id}`,\n    url: `${baseUrl}/project/${project.id}`,\n    type: \"website\",\n  };\n}\n\nexport function generateReferralOGMeta(user: User, baseUrl: string): OGMetaData {\n  return {\n    title: `Join Every1.fun with ${user.displayName || user.username}`,\n    description: `Get started on Every1.fun and earn bonus E1XP points! Use code: ${user.referralCode}`,\n    image: user.avatarUrl || `${baseUrl}/api/og/referral/${user.referralCode}`,\n    url: `${baseUrl}/join/${user.referralCode}`,\n    type: \"website\",\n  };\n}\n\nexport function generateBadgeOGMeta(user: User, badgeName: string, baseUrl: string): OGMetaData {\n  return {\n    title: `${user.displayName || user.username} unlocked ${badgeName}! | Every1.fun`,\n    description: `Check out my ${badgeName} badge on Every1.fun! Total E1XP: ${user.e1xpPoints || 0}`,\n    image: `${baseUrl}/api/og/badge/${user.id}/${badgeName}`,\n    url: `${baseUrl}/profile/${user.id}`,\n    type: \"website\",\n  };\n}\n\nexport function generateOGMetaTags(meta: OGMetaData): string {\n  return `\n    <meta property=\"og:title\" content=\"${meta.title}\" />\n    <meta property=\"og:description\" content=\"${meta.description}\" />\n    <meta property=\"og:image\" content=\"${meta.image}\" />\n    <meta property=\"og:url\" content=\"${meta.url}\" />\n    <meta property=\"og:type\" content=\"${meta.type}\" />\n    <meta name=\"twitter:card\" content=\"summary_large_image\" />\n    <meta name=\"twitter:title\" content=\"${meta.title}\" />\n    <meta name=\"twitter:description\" content=\"${meta.description}\" />\n    <meta name=\"twitter:image\" content=\"${meta.image}\" />\n  `.trim();\n}\n","size_bytes":2872},"client/src/lib/zora.ts":{"content":"import {\n  createCoin,\n  createCoinCall,\n  setApiKey,\n  getCoinCreateFromLogs,\n  CreateConstants,\n  tradeCoin,\n  TradeParameters,\n  createMetadataBuilder,\n  createZoraUploaderForCreator\n} from \"@zoralabs/coins-sdk\";\nimport { createPublicClient, createWalletClient, http, parseEther, type Address, type Hash } from \"viem\";\nimport { base, baseSepolia } from \"viem/chains\";\nimport { uploadToIPFS, uploadToPinata } from \"./pinata\";\n\n// Set up Zora API key\nconst ZORA_API_KEY = import.meta.env.VITE_NEXT_PUBLIC_ZORA_API_KEY || \"\";\n\nif (ZORA_API_KEY) {\n  setApiKey(ZORA_API_KEY);\n  console.log(\"‚úì Zora API key configured successfully\");\n} else {\n  console.error(\"‚ùå VITE_NEXT_PUBLIC_ZORA_API_KEY not configured - coin stats will not load\");\n  console.log(\"Available env vars:\", Object.keys(import.meta.env).filter(k => k.startsWith('VITE_')));\n}\n\nexport interface CoinMetadata {\n  name: string;\n  symbol: string;\n  description?: string;\n  image?: string | File;\n  externalUrl?: string;\n}\n\nexport interface CoinCreationResult {\n  hash: Hash;\n  address: Address;\n  deployment: any;\n}\n\n// Helper function to upload metadata using Pinata\nasync function uploadMetadataViaPinata(metadata: CoinMetadata): Promise<string> {\n  const PINATA_JWT = import.meta.env.VITE_PINATA_JWT;\n\n  if (!PINATA_JWT) {\n    throw new Error(\"PINATA_JWT not configured\");\n  }\n\n  try {\n    // Upload image first if it exists\n    let imageUri = '';\n    if (metadata.image) {\n      if (typeof metadata.image === 'string') {\n        // Image is already a URL\n        imageUri = metadata.image;\n      } else {\n        // Upload the file to Pinata\n        const ipfsHash = await uploadToPinata(metadata.image);\n\n        // Use ipfs:// protocol for Zora contract compatibility\n        imageUri = `ipfs://${ipfsHash}`;\n      }\n    }\n\n    // Create metadata object\n    const metadataJson = {\n      name: metadata.name,\n      description: metadata.description || `A coin representing ${metadata.name}`,\n      image: imageUri,\n      ...(metadata.externalUrl && { external_url: metadata.externalUrl })\n    };\n\n    // Upload metadata JSON to IPFS\n    const metadataUri = await uploadToIPFS(metadataJson);\n\n    console.log(\"‚úì Metadata uploaded via Pinata:\", metadataUri);\n    return metadataUri;\n  } catch (error) {\n    console.error(\"Pinata metadata upload error:\", error);\n    throw new Error(`Failed to upload metadata via Pinata: ${error instanceof Error ? error.message : String(error)}`);\n  }\n}\n\n// Try to upload via Zora first, fallback to Pinata if it fails\nasync function createMetadataForZora(metadata: CoinMetadata, creatorAddress: Address) {\n  if (!ZORA_API_KEY) {\n    throw new Error(\"Zora API key is required for metadata creation\");\n  }\n\n  try {\n    // Convert image URL to File if it's a URL\n    let imageFile: File | undefined;\n    if (metadata.image) {\n      if (typeof metadata.image === 'string') {\n        // Fetch the image and convert to File\n        const response = await fetch(metadata.image);\n        const blob = await response.blob();\n        const filename = metadata.image.split('/').pop() || 'image.jpg';\n        imageFile = new File([blob], filename, { type: blob.type });\n      } else {\n        imageFile = metadata.image;\n      }\n    }\n\n    // Use Zora's metadata builder and uploader\n    const builder = createMetadataBuilder()\n      .withName(metadata.name)\n      .withSymbol(metadata.symbol)\n      .withDescription(metadata.description || `A coin representing ${metadata.name}`);\n\n    if (imageFile) {\n      builder.withImage(imageFile);\n    }\n\n    const { createMetadataParameters } = await builder.upload(\n      createZoraUploaderForCreator(creatorAddress)\n    );\n\n    console.log(\"‚úì Metadata uploaded via Zora:\", createMetadataParameters);\n\n    return createMetadataParameters;\n  } catch (error) {\n    console.error(\"Zora metadata upload error:\", error);\n    console.log(\"Falling back to Pinata upload...\");\n\n    // Fallback to Pinata\n    try {\n      const metadataUri = await uploadMetadataViaPinata(metadata);\n      return {\n        name: metadata.name,\n        symbol: metadata.symbol,\n        metadata: { type: \"RAW_URI\" as const, uri: metadataUri }\n      };\n    } catch (pinataError) {\n      console.error(\"Pinata fallback failed:\", pinataError);\n      throw new Error(`Failed to upload metadata via Zora and Pinata: ${error instanceof Error ? error.message : String(error)}`);\n    }\n  }\n}\n\n\nexport async function createZoraCoin(\n  metadata: CoinMetadata,\n  creatorAddress: Address,\n  chainId: number = base.id\n): Promise<CoinCreationResult> {\n  if (!ZORA_API_KEY) {\n    throw new Error(\"Zora API key not configured\");\n  }\n\n  try {\n    // Set up clients for the specified chain\n    const chain = chainId === baseSepolia.id ? baseSepolia : base;\n    const alchemyApiKey = import.meta.env.VITE_ALCHEMY_API_KEY || \"o3VW3WRXrsXXMRX3l7jZxLUqhWyZzXBy\";\n    const rpcUrl = import.meta.env.VITE_ZORA_RPC_URL || \n                   `https://base-mainnet.g.alchemy.com/v2/${alchemyApiKey}`;\n\n    const publicClient = createPublicClient({\n      chain,\n      transport: http(rpcUrl),\n    });\n\n    // Upload metadata to IPFS via Pinata\n    const metadataUri = await uploadMetadataViaPinata(metadata);\n\n    console.log('Created metadata URI:', metadataUri);\n\n    // Admin platform referral address for earning 20% of all future trading fees\n    const ADMIN_PLATFORM_REFERRAL = \"0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7\"; // Default admin wallet\n\n    // Create coin arguments matching SDK v0.3.2 API with platform referral\n    const createCoinArgs = {\n      creator: creatorAddress,\n      name: metadata.name,\n      symbol: metadata.symbol,\n      metadata: { type: \"RAW_URI\" as const, uri: metadataUri || \"\" },\n      currency: CreateConstants.ContentCoinCurrencies.ETH,\n      chainId,\n      skipMetadataValidation: !metadataUri, // Only skip if no URI (validation will fail on empty)\n      platformReferrer: ADMIN_PLATFORM_REFERRAL, // Earn 20% of all trading fees for this coin\n      startingMarketCap: CreateConstants.StartingMarketCaps.LOW, // Set initial market cap\n    };\n\n    // For client-side, we'll return the call data instead of executing\n    // The actual transaction will be handled by the wallet client\n    const txCalls = await createCoinCall(createCoinArgs);\n\n    // This is a placeholder - actual implementation requires wallet integration\n    throw new Error(\"Wallet integration required for actual coin creation. This is a development environment limitation.\");\n\n  } catch (error) {\n    console.error(\"Zora coin creation error:\", error);\n    throw new Error(`Failed to create Zora coin: ${error}`);\n  }\n}\n\nexport async function createZoraCoinWithWallet(\n  metadata: CoinMetadata,\n  walletClient: any,\n  address: Address,\n  chainId: number = base.id,\n  manualPoolConfig?: `0x${string}`\n): Promise<CoinCreationResult> {\n  try {\n    // Set up clients\n    const chain = chainId === baseSepolia.id ? baseSepolia : base;\n    const alchemyApiKey = import.meta.env.VITE_ALCHEMY_API_KEY || \"o3VW3WRXrsXXMRX3l7jZxLUqhWyZzXBy\";\n    const rpcUrl = import.meta.env.VITE_ZORA_RPC_URL || \n                   `https://base-mainnet.g.alchemy.com/v2/${alchemyApiKey}`;\n\n    const publicClient = createPublicClient({\n      chain,\n      transport: http(rpcUrl),\n    });\n\n    // Upload metadata directly to Pinata (bypassing Zora's validation issues)\n    console.log('üì§ Uploading metadata via Pinata...');\n    const metadataUri = await uploadMetadataViaPinata(metadata);\n    console.log('‚úÖ Metadata uploaded:', metadataUri);\n\n    // Admin platform referral address for earning 20% of all future trading fees\n    const ADMIN_PLATFORM_REFERRAL = \"0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7\"; // Default admin wallet\n\n    // Use direct factory contract deployment (primary method)\n    const { deployCreatorCoinDirect } = await import('@/lib/zora-factory');\n\n    console.log(\"üöÄ Using direct factory deployment with official Zora poolConfig\");\n\n    const directResult = await deployCreatorCoinDirect(\n      {\n        name: metadata.name,\n        symbol: metadata.symbol,\n        metadataUri: metadataUri,\n        creatorAddress: address,\n        platformReferrer: ADMIN_PLATFORM_REFERRAL as Address,\n        manualPoolConfig: manualPoolConfig,\n        contentUrl: metadata.externalUrl || metadataUri,\n        useActivityTracker: true, // Enable on-chain activity tracking for grants\n      },\n      walletClient,\n      chainId\n    );\n\n    console.log(\"‚úÖ Coin deployed successfully:\", directResult.address);\n\n    return {\n      hash: directResult.hash,\n      address: directResult.address,\n      deployment: null\n    };\n\n  } catch (error) {\n    console.error(\"‚ùå Zora coin creation with wallet error:\", error);\n    throw new Error(`Failed to create Zora coin: ${error instanceof Error ? error.message : String(error)}`);\n  }\n}\n\nexport async function getCoinStats(coinAddress: string) {\n  // This would integrate with Zora's coin querying APIs\n  // For now, return null as placeholder\n  return null;\n}\n\nexport async function tradeZoraCoin({\n  coinAddress,\n  ethAmount,\n  walletClient,\n  publicClient,\n  userAddress,\n  isBuying = true\n}: {\n  coinAddress: Address;\n  ethAmount: string;\n  walletClient: any;\n  publicClient: any;\n  userAddress: Address;\n  isBuying?: boolean;\n}) {\n  if (!ZORA_API_KEY) {\n    throw new Error(\"Zora API key not configured\");\n  }\n\n  try {\n    const { tradeCoin } = await import(\"@zoralabs/coins-sdk\");\n\n    // Convert ETH amount to wei for the transaction\n    const amountInWei = parseEther(ethAmount);\n\n    // Admin trade referral address for earning 4% of this specific trade\n    const ADMIN_TRADE_REFERRAL = \"0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7\";\n\n    // Create trade parameters according to Zora SDK documentation\n    const tradeParameters = isBuying ? {\n      // Buying coin with ETH\n      sell: { type: \"eth\" as const },\n      buy: { \n        type: \"erc20\" as const, \n        address: coinAddress \n      },\n      amountIn: amountInWei,\n      slippage: 0.05, // 5% slippage tolerance\n      sender: userAddress,\n      tradeReferrer: ADMIN_TRADE_REFERRAL, // Earn 4% of this trade\n    } : {\n      // Selling coin for ETH\n      sell: { \n        type: \"erc20\" as const, \n        address: coinAddress \n      },\n      buy: { type: \"eth\" as const },\n      amountIn: amountInWei,\n      slippage: 0.15, // 15% slippage tolerance for selling\n      sender: userAddress,\n      tradeReferrer: ADMIN_TRADE_REFERRAL, // Earn 4% of this trade\n    };\n\n    console.log(\"Trading with parameters:\", tradeParameters);\n\n    // Get account from wallet client\n    const account = walletClient.account;\n    if (!account) {\n      throw new Error(\"No account found in wallet client\");\n    }\n\n    const receipt = await tradeCoin({\n      tradeParameters,\n      walletClient,\n      account,\n      publicClient,\n    });\n\n    console.log(\"Trade receipt:\", receipt);\n\n    if (!receipt || !receipt.transactionHash) {\n      throw new Error(\"Trade transaction failed - no transaction hash returned\");\n    }\n\n    return {\n      hash: receipt.transactionHash,\n      success: true,\n      receipt\n    };\n  } catch (error) {\n    console.error(\"Trade error:\", error);\n\n    // Provide more specific error messages\n    if (error instanceof Error) {\n      if (error.message.includes(\"insufficient funds\")) {\n        throw new Error(\"Insufficient ETH balance for this trade\");\n      } else if (error.message.includes(\"user rejected\")) {\n        throw new Error(\"Transaction was cancelled by user\");\n      } else if (error.message.includes(\"slippage\")) {\n        throw new Error(\"Trade failed due to high slippage - try again with higher slippage tolerance\");\n      } else if (error.message.includes(\"Slippage must be less than 1\")) {\n        throw new Error(\"Invalid slippage configuration\");\n      } else if (error.message.includes(\"Amount in must be greater than 0\")) {\n        throw new Error(\"Trade amount must be greater than 0\");\n      } else {\n        throw new Error(`Trading failed: ${error.message}`);\n      }\n    }\n\n    throw new Error(\"Trading failed - unknown error occurred\");\n  }\n}\n\n// Export for compatibility\nexport const createBaseCoin = createZoraCoin;","size_bytes":12154},"server/registry-service.ts":{"content":"import { createPublicClient, createWalletClient, http, Hash, keccak256, toBytes } from \"viem\";\nimport { base, baseSepolia } from \"viem/chains\";\nimport { privateKeyToAccount } from \"viem/accounts\";\nimport type { Coin } from \"@shared/schema\";\n\nconst REGISTRY_CONTRACT_ADDRESS = process.env.REGISTRY_CONTRACT_ADDRESS || \"0x0000000000000000000000000000000000000000\";\n\nconst REGISTRY_ABI = [\n  {\n    inputs: [\n      { name: \"coinAddresses\", type: \"address[]\" },\n      { name: \"creators\", type: \"address[]\" },\n      { name: \"metadataHashes\", type: \"bytes32[]\" }\n    ],\n    name: \"registerBatch\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\"\n  },\n  {\n    inputs: [{ name: \"coinAddress\", type: \"address\" }],\n    name: \"isPlatformCoin\",\n    outputs: [{ name: \"\", type: \"bool\" }],\n    stateMutability: \"view\",\n    type: \"function\"\n  },\n  {\n    inputs: [],\n    name: \"totalCoinsRegistered\",\n    outputs: [{ name: \"\", type: \"uint256\" }],\n    stateMutability: \"view\",\n    type: \"function\"\n  },\n  {\n    inputs: [{ name: \"creator\", type: \"address\" }],\n    name: \"getCreatorCoinCount\",\n    outputs: [{ name: \"\", type: \"uint256\" }],\n    stateMutability: \"view\",\n    type: \"function\"\n  }\n] as const;\n\nexport class RegistryService {\n  private publicClient: any;\n  private walletClient: any;\n  private chainId: number;\n\n  constructor(chainId: number = base.id) {\n    this.chainId = chainId;\n    const chain = chainId === baseSepolia.id ? baseSepolia : base;\n    \n    const alchemyApiKey = process.env.VITE_ALCHEMY_API_KEY || \"o3VW3WRXrsXXMRX3l7jZxLUqhWyZzXBy\";\n    const rpcUrl = process.env.VITE_ZORA_RPC_URL || \n                   `https://base-mainnet.g.alchemy.com/v2/${alchemyApiKey}`;\n\n    this.publicClient = createPublicClient({\n      chain,\n      transport: http(rpcUrl),\n    });\n\n    const privateKey = process.env.PLATFORM_PRIVATE_KEY;\n    if (privateKey) {\n      const account = privateKeyToAccount(privateKey as `0x${string}`);\n      this.walletClient = createWalletClient({\n        account,\n        chain,\n        transport: http(rpcUrl),\n      });\n    }\n  }\n\n  generateMetadataHash(coin: Coin): `0x${string}` {\n    const metadata = `${coin.name}|${coin.symbol}|${coin.ipfsUri || ''}`;\n    return keccak256(toBytes(metadata));\n  }\n\n  async registerCoinsBatch(coins: Coin[]): Promise<Hash | null> {\n    if (!this.walletClient) {\n      console.error(\"Wallet client not configured. Set PLATFORM_PRIVATE_KEY environment variable.\");\n      return null;\n    }\n\n    if (coins.length === 0) {\n      console.log(\"No coins to register\");\n      return null;\n    }\n\n    try {\n      const coinAddresses = coins\n        .filter(c => c.address)\n        .map(c => c.address as `0x${string}`);\n      \n      const creators = coins\n        .filter(c => c.address)\n        .map(c => c.creator_wallet as `0x${string}`);\n      \n      const metadataHashes = coins\n        .filter(c => c.address)\n        .map(c => this.generateMetadataHash(c));\n\n      console.log(`Registering ${coinAddresses.length} coins to registry...`);\n\n      const { request } = await this.publicClient.simulateContract({\n        address: REGISTRY_CONTRACT_ADDRESS as `0x${string}`,\n        abi: REGISTRY_ABI,\n        functionName: 'registerBatch',\n        args: [coinAddresses, creators, metadataHashes],\n        account: this.walletClient.account,\n      });\n\n      const hash = await this.walletClient.writeContract(request);\n      \n      console.log(`Registry batch transaction sent: ${hash}`);\n      \n      const receipt = await this.publicClient.waitForTransactionReceipt({ hash });\n      \n      if (receipt.status === 'success') {\n        console.log(`Successfully registered ${coinAddresses.length} coins`);\n        return hash;\n      } else {\n        console.error(\"Registry transaction failed\");\n        return null;\n      }\n    } catch (error) {\n      console.error(\"Error registering coins batch:\", error);\n      return null;\n    }\n  }\n\n  async isPlatformCoin(coinAddress: string): Promise<boolean> {\n    try {\n      const result = await this.publicClient.readContract({\n        address: REGISTRY_CONTRACT_ADDRESS as `0x${string}`,\n        abi: REGISTRY_ABI,\n        functionName: 'isPlatformCoin',\n        args: [coinAddress as `0x${string}`],\n      });\n      \n      return result as boolean;\n    } catch (error) {\n      console.error(\"Error checking platform coin:\", error);\n      return false;\n    }\n  }\n\n  async getTotalCoinsRegistered(): Promise<number> {\n    try {\n      const result = await this.publicClient.readContract({\n        address: REGISTRY_CONTRACT_ADDRESS as `0x${string}`,\n        abi: REGISTRY_ABI,\n        functionName: 'totalCoinsRegistered',\n      });\n      \n      return Number(result);\n    } catch (error) {\n      console.error(\"Error getting total coins:\", error);\n      return 0;\n    }\n  }\n\n  async getCreatorCoinCount(creatorAddress: string): Promise<number> {\n    try {\n      const result = await this.publicClient.readContract({\n        address: REGISTRY_CONTRACT_ADDRESS as `0x${string}`,\n        abi: REGISTRY_ABI,\n        functionName: 'getCreatorCoinCount',\n        args: [creatorAddress as `0x${string}`],\n      });\n      \n      return Number(result);\n    } catch (error) {\n      console.error(\"Error getting creator coin count:\", error);\n      return 0;\n    }\n  }\n}\n","size_bytes":5285},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n/**\n * Format currency values with smart precision:\n * - For values >= $1B: show in Billions (e.g., $1.23B)\n * - For values >= $1M: show in Millions (e.g., $4.56M)\n * - For values >= $1K: show in Thousands (e.g., $7.89K)\n * - For values < $1K: show 2 decimal places (e.g., $123.45)\n */\nexport function formatSmartCurrency(value: number | string | null | undefined): string {\n  // Handle null, undefined, or non-numeric values\n  if (value == null || value === '') return \"$0.00\";\n\n  // Convert string to number if needed\n  const numValue = typeof value === 'string' ? parseFloat(value) : value;\n\n  // Handle NaN or invalid numbers\n  if (isNaN(numValue)) return \"$0.00\";\n\n  if (numValue >= 1_000_000_000) {\n    return `$${(numValue / 1_000_000_000).toFixed(2)}B`;\n  }\n  if (numValue >= 1_000_000) {\n    return `$${(numValue / 1_000_000).toFixed(2)}M`;\n  }\n  if (numValue >= 1_000) {\n    return `$${(numValue / 1_000).toFixed(2)}K`;\n  }\n  return `$${numValue.toLocaleString(\"en-US\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n}\n\n// Format Zora coin supply with proper decimals\nexport function formatCoinSupply(supply: string | number): string {\n  const supplyNum = typeof supply === 'string' ? parseFloat(supply) : supply;\n  if (supplyNum >= 1_000_000_000) {\n    return `${(supplyNum / 1_000_000_000).toFixed(2)}B`;\n  }\n  if (supplyNum >= 1_000_000) {\n    return `${(supplyNum / 1_000_000).toFixed(2)}M`;\n  }\n  if (supplyNum >= 1_000) {\n    return `${(supplyNum / 1_000).toFixed(2)}K`;\n  }\n  return supplyNum.toFixed(2);\n}\n\n// Format price change percentage\nexport function formatPriceChange(change: number): string {\n  const prefix = change >= 0 ? '+' : '';\n  return `${prefix}${change.toFixed(2)}%`;\n}\n\n// Parse Zora token amount (considering 18 decimals)\nexport function parseZoraTokenAmount(amount: string): string {\n  const value = parseFloat(amount) / Math.pow(10, 18);\n  return value.toFixed(6);\n}","size_bytes":2084},"client/src/pages/groups.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Users, Search, Plus } from \"lucide-react\";\nimport type { Group } from \"@shared/schema\";\n\nexport default function Groups() {\n  const { data: groups, isLoading } = useQuery<Group[]>({\n    queryKey: [\"/api/groups\"],\n  });\n\n  return (\n    <div className=\"container max-w-5xl mx-auto px-4 py-8 space-y-8\">\n      {/* Header */}\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-3\">\n          <Users className=\"h-8 w-8 text-primary\" />\n          <div>\n            <h1 className=\"text-3xl font-bold\">Groups</h1>\n            <p className=\"text-muted-foreground\">\n              Join creator communities and collaborate\n            </p>\n          </div>\n        </div>\n        <Button data-testid=\"button-create-group\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Create Group\n        </Button>\n      </div>\n\n      {/* Search */}\n      <div className=\"relative\">\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n        <Input\n          type=\"search\"\n          placeholder=\"Search groups...\"\n          className=\"pl-10 h-12\"\n          data-testid=\"input-search-groups\"\n        />\n      </div>\n\n      {/* Groups Grid */}\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[...Array(6)].map((_, i) => (\n            <div\n              key={i}\n              className=\"h-64 bg-card rounded-2xl animate-pulse\"\n              data-testid=\"skeleton-group-card\"\n            />\n          ))}\n        </div>\n      ) : groups && groups.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {groups.map((group) => (\n            <Card\n              key={group.id}\n              className=\"overflow-hidden hover-elevate active-elevate-2 transition-all duration-200 cursor-pointer\"\n              data-testid={`card-group-${group.id}`}\n            >\n              {group.coverImageUrl && (\n                <div className=\"h-32 overflow-hidden\">\n                  <img\n                    src={group.coverImageUrl}\n                    alt={group.name}\n                    className=\"w-full h-full object-cover\"\n                  />\n                </div>\n              )}\n              {!group.coverImageUrl && (\n                <div className=\"h-32 bg-gradient-to-br from-primary/20 to-accent/20\" />\n              )}\n\n              <div className=\"p-6 space-y-4\">\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <h3\n                      className=\"font-bold text-lg line-clamp-1\"\n                      data-testid={`text-group-name-${group.id}`}\n                    >\n                      {group.name}\n                    </h3>\n                    {group.isPrivate && (\n                      <Badge variant=\"secondary\" className=\"shrink-0\">\n                        Private\n                      </Badge>\n                    )}\n                  </div>\n\n                  {group.description && (\n                    <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                      {group.description}\n                    </p>\n                  )}\n\n                  {group.category && (\n                    <Badge className=\"bg-accent text-accent-foreground\">\n                      {group.category}\n                    </Badge>\n                  )}\n                </div>\n\n                <div className=\"flex items-center justify-between pt-2 border-t border-border\">\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <Users className=\"h-4 w-4\" />\n                    <span data-testid={`text-member-count-${group.id}`}>\n                      {group.memberCount?.toLocaleString() || 0} members\n                    </span>\n                  </div>\n                  <Button size=\"sm\" data-testid={`button-join-${group.id}`}>\n                    Join\n                  </Button>\n                </div>\n              </div>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-16\">\n          <Users className=\"h-16 w-16 text-muted-foreground mx-auto mb-4\" />\n          <h3 className=\"text-lg font-semibold mb-2\">No groups yet</h3>\n          <p className=\"text-muted-foreground mb-6\">\n            Create the first group and start building your community\n          </p>\n          <Button>\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Create Group\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":4909},"client/src/components/top-creators-stories.tsx":{"content":"import { useState } from \"react\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { cn, formatSmartCurrency } from \"@/lib/utils\";\nimport type { User } from \"@shared/schema\";\nimport ProfileCardModal from \"@/components/profile-card-modal\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\n\ninterface TopCreatorsStoriesProps {\n  creators: User[];\n  limit?: number;\n  className?: string;\n}\n\nexport function TopCreatorsStories({\n  creators,\n  limit,\n  className,\n}: TopCreatorsStoriesProps) {\n  const isMobile = useIsMobile();\n  const displayLimit = limit || (isMobile ? 5 : 6);\n  const topCreators = isMobile ? creators.slice(0, 5) : creators.slice(0, displayLimit);\n  const [selectedCreator, setSelectedCreator] = useState<string | null>(null);\n  const [isProfileModalOpen, setIsProfileModalOpen] = useState(false);\n\n  return (\n    <>\n      <div\n        className={cn(\n          \"flex gap-3 overflow-x-auto scrollbar-hide pb-2 justify-start md:justify-center top-creators-stories -mt-4 md:mt-0\",\n          className,\n        )}\n        data-tour=\"top-creators\"\n      >\n        {topCreators.map((creator, index) => {\n          const earnings = formatSmartCurrency((creator.e1xpPoints || 0) * 0.001).replace('$', '');\n\n          return (\n            <div\n              key={creator.id}\n              onClick={() => {\n                setSelectedCreator(creator.walletAddress || \"\");\n                setIsProfileModalOpen(true);\n              }}\n              className=\"flex flex-col items-center gap-1.5 flex-shrink-0 group cursor-pointer\"\n              data-testid={`link-story-creator-${creator.id}`}\n            >\n              <div className=\"relative\">\n                <div className=\"p-[2px] rounded-full bg-gradient-to-tr from-primary via-secondary to-accent group-hover:scale-105 transition-transform duration-200\">\n                  <div className=\"p-[2px] rounded-full bg-background\">\n                    <Avatar className=\"h-16 w-16 md:h-12 md:w-12 ring-0\">\n                      <AvatarImage src={creator.avatarUrl || undefined} />\n                      <AvatarFallback className=\"bg-gradient-to-br from-primary/20 to-secondary/20 text-foreground font-bold text-base md:text-sm\">\n                        {creator.username?.charAt(0).toUpperCase() || \"?\"}\n                      </AvatarFallback>\n                    </Avatar>\n                  </div>\n                </div>\n\n                <div className=\"absolute -bottom-0.5 -right-0.5 min-w-[24px] md:min-w-[20px] h-4 md:h-3.5 px-1.5 md:px-1 rounded-full bg-white flex items-center justify-center text-[9px] md:text-[8px] font-bold text-green-600 ring-1 ring-background shadow-sm\">\n                  ${earnings}\n                </div>\n              </div>\n\n              <span className=\"text-[11px] md:text-[10px] font-medium text-foreground max-w-[64px] md:max-w-[56px] truncate text-center group-hover:text-primary transition-colors\">\n                {creator.username || \"Unknown\"}\n              </span>\n            </div>\n          );\n        })}\n      </div>\n      \n      {selectedCreator && (\n        <ProfileCardModal\n          creatorAddress={selectedCreator}\n          open={isProfileModalOpen}\n          onOpenChange={setIsProfileModalOpen}\n        />\n      )}\n    </>\n  );\n}\n","size_bytes":3285},"server/streak-reminder-cron.ts":{"content":"import cron from 'node-cron';\nimport { storage } from './supabase-storage';\nimport { sendTelegramNotification } from './telegram-bot';\nimport { notificationService } from './notification-service'; // Assuming notificationService is imported from here\n\n// Run every 6 hours to remind users about unclaimed points\nexport function startStreakReminderCron() {\n  // Run at 9 AM, 3 PM, and 9 PM daily\n  cron.schedule('0 9,15,21 * * *', async () => {\n    try {\n      console.log('üîî Running streak reminder check...');\n\n      const creators = await storage.getAllCreators();\n      const today = new Date().toISOString().split('T')[0];\n      let remindersCount = 0;\n\n      for (const creator of creators) {\n        try {\n          // Use address for wallet users, privyId for email-only users\n          const userId = creator.address || creator.privyId || creator.id;\n          if (!userId) continue; // Skip if no identifier\n          \n          const loginStreak = await storage.getLoginStreak(userId);\n\n          // New user - hasn't claimed first bonus\n          if (!loginStreak) {\n            await notificationService.notifyWelcomeBonus(userId);\n            remindersCount++;\n            continue;\n          }\n\n          // User hasn't claimed today's points\n          if (loginStreak.lastLoginDate !== today) {\n            const lastLogin = new Date(loginStreak.lastLoginDate || today);\n            const todayDate = new Date(today);\n            const daysDiff = Math.floor((todayDate.getTime() - lastLogin.getTime()) / (1000 * 60 * 60 * 24));\n\n            let currentStreak = parseInt(loginStreak.currentStreak || '0');\n            let pointsAvailable = 10;\n            let streakStatus = '';\n\n            if (daysDiff === 1) {\n              const nextStreak = currentStreak + 1;\n              pointsAvailable = 10 + Math.min(Math.floor(nextStreak / 7) * 5, 50);\n              streakStatus = `Continue your ${currentStreak} day streak`;\n            } else {\n              pointsAvailable = 10;\n              streakStatus = `Your ${currentStreak} day streak will reset`;\n            }\n\n            await notificationService.notifyE1XPClaimReminder(\n              userId,\n              pointsAvailable.toString()\n            );\n\n            remindersCount++;\n          }\n        } catch (error) {\n          const userId = creator.address || creator.privyId || creator.id;\n          console.error(`Error sending reminder to ${userId}:`, error);\n        }\n      }\n\n      console.log(`‚úÖ Sent ${remindersCount} streak reminders`);\n    } catch (error) {\n      console.error('‚ùå Streak reminder cron error:', error);\n    }\n  });\n\n  console.log('‚úÖ Streak reminder cron started (runs at 9 AM, 3 PM, and 9 PM daily)');\n}","size_bytes":2717},"client/src/components/notification-bell.tsx":{"content":"import { useEffect, useRef, useState, useCallback } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link } from \"wouter\";\nimport { socketClient } from \"@/lib/socket-client\";\nimport type { Notification } from \"@shared/schema\";\n\nconst NotificationIcon = ({ className }: { className?: string }) => (\n  <svg width=\"18\" height=\"20\" viewBox=\"0 0 18 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" className={className}>\n    <path d=\"M5.35206 18.242C5.78721 18.7922 6.34171 19.2364 6.97367 19.541C7.60564 19.8455 8.29855 20.0025 9.00006 20C9.70158 20.0025 10.3945 19.8455 11.0264 19.541C11.6584 19.2364 12.2129 18.7922 12.6481 18.242C10.2271 18.5702 7.77299 18.5702 5.35206 18.242ZM15.7501 7V7.704C15.7501 8.549 15.9901 9.375 16.4421 10.078L17.5501 11.801C18.5611 13.375 17.7891 15.514 16.0301 16.011C11.4338 17.313 6.56631 17.313 1.97006 16.011C0.211062 15.514 -0.560938 13.375 0.450062 11.801L1.55806 10.078C2.01164 9.36936 2.25217 8.54537 2.25106 7.704V7C2.25106 3.134 5.27306 0 9.00006 0C12.7271 0 15.7501 3.134 15.7501 7Z\" fill=\"currentColor\"/>\n  </svg>\n);\n\nexport function NotificationBell() {\n  const { authenticated, user, getAccessToken } = usePrivy();\n  const { toast } = useToast();\n  const previousNotificationIds = useRef<Set<string>>(new Set());\n  const [unreadMessageCount, setUnreadMessageCount] = useState(0);\n\n  // Shared function to fetch unread message count\n  const fetchUnreadMessages = useCallback(async () => {\n    if (!authenticated || !user) {\n      setUnreadMessageCount(0);\n      return;\n    }\n\n    try {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {};\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(\"/api/messages/unread-count\", {\n        credentials: \"include\",\n        headers,\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setUnreadMessageCount(data.count || 0);\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch unread message count:\", error);\n    }\n  }, [authenticated, user, getAccessToken]);\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/e1xp/notifications\"],\n    enabled: authenticated,\n    refetchInterval: 10000,\n    queryFn: async () => {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {};\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(\"/api/e1xp/notifications\", {\n        credentials: \"include\",\n        headers,\n      });\n      if (!response.ok) throw new Error('Failed to fetch notifications');\n      return response.json();\n    },\n  });\n\n  // Show toast for new notifications\n  useEffect(() => {\n    if (!notifications.length) return;\n\n    if (previousNotificationIds.current.size === 0) {\n      previousNotificationIds.current = new Set(notifications.map((n) => n.id));\n      return;\n    }\n\n    const newNotifications = notifications.filter(\n      (n) => !previousNotificationIds.current.has(n.id),\n    );\n\n    newNotifications.forEach((notification) => {\n      const icons: Record<string, string> = {\n        referral: \"üéÅ\",\n        reward: \"üèÜ\",\n        trade: \"üìà\",\n        streak: \"üî•\",\n        welcome: \"üëã\",\n        admin: \"üí¨\",\n        milestone: \"üéØ\",\n        follower: \"üë•\",\n        points_earned: \"‚≠ê\",\n        trade_completed: \"‚úÖ\",\n      };\n      const emoji = icons[notification.type] || \"üîî\";\n\n      toast({\n        title: `${emoji} ${notification.title}`,\n        description: notification.message,\n        duration: 4000,\n      });\n    });\n\n    previousNotificationIds.current = new Set(notifications.map((n) => n.id));\n  }, [notifications, toast]);\n\n  // Get unread message count from conversations\n  useEffect(() => {\n    if (!authenticated || !user) return;\n\n    fetchUnreadMessages();\n    const interval = setInterval(fetchUnreadMessages, 30000); // Check every 30 seconds\n\n    return () => clearInterval(interval);\n  }, [authenticated, user, fetchUnreadMessages]);\n\n  // Connect to Socket.IO and listen for admin messages\n  useEffect(() => {\n    if (!authenticated || !user) {\n      socketClient.disconnect();\n      return;\n    }\n\n    // Connect to Socket.IO with user's wallet address or Privy ID (for email users)\n    const userId = user.wallet?.address || user.id;\n    console.log('üîå Connecting to Socket.IO with userId:', userId);\n    socketClient.connect(userId);\n\n    const handleAdminMessage = (data: any) => {\n      console.log('üì® Received admin message:', data);\n      toast({\n        title: \"üí¨ Message from Admin\",\n        description: data.message,\n        duration: 6000,\n      });\n    };\n\n    const handleAdminBroadcast = (data: any) => {\n      console.log('üì¢ Received admin broadcast:', data);\n      toast({\n        title: \"üì¢ Announcement from Creatorland\",\n        description: data.message,\n        duration: 6000,\n      });\n    };\n\n    // Handle new messages from other users\n    const handleNewMessage = (message: any) => {\n      console.log('üí¨ Received new message:', message);\n      // Increment unread message count\n      setUnreadMessageCount((prev) => prev + 1);\n      \n      // Show toast notification\n      toast({\n        title: \"üí¨ New Message\",\n        description: message.content.length > 50 \n          ? `${message.content.substring(0, 50)}...` \n          : message.content,\n        duration: 5000,\n      });\n    };\n\n    // Handle conversation updates\n    const handleConversationUpdated = () => {\n      // Refresh unread count when conversations update\n      fetchUnreadMessages();\n    };\n\n    // Handle real-time notifications (welcome bonus, rewards, etc.)\n    const handleNotification = (notification: any) => {\n      console.log('üîî Received real-time notification:', notification);\n      \n      const icons: Record<string, string> = {\n        referral: \"üéÅ\",\n        reward: \"üèÜ\",\n        trade: \"üìà\",\n        streak: \"üî•\",\n        welcome: \"üëã\",\n        admin: \"üí¨\",\n        milestone: \"üéØ\",\n        follower: \"üë•\",\n        points_earned: \"‚≠ê\",\n        trade_completed: \"‚úÖ\",\n      };\n      const emoji = icons[notification.type] || \"üîî\";\n\n      toast({\n        title: `${emoji} ${notification.title}`,\n        description: notification.message,\n        duration: 5000,\n      });\n      \n      // Refetch notifications to update the badge count\n      queryClient.invalidateQueries({ queryKey: [\"/api/e1xp/notifications\"] });\n    };\n\n    socketClient.on('admin_message', handleAdminMessage);\n    socketClient.on('admin_broadcast', handleAdminBroadcast);\n    socketClient.on('new_message', handleNewMessage);\n    socketClient.on('conversation_updated', handleConversationUpdated);\n    socketClient.on('notification', handleNotification);\n\n    return () => {\n      socketClient.off('admin_message', handleAdminMessage);\n      socketClient.off('admin_broadcast', handleAdminBroadcast);\n      socketClient.off('new_message', handleNewMessage);\n      socketClient.off('conversation_updated', handleConversationUpdated);\n      socketClient.off('notification', handleNotification);\n    };\n  }, [authenticated, user, toast, fetchUnreadMessages]);\n\n  const unreadCount = notifications.filter((n) => !n.read).length;\n  const totalUnread = unreadCount + unreadMessageCount;\n\n  if (!authenticated) return null;\n\n  return (\n    <Link href=\"/notifications\">\n      <Button variant=\"ghost\" size=\"icon\" className=\"relative\" data-testid=\"button-notifications\">\n        <NotificationIcon className=\"h-5 w-5\" />\n        {totalUnread > 0 && (\n          <span className=\"absolute top-0 right-0 bg-destructive text-destructive-foreground rounded-full h-4 min-w-4 px-1 flex items-center justify-center text-[10px] font-bold leading-none\" data-testid=\"badge-notification-count\">\n            {totalUnread > 9 ? \"9+\" : totalUnread}\n          </span>\n        )}\n      </Button>\n    </Link>\n  );\n}\n","size_bytes":8252},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"server/telegram-bot.ts":{"content":"import TelegramBot from 'node-telegram-bot-api';\nimport { storage } from './storage';\n\nconst TELEGRAM_BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN || '';\nconst TELEGRAM_CHANNEL_ID = process.env.TELEGRAM_CHANNEL_ID || '';\n\nlet bot: TelegramBot | null = null;\nlet botInstance: any = null; // Added for singleton check\nconst userWallets = new Map<number, string>();\nlet isPolling = false;\nlet initializationPromise: Promise<void> | null = null;\n\n// Helper function to format wallet address for display\nfunction formatAddress(address: string): string {\n  if (!address) return 'Unknown';\n  return `${address.slice(0, 6)}...${address.slice(-4)}`;\n}\n\n// Helper function to format timestamps\nfunction formatTimestamp(date: Date | string | null | undefined): string {\n  if (!date) return 'N/A';\n  const d = typeof date === 'string' ? new Date(date) : date;\n  if (!d || isNaN(d.getTime())) return 'N/A';\n  return d.toLocaleString('en-US', { \n    month: '2-digit',\n    day: '2-digit', \n    year: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    second: '2-digit',\n    hour12: false,\n    timeZone: 'UTC'\n  }).replace(',', '') + ' UTC';\n}\n\n// Helper function to format numbers with commas\nfunction formatNumber(num: number | string): string {\n  const n = typeof num === 'string' ? parseFloat(num) : num;\n  if (isNaN(n)) return '0.00';\n  return n.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n}\n\n// Format new coin creation notification\nfunction formatNewCoinMessage(coin: any, stats?: any): string {\n  const marketCap = stats?.marketCap ? `$${formatNumber(stats.marketCap)}` : '$0.00';\n  const totalSupply = stats?.totalSupply ? formatNumber(stats.totalSupply) : '1.00B';\n  const creatorAddress = coin.creator_wallet || 'Unknown';\n  const contractAddress = coin.address || 'Pending';\n\n  let message = `üÜïü™ô NEW CREATOR COIN CREATED\\n\\n`;\n  message += `üìõ ${coin.name} (${coin.symbol})\\n`;\n  message += `üí∞ Market Cap: ${marketCap}\\n`;\n  message += `üìä Total Supply: ${totalSupply}\\n`;\n  message += `üë§ [${formatAddress(creatorAddress)}](https://zora.co/profile/${creatorAddress})\\n`;\n  message += `üìÖ Created: ${formatTimestamp(coin.createdAt)}\\n`;\n  message += `üìÑ Contract: ${formatAddress(contractAddress)}\\n\\n`;\n\n  if (coin.address) {\n    message += `üîó [View on Zora](https://zora.co/creator-coins/base:${coin.address}) | `;\n    message += `[BaseScan](https://basescan.org/address/${coin.address}) | `;\n    message += `[DexScreener](https://dexscreener.com/base/${coin.address})`;\n  }\n\n  return message;\n}\n\n// Format trading activity notification\nfunction formatTradingActivityMessage(coin: any, stats?: any, activityTime?: Date): string {\n  const marketCap = stats?.marketCap ? `$${formatNumber(stats.marketCap)}` : '$0.00';\n  const volume24h = stats?.volume24h ? `$${formatNumber(stats.volume24h)}` : '$0.00';\n  const totalSupply = stats?.totalSupply ? formatNumber(stats.totalSupply) : '1.00B';\n  const holders = stats?.uniqueHolders || stats?.holders || 0;\n  const creatorAddress = coin.creator_wallet || 'Unknown';\n  const contractAddress = coin.address || 'Unknown';\n\n  let message = `üîÑüìä TRADING ACTIVITY\\n\\n`;\n  message += `üìõ ${coin.name} (${coin.symbol})\\n`;\n  message += `üí∞ Market Cap: ${marketCap}\\n`;\n  message += `üìä 24h Volume: ${volume24h}\\n`;\n  message += `üìä Total Supply: ${totalSupply}\\n`;\n  message += `üë• Holders: ${holders}\\n`;\n  message += `üë§ [${formatAddress(creatorAddress)}](https://zora.co/profile/${creatorAddress})\\n`;\n  message += `üìÑ Contract: ${formatAddress(contractAddress)}\\n`;\n  message += `üìÖ Created: ${formatTimestamp(coin.createdAt)}\\n`;\n  if (activityTime) {\n    message += `‚è∞ Activity: ${formatTimestamp(activityTime)}\\n`;\n  }\n  message += `\\n`;\n\n  if (coin.address) {\n    message += `üîó [View on Zora](https://zora.co/creator-coins/base:${coin.address}) | `;\n    message += `[BaseScan](https://basescan.org/address/${coin.address}) | `;\n    message += `[DexScreener](https://dexscreener.com/base/${coin.address})`;\n  }\n\n  return message;\n}\n\n// Format buy activity notification\nfunction formatBuyActivityMessage(coin: any, stats?: any, activityTime?: Date): string {\n  const marketCap = stats?.marketCap ? `$${formatNumber(stats.marketCap)}` : '$0.00';\n  const totalSupply = stats?.totalSupply ? formatNumber(stats.totalSupply) : '1.00B';\n  const holders = stats?.uniqueHolders || stats?.holders || 0;\n  const creatorAddress = coin.creator_wallet || 'Unknown';\n  const contractAddress = coin.address || 'Unknown';\n\n  let message = `üü¢üí∞ BUY ACTIVITY\\n\\n`;\n  message += `üìõ ${coin.name} (${coin.symbol})\\n`;\n  message += `üí∞ Market Cap: ${marketCap}\\n`;\n  message += `üìä Total Supply: ${totalSupply}\\n`;\n  message += `üë• Holders: ${holders}\\n`;\n  message += `üë§ [${formatAddress(creatorAddress)}](https://zora.co/profile/${creatorAddress})\\n`;\n  message += `üìÑ Contract: ${formatAddress(contractAddress)}\\n`;\n  message += `üìÖ Created: ${formatTimestamp(coin.createdAt)}\\n`;\n  if (activityTime) {\n    message += `‚è∞ Activity: ${formatTimestamp(activityTime)}\\n`;\n  }\n  message += `\\n`;\n\n  if (coin.address) {\n    message += `üîó [View on Zora](https://zora.co/creator-coins/base:${coin.address}) | `;\n    message += `[BaseScan](https://basescan.org/address/${coin.address}) | `;\n    message += `[DexScreener](https://dexscreener.com/base/${coin.address})`;\n  }\n\n  return message;\n}\n\n// Format sell activity notification\nfunction formatSellActivityMessage(coin: any, stats?: any, activityTime?: Date): string {\n  const marketCap = stats?.marketCap ? `$${formatNumber(stats.marketCap)}` : '$0.00';\n  const totalSupply = stats?.totalSupply ? formatNumber(stats.totalSupply) : '1.00B';\n  const holders = stats?.uniqueHolders || stats?.holders || 0;\n  const creatorAddress = coin.creator_wallet || 'Unknown';\n  const contractAddress = coin.address || 'Unknown';\n\n  let message = `üî¥üí∞ SELL ACTIVITY\\n\\n`;\n  message += `üìõ ${coin.name} (${coin.symbol})\\n`;\n  message += `üí∞ Market Cap: ${marketCap}\\n`;\n  message += `üìä Total Supply: ${totalSupply}\\n`;\n  message += `üë• Holders: ${holders}\\n`;\n  message += `üë§ [${formatAddress(creatorAddress)}](https://zora.co/profile/${creatorAddress})\\n`;\n  message += `üìÑ Contract: ${formatAddress(contractAddress)}\\n`;\n  message += `üìÖ Created: ${formatTimestamp(coin.createdAt)}\\n`;\n  if (activityTime) {\n    message += `‚è∞ Activity: ${formatTimestamp(activityTime)}\\n`;\n  }\n  message += `\\n`;\n\n  if (coin.address) {\n    message += `üîó [View on Zora](https://zora.co/creator-coins/base:${coin.address}) | `;\n    message += `[BaseScan](https://basescan.org/address/${coin.address}) | `;\n    message += `[DexScreener](https://dexscreener.com/base/${coin.address})`;\n  }\n\n  return message;\n}\n\n// Format daily market cap update\nfunction formatDailyMarketCapUpdate(coins: any[]): string {\n  let message = `üìäüí∞ DAILY MARKET CAP UPDATE\\n\\n`;\n\n  const totalMarketCap = coins.reduce((sum, coin) => {\n    const mc = coin.stats?.marketCap || 0;\n    return sum + (typeof mc === 'string' ? parseFloat(mc) : mc);\n  }, 0);\n\n  message += `üíµ Total Platform Market Cap: $${formatNumber(totalMarketCap)}\\n`;\n  message += `ü™ô Total Coins: ${coins.length}\\n\\n`;\n\n  // Top 5 coins by market cap\n  const topCoins = coins\n    .filter(c => c.stats?.marketCap)\n    .sort((a, b) => {\n      const mcA = typeof a.stats.marketCap === 'string' ? parseFloat(a.stats.marketCap) : a.stats.marketCap;\n      const mcB = typeof b.stats.marketCap === 'string' ? parseFloat(b.stats.marketCap) : b.stats.marketCap;\n      return mcB - mcA;\n    })\n    .slice(0, 5);\n\n  if (topCoins.length > 0) {\n    message += `üèÜ TOP 5 BY MARKET CAP:\\n\\n`;\n    topCoins.forEach((coin, index) => {\n      const mc = typeof coin.stats.marketCap === 'string' ? parseFloat(coin.stats.marketCap) : coin.stats.marketCap;\n      message += `${index + 1}. ${coin.name} - $${formatNumber(mc)}\\n`;\n    });\n  }\n\n  return message;\n}\n\n// Format daily volume update\nfunction formatDailyVolumeUpdate(coins: any[]): string {\n  let message = `üìàüìä 24H VOLUME UPDATE\\n\\n`;\n\n  const totalVolume = coins.reduce((sum, coin) => {\n    const vol = coin.stats?.volume24h || 0;\n    return sum + (typeof vol === 'string' ? parseFloat(vol) : vol);\n  }, 0);\n\n  message += `üíµ Total 24h Volume: $${formatNumber(totalVolume)}\\n`;\n  message += `ü™ô Active Coins: ${coins.filter(c => c.stats?.volume24h && parseFloat(c.stats.volume24h) > 0).length}\\n\\n`;\n\n  // Top 5 coins by volume\n  const topCoins = coins\n    .filter(c => c.stats?.volume24h && parseFloat(c.stats.volume24h) > 0)\n    .sort((a, b) => {\n      const volA = typeof a.stats.volume24h === 'string' ? parseFloat(a.stats.volume24h) : a.stats.volume24h;\n      const volB = typeof b.stats.volume24h === 'string' ? parseFloat(b.stats.volume24h) : b.stats.volume24h;\n      return volB - volA;\n    })\n    .slice(0, 5);\n\n  if (topCoins.length > 0) {\n    message += `üèÜ TOP 5 BY 24H VOLUME:\\n\\n`;\n    topCoins.forEach((coin, index) => {\n      const vol = typeof coin.stats.volume24h === 'string' ? parseFloat(coin.stats.volume24h) : coin.stats.volume24h;\n      message += `${index + 1}. ${coin.name} - $${formatNumber(vol)}\\n`;\n    });\n  }\n\n  return message;\n}\n\n// Format creator earnings update\nfunction formatCreatorEarningsUpdate(walletAddress: string, totalEarnings: number, coins: any[]): string {\n  let message = `üíéüí∞ YOUR CREATOR EARNINGS\\n\\n`;\n  message += `üë§ Wallet: [${formatAddress(walletAddress)}](https://zora.co/profile/${walletAddress})\\n`;\n  message += `üíµ Total Earnings: $${formatNumber(totalEarnings)}\\n`;\n  message += `ü™ô Total Coins Created: ${coins.length}\\n\\n`;\n\n  // Show top earning coins\n  const earningCoins = coins\n    .filter(c => c.stats?.creatorEarnings && c.stats.creatorEarnings.length > 0)\n    .sort((a, b) => {\n      const earningsA = parseFloat(a.stats.creatorEarnings[0]?.amountUsd || '0');\n      const earningsB = parseFloat(b.stats.creatorEarnings[0]?.amountUsd || '0');\n      return earningsB - earningsA;\n    })\n    .slice(0, 5);\n\n  if (earningCoins.length > 0) {\n    message += `üèÜ TOP EARNING COINS:\\n\\n`;\n    earningCoins.forEach((coin, index) => {\n      const earnings = parseFloat(coin.stats.creatorEarnings[0]?.amountUsd || '0');\n      message += `${index + 1}. ${coin.name} - $${formatNumber(earnings)}\\n`;\n    });\n  }\n\n  return message;\n}\n\nexport async function initTelegramBot() {\n  // If initialization is already in progress, wait for it\n  if (initializationPromise) {\n    console.log('‚è≥ Telegram bot initialization already in progress, waiting...');\n    await initializationPromise;\n    return;\n  }\n\n  if (!TELEGRAM_BOT_TOKEN) {\n    console.warn('TELEGRAM_BOT_TOKEN not set, Telegram bot disabled');\n    return;\n  }\n\n  // Prevent multiple bot instances\n  if (botInstance && isPolling) {\n    console.log(\"‚ö†Ô∏è Telegram bot already initialized and polling, skipping...\");\n    return;\n  }\n\n  // Create initialization promise to prevent concurrent calls\n  initializationPromise = (async () => {\n    try {\n      // If a bot exists, stop it completely before creating a new one\n      if (bot) {\n        console.log('Existing Telegram bot found, cleaning up...');\n        try {\n          if (isPolling) {\n            await bot.stopPolling({ cancel: true });\n            await new Promise(resolve => setTimeout(resolve, 2000)); // Increased wait time\n          }\n          bot.removeAllListeners();\n          bot = null;\n          botInstance = null;\n          isPolling = false;\n          console.log('‚úÖ Cleaned up existing bot instance');\n        } catch (error) {\n          console.error('Error cleaning up existing bot:', error);\n          bot = null;\n          botInstance = null;\n          isPolling = false;\n        }\n      }\n\n      bot = new TelegramBot(TELEGRAM_BOT_TOKEN, { \n        polling: {\n          interval: 500,\n          autoStart: false,\n          params: {\n            timeout: 10\n          }\n        }\n      });\n\n      // Add polling error handler BEFORE starting polling\n      bot.on('polling_error', (error) => {\n        // Silently handle 409 conflicts - don't log repeatedly\n        if (error.message.includes('409 Conflict')) {\n          if (!global.isShuttingDown && isPolling) {\n            console.log('‚ö†Ô∏è Detected multiple bot instances, stopping this one...');\n            isPolling = false;\n            if (bot) {\n              bot.stopPolling({ cancel: true }).catch(() => {});\n              bot.removeAllListeners();\n              bot = null;\n              botInstance = null;\n            }\n          }\n        } else {\n          console.error('Telegram polling error:', error.message);\n        }\n      });\n\n      // Start polling manually to track state\n      try {\n        await bot.startPolling();\n        isPolling = true;\n        botInstance = bot;\n        console.log('Telegram bot polling started successfully');\n      } catch (error) {\n        console.error('Failed to start Telegram bot polling:', error);\n        isPolling = false;\n        bot = null;\n        botInstance = null;\n        throw error; // Re-throw to handle in outer try-catch\n      }\n    } finally {\n      initializationPromise = null;\n    }\n  })();\n\n  await initializationPromise;\n\n  bot.onText(/\\/start/, (msg) => {\n    const chatId = msg.chat.id;\n    bot?.sendMessage(\n      chatId,\n      'üëã Welcome to CoinIT Notifications!\\n\\n' +\n      'Connect your wallet to receive notifications about:\\n' +\n      '‚Ä¢ üÜï New coin creations\\n' +\n      '‚Ä¢ üü¢ Buy activity\\n' +\n      '‚Ä¢ üî¥ Sell activity\\n' +\n      '‚Ä¢ üîÑ Trading activity\\n' +\n      '‚Ä¢ üíé Creator earnings\\n' +\n      '‚Ä¢ üìä Market updates\\n\\n' +\n      'Use /connect <wallet_address> to link your wallet.'\n    );\n  });\n\n  bot.onText(/\\/connect (.+)/, async (msg, match) => {\n    const chatId = msg.chat.id;\n    const walletAddress = match?.[1];\n\n    if (!walletAddress || !walletAddress.startsWith('0x')) {\n      bot?.sendMessage(chatId, '‚ùå Invalid wallet address. Please use format: /connect 0x...');\n      return;\n    }\n\n    userWallets.set(chatId, walletAddress.toLowerCase());\n    await bot?.sendMessage(\n      chatId,\n      `‚úÖ Wallet connected: ${walletAddress}\\n\\nYou will now receive notifications for this wallet.`\n    );\n\n    try {\n      const { storage } = await import('./storage');\n      const userCoins = await storage.getCoinsByCreator(walletAddress.toLowerCase());\n\n      if (userCoins.length > 0) {\n        let message = `\\nü™ô *Your Existing Coins*\\n\\nYou have ${userCoins.length} coin(s):\\n\\n`;\n\n        for (const coin of userCoins.slice(0, 10)) {\n          message += `‚Ä¢ *${coin.name}* (${coin.symbol})\\n`;\n          if (coin.address) {\n            message += `  Contract: \\`${coin.address}\\`\\n`;\n          }\n          message += `  Status: ${coin.status}\\n\\n`;\n        }\n\n        if (userCoins.length > 10) {\n          message += `... and ${userCoins.length - 10} more coins\\n`;\n        }\n\n        await bot?.sendMessage(chatId, message, { parse_mode: 'Markdown' });\n      } else {\n        await bot?.sendMessage(chatId, '\\n‚ÑπÔ∏è You have no coins yet. Create your first coin to get started!');\n      }\n    } catch (error) {\n      console.error('Error fetching user coins:', error);\n    }\n  });\n\n  bot.onText(/\\/disconnect/, (msg) => {\n    const chatId = msg.chat.id;\n    userWallets.delete(chatId);\n    bot?.sendMessage(chatId, '‚úÖ Wallet disconnected. You will no longer receive notifications.');\n  });\n\n  bot.onText(/\\/status/, (msg) => {\n    const chatId = msg.chat.id;\n    const wallet = userWallets.get(chatId);\n\n    if (!wallet) {\n      bot?.sendMessage(chatId, '‚ùå No wallet connected. Use /connect <wallet_address> to connect.');\n      return;\n    }\n\n    bot?.sendMessage(chatId, `‚úÖ Connected to wallet: ${wallet}`);\n  });\n\n  console.log('Telegram bot initialized successfully');\n  botInstance = bot; // Store the initialized bot instance\n}\n\nexport async function sendTelegramNotification(\n  walletAddress: string | null | undefined,\n  title: string,\n  message: string,\n  type: string,\n  coinData?: any,\n  stats?: any\n) {\n  if (!bot) {\n    console.warn('Bot not initialized, cannot send notification.');\n    return;\n  }\n\n  // Gracefully handle email-only users without wallet addresses\n  if (!walletAddress) {\n    console.log('Skipping Telegram notification for user without wallet address');\n    return;\n  }\n\n  let formattedMessage = message;\n\n  // Use formatted messages based on event type\n  if (coinData) {\n    switch (type) {\n      case 'coin_created':\n        formattedMessage = formatNewCoinMessage(coinData, stats);\n        break;\n      case 'buy':\n        formattedMessage = formatBuyActivityMessage(coinData, stats, new Date());\n        break;\n      case 'sell':\n        formattedMessage = formatSellActivityMessage(coinData, stats, new Date());\n        break;\n      case 'trade':\n        formattedMessage = formatTradingActivityMessage(coinData, stats, new Date());\n        break;\n      default:\n        formattedMessage = message;\n    }\n  }\n\n  // Extract image URL from coinData\n  const imageUrl = coinData?.image || coinData?.metadata?.image;\n  const isVideo = imageUrl && imageUrl.match(/\\.(mp4|webm|mov|avi)$/i);\n  const isAudio = imageUrl && imageUrl.match(/\\.(mp3|wav|ogg|m4a)$/i);\n\n  // Broadcast to channel if it's a coin creation and channel is configured\n  if (TELEGRAM_CHANNEL_ID && type === 'coin_created') {\n    try {\n      if (imageUrl && !isAudio) {\n        if (isVideo) {\n          // Send video with caption\n          await bot.sendVideo(\n            TELEGRAM_CHANNEL_ID,\n            imageUrl,\n            {\n              caption: formattedMessage,\n              parse_mode: 'Markdown',\n            }\n          );\n        } else {\n          // Send photo with caption\n          await bot.sendPhoto(\n            TELEGRAM_CHANNEL_ID,\n            imageUrl,\n            {\n              caption: formattedMessage,\n              parse_mode: 'Markdown',\n            }\n          );\n        }\n      } else {\n        // Send text message only\n        await bot.sendMessage(\n          TELEGRAM_CHANNEL_ID,\n          formattedMessage,\n          { \n            parse_mode: 'Markdown',\n            disable_web_page_preview: false \n          }\n        );\n      }\n      console.log('Broadcasted coin creation to channel with media');\n    } catch (error) {\n      console.error('Failed to broadcast to channel:', error);\n      // Fallback to text-only message\n      try {\n        await bot.sendMessage(\n          TELEGRAM_CHANNEL_ID,\n          formattedMessage,\n          { parse_mode: 'Markdown', disable_web_page_preview: false }\n        );\n      } catch (fallbackError) {\n        console.error('Fallback message also failed:', fallbackError);\n      }\n    }\n  }\n\n  // Find all chat IDs connected to this wallet\n  const chatIds = Array.from(userWallets.entries())\n    .filter(([_, wallet]) => wallet.toLowerCase() === walletAddress.toLowerCase())\n    .map(([chatId]) => chatId);\n\n  for (const chatId of chatIds) {\n    try {\n      if (imageUrl && !isAudio) {\n        if (isVideo) {\n          // Send video with caption\n          await bot.sendVideo(\n            chatId,\n            imageUrl,\n            {\n              caption: formattedMessage,\n              parse_mode: 'Markdown',\n            }\n          );\n        } else {\n          // Send photo with caption\n          await bot.sendPhoto(\n            chatId,\n            imageUrl,\n            {\n              caption: formattedMessage,\n              parse_mode: 'Markdown',\n            }\n          );\n        }\n      } else {\n        // Send text message only\n        await bot.sendMessage(\n          chatId,\n          formattedMessage,\n          { parse_mode: 'Markdown' }\n        );\n      }\n    } catch (error) {\n      console.error(`Failed to send Telegram notification to ${chatId}:`, error);\n      // Fallback to text-only message\n      try {\n        await bot.sendMessage(\n          chatId,\n          formattedMessage,\n          { parse_mode: 'Markdown' }\n        );\n      } catch (fallbackError) {\n        console.error('Fallback message also failed:', fallbackError);\n      }\n    }\n  }\n}\n\nexport async function broadcastExistingCoins(coins: any[]) {\n  if (!bot || !TELEGRAM_CHANNEL_ID) {\n    console.log('Telegram bot not initialized or channel not configured');\n    return;\n  }\n\n  try {\n    console.log(`Broadcasting ${coins.length} coins to channel ${TELEGRAM_CHANNEL_ID}...`);\n\n    let message = `üìäü™ô PLATFORM UPDATE\\n\\n`;\n    message += `Total Coins: ${coins.length}\\n`;\n    message += `Active Creators: ${new Set(coins.map(c => c.creator_wallet)).size}\\n\\n`;\n\n    const latestCoins = coins.slice(0, 5);\n    message += `*Latest Coins:*\\n\\n`;\n\n    for (const coin of latestCoins) {\n      message += `‚Ä¢ *${coin.name}* (${coin.symbol})\\n`;\n      if (coin.address) {\n        message += `  [View on Zora](https://zora.co/creator-coins/base:${coin.address})\\n`;\n      }\n    }\n\n    if (coins.length > 5) {\n      message += `\\n... and ${coins.length - 5} more coins\\n`;\n    }\n\n    message += `\\nüöÄ *Join the trading action!*`;\n\n    await bot.sendMessage(TELEGRAM_CHANNEL_ID, message, { \n      parse_mode: 'Markdown',\n      disable_web_page_preview: true \n    });\n    console.log('Successfully broadcast to channel');\n  } catch (error) {\n    console.error('Failed to broadcast to channel:', error);\n  }\n}\n\nexport async function stopTelegramBot() {\n  // Wait for any ongoing initialization\n  if (initializationPromise) {\n    await initializationPromise.catch(() => {});\n  }\n\n  if (bot && isPolling) {\n    try {\n      await bot.stopPolling({ cancel: true });\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      isPolling = false;\n      bot.removeAllListeners();\n      bot = null;\n      botInstance = null;\n      console.log('Telegram bot stopped');\n    } catch (error) {\n      console.error('Error stopping Telegram bot:', error);\n      // Force cleanup even if error\n      isPolling = false;\n      bot = null;\n      botInstance = null;\n    }\n  } else if (bot) {\n    // If bot exists but not polling, just clean up\n    bot.removeAllListeners();\n    bot = null;\n    botInstance = null;\n    console.log('Telegram bot instance cleared (was not polling)');\n  }\n}\n\n// Graceful shutdown\nprocess.on('SIGINT', async () => {\n  await stopTelegramBot();\n  process.exit(0);\n});\n\nprocess.on('SIGTERM', async () => {\n  await stopTelegramBot();\n  process.exit(0);\n});\n\nexport { \n  bot, \n  formatNewCoinMessage, \n  formatTradingActivityMessage, \n  formatBuyActivityMessage, \n  formatSellActivityMessage,\n  formatDailyMarketCapUpdate,\n  formatDailyVolumeUpdate,\n  formatCreatorEarningsUpdate\n};","size_bytes":22650},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/lib/privy-provider.tsx":{"content":"import { PrivyProvider, usePrivy } from '@privy-io/react-auth';\nimport { base, baseSepolia } from 'viem/chains';\nimport { SmartAccountProvider } from '@/contexts/SmartAccountContext';\nimport { useEffect, useRef } from 'react';\n\nfunction AuthHandler({ children }: { children: React.ReactNode }) {\n  const { ready, authenticated, user } = usePrivy();\n  const hasHandledLogin = useRef(false);\n\n  useEffect(() => {\n    if (!ready || !authenticated || !user || hasHandledLogin.current) {\n      return;\n    }\n\n    const handleLogin = async () => {\n      try {\n        // Get Privy user ID (primary identifier)\n        const privyId = user?.id;\n        // Get wallet address if available (wallet login or embedded wallet)\n        const address = user?.wallet?.address || user?.linkedAccounts?.find((acc: any) => acc.type === 'wallet')?.address;\n        // Get email if available (email login)\n        const email = user?.email?.address || user?.linkedAccounts?.find((acc: any) => acc.type === 'email')?.address;\n\n        if (!privyId) {\n          console.error('No Privy ID found for user');\n          return;\n        }\n\n        console.log('User logged in:', { privyId, address, email });\n\n        // Create or update creator profile - wait for this to complete\n        const creatorResponse = await fetch('/api/creators/sync', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ \n            privyId, \n            address: address || null,\n            email: email || null \n          }),\n          credentials: 'include',\n        });\n\n        if (!creatorResponse.ok) {\n          const errorData = await creatorResponse.json();\n          console.error('‚ùå Failed to sync creator profile:', errorData);\n          return;\n        }\n\n        const creatorData = await creatorResponse.json();\n        console.log('‚úÖ Creator profile synced:', creatorData.id);\n\n        // Trigger daily login to award welcome bonus (works for both email and wallet users)\n        if (privyId) {\n          const response = await fetch('/api/login-streak/check-in', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ \n              privyId, \n              address: address || null // address can be null for email users\n            }),\n            credentials: 'include',\n          });\n\n          if (response.ok) {\n            const data = await response.json();\n            if (data.isFirstLogin) {\n              console.log('‚úÖ Welcome bonus awarded!', data);\n              // Show success notification to user\n              const event = new CustomEvent('e1xp-claimed', { \n                detail: { \n                  points: data.pointsEarned || 10,\n                  message: 'Welcome to CoinIT! üéâ'\n                }\n              });\n              window.dispatchEvent(event);\n            } else if (data.pointsEarned > 0) {\n              console.log('‚úÖ Daily login bonus!', data);\n            }\n          } else {\n            const errorData = await response.json();\n            console.error('‚ùå Failed to award welcome bonus:', errorData);\n          }\n        }\n\n        hasHandledLogin.current = true;\n      } catch (error) {\n        console.error('Failed to handle login:', error);\n      }\n    };\n\n    handleLogin();\n  }, [ready, authenticated, user]);\n\n  return <>{children}</>;\n}\n\nexport function AppPrivyProvider({ children }: { children: React.ReactNode }) {\n\n  return (\n    <PrivyProvider\n      appId={import.meta.env.VITE_PRIVY_APP_ID || ''}\n      config={{\n        loginMethods: ['email', 'wallet'],\n        appearance: {\n          theme: 'dark',\n          accentColor: '#22c55e',\n          logo: 'https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png',\n          landingHeader: 'Welcome to Every1.fun',\n          showWalletLoginFirst: false,\n        },\n        defaultChain: base,\n        supportedChains: [base, baseSepolia],\n        embeddedWallets: {\n          ethereum: {\n            createOnLogin: 'all-users',\n          },\n          showWalletUIs: false,\n        },\n      }}\n    >\n      <AuthHandler>\n        <SmartAccountProvider>\n          {children}\n        </SmartAccountProvider>\n      </AuthHandler>\n    </PrivyProvider>\n  );\n}","size_bytes":4273},"client/src/pages/creators.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\nimport { Users, TrendingUp, Award, Star, Flame } from \"lucide-react\";\nimport { createAvatar } from \"@dicebear/core\";\nimport { avataaars } from \"@dicebear/collection\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport {\n  getMostValuableCreatorCoins,\n  getCreatorCoins,\n} from \"@zoralabs/coins-sdk\";\nimport ProfileCardModal from \"@/components/profile-card-modal\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { formatSmartCurrency } from \"@/lib/utils\";\n\n// Creator type from Zora data\ntype Creator = {\n  id: string;\n  address: string;\n  username: string;\n  displayName: string;\n  bio: string;\n  avatarUrl: string;\n  createdAt: string;\n  totalConnections: number;\n  totalProfileViews: number;\n  e1xpPoints: number;\n  marketCap: string;\n  volume24h: string;\n};\n\nexport default function Creators() {\n  const { user: privyUser, login } = usePrivy();\n  const [selectedTab, setSelectedTab] = useState<\"top\" | \"rising\" | \"new\">(\n    \"top\",\n  );\n  const [selectedCreator, setSelectedCreator] = useState<string | null>(null);\n  const [isProfileModalOpen, setIsProfileModalOpen] = useState(false);\n\n  // Fetch Zora creator coins data\n  const { data: zoraCreatorsData, isLoading: creatorsLoading } = useQuery({\n    queryKey: [\"/api/zora/creators\", selectedTab],\n    queryFn: async () => {\n      let response;\n\n      if (selectedTab === \"top\") {\n        response = await getMostValuableCreatorCoins({ count: 50 });\n      } else if (selectedTab === \"new\") {\n        response = await getCreatorCoins({ count: 50 });\n      } else {\n        // Rising stars - use regular creator coins\n        response = await getCreatorCoins({ count: 50 });\n      }\n\n      const creators =\n        response.data?.exploreList?.edges?.map((edge: any) => {\n          const coin = edge.node;\n          return {\n            id: coin.creatorAddress || coin.address,\n            address: coin.creatorAddress || coin.address,\n            username: coin.symbol || \"creator\",\n            displayName: coin.name || \"Creator\",\n            bio: coin.description || \"\",\n            avatarUrl:\n              coin.mediaContent?.previewImage?.medium ||\n              coin.mediaContent?.previewImage?.small ||\n              createAvatar(avataaars, {\n                seed: coin.creatorAddress,\n                size: 56,\n              }).toDataUri(),\n            createdAt: coin.createdAt || new Date().toISOString(),\n            totalConnections: coin.uniqueHolders || 0,\n            totalProfileViews: Math.floor((coin.uniqueHolders || 0) * 3), // Estimate\n            e1xpPoints: Math.floor(parseFloat(coin.marketCap || \"0\") * 100),\n            marketCap: coin.marketCap,\n            volume24h: coin.volume24h,\n          };\n        }) || [];\n\n      return creators;\n    },\n    refetchInterval: 30000, // Refresh every 30 seconds\n  });\n\n  const creators = zoraCreatorsData || [];\n\n  const filteredCreators = creators\n    .filter(\n      (creator: any) =>\n        creator.totalConnections && creator.totalConnections > 0,\n    )\n    .sort((a: any, b: any) => {\n      switch (selectedTab) {\n        case \"top\":\n          return (b.totalConnections || 0) - (a.totalConnections || 0);\n        case \"rising\":\n          return (b.totalProfileViews || 0) - (a.totalProfileViews || 0);\n        case \"new\":\n          return (\n            new Date(b.createdAt || \"\").getTime() -\n            new Date(a.createdAt || \"\").getTime()\n          );\n        default:\n          return (b.totalConnections || 0) - (a.totalConnections || 0);\n      }\n    });\n\n  const formatAddress = (address: string) => {\n    return `${address.slice(0, 6)}...${address.slice(-4)}`;\n  };\n\n  const getAvatarBgColor = (index: number) => {\n    const colors = [\n      \"bg-pink-200 dark:bg-pink-300\",\n      \"bg-purple-200 dark:bg-purple-300\",\n      \"bg-yellow-200 dark:bg-yellow-300\",\n      \"bg-blue-200 dark:bg-blue-300\",\n      \"bg-green-200 dark:bg-green-300\",\n      \"bg-orange-200 dark:bg-orange-300\",\n      \"bg-red-200 dark:bg-red-300\",\n      \"bg-indigo-200 dark:bg-indigo-300\",\n    ];\n    return colors[index % colors.length];\n  };\n\n  const getRankColor = (index: number) => {\n    const colors = [\n      \"text-pink-600 dark:text-pink-500\",\n      \"text-purple-600 dark:text-purple-500\",\n      \"text-yellow-600 dark:text-yellow-500\",\n      \"text-blue-600 dark:text-blue-500\",\n      \"text-green-600 dark:text-green-500\",\n      \"text-orange-600 dark:text-orange-500\",\n      \"text-red-600 dark:text-red-500\",\n      \"text-indigo-600 dark:text-indigo-500\",\n    ];\n    return colors[index % colors.length];\n  };\n\n  const totalMarketCap = filteredCreators.reduce(\n    (acc: number, creator: any) => acc + parseFloat(creator.marketCap || \"0\"),\n    0,\n  );\n\n  const totalEarnings = filteredCreators.reduce(\n    (acc: number, creator: any) => acc + (creator.e1xpPoints || 0) * 0.001,\n    0,\n  );\n\n  const formatNumber = (num: number): string => {\n    if (num >= 1000000000) {\n      return `${(num / 1000000000).toFixed(1).replace(/\\.0$/, '')}B`;\n    } else if (num >= 1000000) {\n      return `${(num / 1000000).toFixed(1).replace(/\\.0$/, '')}M`;\n    } else if (num >= 1000) {\n      return `${(num / 1000).toFixed(1).replace(/\\.0$/, '')}K`;\n    }\n    return num.toFixed(0);\n  };\n\n  const formatCurrency = (num: number): string => {\n    if (num >= 1000000000) {\n      return `$${(num / 1000000000).toFixed(2).replace(/\\.00$/, '')}B`;\n    } else if (num >= 1000000) {\n      return `$${(num / 1000000).toFixed(2).replace(/\\.00$/, '')}M`;\n    } else if (num >= 1000) {\n      return `$${(num / 1000).toFixed(2).replace(/\\.00$/, '')}K`;\n    }\n    return `$${num.toFixed(0)}`;\n  };\n\n  const avgHolders =\n    filteredCreators.length > 0\n      ? filteredCreators.reduce(\n          (acc: number, creator: any) => acc + (creator.totalConnections || 0),\n          0,\n        ) / filteredCreators.length\n      : 0;\n\n  return (\n    <div className=\"container max-w-5xl mx-auto px-3 sm:px-4 py-4 sm:py-8 space-y-4 sm:space-y-8\">\n      <div className=\"mb-4 sm:mb-6\">\n        <div className=\"flex flex-col items-center gap-1 sm:gap-2\">\n          {/* Stats - Compact single line on mobile */}\n          <div className=\"grid grid-cols-4 gap-2 mb-6\">\n            <div className=\"text-center bg-muted/20 rounded-lg p-1.5\">\n              <div className=\"text-sm font-bold text-primary\">\n                {creatorsLoading ? \"-\" : filteredCreators.length}\n              </div>\n              <div className=\"text-[9px] text-muted-foreground\">Creators</div>\n            </div>\n            <div className=\"text-center bg-muted/20 rounded-lg p-1.5\">\n              <div className=\"text-sm font-bold text-green-500\">\n                ${formatNumber(totalMarketCap)}\n              </div>\n              <div className=\"text-[9px] text-muted-foreground\">Market Cap</div>\n            </div>\n            <div className=\"text-center bg-muted/20 rounded-lg p-1.5\">\n              <div className=\"text-sm font-bold text-green-500\">\n                {formatSmartCurrency(totalEarnings)}\n              </div>\n              <div className=\"text-[9px] text-muted-foreground\">Earnings</div>\n            </div>\n            <div className=\"text-center bg-muted/20 rounded-lg p-1.5\">\n              <div className=\"text-sm font-bold text-foreground\">\n                {creatorsLoading ? \"-\" : formatNumber(avgHolders)}\n              </div>\n              <div className=\"text-[9px] text-muted-foreground\">\n                Avg. Holders\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex gap-1.5 sm:gap-4 -mt-2 sm:mt-0 mb-4 sm:mb-6 overflow-x-auto pb-2 -mx-3 px-3 sm:mx-0 sm:px-0 sm:overflow-visible\">\n        <button\n          onClick={() => setSelectedTab(\"top\")}\n          className={`flex-1 px-2 sm:px-6 py-1.5 sm:py-2 rounded-lg font-medium transition-all text-xs sm:text-base whitespace-nowrap ${\n            selectedTab === \"top\"\n              ? \"bg-primary text-primary-foreground\"\n              : \"bg-card text-muted-foreground hover:bg-muted\"\n          }`}\n        >\n          <div className=\"flex items-center justify-center gap-1 sm:gap-2\">\n            <Award className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n            <span className=\"hidden sm:inline\">Top Creators</span>\n            <span className=\"sm:hidden\">Top</span>\n          </div>\n        </button>\n        <button\n          onClick={() => setSelectedTab(\"rising\")}\n          className={`flex-1 px-2 sm:px-6 py-1.5 sm:py-2 rounded-lg font-medium transition-all text-xs sm:text-base whitespace-nowrap ${\n            selectedTab === \"rising\"\n              ? \"bg-primary text-primary-foreground\"\n              : \"bg-card text-muted-foreground hover:bg-muted\"\n          }`}\n        >\n          <div className=\"flex items-center justify-center gap-1 sm:gap-2\">\n            <TrendingUp className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n            <span className=\"hidden sm:inline\">Rising Stars</span>\n            <span className=\"sm:hidden\">Rising</span>\n          </div>\n        </button>\n        <button\n          onClick={() => setSelectedTab(\"new\")}\n          className={`flex-1 px-2 sm:px-6 py-1.5 sm:py-2 rounded-lg font-medium transition-all text-xs sm:text-base whitespace-nowrap ${\n            selectedTab === \"new\"\n              ? \"bg-primary text-primary-foreground\"\n              : \"bg-card text-muted-foreground hover:bg-muted\"\n          }`}\n        >\n          <div className=\"flex items-center justify-center gap-1 sm:gap-2\">\n            <Flame className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n            <span className=\"hidden sm:inline\">New Creators</span>\n            <span className=\"sm:hidden\">New</span>\n          </div>\n        </button>\n      </div>\n\n      {creatorsLoading ? (\n        <div className=\"space-y-4\">\n          {[...Array(8)].map((_, i) => (\n            <div key={i} className=\"bg-card rounded-xl p-4 sm:p-6\">\n              <div className=\"flex items-center gap-3 sm:gap-4\">\n                <div className=\"w-12 h-12 sm:w-14 sm:h-14 bg-muted/20 rounded-full animate-pulse flex-shrink-0\"></div>\n                <div className=\"flex-1 min-w-0 space-y-2\">\n                  <div className=\"h-5 bg-muted/20 rounded w-32 sm:w-40 animate-pulse\"></div>\n                  <div className=\"h-4 bg-muted/20 rounded w-24 sm:w-32 animate-pulse\"></div>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      ) : filteredCreators.length === 0 ? (\n        <div className=\"text-center py-16\">\n          <Users className=\"w-8 h-8 text-muted-foreground\" />\n          <h3 className=\"text-xl font-bold text-foreground mb-2\">\n            No creators yet\n          </h3>\n          <p className=\"text-muted-foreground mb-6\">\n            Be the first to create content and become a creator!\n          </p>\n        </div>\n      ) : (\n        <div className=\"space-y-2 sm:space-y-3\">\n          {filteredCreators.map((creator: any, index: number) => {\n            const isCurrentUser =\n              privyUser?.wallet?.address &&\n              creator.id === privyUser.wallet.address;\n            const createdDaysAgo = Math.floor(\n              (Date.now() - new Date(creator.createdAt || \"\").getTime()) /\n                (1000 * 60 * 60 * 24),\n            );\n            const isVeteran = createdDaysAgo >= 365;\n\n            return (\n              <div\n                key={creator.id}\n                className={`rounded-2xl overflow-hidden transition-all ${\n                  isCurrentUser\n                    ? \"bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30\"\n                    : \"bg-card\"\n                }`}\n              >\n                <div className=\"flex sm:hidden gap-2 p-1.5\">\n                  <div className=\"flex flex-col items-center gap-1 flex-shrink-0\">\n                    <div\n                      className={`relative cursor-pointer rounded-full p-0.5 ${getAvatarBgColor(index)}`}\n                      onClick={() => {\n                        setSelectedCreator(creator.address);\n                        setIsProfileModalOpen(true);\n                      }}\n                      data-testid={`button-avatar-mobile-${index}`}\n                    >\n                      <img\n                        src={creator.avatarUrl}\n                        alt={creator.displayName || creator.username}\n                        className=\"w-10 h-10 rounded-full\"\n                      />\n                      {index === 0 && (\n                        <Award className=\"absolute -top-1 -right-1 w-4 h-4 text-yellow-500\" />\n                      )}\n                    </div>\n                    <p className=\"text-muted-foreground text-[9px] max-w-[48px] truncate text-center\">\n                      @{creator.username}\n                    </p>\n                  </div>\n\n                  <div className=\"flex-1 min-w-0 flex items-center\">\n                    <div className=\"grid grid-cols-4 gap-0.5 w-full\">\n                      <div className=\"text-center\">\n                        <div className=\"text-foreground font-bold text-[10px]\">\n                          {formatNumber(creator.totalConnections || 0)}\n                        </div>\n                        <div className=\"text-muted-foreground text-[8px]\">\n                          Holders\n                        </div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-foreground font-bold text-[10px]\">\n                          {formatCurrency(parseFloat(creator.marketCap || \"0\"))}\n                        </div>\n                        <div className=\"text-muted-foreground text-[8px]\">\n                          M.Cap\n                        </div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-foreground font-bold text-[10px]\">\n                          {formatCurrency(parseFloat(creator.volume24h || \"0\"))}\n                        </div>\n                        <div className=\"text-muted-foreground text-[8px]\">\n                          Vol\n                        </div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-yellow-500 font-bold text-[10px] flex items-center justify-center gap-0.5\">\n                          <Star className=\"w-2 h-2\" />\n                          {formatNumber(creator.e1xpPoints || 0)}\n                        </div>\n                        <div className=\"text-muted-foreground text-[8px]\">\n                          E1XP\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"hidden sm:flex items-center gap-2 p-2 hover:bg-muted/5 transition-colors\">\n                  <div\n                    className=\"relative flex-shrink-0 cursor-pointer\"\n                    onClick={() => {\n                      setSelectedCreator(creator.address);\n                      setIsProfileModalOpen(true);\n                    }}\n                    data-testid={`button-avatar-desktop-${index}`}\n                  >\n                    <img\n                      src={creator.avatarUrl}\n                      alt={creator.displayName || creator.username}\n                      className=\"w-10 h-10 rounded-full hover:ring-2 hover:ring-primary transition-all\"\n                    />\n                    {index < 3 && (\n                      <div className=\"absolute -top-1 -right-1 w-4 h-4 bg-primary rounded-full flex items-center justify-center text-[10px] font-bold text-primary-foreground\">\n                        {index + 1}\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"flex-1 min-w-0 grid grid-cols-5 gap-2 items-center\">\n                    <div className=\"min-w-0\">\n                      <h3 className=\"text-foreground font-bold text-sm truncate flex items-center gap-1\">\n                        {creator.displayName || creator.username}\n                        {index === 0 && (\n                          <Award className=\"w-3 h-3 text-yellow-500 flex-shrink-0\" />\n                        )}\n                      </h3>\n                      <p className=\"text-muted-foreground text-[10px]\">\n                        {creator.username}\n                      </p>\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"text-foreground font-bold text-sm\">\n                        {formatNumber(creator.totalConnections || 0)}\n                      </div>\n                      <div className=\"text-muted-foreground text-[10px]\">\n                        Holders\n                      </div>\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"text-foreground font-bold text-sm\">\n                        {formatCurrency(parseFloat(creator.marketCap || \"0\"))}\n                      </div>\n                      <div className=\"text-muted-foreground text-[10px]\">\n                        Market Cap\n                      </div>\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"text-foreground font-bold text-sm\">\n                        {formatCurrency(parseFloat(creator.volume24h || \"0\"))}\n                      </div>\n                      <div className=\"text-muted-foreground text-[10px]\">\n                        24h Vol\n                      </div>\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"text-yellow-500 font-bold text-sm flex items-center justify-center gap-1\">\n                        <Star className=\"w-3 h-3\" />\n                        {formatNumber(creator.e1xpPoints || 0)}\n                      </div>\n                      <div className=\"text-muted-foreground text-[10px]\">\n                        E1XP\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {selectedCreator && (\n        <ProfileCardModal\n          creatorAddress={selectedCreator}\n          open={isProfileModalOpen}\n          onOpenChange={setIsProfileModalOpen}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":18488},"server/notification-cron.ts":{"content":"import cron from 'node-cron';\nimport { notificationService } from './notification-service';\nimport { storage } from './supabase-storage';\n\nexport class NotificationCron {\n  private jobs: cron.ScheduledTask[] = [];\n  private started: boolean = false;\n\n  start() {\n    // Idempotence check - prevent duplicate job scheduling\n    if (this.started || this.jobs.length > 0) {\n      console.log('‚ö†Ô∏è Notification cron jobs already running, skipping duplicate start');\n      return;\n    }\n\n    this.started = true;\n    console.log('üîî Starting notification cron jobs...');\n\n    // Send all periodic notifications every 4 hours\n    const periodicJob = cron.schedule('0 */4 * * *', async () => {\n      console.log('üì¢ Running periodic notifications...');\n      try {\n        await notificationService.sendAllPeriodicNotifications();\n      } catch (error) {\n        console.error('‚ùå Periodic notifications error:', error);\n      }\n    });\n    this.jobs.push(periodicJob);\n\n    // Send top traders notifications for 24h every 6 hours\n    const tradersJob24h = cron.schedule('0 */6 * * *', async () => {\n      console.log('üèÜ Sending 24h top traders notification...');\n      try {\n        await notificationService.notifyTopTraders(24);\n      } catch (error) {\n        console.error('‚ùå Top traders (24h) notification error:', error);\n      }\n    });\n    this.jobs.push(tradersJob24h);\n\n    // Send top traders notifications for 10h every 3 hours\n    const tradersJob10h = cron.schedule('0 */3 * * *', async () => {\n      console.log('üî• Sending 10h top traders notification...');\n      try {\n        await notificationService.notifyTopTraders(10);\n      } catch (error) {\n        console.error('‚ùå Top traders (10h) notification error:', error);\n      }\n    });\n    this.jobs.push(tradersJob10h);\n\n    // Send top traders notifications for 3 days every day\n    const tradersJob3d = cron.schedule('0 12 * * *', async () => {\n      console.log('üíé Sending 3-day top traders notification...');\n      try {\n        await notificationService.notifyTopTraders(72); // 3 days = 72 hours\n      } catch (error) {\n        console.error('‚ùå Top traders (3d) notification error:', error);\n      }\n    });\n    this.jobs.push(tradersJob3d);\n\n    // Send weekly top earners every Monday at 10 AM\n    const weeklyJob = cron.schedule('0 10 * * 1', async () => {\n      console.log('üìä Sending weekly top earners notification...');\n      try {\n        await notificationService.sendWeeklyTopEarnersNotification();\n      } catch (error) {\n        console.error('‚ùå Weekly top earners notification error:', error);\n      }\n    });\n    this.jobs.push(weeklyJob);\n\n    // Send top creators every 8 hours\n    const creatorsJob = cron.schedule('0 */8 * * *', async () => {\n      console.log('üëë Sending top creators notification...');\n      try {\n        await notificationService.sendTopCreatorsNotification();\n      } catch (error) {\n        console.error('‚ùå Top creators notification error:', error);\n      }\n    });\n    this.jobs.push(creatorsJob);\n\n    // Send top coins every 6 hours\n    const coinsJob = cron.schedule('0 */6 * * *', async () => {\n      console.log('üèÜ Sending top coins notification...');\n      try {\n        await notificationService.sendTopCoinsNotification();\n      } catch (error) {\n        console.error('‚ùå Top coins notification error:', error);\n      }\n    });\n    this.jobs.push(coinsJob);\n\n    // Send recent trades every 2 hours\n    const tradesJob = cron.schedule('0 */2 * * *', async () => {\n      console.log('üìä Sending recent trades notification...');\n      try {\n        await notificationService.sendRecentTradesNotification();\n      } catch (error) {\n        console.error('‚ùå Recent trades notification error:', error);\n      }\n    });\n    this.jobs.push(tradesJob);\n\n    console.log(`‚úÖ Started ${this.jobs.length} notification cron jobs`);\n  }\n\n  stop() {\n    console.log('üõë Stopping notification cron jobs...');\n    this.jobs.forEach(job => job.stop());\n    this.jobs = [];\n    this.started = false;\n    console.log('‚úÖ All notification cron jobs stopped');\n  }\n\n  getSchedules(): string[] {\n    return [\n      'All periodic notifications: every 4 hours',\n      'Top traders (24h): every 6 hours',\n      'Top traders (10h): every 3 hours',\n      'Top traders (3 days): daily at 12 PM',\n      'Weekly top earners: Mondays at 10 AM',\n      'Top creators: every 8 hours',\n      'Top coins: every 6 hours',\n      'Recent trades: every 2 hours'\n    ];\n  }\n}\n\n// Schedule notification jobs\nexport function scheduleNotificationJobs() {\n  const cronJobs = new NotificationCron();\n  cronJobs.start();\n}\n\nexport const notificationCron = new NotificationCron();","size_bytes":4697},"server/supabase-storage.ts":{"content":"import { createClient, SupabaseClientOptions } from '@supabase/supabase-js';\nimport {\n  type Coin, type InsertCoin, type UpdateCoin,\n  type ScrapedContent, type InsertScrapedContent,\n  type Reward, type InsertReward,\n  type Creator, type InsertCreator, type UpdateCreator,\n  type Comment, type InsertComment,\n  type Notification, type InsertNotification,\n  type Follow, type InsertFollow,\n  type Referral, type InsertReferral,\n  type LoginStreak, type InsertLoginStreak, type UpdateLoginStreak,\n  type NotificationType,\n  type E1xpReward // Assuming E1xpReward is defined in @shared/schema\n} from '@shared/schema';\nimport { type User, users } from '@shared/schema';\nimport { db } from './db';\nimport { eq } from 'drizzle-orm';\n\n\n// Initialize Supabase client with service role key for full database access\nconst supabaseUrl = process.env.VITE_SUPABASE_URL || 'https://hgwhbdlejogerdghkxac.supabase.co';\nconst supabaseServiceKey = process.env.VITE_SUPABASE_SERVICE_ROLE_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhnd2hiZGxlam9nZXJkZ2hreGFjIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MDc1MzI4NiwiZXhwIjoyMDc2MzI5Mjg2fQ.pTy3zUBuCUqZJd-tC4VXu-HYCO1SfrObTGh2eXHYY3g';\n\nif (!supabaseUrl || !supabaseServiceKey) {\n  console.error('Environment configuration error:');\n  console.error('VITE_SUPABASE_URL:', supabaseUrl ? 'set' : 'missing');\n  console.error('VITE_SUPABASE_SERVICE_ROLE_KEY:', supabaseServiceKey ? 'set' : 'missing');\n  throw new Error('Missing Supabase configuration. Set VITE_SUPABASE_URL and VITE_SUPABASE_SERVICE_ROLE_KEY in .env');\n}\n\nconsole.log('üîå Connecting to Supabase:', supabaseUrl);\n\nconst supabaseOptions: SupabaseClientOptions<'public'> = {\n  auth: {\n    persistSession: false,\n    autoRefreshToken: false,\n  },\n  realtime: {\n    enabled: false,\n  },\n  global: {\n    headers: {\n      'x-disable-realtime': 'true',\n    },\n    fetch: (url, options = {}) => {\n      // Block WebSocket connections to realtime\n      if (url.toString().includes('/realtime/') || url.toString().includes('/v2')) {\n        return Promise.reject(new Error('Realtime connections are disabled'));\n      }\n      return fetch(url, options);\n    },\n  },\n  db: {\n    schema: 'public',\n  },\n};\n\nconst supabase = createClient(supabaseUrl, supabaseServiceKey, supabaseOptions);\n\n// Type definitions for notifications\nexport interface UserNotification {\n  id: string;\n  userId: string;\n  type: string;\n  title: string;\n  message: string;\n  metadata?: any;\n  read: boolean;\n  createdAt: string;\n  updatedAt?: string;\n  creator?: {\n    address: string;\n    name: string | null;\n    avatar: string | null;\n  };\n}\n\nexport interface NotificationMetadata {\n  points?: number;\n  reason?: string;\n  totalPoints?: number;\n  shareText?: string;\n  streakDays?: number;\n  [key: string]: any;\n}\n\nexport interface ModerationType {\n  type: 'warning' | 'restrict' | 'ban';\n  reason: string;\n  duration?: number;\n}\n\nexport class SupabaseStorage {\n  private supabase: typeof supabase;\n\n  constructor() {\n    this.supabase = supabase;\n  }\n\n  // ===== COINS =====\n  async getAllCoins(): Promise<Coin[]> {\n    const { data, error } = await supabase\n      .from('coins')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Coin[];\n  }\n\n  async getCoin(id: string): Promise<Coin | undefined> {\n    const { data, error } = await supabase\n      .from('coins')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error && error.code !== 'PGRST116') throw error;\n    return data as Coin | undefined;\n  }\n\n  async getCoinByAddress(address: string): Promise<Coin | undefined> {\n    const { data, error } = await supabase\n      .from('coins')\n      .select('*')\n      .eq('address', address)\n      .single();\n\n    if (error && error.code !== 'PGRST116') throw error;\n    return data as Coin | undefined;\n  }\n\n  async getCoinsByCreator(creator: string): Promise<Coin[]> {\n    const { data, error } = await supabase\n      .from('coins')\n      .select('*')\n      .eq('creator_wallet', creator)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Coin[];\n  }\n\n  async createCoin(insertCoin: InsertCoin): Promise<Coin> {\n    const { data, error } = await supabase\n      .from('coins')\n      .insert({\n        name: insertCoin.name,\n        symbol: insertCoin.symbol,\n        address: insertCoin.address,\n        creator_wallet: insertCoin.creatorWallet,\n        status: insertCoin.status || 'pending',\n        scraped_content_id: insertCoin.scrapedContentId,\n        ipfs_uri: insertCoin.ipfsUri,\n        chain_id: insertCoin.chainId,\n        registry_tx_hash: insertCoin.registryTxHash,\n        metadata_hash: insertCoin.metadataHash,\n        registered_at: insertCoin.registeredAt,\n        image: insertCoin.image,\n        description: insertCoin.description,\n        created_at: new Date().toISOString()\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Coin;\n  }\n\n  async updateCoin(id: string, update: UpdateCoin): Promise<Coin | undefined> {\n    const updateData: any = {};\n\n    if (update.address !== undefined) updateData.address = update.address;\n    if (update.status !== undefined) updateData.status = update.status;\n    if (update.registryTxHash !== undefined) updateData.registry_tx_hash = update.registryTxHash;\n    if (update.metadataHash !== undefined) updateData.metadata_hash = update.metadataHash;\n    if (update.registeredAt !== undefined) updateData.registered_at = update.registeredAt;\n    if (update.activityTrackerTxHash !== undefined) updateData.activity_tracker_tx_hash = update.activityTrackerTxHash;\n    if (update.activityTrackerRecordedAt !== undefined) updateData.activity_tracker_recorded_at = update.activityTrackerRecordedAt;\n    if (update.createdAt !== undefined) updateData.created_at = update.createdAt;\n    if ((update as any).hidden !== undefined) updateData.hidden = (update as any).hidden;\n    if ((update as any).pinOrder !== undefined) updateData.pin_order = (update as any).pinOrder;\n\n    const { data, error } = await supabase\n      .from('coins')\n      .update(updateData)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Coin;\n  }\n\n  async updateCoinByAddress(address: string, updates: Partial<Coin>): Promise<Coin | null> {\n    const { data, error } = await supabase\n      .from('coins')\n      .update(updates as any)\n      .eq('address', address)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  async getPinnedCoins(): Promise<Coin[]> {\n    const { data, error } = await supabase\n      .from('coins')\n      .select('*')\n      .eq('status', 'active')\n      .not('pin_order', 'is', null)\n      .order('pin_order', { ascending: true });\n\n    if (error) throw error;\n\n    // Map snake_case to camelCase for consistency\n    return (data || []).map((coin: any) => ({\n      ...coin,\n      creatorWallet: coin.creator_wallet,\n      scrapedContentId: coin.scraped_content_id,\n      ipfsUri: coin.ipfs_uri,\n      chainId: coin.chain_id,\n      registryTxHash: coin.registry_tx_hash,\n      metadataHash: coin.metadata_hash,\n      registeredAt: coin.registered_at,\n      createdAt: coin.created_at,\n      pinOrder: coin.pin_order,\n      hidden: coin.hidden,\n    })) as Coin[];\n  }\n\n  async pinCoin(address: string): Promise<Coin | undefined> {\n    // Check current pinned count\n    const pinnedCoins = await this.getPinnedCoins();\n    if (pinnedCoins.length >= 6) {\n      throw new Error('Maximum of 6 coins can be pinned');\n    }\n\n    // Get the next pin order number (Supabase returns snake_case)\n    const nextPinOrder = pinnedCoins.length > 0\n      ? Math.max(...pinnedCoins.map(c => (c as any).pin_order || 0)) + 1\n      : 1;\n\n    // Update the coin\n    const { data, error } = await supabase\n      .from('coins')\n      .update({ pin_order: nextPinOrder })\n      .eq('address', address)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Coin;\n  }\n\n  async unpinCoin(address: string): Promise<Coin | undefined> {\n    const { data, error } = await supabase\n      .from('coins')\n      .update({ pin_order: null })\n      .eq('address', address)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Coin;\n  }\n\n  // ===== SCRAPED CONTENT =====\n  async getScrapedContent(id: string): Promise<ScrapedContent | undefined> {\n    const { data, error } = await supabase\n      .from('scraped_content')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error && error.code !== 'PGRST116') throw error;\n    return data as ScrapedContent | undefined;\n  }\n\n  async createScrapedContent(content: InsertScrapedContent): Promise<ScrapedContent> {\n    const { data, error } = await supabase\n      .from('scraped_content')\n      .insert({\n        url: content.url,\n        platform: content.platform || 'blog',\n        title: content.title,\n        description: content.description,\n        author: content.author,\n        publish_date: content.publishDate,\n        image: content.image,\n        content: content.content,\n        tags: content.tags || [],\n        metadata: content.metadata || {},\n        scraped_at: new Date().toISOString()\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as ScrapedContent;\n  }\n\n  async getAllScrapedContent(): Promise<ScrapedContent[]> {\n    const { data, error } = await supabase\n      .from('scraped_content')\n      .select('*')\n      .order('scraped_at', { ascending: false });\n\n    if (error) throw error;\n    return data as ScrapedContent[];\n  }\n\n  // ===== REWARDS =====\n  async getReward(id: string): Promise<Reward | undefined> {\n    const { data, error } = await supabase\n      .from('rewards')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error && error.code !== 'PGRST116') throw error;\n    return data as Reward | undefined;\n  }\n\n  async createReward(reward: InsertReward): Promise<Reward> {\n    const { data, error } = await supabase\n      .from('rewards')\n      .insert({\n        type: reward.type,\n        coin_address: reward.coinAddress,\n        coin_symbol: reward.coinSymbol,\n        transaction_hash: reward.transactionHash,\n        reward_amount: reward.rewardAmount,\n        reward_currency: reward.rewardCurrency || 'ZORA',\n        recipient_address: reward.recipientAddress,\n        created_at: new Date().toISOString()\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Reward;\n  }\n\n  async getAllRewards(): Promise<Reward[]> {\n    const { data, error } = await supabase\n      .from('rewards')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Reward[];\n  }\n\n  async getRewardsByCoin(coinAddress: string): Promise<Reward[]> {\n    const { data, error } = await supabase\n      .from('rewards')\n      .select('*')\n      .eq('coin_address', coinAddress)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Reward[];\n  }\n\n  async getRewardsByRecipient(recipientAddress: string): Promise<Reward[]> {\n    const { data, error } = await supabase\n      .from('rewards')\n      .select('*')\n      .eq('recipient_address', recipientAddress)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Reward[];\n  }\n\n  // ===== CREATORS =====\n  async getCreator(id: string): Promise<Creator | undefined> {\n    const { data, error } = await supabase\n      .from('creators')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error && error.code !== 'PGRST116') throw error;\n    return data as Creator | undefined;\n  }\n\n  async getCreatorByAddress(address: string): Promise<Creator | null> {\n    const { data, error } = await supabase\n      .from('creators')\n      .select('*')\n      .eq('address', address)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') return null;\n      throw error;\n    }\n    return data;\n  }\n\n  async getCreatorByPrivyId(privyId: string): Promise<Creator | null> {\n    const { data, error } = await supabase\n      .from('creators')\n      .select('*')\n      .eq('privy_id', privyId)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') return null;\n      throw error;\n    }\n    return data;\n  }\n\n  async getCreatorByReferralCode(referralCode: string): Promise<Creator | undefined> {\n    const { data, error } = await supabase\n      .from('creators')\n      .select('*')\n      .eq('referral_code', referralCode)\n      .single();\n\n    if (error && error.code !== 'PGRST116') throw error;\n    return data as Creator | undefined;\n  }\n\n  async createCreator(data: InsertCreator): Promise<Creator> {\n    // For email-only users, we need to allow null address\n    // First check if address column allows null, if not we'll need to add a placeholder\n    const creatorData: any = {\n      privy_id: data.privyId || null,\n      address: data.address || `email_${data.privyId || Date.now()}`, // Placeholder for email users\n      name: data.name || null,\n      bio: data.bio || null,\n      avatar: data.avatar || null,\n      verified: data.verified || 'false',\n      total_coins: data.totalCoins || '0',\n      total_volume: data.totalVolume || '0',\n      followers: data.followers || '0',\n      referral_code: data.referralCode || null,\n      points: data.points || '0',\n      created_at: new Date().toISOString(),\n    };\n\n    const { data: creator, error } = await supabase\n      .from('creators')\n      .insert(creatorData)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Failed to create creator:', error);\n      throw error;\n    }\n    return creator as Creator;\n  }\n\n  async updateCreator(id: string, update: UpdateCreator): Promise<Creator | undefined> {\n    const updates: any = {\n      updated_at: new Date().toISOString()\n    };\n\n    if (update.name !== undefined) updates.name = update.name;\n    if (update.bio !== undefined) updates.bio = update.bio;\n    if (update.avatar !== undefined) updates.avatar = update.avatar;\n    if (update.verified !== undefined) updates.verified = update.verified;\n    if (update.totalCoins !== undefined) updates.total_coins = update.totalCoins;\n    if (update.totalVolume !== undefined) updates.total_volume = update.totalVolume;\n    if (update.followers !== undefined) updates.followers = update.followers;\n    if (update.referralCode !== undefined) updates.referral_code = update.referralCode;\n    if (update.points !== undefined) updates.points = update.points;\n\n    const { data, error } = await supabase\n      .from('creators')\n      .update(updates)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Creator;\n  }\n\n  async getAllCreators(): Promise<Creator[]> {\n    const { data, error } = await supabase\n      .from('creators')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Creator[];\n  }\n\n  async getTopCreators(): Promise<Creator[]> {\n    const { data, error } = await supabase\n      .from('creators')\n      .select('*')\n      .order('total_coins', { ascending: false })\n      .limit(10);\n\n    if (error) throw error;\n    return data as Creator[];\n  }\n\n  // Points System Methods\n  async addPoints(creatorId: string, amount: number, reason: string): Promise<void> {\n    // Accept creator id, wallet address, or privy ID\n    let creator = await this.getCreator(creatorId);\n    if (!creator) {\n      // Try looking up by address\n      creator = await this.getCreatorByAddress(creatorId);\n    }\n    if (!creator) {\n      // Try looking up by Privy ID (for email-only users)\n      creator = await this.getCreatorByPrivyId(creatorId);\n    }\n\n    if (!creator) throw new Error('Creator not found');\n\n    const currentPoints = parseInt(creator.points || '0');\n    const newPoints = currentPoints + amount;\n\n    await this.updateCreator(creator.id, { points: newPoints.toString() });\n  }\n\n  async awardPoints(creatorId: string, amount: number, reason: string, type: NotificationType): Promise<void> {\n    // Add points (supports wallet address, creator id, or Privy ID)\n    await this.addPoints(creatorId, amount, reason);\n\n    // Resolve creator record (after points update)\n    let creator = await this.getCreator(creatorId);\n    if (!creator) creator = await this.getCreatorByAddress(creatorId);\n    if (!creator) creator = await this.getCreatorByPrivyId(creatorId);\n    if (!creator) return;\n\n    const newPoints = parseInt(creator.points || '0');\n\n    // Use address for wallet users, privyId for email-only users\n    const userId = creator.address || creator.privyId || creator.id;\n\n    // Use notification service\n    const { notificationService } = await import('./notification-service');\n    await notificationService.notifyE1XPEarned(userId, amount, reason);\n\n    // Build profile URL - use name for email users without address\n    const profileUrl = creator.address\n      ? `https://every1.fun/profile/${creator.address}`\n      : creator.name\n        ? `https://every1.fun/@${creator.name}`\n        : `https://every1.fun`;\n\n    await this.createNotification({\n      userId,\n      type,\n      title: '‚ö° E1XP Points Earned!',\n      message: `You earned ${amount} E1XP points for ${reason}`,\n      metadata: {\n        points: amount,\n        reason,\n        totalPoints: newPoints,\n        shareText: `I just earned ${amount} E1XP points on @Every1Fun for ${reason}! Total: ${newPoints} ‚ö°\\n\\nJoin me: ${profileUrl}\\n\\n#Every1Fun #E1XP #Web3`\n      },\n      read: false\n    });\n  }\n\n  async getDailyPointsStatus(creatorId: string): Promise<{ claimed: boolean; streak: number; nextClaimAmount: number }> {\n    const today = new Date().toISOString().split('T')[0];\n\n    const { data: claimData, error: claimError } = await supabase\n      .from('daily_points')\n      .select('*')\n      .eq('creator_id', creatorId)\n      .eq('date', today)\n      .single();\n\n    if (claimError && claimError.code !== 'PGRST116') throw claimError;\n\n    const { data: streakData, error: streakError } = await supabase\n      .from('daily_points')\n      .select('date')\n      .eq('creator_id', creatorId)\n      .order('date', { ascending: false });\n\n    if (streakError) throw streakError;\n\n    let streak = 0;\n    if (streakData && streakData.length > 0) {\n      const dates = streakData.map(d => new Date(d.date));\n      const yesterday = new Date();\n      yesterday.setDate(yesterday.getDate() - 1);\n\n      if (dates[0].toISOString().split('T')[0] === yesterday.toISOString().split('T')[0]) {\n        for (let i = 0; i < dates.length; i++) {\n          const expectedDate = new Date();\n          expectedDate.setDate(expectedDate.getDate() - (i + 1));\n          if (dates[i].toISOString().split('T')[0] === expectedDate.toISOString().split('T')[0]) {\n            streak++;\n          } else break;\n        }\n      }\n    }\n\n    const basePoints = 10;\n    const streakBonus = Math.floor(streak / 7) * 5;\n    const nextClaimAmount = basePoints + streakBonus;\n\n    return {\n      claimed: !!claimData,\n      streak,\n      nextClaimAmount\n    };\n  }\n\n  async claimDailyPoints(creatorId: string): Promise<number> {\n    const { claimed, streak, nextClaimAmount } = await this.getDailyPointsStatus(creatorId);\n    if (claimed) throw new Error('Daily points already claimed');\n\n    const today = new Date().toISOString().split('T')[0];\n\n    const { error } = await supabase\n      .from('daily_points')\n      .insert({\n        creator_id: creatorId,\n        date: today,\n        points: nextClaimAmount\n      });\n\n    if (error) throw error;\n\n    await this.awardPoints(\n      creatorId,\n      nextClaimAmount,\n      `daily login (${streak + 1} day streak)`,\n      'points_earned'\n    );\n\n    if ((streak + 1) % 7 === 0) {\n      // Get creator address for notification\n      const creator = await this.getCreator(creatorId);\n      if (creator) {\n        await this.createNotification({\n          userId: creator.address,\n          type: 'streak_milestone',\n          title: 'üéâ Weekly Streak Achievement!',\n          message: `Congratulations! You've maintained a ${streak + 1} day streak! Keep it up for more bonus points!`,\n          metadata: {\n            streakDays: streak + 1,\n            shareText: `I just hit a ${streak + 1} day streak on @Every1Fun! üî• Earning more E1XP points every day!\\n\\n#Every1Fun #E1XP #Web3`\n          },\n          read: false\n        });\n      }\n    }\n\n    return nextClaimAmount;\n  }\n\n  // Notification Methods\n  // Flexible createNotification: accepts payloads with either creator_id, userId, user_id or combinations.\n  async createNotification(data: any): Promise<Notification> {\n    // Map creator_id or userId to user_id for the database\n    const userId = data.userId || data.creator_id || data.user_id;\n\n    if (!userId) {\n      console.error('Cannot create notification: no user_id provided', data);\n      throw new Error('user_id is required for notifications');\n    }\n\n    const notificationData = {\n      user_id: userId,\n      type: data.type,\n      title: data.title,\n      message: data.message,\n      coin_address: data.coinAddress || data.coin_address || null,\n      coin_symbol: data.coinSymbol || data.coin_symbol || null,\n      amount: data.amount || null,\n      transaction_hash: data.transactionHash || data.transaction_hash || null,\n      read: data.read || false,\n      created_at: new Date().toISOString(),\n    };\n\n    const { data: notification, error } = await supabase\n      .from('notifications')\n      .insert(notificationData)\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Failed to create notification:', error);\n      throw error;\n    }\n\n    // Map snake_case to camelCase for the frontend\n    return {\n      ...notification,\n      userId: notification.user_id,\n      coinAddress: notification.coin_address,\n      coinSymbol: notification.coin_symbol,\n      transactionHash: notification.transaction_hash,\n      createdAt: notification.created_at,\n      updatedAt: notification.updated_at,\n    } as Notification;\n  }\n\n  async getUserNotifications(userId: string): Promise<Notification[]> {\n    const { data, error } = await supabase\n      .from('notifications')\n      .select('*')\n      .eq('user_id', userId)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n\n    // Map snake_case to camelCase for the frontend\n    return (data || []).map(notification => ({\n      ...notification,\n      userId: notification.user_id,\n      coinAddress: notification.coin_address,\n      coinSymbol: notification.coin_symbol,\n      transactionHash: notification.transaction_hash,\n      createdAt: notification.created_at,\n      updatedAt: notification.updated_at,\n    })) as Notification[];\n  }\n\n  async getNotificationsByUser(userId: string): Promise<Notification[]> {\n    const { data, error } = await supabase\n      .from('notifications')\n      .select('*')\n      .eq('user_id', userId)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n\n    // Map snake_case to camelCase for the frontend\n    return (data || []).map(notification => ({\n      ...notification,\n      userId: notification.user_id,\n      coinAddress: notification.coin_address,\n      coinSymbol: notification.coin_symbol,\n      transactionHash: notification.transaction_hash,\n      createdAt: notification.created_at,\n      updatedAt: notification.updated_at,\n    })) as Notification[];\n  }\n\n  async getUnreadNotificationsByUser(userId: string): Promise<Notification[]> {\n    const { data, error } = await supabase\n      .from('notifications')\n      .select('*')\n      .eq('user_id', userId)\n      .eq('read', false)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n\n    // Map snake_case to camelCase for the frontend\n    return (data || []).map(notification => ({\n      ...notification,\n      userId: notification.user_id,\n      coinAddress: notification.coin_address,\n      coinSymbol: notification.coin_symbol,\n      transactionHash: notification.transaction_hash,\n      createdAt: notification.created_at,\n      updatedAt: notification.updated_at,\n    })) as Notification[];\n  }\n\n  async markNotificationAsRead(id: string): Promise<Notification | undefined> {\n    const { data, error } = await supabase\n      .from('notifications')\n      .update({ read: true })\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n\n    // Map snake_case to camelCase for the frontend\n    if (data) {\n      return {\n        ...data,\n        userId: data.user_id,\n        coinAddress: data.coin_address,\n        coinSymbol: data.coin_symbol,\n        transactionHash: data.transaction_hash,\n        createdAt: data.created_at,\n        updatedAt: data.updated_at,\n      } as Notification;\n    }\n    return undefined;\n  }\n\n  async markAllNotificationsAsRead(userId: string): Promise<void> {\n    const { error } = await supabase\n      .from('notifications')\n      .update({ read: true })\n      .eq('user_id', userId);\n\n    if (error) throw error;\n  }\n\n  async deleteNotification(id: string): Promise<boolean> {\n    const { error } = await supabase\n      .from('notifications')\n      .delete()\n      .eq('id', id);\n\n    if (error) throw error;\n    return true;\n  }\n\n  // Moderation Methods\n  async moderateUser(creatorId: string, action: ModerationType): Promise<void> {\n    const now = new Date();\n    const expiresAt = action.duration\n      ? new Date(now.getTime() + action.duration * 24 * 60 * 60 * 1000)\n      : null;\n\n    const { error: moderationError } = await supabase\n      .from('moderation_actions')\n      .insert({\n        creator_id: creatorId,\n        type: action.type,\n        reason: action.reason,\n        expires_at: expiresAt?.toISOString(),\n        created_at: now.toISOString(),\n        updated_at: now.toISOString()\n      });\n\n    if (moderationError) throw moderationError;\n\n    const updates: any = {\n      status: action.type === 'warning' ? 'warned' : action.type,\n      restricted_until: expiresAt?.toISOString(),\n      updated_at: now.toISOString()\n    };\n\n    const { error: updateError } = await supabase\n      .from('creators')\n      .update(updates)\n      .eq('id', creatorId);\n\n    if (updateError) throw updateError;\n\n    const notification = {\n      creator_id: creatorId,\n      type: `account_${action.type}`,\n      title: `Account ${action.type === 'warning' ? 'Warning' : action.type === 'restrict' ? 'Restricted' : 'Banned'}`,\n      message: `Your account has been ${action.type === 'warning' ? 'warned' : action.type === 'restrict' ? 'restricted' : 'banned'} for the following reason: ${action.reason}`,\n      metadata: {\n        type: action.type,\n        reason: action.reason,\n        duration: action.duration,\n        expiresAt: expiresAt?.toISOString()\n      },\n      read: false,\n      created_at: now.toISOString(),\n      updated_at: now.toISOString()\n    };\n\n    const { error: notificationError } = await supabase\n      .from('notifications')\n      .insert(notification);\n\n    if (notificationError) throw notificationError;\n  }\n\n  async getModerationHistory(creatorId: string): Promise<ModerationType[]> {\n    const { data, error } = await supabase\n      .from('moderation_actions')\n      .select('*')\n      .eq('creator_id', creatorId)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as ModerationType[];\n  }\n\n  // ===== PUSH SUBSCRIPTIONS =====\n  async createPushSubscription(data: { userAddress: string; subscription: string; endpoint: string }): Promise<void> {\n    const { error } = await supabase\n      .from('push_subscriptions')\n      .upsert({\n        user_address: data.userAddress,\n        subscription: data.subscription,\n        endpoint: data.endpoint,\n        created_at: new Date().toISOString()\n      }, {\n        onConflict: 'user_address'\n      });\n\n    if (error) throw error;\n  }\n\n  async getPushSubscriptionsByUser(userAddress: string): Promise<any[]> {\n    const { data, error } = await supabase\n      .from('push_subscriptions')\n      .select('*')\n      .eq('user_address', userAddress);\n\n    if (error) throw error;\n    return data || [];\n  }\n\n  async getAllPushSubscriptions(): Promise<any[]> {\n    const { data, error } = await supabase\n      .from('push_subscriptions')\n      .select('*');\n\n    if (error) throw error;\n    return data || [];\n  }\n\n  // ===== COMMENTS =====\n  async createComment(comment: InsertComment): Promise<Comment> {\n    const { data, error } = await supabase\n      .from('comments')\n      .insert({\n        coin_address: comment.coinAddress,\n        user_address: comment.userAddress,\n        comment: comment.comment,\n        transaction_hash: comment.transactionHash,\n        created_at: new Date().toISOString()\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Comment;\n  }\n\n  async getCommentsByCoin(coinAddress: string): Promise<Comment[]> {\n    const { data, error } = await supabase\n      .from('comments')\n      .select('*')\n      .eq('coin_address', coinAddress)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Comment[];\n  }\n\n  async getAllComments(): Promise<Comment[]> {\n    const { data, error } = await supabase\n      .from('comments')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Comment[];\n  }\n\n  // ===== FOLLOWS =====\n  async createFollow(insertFollow: InsertFollow): Promise<Follow> {\n    const { data, error } = await supabase\n      .from('follows')\n      .insert({\n        follower_address: insertFollow.followerAddress,\n        creator_address: insertFollow.followingAddress,\n        created_at: new Date().toISOString()\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Follow;\n  }\n\n  async deleteFollow(followerAddress: string, followingAddress: string): Promise<boolean> {\n    const { error } = await supabase\n      .from('follows')\n      .delete()\n      .eq('follower_address', followerAddress)\n      .eq('creator_address', followingAddress);\n\n    if (error) throw error;\n    return true;\n  }\n\n  async getFollowers(userAddress: string): Promise<Follow[]> {\n    const { data, error } = await supabase\n      .from('follows')\n      .select('*')\n      .eq('creator_address', userAddress)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Follow[];\n  }\n\n  async getFollowing(userAddress: string): Promise<Follow[]> {\n    const { data, error } = await supabase\n      .from('follows')\n      .select('*')\n      .eq('follower_address', userAddress)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Follow[];\n  }\n\n  async isFollowing(followerAddress: string, followingAddress: string): Promise<boolean> {\n    const { data, error } = await supabase\n      .from('follows')\n      .select('id')\n      .eq('follower_address', followerAddress)\n      .eq('creator_address', followingAddress)\n      .single();\n\n    return data !== null && !error;\n  }\n\n  async getFollowersByAddress(userAddress: string): Promise<Follow[]> {\n    return this.getFollowers(userAddress);\n  }\n\n  async getFollowingByAddress(userAddress: string): Promise<Follow[]> {\n    return this.getFollowing(userAddress);\n  }\n\n  // ===== REFERRALS =====\n  async createReferral(insertReferral: InsertReferral): Promise<Referral> {\n    const { data, error } = await supabase\n      .from('referrals')\n      .insert({\n        referrer_address: insertReferral.referrerAddress,\n        referred_address: insertReferral.referredAddress,\n        referral_code: insertReferral.referralCode,\n        points_earned: insertReferral.pointsEarned || '100',\n        claimed: true,\n        created_at: new Date().toISOString()\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as Referral;\n  }\n\n  async getReferralsByReferrer(referrerAddress: string): Promise<Referral[]> {\n    const { data, error } = await supabase\n      .from('referrals')\n      .select('*')\n      .eq('referrer_address', referrerAddress)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Referral[];\n  }\n\n  async getReferralsByCode(referralCode: string): Promise<Referral[]> {\n    const { data, error } = await supabase\n      .from('referrals')\n      .select('*')\n      .eq('referral_code', referralCode)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data as Referral[];\n  }\n\n  async getReferralByAddresses(referrerAddress: string, referredAddress: string): Promise<Referral | undefined> {\n    const { data, error } = await supabase\n      .from('referrals')\n      .select('*')\n      .eq('referrer_address', referrerAddress)\n      .eq('referred_address', referredAddress)\n      .single();\n\n    if (error && error.code !== 'PGRST116') throw error;\n    return data as Referral | undefined;\n  }\n\n  // ===== LOGIN STREAKS =====\n  async getLoginStreak(userId: string): Promise<LoginStreak | undefined> {\n    console.log('[Storage] getLoginStreak for identifier:', userId);\n\n    const { data, error } = await supabase\n      .from('login_streaks')\n      .select('*')\n      .eq('user_id', userId)\n      .single();\n\n    if (error) {\n      if (error.code === 'PGRST116') {\n        console.log('[Storage] No login streak found for user:', userId);\n        return undefined;\n      }\n      console.error('Login streak fetch error:', error);\n      throw error;\n    }\n\n    if (!data) {\n      console.log('[Storage] No login streak data returned for user:', userId);\n      return undefined;\n    }\n\n    console.log('[Storage] Found login streak:', {\n      currentStreak: data.current_streak,\n      longestStreak: data.longest_streak,\n      lastLoginDate: data.last_login_date,\n    });\n\n    const now = new Date();\n    const lastLoginDate = data.last_login_date;\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()).toISOString().split('T')[0];\n\n    // Build weekly calendar showing which days this week were checked in\n    const weeklyCalendar = [false, false, false, false, false, false, false];\n    const currentDayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, etc.\n    const mondayIndex = currentDayOfWeek === 0 ? 6 : currentDayOfWeek - 1; // Convert to Monday-first (0 = Monday)\n\n    // Mark today as checked in if user has checked in today\n    if (lastLoginDate === today) {\n      weeklyCalendar[mondayIndex] = true;\n    }\n\n    // Map snake_case to camelCase\n    return {\n      id: data.id,\n      userId: data.user_id,\n      currentStreak: data.current_streak,\n      longestStreak: data.longest_streak,\n      lastLoginDate: data.last_login_date,\n      totalPoints: data.total_points,\n      loginDates: data.login_dates,\n      weeklyCalendar: weeklyCalendar,\n    } as LoginStreak;\n  }\n\n  async createLoginStreak(insertLoginStreak: InsertLoginStreak): Promise<LoginStreak> {\n    const { data, error } = await supabase\n      .from('login_streaks')\n      .insert({\n        user_id: insertLoginStreak.userId,\n        current_streak: insertLoginStreak.currentStreak,\n        longest_streak: insertLoginStreak.longestStreak,\n        last_login_date: insertLoginStreak.lastLoginDate,\n        total_points: insertLoginStreak.totalPoints,\n        login_dates: insertLoginStreak.loginDates,\n        weekly_calendar: insertLoginStreak.weeklyCalendar || [false, false, false, false, false, false, false],\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n\n    // Map snake_case to camelCase\n    return {\n      id: data.id,\n      userId: data.user_id,\n      currentStreak: data.current_streak,\n      longestStreak: data.longest_streak,\n      lastLoginDate: data.last_login_date,\n      totalPoints: data.total_points,\n      loginDates: data.login_dates,\n      weeklyCalendar: data.weekly_calendar,\n    } as LoginStreak;\n  }\n\n  async updateLoginStreak(userAddress: string, update: UpdateLoginStreak): Promise<LoginStreak | undefined> {\n    const updates: any = { updated_at: new Date().toISOString() };\n\n    if (update.currentStreak !== undefined) updates.current_streak = update.currentStreak;\n    if (update.longestStreak !== undefined) updates.longest_streak = update.longestStreak;\n    if (update.lastLoginDate !== undefined) updates.last_login_date = update.lastLoginDate;\n    if (update.totalPoints !== undefined) updates.total_points = update.totalPoints;\n    if (update.loginDates !== undefined) updates.login_dates = update.loginDates;\n    if (update.weeklyCalendar !== undefined) updates.weekly_calendar = update.weeklyCalendar;\n\n    const { data, error } = await supabase\n      .from('login_streaks')\n      .update(updates)\n      .eq('user_address', userAddress)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as LoginStreak | undefined;\n  }\n\n  async checkInStreak(userId: string): Promise<{ currentStreak: number; pointsEarned: number; isFirstLogin: boolean }> {\n    const today = new Date().toISOString().split('T')[0];\n\n    // Get existing streak data\n    const { data: existingStreak, error: fetchError } = await supabase\n      .from('login_streaks')\n      .select('*')\n      .eq('user_id', userId)\n      .single();\n\n    if (fetchError && fetchError.code !== 'PGRST116') {\n      throw fetchError;\n    }\n\n    // Check if already checked in today\n    if (existingStreak?.last_login_date === today) {\n      throw new Error('You have already checked in today. Come back tomorrow!');\n    }\n\n    // Check if this is the user's first login\n    const isFirstLogin = !existingStreak;\n\n    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];\n    let currentStreak = 1;\n    let pointsEarned = 10;\n\n    if (existingStreak) {\n      if (existingStreak.last_login_date === yesterday) {\n        currentStreak = (existingStreak.current_streak || 0) + 1;\n      }\n    }\n\n    // Calculate bonus points for streaks\n    if (currentStreak === 3) pointsEarned = 25;\n    else if (currentStreak === 7) pointsEarned = 50;\n    else if (currentStreak === 30) pointsEarned = 200;\n\n    const longestStreak = Math.max(currentStreak, existingStreak?.longest_streak || 0);\n\n    if (existingStreak) {\n      const { error } = await supabase\n        .from('login_streaks')\n        .update({\n          current_streak: currentStreak,\n          longest_streak: longestStreak,\n          last_login_date: today,\n          total_points: (existingStreak.total_points || 0) + pointsEarned,\n        })\n        .eq('user_id', userId);\n\n      if (error) throw error;\n    } else {\n      const { error } = await supabase\n        .from('login_streaks')\n        .upsert({\n          user_id: userId,\n          current_streak: currentStreak,\n          longest_streak: longestStreak,\n          last_login_date: today,\n          total_points: pointsEarned,\n        }, {\n          onConflict: 'user_id'\n        });\n\n      if (error) throw error;\n    }\n\n    // Award points to creator\n    await this.awardPoints(userId, pointsEarned, `Daily login streak (Day ${currentStreak})`, 'daily_login');\n\n    return { currentStreak, pointsEarned, isFirstLogin };\n  }\n\n\n  // ===== E1XP REWARDS =====\n  async getE1xpRewardsByUser(userId: string): Promise<E1xpReward[]> {\n    const { data, error } = await supabase\n      .from('e1xp_rewards')\n      .select('*')\n      .eq('user_id', userId)\n      .order('created_at', { ascending: false });\n\n    if (error) {\n      // Return empty array if table doesn't exist yet\n      if (error.code === 'PGRST205') {\n        console.log('e1xp_rewards table not found, returning empty array');\n        return [];\n      }\n      throw error;\n    }\n    return data || [];\n  }\n\n  async getUnclaimedE1xpRewardsByUser(userId: string): Promise<E1xpReward[]> {\n    const { data, error } = await supabase\n      .from('e1xp_rewards')\n      .select('*')\n      .eq('user_id', userId)\n      .eq('claimed', false)\n      .order('created_at', { ascending: false });\n\n    if (error) {\n      // Return empty array if table doesn't exist yet\n      if (error.code === 'PGRST205') {\n        console.log('e1xp_rewards table not found, returning empty array');\n        return [];\n      }\n      throw error;\n    }\n    return data || [];\n  }\n\n  async claimE1xpReward(rewardId: string): Promise<E1xpReward | undefined> {\n    const { data, error } = await supabase\n      .from('e1xp_rewards')\n      .update({ claimed: true, claimed_at: new Date().toISOString() })\n      .eq('id', rewardId)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as E1xpReward | undefined;\n  }\n\n  async createE1xpReward(reward: any): Promise<E1xpReward> {\n    const { data, error } = await supabase\n      .from('e1xp_rewards')\n      .insert({\n        user_id: reward.userId,\n        amount: reward.amount,\n        type: reward.type,\n        title: reward.title,\n        message: reward.message,\n        metadata: reward.metadata || {},\n        claimed: false,\n        created_at: new Date().toISOString(),\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data as E1xpReward;\n  }\n\n  async getRewardsByCreator(address: string): Promise<any[]> {\n    const { data, error } = await supabase\n      .from('rewards')\n      .select('*')\n      .eq('recipient_address', address)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data || [];\n  }\n\n  // ===== USERS (for E1XP and referrals) =====\n  async getAllUsers(): Promise<User[]> {\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (error) {\n      console.error('Error fetching all users:', error);\n      // Return empty array if table doesn't exist or other error\n      if (error.code === 'PGRST205') {\n        console.log('users table not found, returning empty array');\n        return [];\n      }\n      throw error;\n    }\n    return data as User[];\n  }\n\n  async getUserByPrivyId(privyId: string): Promise<User | undefined> {\n    const result = await db\n      .select()\n      .from(users)\n      .where(eq(users.privyId, privyId))\n      .limit(1);\n    return result[0];\n  }\n\n  async getUserByAddress(address: string): Promise<User | undefined> {\n    const result = await db\n      .select()\n      .from(users)\n      .where(eq(users.walletAddress, address))\n      .limit(1);\n    return result[0];\n  }\n\n  async getUserById(id: string): Promise<User | undefined> {\n    const result = await db\n      .select()\n      .from(users)\n      .where(eq(users.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async getUserByReferralCode(referralCode: string): Promise<User | undefined> {\n    const result = await db\n      .select()\n      .from(users)\n      .where(eq(users.referralCode, referralCode))\n      .limit(1);\n    return result[0];\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .eq('email', email)\n      .single();\n\n    if (error && error.code !== 'PGRST116') throw error;\n    return data as User | undefined;\n  }\n\n  // ===== COMMENT REACTIONS =====\n  async addCommentReaction(data: { commentId: string; userAddress: string; emoji: string }) {\n    const { data: reaction, error } = await supabase\n      .from('comment_reactions')\n      .upsert({\n        comment_id: data.commentId,\n        user_address: data.userAddress,\n        emoji: data.emoji,\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return reaction;\n  }\n\n  async removeCommentReaction(commentId: string, userAddress: string, emoji: string) {\n    const { error } = await supabase\n      .from('comment_reactions')\n      .delete()\n      .eq('comment_id', commentId)\n      .eq('user_address', userAddress)\n      .eq('emoji', emoji);\n\n    if (error) throw error;\n  }\n\n  async getCommentReactions(commentId: string) {\n    const { data, error } = await supabase\n      .from('comment_reactions')\n      .select('*')\n      .eq('comment_id', commentId);\n\n    if (error) throw error;\n    return data || [];\n  }\n\n  // ===== USER BADGES =====\n  async awardBadge(data: { userId: string; badgeType: string; badgeName: string; badgeIcon?: string; description?: string; metadata?: any }) {\n    const { data: badge, error } = await supabase\n      .from('user_badges')\n      .insert({\n        user_id: data.userId,\n        badge_type: data.badgeType,\n        badge_name: data.badgeName,\n        badge_icon: data.badgeIcon,\n        description: data.description,\n        metadata: data.metadata || {},\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return badge;\n  }\n\n  async getUserBadges(userId: string) {\n    const { data, error } = await supabase\n      .from('user_badges')\n      .select('*')\n      .eq('user_id', userId)\n      .order('earned_at', { ascending: false });\n\n    if (error) throw error;\n    return data || [];\n  }\n\n  // ===== TRADE HISTORY =====\n  async recordTrade(data: {\n    userAddress: string;\n    coinAddress: string;\n    coinSymbol?: string;\n    tradeType: string;\n    amountEth: string;\n    amountTokens?: string;\n    pricePerToken?: string;\n    totalValueUsd?: string;\n    transactionHash?: string;\n    blockNumber?: number;\n    gasUsed?: string;\n    gasPrice?: string;\n    metadata?: any;\n  }) {\n    const { data: trade, error } = await supabase\n      .from('trade_history')\n      .insert({\n        user_address: data.userAddress,\n        coin_address: data.coinAddress,\n        coin_symbol: data.coinSymbol,\n        trade_type: data.tradeType,\n        amount_eth: data.amountEth,\n        amount_tokens: data.amountTokens,\n        price_per_token: data.pricePerToken,\n        total_value_usd: data.totalValueUsd,\n        transaction_hash: data.transactionHash,\n        block_number: data.blockNumber,\n        gas_used: data.gasUsed,\n        gas_price: data.gasPrice,\n        metadata: data.metadata || {},\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return trade;\n  }\n\n  async getUserTradeHistory(userAddress: string, limit = 50) {\n    const { data, error } = await supabase\n      .from('trade_history')\n      .select('*')\n      .eq('user_address', userAddress)\n      .order('timestamp', { ascending: false })\n      .limit(limit);\n\n    if (error) throw error;\n    return data || [];\n  }\n\n  async getCoinTradeHistory(coinAddress: string, limit = 50) {\n    const { data, error } = await supabase\n      .from('trade_history')\n      .select('*')\n      .eq('coin_address', coinAddress)\n      .order('timestamp', { ascending: false })\n      .limit(limit);\n\n    if (error) throw error;\n    return data || [];\n  }\n\n  // ===== CREATOR STORIES =====\n  async createStory(data: {\n    creatorAddress: string;\n    contentType?: string;\n    contentUrl?: string;\n    textContent?: string;\n    thumbnailUrl?: string;\n    duration?: number;\n  }) {\n    const expiresAt = new Date(Date.now() + (data.duration || 86400) * 1000);\n\n    const { data: story, error } = await supabase\n      .from('creator_stories')\n      .insert({\n        creator_address: data.creatorAddress,\n        content_type: data.contentType || 'image',\n        content_url: data.contentUrl,\n        text_content: data.textContent,\n        thumbnail_url: data.thumbnailUrl,\n        duration: data.duration || 86400,\n        expires_at: expiresAt.toISOString(),\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return story;\n  }\n\n  async getActiveStories(creatorAddress?: string) {\n    let query = supabase\n      .from('creator_stories')\n      .select('*')\n      .eq('is_active', true)\n      .gt('expires_at', new Date().toISOString())\n      .order('created_at', { ascending: false });\n\n    if (creatorAddress) {\n      query = query.eq('creator_address', creatorAddress);\n    }\n\n    const { data, error } = await query;\n    if (error) throw error;\n    return data || [];\n  }\n\n  async recordStoryView(storyId: string, viewerAddress: string) {\n    const { error: viewError } = await supabase\n      .from('story_views')\n      .upsert({\n        story_id: storyId,\n        viewer_address: viewerAddress,\n      });\n\n    if (viewError && viewError.code !== '23505') throw viewError;\n\n    const { error: updateError } = await supabase.rpc('increment_story_views', { story_id: storyId });\n    if (updateError) console.error('Error incrementing story views:', updateError);\n  }\n\n  async getStoryViews(storyId: string) {\n    const { data, error } = await supabase\n      .from('story_views')\n      .select('*')\n      .eq('story_id', storyId);\n\n    if (error) throw error;\n    return data || [];\n  }\n\n  // ===== SEARCH HISTORY =====\n  async recordSearch(data: {\n    userAddress?: string;\n    searchQuery: string;\n    searchType?: string;\n    resultCount?: number;\n    clickedResult?: string;\n  }) {\n    const { data: search, error } = await supabase\n      .from('search_history')\n      .insert({\n        user_address: data.userAddress,\n        search_query: data.searchQuery,\n        search_type: data.searchType || 'general',\n        result_count: data.resultCount || 0,\n        clicked_result: data.clickedResult,\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n    return search;\n  }\n\n  async getPopularSearches(limit = 10) {\n    const { data, error } = await supabase\n      .from('search_history')\n      .select('search_query, COUNT(*) as count')\n      .gte('created_at', new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString())\n      .group('search_query')\n      .order('count', { ascending: false })\n      .limit(limit);\n\n    if (error) throw error;\n    return data || [];\n  }\n\n  async getUserSearchHistory(userAddress: string, limit = 20) {\n    const { data, error } = await supabase\n      .from('search_history')\n      .select('*')\n      .eq('user_address', userAddress)\n      .order('created_at', { ascending: false })\n      .limit(limit);\n\n    if (error) throw error;\n    return data || [];\n  }\n\n  // ===== MESSAGES =====\n  async createMessage(insertMessage: any): Promise<any> {\n    const { data, error } = await supabase\n      .from('messages')\n      .insert({\n        sender_id: insertMessage.senderId,\n        recipient_id: insertMessage.recipientId,\n        content: insertMessage.content,\n        message_type: insertMessage.messageType || 'text',\n        is_read: false,\n      })\n      .select()\n      .single();\n\n    if (error) throw error;\n\n    // Map snake_case to camelCase\n    return {\n      id: data.id,\n      senderId: data.sender_id,\n      recipientId: data.recipient_id,\n      content: data.content,\n      messageType: data.message_type,\n      isRead: data.is_read,\n      createdAt: new Date(data.created_at),\n    };\n  }\n\n  async getMessagesBetweenUsers(userId1: string, userId2: string): Promise<any[]> {\n    const { data, error } = await supabase\n      .from('messages')\n      .select('*')\n      .or(`and(sender_id.eq.${userId1},recipient_id.eq.${userId2}),and(sender_id.eq.${userId2},recipient_id.eq.${userId1})`)\n      .order('created_at', { ascending: true });\n\n    if (error) throw error;\n\n    // Map snake_case to camelCase\n    return (data || []).map(msg => ({\n      id: msg.id,\n      senderId: msg.sender_id,\n      recipientId: msg.recipient_id,\n      content: msg.content,\n      messageType: msg.message_type,\n      isRead: msg.is_read,\n      createdAt: new Date(msg.created_at),\n    }));\n  }\n\n  async markMessagesAsRead(userId: string, otherUserId: string): Promise<void> {\n    const { error } = await supabase\n      .from('messages')\n      .update({ is_read: true })\n      .eq('recipient_id', userId)\n      .eq('sender_id', otherUserId)\n      .eq('is_read', false);\n\n    if (error) throw error;\n  }\n\n  async getConversationsForUser(userId: string): Promise<Array<{ otherUserId: string, lastMessage: any }>> {\n    // Get all messages where user is sender or recipient\n    const { data: allMessages, error } = await supabase\n      .from('messages')\n      .select('*')\n      .or(`sender_id.eq.${userId},recipient_id.eq.${userId}`)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n\n    // Group by conversation partner\n    const conversationMap = new Map<string, any>();\n\n    for (const msg of allMessages || []) {\n      const otherUserId = msg.sender_id === userId ? msg.recipient_id : msg.sender_id;\n      if (!conversationMap.has(otherUserId)) {\n        conversationMap.set(otherUserId, {\n          id: msg.id,\n          senderId: msg.sender_id,\n          recipientId: msg.recipient_id,\n          content: msg.content,\n          messageType: msg.message_type,\n          isRead: msg.is_read,\n          createdAt: new Date(msg.created_at),\n        });\n      }\n    }\n\n    return Array.from(conversationMap.entries()).map(([otherUserId, lastMessage]) => ({\n      otherUserId,\n      lastMessage\n    }));\n  }\n\n  async getUnreadMessageCount(userId: string, otherUserId: string): Promise<number> {\n    const { count, error } = await supabase\n      .from('messages')\n      .select('*', { count: 'exact', head: true })\n      .eq('recipient_id', userId)\n      .eq('sender_id', otherUserId)\n      .eq('is_read', false);\n\n    if (error) throw error;\n    return count || 0;\n  }\n}\n\nexport const storage = new SupabaseStorage();","size_bytes":53401},"server/migrate-old-data.ts":{"content":"import { storage } from \"./supabase-storage\";\n\n// Old coins data structure\ninterface OldCoin {\n  id: string;\n  coin_address: string;\n  creator_wallet: string;\n  transaction_hash: string;\n  created_at: string;\n  ipfs_uri: string;\n  metadata: {\n    tags?: string[];\n    image?: string;\n    title?: string;\n    author?: string;\n    content?: string;\n    description?: string;\n    originalUrl?: string;\n    publishDate?: string;\n  };\n  name: string;\n  symbol: string;\n}\n\nconst oldCoinsData: OldCoin[] = [\n  {\n    id: '085bbf2d-ea9a-4311-a93c-81efe81c4e03',\n    coin_address: '0xd4eC4b5D04EB1cc6344f25611542E540Da3AcBF7',\n    creator_wallet: '0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7',\n    transaction_hash: '0xf32a87327eb785d7c62bccc72e04099c36f6d9ac6795671edd44694f155b3be1',\n    created_at: '2025-09-25 00:03:55.594818',\n    ipfs_uri: 'ipfs://bafkreihrnjn4hj6wozky2ss357ma7ewasghxjovzpyykagy5c5qqkt5x3i',\n    metadata: {\n      tags: [],\n      image: 'https://zora.co/api/og-image/coin/base:0xde7c9a53edd5ef151210aa7c1da9dc80068547ab',\n      title: 'Test this test that',\n      author: '',\n      content: '',\n      description: 'A coin representing the blog post: Why Every Senior Developer I Know Is Planning Their Exit | by Harishsingh | Sep, 2025 | Medium',\n      originalUrl: 'https://zora.co/coin/base:0xde7c9a53edd5ef151210aa7c1da9dc80068547ab',\n      publishDate: ''\n    },\n    name: 'Test this test that',\n    symbol: 'TESTTHIS'\n  },\n  {\n    id: '5802d950-d913-4fc2-b4ef-5d4c2f1db213',\n    coin_address: '0x509059DBB581927C8641673126eBACD46AC359Ca',\n    creator_wallet: '0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7',\n    transaction_hash: '0xa0a1215e52ede64b456c92987c4ce6547ba53e309ae80ec064b1e06865f9f6ca',\n    created_at: '2025-09-25 16:07:43.724032',\n    ipfs_uri: 'ipfs://bafkreiel7sh6daodoktdm3pmaeblaknyp2otbilkz3xthvozvksu6gxnge',\n    metadata: {\n      tags: [],\n      image: 'https://yellow-patient-cheetah-559.mypinata.cloud/ipfs/bafkreiel7sh6daodoktdm3pmaeblaknyp2otbilkz3xthvozvksu6gxnge',\n      title: 'VICTORIA',\n      author: '',\n      content: '',\n      description: '',\n      originalUrl: '',\n      publishDate: ''\n    },\n    name: 'VICTORIA',\n    symbol: 'VICTO'\n  },\n  {\n    id: 'f3f15db4-b357-47f1-bff3-7537933845a0',\n    coin_address: '0x123...',\n    creator_wallet: '0xabc...',\n    transaction_hash: '0xhash...',\n    created_at: '2025-09-13 12:21:24.872099',\n    ipfs_uri: 'ipfs://uri',\n    metadata: {\n      tags: [],\n      image: '',\n      title: 'Recovered Blog Coin',\n      author: '',\n      content: '',\n      description: 'A recovered blog coin from the old system',\n      originalUrl: '',\n      publishDate: ''\n    },\n    name: 'Recovered Blog Coin',\n    symbol: 'BLOGFIX'\n  },\n  {\n    id: 'f4248ea3-59b2-4448-92ae-bfc7f59e9d12',\n    coin_address: '0xDE7C9a53eDd5Ef151210Aa7C1Da9dC80068547Ab',\n    creator_wallet: '0xb843A2D0D4B9E628500d2E0f6f0382e063C14a95',\n    transaction_hash: '0xf2469e00c6688fa9b193bc7b4c1f0ebacf64f87ae552dec948c53d83a0c4b370',\n    created_at: '2025-09-13 13:27:57.883838',\n    ipfs_uri: 'ipfs://bafkreihtfa57szgjp6qu7xzytj7otuyoyl67qmnzlu3p4bmesuumpsa3ki',\n    metadata: {\n      tags: [],\n      image: 'https://miro.medium.com/v2/da:true/resize:fit:1200/0*jCeSNt_UZku7uzGM',\n      title: 'Why Every Senior Developer I Know Is Planning Their Exit | by Harishsingh | Sep, 2025 | Medium',\n      author: 'Harishsingh',\n      content: 'Member-only storyWhy Every Senior Developer I Know Is Planning Their ExitHarishsingh4 min read¬∑Sep 4, 2025--62ShareAfter 10 years in software development, with the last three in high-frequency trading, I\\'m witnessing something unprecedented: every senior developer in my network is planning their exit from traditional employment. Not just job-hopping , complete career pivots.Press enter or click to view image in full sizeAI-generated digital illustrationThe reasons go deeper than burnout or better pay. The fundamental relationship between developers and the industry has shifted, and the smart money is already moving.The Invisible Productivity TaxModern development has become an exercise in navigating bureaucracy rather than solving problems. Here\\'s what my day looked like this week:Time Breakdown (40-hour week):Actual coding: 12 hours (30%)Meetings about meetings: 8 hours (20%)Process compliance: 8 hours (20%)Documentation for audit trails: 6 hours (15%)Context switching overhead: 6 hours (15%)In HFT, microseconds matter. Yet I spend more time in Jira than optimizing algorithms. The irony is suffocating.// What I want to writefunc optimizeOrderExecution(order *Order) (*Execution, error) { return executeWithMinimalLatency(order)}// What compliance‚Ä¶',\n      description: 'Why Every Senior Developer I Know Is Planning Their Exit After 10 years in software development, with the last three in high-frequency trading, I\\'m witnessing something unprecedented: every senior ‚Ä¶',\n      originalUrl: 'https://medium.com/@harishsingh8529/why-every-senior-developer-i-know-is-planning-their-exit-8294cc17b7c7',\n      publishDate: '2025-09-10T04:50:40.894Z'\n    },\n    name: 'Test this test that',\n    symbol: 'TESTEST'\n  },\n  {\n    id: 'fc0604ca-6e8a-4fed-b7e0-078ca63b6a09',\n    coin_address: '0x285f10f443aA139C1d0982815BF1B039aE438a3a',\n    creator_wallet: '0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7',\n    transaction_hash: '',\n    created_at: '2025-09-28 16:26:39.379569',\n    ipfs_uri: 'ipfs://bafkreicvvt4qxbyqjle5lkn472eyucggenrflzlkflozv2dpo5aj6jnvxm',\n    metadata: {\n      tags: [],\n      image: 'ipfs://bafybeifknagau4jdfz2bym4y7nurtjtop53wnamy5lzx573pzjpmxrg7mu',\n      title: 'CreatorEarning',\n      author: '',\n      content: '',\n      description: 'A coin representing the image: CreatorEarning',\n      originalUrl: '',\n      publishDate: ''\n    },\n    name: 'CreatorEarning',\n    symbol: 'CREATEANDEARN'\n  },\n  {\n    id: 'fd630af5-fad3-426b-920a-22aa86fee84e',\n    coin_address: '0xe8aFE7B4687abad8603495deC3b9Fd37D697b663',\n    creator_wallet: '0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7',\n    transaction_hash: '0x0a679ca18599d1401806dc9f1ce6211d9d8eeae35cc728bd0863624b8ea085a4',\n    created_at: '2025-09-25 14:47:07.161196',\n    ipfs_uri: 'ipfs://bafkreifzddskxxtsmqpjzutdg3hpf4qagowixd7bjem4y6jifzy3vi7oey',\n    metadata: {\n      tags: [],\n      image: 'ipfs://bafkreifzddskxxtsmqpjzutdg3hpf4qagowixd7bjem4y6jifzy3vi7oey',\n      title: 'YELLOW',\n      author: '',\n      content: '',\n      description: '',\n      originalUrl: '',\n      publishDate: ''\n    },\n    name: 'YELLOW',\n    symbol: 'YELLOW'\n  }\n];\n\nlet migrationCompleted = false;\n\nexport async function migrateOldData() {\n  const startTime = Date.now();\n  const errors: string[] = [];\n  let migratedCount = 0;\n\n  for (const oldCoin of oldCoinsData) {\n    try {\n      // Check if coin already exists by address\n      const existingCoin = await storage.getCoinByAddress(oldCoin.coin_address);\n      if (existingCoin) {\n        console.log(`Coin ${oldCoin.coin_address} already exists, skipping`);\n        continue;\n      }\n\n      // Create scraped content from metadata\n      const scrapedContent = await storage.createScrapedContent({\n        url: oldCoin.metadata.originalUrl || `https://etherscan.io/tx/${oldCoin.transaction_hash}`,\n        platform: 'blog',\n        title: oldCoin.metadata.title || oldCoin.name,\n        description: oldCoin.metadata.description || '',\n        author: oldCoin.metadata.author || '',\n        publishDate: oldCoin.metadata.publishDate || '',\n        image: oldCoin.metadata.image || '',\n        content: oldCoin.metadata.content || '',\n        tags: oldCoin.metadata.tags || [],\n      });\n\n      // Skip coins without creator_wallet\n      if (!oldCoin.creator_wallet) {\n        const errorMsg = `Skipped coin ${oldCoin.id}: missing creator_wallet`;\n        errors.push(errorMsg);\n        console.log(errorMsg);\n        continue;\n      }\n\n      // Create coin and creator, linked to scraped content\n      const coin = await storage.createCoin({\n        name: oldCoin.name,\n        symbol: oldCoin.symbol,\n        creator_wallet: oldCoin.creator_wallet,\n        address: oldCoin.coin_address,\n        status: 'active',\n        scrapedContentId: scrapedContent?.id || null,\n        ipfsUri: oldCoin.ipfs_uri || null,\n      });\n\n      // Create or update creator\n      let creator = await storage.getCreatorByAddress(oldCoin.creator_wallet);\n      if (!creator) {\n        creator = await storage.createCreator({\n          address: oldCoin.creator_wallet,\n          totalCoins: '1',\n          totalVolume: '0',\n          followers: '0',\n        });\n      } else {\n        const newTotalCoins = (parseInt(creator.totalCoins) + 1).toString();\n        await storage.updateCreator(creator.id, {\n          totalCoins: newTotalCoins,\n        });\n      }\n\n      migratedCount++;\n    } catch (error) {\n      const errorMsg = `Failed to migrate coin ${oldCoin.id}: ${error}`;\n      errors.push(errorMsg);\n    }\n  }\n\n  const duration = Date.now() - startTime;\n  return {\n    success: true,\n    count: migratedCount,\n    total: oldCoinsData.length,\n    errors,\n    duration: `${duration}ms`\n  };\n}\n\nexport async function autoMigrateOnStartup() {\n  if (migrationCompleted) {\n    return { message: \"Migration already completed\" };\n  }\n\n  try {\n    // Check if any coins exist already\n    const existingCoins = await storage.getAllCoins();\n    if (existingCoins.length === 0) {\n      console.log(\"No coins found, running automatic migration...\");\n      const result = await migrateOldData();\n      migrationCompleted = true;\n      console.log(`Migration completed: ${result.count}/${result.total} coins imported`);\n      return result;\n    } else {\n      console.log(`Found ${existingCoins.length} existing coins, skipping migration`);\n      migrationCompleted = true;\n      return { message: `Skipped migration, found ${existingCoins.length} existing coins` };\n    }\n  } catch (error) {\n    console.error(\"Auto migration failed:\", error);\n    return { error: \"Auto migration failed\" };\n  }\n}\n\n// Old rewards/fee data from previous database\ninterface OldReward {\n  type: 'platform' | 'trade';\n  coinAddress: string;\n  coinSymbol: string;\n  transactionHash: string;\n  rewardAmount: string;\n  recipientAddress: string;\n  createdAt: string;\n}\n\nconst oldRewardsData: OldReward[] = [\n  // Add your historical rewards data here\n  // Example format:\n  // {\n  //   type: 'platform',\n  //   coinAddress: '0xd4eC4b5D04EB1cc6344f25611542E540Da3AcBF7',\n  //   coinSymbol: 'TESTTHIS',\n  //   transactionHash: '0x...',\n  //   rewardAmount: '1000000000000000000', // 1 ZORA in wei\n  //   recipientAddress: '0xYourPlatformAddress',\n  //   createdAt: '2025-09-25 00:03:55'\n  // }\n];\n\nexport async function migrateOldRewards() {\n  const startTime = Date.now();\n  const errors: string[] = [];\n  let migratedCount = 0;\n\n  for (const oldReward of oldRewardsData) {\n    try {\n      // Check if reward already exists by transaction hash\n      const existingRewards = await storage.getAllRewards();\n      const exists = existingRewards.some(r => r.transactionHash === oldReward.transactionHash);\n      \n      if (exists) {\n        console.log(`Reward ${oldReward.transactionHash} already exists, skipping`);\n        continue;\n      }\n\n      await storage.createReward({\n        type: oldReward.type,\n        coinAddress: oldReward.coinAddress,\n        coinSymbol: oldReward.coinSymbol,\n        transactionHash: oldReward.transactionHash,\n        rewardAmount: oldReward.rewardAmount,\n        rewardCurrency: 'ZORA',\n        recipientAddress: oldReward.recipientAddress,\n      });\n\n      migratedCount++;\n    } catch (error) {\n      const errorMsg = `Failed to migrate reward ${oldReward.transactionHash}: ${error}`;\n      errors.push(errorMsg);\n    }\n  }\n\n  const duration = Date.now() - startTime;\n  return {\n    success: true,\n    count: migratedCount,\n    total: oldRewardsData.length,\n    errors,\n    duration: `${duration}ms`\n  };\n}\n\n// Export for use in routes\nexport { oldCoinsData, oldRewardsData };","size_bytes":11985},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/trade-modal-desktop.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport type { Coin, Comment } from \"@shared/schema\";\nimport { useAccount, usePublicClient, useWalletClient } from \"wagmi\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2, CheckCircle2, ExternalLink, Coins, MessageCircle, Users, Activity as ActivityIcon, Info, Copy, Check, TrendingUp } from \"lucide-react\";\nimport { getCoin, getCoinHolders } from \"@zoralabs/coins-sdk\";\nimport { base } from \"viem/chains\";\nimport { formatEther } from \"viem\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from \"recharts\";\nimport { Carousel, CarouselContent, CarouselItem, CarouselNext, CarouselPrevious } from \"@/components/ui/carousel\";\nimport { formatSmartCurrency } from \"@/lib/utils\";\n\ntype CoinProp = {\n  id: string;\n  name: string;\n  symbol: string;\n  address: string;\n  image?: string;\n  marketCap?: string;\n  volume24h?: string;\n  holders?: number;\n  creator?: string;\n  createdAt?: string;\n  category?: string;\n  platform?: string;\n  creator_wallet?: string;\n  metadata?: any;\n  type?: string;\n};\n\ninterface TradeModalDesktopProps {\n  coin: CoinProp;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport default function TradeModalDesktop({ coin, open, onOpenChange }: TradeModalDesktopProps) {\n  const { toast } = useToast();\n  const [ethAmount, setEthAmount] = useState(\"0.000111\");\n  const [isTrading, setIsTrading] = useState(false);\n  const [txHash, setTxHash] = useState<string | null>(null);\n  const [isBuying, setIsBuying] = useState(true);\n  const [comment, setComment] = useState(\"\");\n  const [standaloneComment, setStandaloneComment] = useState(\"\");\n  const [balance, setBalance] = useState<string>(\"0\");\n  const [marketCap, setMarketCap] = useState<string | null>(null);\n  const [volume24h, setVolume24h] = useState<string | null>(null);\n  const [creatorEarnings, setCreatorEarnings] = useState<string | null>(null);\n  const [coinImage, setCoinImage] = useState<string | null>(null);\n  const [holders, setHolders] = useState<Array<{\n    address: string;\n    balance: string;\n    percentage: number;\n    profile?: string | null;\n  }>>([]);\n  const [totalSupply, setTotalSupply] = useState<string | null>(null);\n  const [uniqueHoldersCount, setUniqueHoldersCount] = useState<number>(0);\n  const [chartData, setChartData] = useState<Array<{ time: string; price: number }>>([]);\n  const [timeframe, setTimeframe] = useState<'1H' | '1D' | 'W' | 'M' | 'All'>('1D');\n  const [priceChange, setPriceChange] = useState<number>(0);\n  const [currentSlide, setCurrentSlide] = useState(0);\n  const [carouselApi, setCarouselApi] = useState<any>(null);\n  const [copiedAddress, setCopiedAddress] = useState(false);\n  const [currentPrice, setCurrentPrice] = useState<string | null>(null);\n\n  const { address, isConnected } = useAccount();\n  const { data: walletClient } = useWalletClient();\n  const publicClient = usePublicClient();\n\n  useEffect(() => {\n    if (!carouselApi) return;\n    const onSelect = () => setCurrentSlide(carouselApi.selectedScrollSnap());\n    carouselApi.on(\"select\", onSelect);\n    return () => carouselApi.off(\"select\", onSelect);\n  }, [carouselApi]);\n\n  const { data: comments = [], isLoading: commentsLoading } = useQuery<Comment[]>({\n    queryKey: ['/api/comments/coin', coin.address],\n    queryFn: async () => {\n      const response = await fetch(`/api/comments/coin/${coin.address}`, {\n        credentials: 'include'\n      });\n      if (!response.ok) throw new Error('Failed to fetch comments');\n      return response.json();\n    },\n    enabled: open && !!coin.address,\n  });\n\n  const createCommentMutation = useMutation({\n    mutationFn: async (commentData: { coinAddress: string; userAddress: string; comment: string; transactionHash?: string }) => {\n      return await apiRequest('POST', '/api/comments', commentData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/comments/coin', coin.address] });\n    },\n  });\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    setCopiedAddress(true);\n    setTimeout(() => setCopiedAddress(false), 2000);\n  };\n\n  const handleStandaloneComment = async () => {\n    if (!isConnected || !address || !coin.address || !standaloneComment.trim()) return;\n\n    try {\n      await createCommentMutation.mutateAsync({\n        coinAddress: coin.address,\n        userAddress: address,\n        comment: standaloneComment.trim(),\n      });\n      setStandaloneComment(\"\");\n      toast({ title: \"Comment added\", description: \"Your comment has been posted\" });\n    } catch (error) {\n      console.error('Failed to post comment:', error);\n      toast({ title: \"Failed to post comment\", description: \"Please try again\", variant: \"destructive\" });\n    }\n  };\n\n  useEffect(() => {\n    async function fetchBalance() {\n      if (!address || !publicClient) return;\n      try {\n        const bal = await publicClient.getBalance({ address });\n        setBalance(formatEther(bal));\n      } catch (error) {\n        console.error(\"Error fetching balance:\", error);\n      }\n    }\n    if (isConnected && open) fetchBalance();\n  }, [address, isConnected, publicClient, open]);\n\n  useEffect(() => {\n    async function fetchCoinStats() {\n      if (!coin.address) return;\n      try {\n        const response = await getCoin({\n          address: coin.address as `0x${string}`,\n          chain: base.id,\n        });\n\n        const coinData = response.data?.zora20Token;\n        if (coinData) {\n          // Market Cap\n          if (coinData.marketCap !== null && coinData.marketCap !== undefined) {\n            const mcValue = typeof coinData.marketCap === 'string' ? parseFloat(coinData.marketCap) : coinData.marketCap;\n            setMarketCap(mcValue.toFixed(2));\n          }\n          \n          // Volume 24h\n          if (coinData.volume24h !== null && coinData.volume24h !== undefined) {\n            const volValue = typeof coinData.volume24h === 'string' ? parseFloat(coinData.volume24h) : coinData.volume24h;\n            setVolume24h(volValue.toString());\n            setCreatorEarnings((volValue * 0.005).toString());\n          }\n          \n          // Total Supply\n          if (coinData.totalSupply) {\n            setTotalSupply(coinData.totalSupply);\n          }\n          \n          // Current Price\n          if (coinData.price) {\n            const price = typeof coinData.price === 'string' ? parseFloat(coinData.price) : coinData.price;\n            setCurrentPrice(coinData.price);\n            \n            // Generate realistic chart data based on current price\n            const now = Date.now();\n            const hourInMs = 60 * 60 * 1000;\n            const data = [];\n            \n            for (let i = 23; i >= 0; i--) {\n              const time = new Date(now - i * hourInMs);\n              const variance = (Math.random() - 0.5) * 0.1; // ¬±10% variance\n              const pricePoint = price * (1 + variance);\n              data.push({\n                time: time.toLocaleTimeString('en-US', { hour: 'numeric', hour12: true }),\n                price: parseFloat(pricePoint.toFixed(6))\n              });\n            }\n            setChartData(data);\n          }\n          \n          // Price Change 24h\n          if (coinData.priceChange24h !== null && coinData.priceChange24h !== undefined) {\n            const priceChangeValue = typeof coinData.priceChange24h === 'string' \n              ? parseFloat(coinData.priceChange24h) \n              : coinData.priceChange24h;\n            setPriceChange(priceChangeValue);\n          }\n          \n          // Coin Image\n          if (coinData.mediaContent?.previewImage) {\n            const previewImage = coinData.mediaContent.previewImage as any;\n            setCoinImage(previewImage.medium || previewImage.small || null);\n          }\n        }\n\n        const holdersResponse = await getCoinHolders({\n          chainId: base.id,\n          address: coin.address as `0x${string}`,\n          count: 50,\n        });\n\n        const holderBalances = holdersResponse.data?.zora20Token?.tokenBalances?.edges || [];\n        const supply = parseFloat(coinData?.totalSupply || \"0\");\n\n        if (holderBalances.length > 0 && supply > 0) {\n          const processedHolders = holderBalances.map((edge: any) => {\n            const balance = parseFloat(edge.node.balance || \"0\");\n            return {\n              address: edge.node.ownerAddress,\n              balance: edge.node.balance,\n              percentage: (balance / supply) * 100,\n              profile: edge.node.ownerProfile?.handle || null,\n            };\n          });\n          setHolders(processedHolders);\n        }\n      } catch (error) {\n        console.error(\"Error fetching coin stats:\", error);\n      }\n    }\n    if (open) fetchCoinStats();\n  }, [coin.address, open]);\n\n  const handleTrade = async () => {\n    if (!isConnected || !address || !walletClient || !publicClient) {\n      toast({ title: \"Wallet not connected\", description: \"Please connect your wallet first\", variant: \"destructive\" });\n      return;\n    }\n\n    const ethAmountNum = parseFloat(ethAmount);\n    if (!ethAmount || ethAmountNum <= 0) {\n      toast({ title: \"Invalid amount\", description: \"Please enter a valid ETH amount\", variant: \"destructive\" });\n      return;\n    }\n\n    setIsTrading(true);\n    try {\n      const { tradeZoraCoin } = await import(\"@/lib/zora\");\n      const result = await tradeZoraCoin({\n        coinAddress: coin.address as `0x${string}`,\n        ethAmount,\n        walletClient,\n        publicClient,\n        userAddress: address,\n        isBuying,\n      });\n\n      if (result?.hash) {\n        setTxHash(result.hash);\n        toast({ title: \"Trade successful!\", description: `You ${isBuying ? 'bought' : 'sold'} ${coin.symbol} tokens` });\n        const newBal = await publicClient.getBalance({ address });\n        setBalance(formatEther(newBal));\n      }\n    } catch (error) {\n      console.error(\"Trade failed:\", error);\n      toast({ title: \"Trade failed\", description: error instanceof Error ? error.message : \"Trade failed\", variant: \"destructive\" });\n    } finally {\n      setIsTrading(false);\n    }\n  };\n\n  const formatAddress = (address?: string) => {\n    if (!address) return 'Unknown';\n    return `${address.slice(0, 6)}...${address.slice(-4)}`;\n  };\n\n  const setQuickAmount = (amount: string) => {\n    if (amount === 'Max') {\n      setEthAmount((parseFloat(balance) * 0.9).toFixed(6));\n    } else {\n      setEthAmount(amount);\n    }\n  };\n\n  const displayImage = coinImage || coin?.image || coin?.metadata?.image;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-2xl max-h-[80vh] bg-card/95 backdrop-blur-sm border-border/50 p-0 overflow-hidden sm:rounded-2xl\">\n        <div className=\"flex max-h-[75vh]\">\n          <div className=\"w-5/12 bg-gradient-to-br from-muted/20 to-muted/10 flex flex-col p-2.5\">\n            <div className=\"mb-2\">\n              <p className=\"text-xs text-muted-foreground mb-0.5\">Market cap</p>\n              <div className=\"flex items-baseline gap-2\">\n                <h3 className=\"text-lg font-bold text-foreground\">${marketCap || '0'}</h3>\n                <span className={`text-xs font-semibold ${priceChange >= 0 ? 'text-green-500' : 'text-red-500'}`}>\n                  {priceChange >= 0 ? '+' : ''}{priceChange.toFixed(2)}%\n                </span>\n              </div>\n            </div>\n\n            <div className=\"flex-1 min-h-[180px] relative\">\n              <Carousel className=\"w-full h-full\" opts={{ loop: false }} setApi={setCarouselApi}>\n                <CarouselContent className=\"h-full\">\n                  <CarouselItem className=\"h-full px-2\">\n                    <div className=\"h-full flex items-center justify-center bg-gradient-to-br from-muted/10 to-muted/5 rounded-lg overflow-hidden\">\n                      {displayImage ? (\n                        <img src={displayImage} alt={coin.name} className=\"max-w-full max-h-full object-contain\" />\n                      ) : (\n                        <div className=\"flex flex-col items-center justify-center text-muted-foreground\">\n                          <Coins className=\"w-16 h-16 mb-2 opacity-30\" />\n                          <p className=\"text-sm\">No media available</p>\n                        </div>\n                      )}\n                    </div>\n                  </CarouselItem>\n\n                  <CarouselItem className=\"h-full px-2\">\n                    <div className=\"h-full flex flex-col bg-gradient-to-br from-muted/10 to-muted/5 rounded-lg p-2\">\n                      <div className=\"flex-1 min-h-0\">\n                        {chartData.length > 0 ? (\n                          <ResponsiveContainer width=\"100%\" height=\"100%\">\n                            <LineChart data={chartData}>\n                              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border))\" opacity={0.3} />\n                              <XAxis dataKey=\"time\" stroke=\"hsl(var(--muted-foreground))\" style={{ fontSize: '9px' }} />\n                              <YAxis stroke=\"hsl(var(--muted-foreground))\" style={{ fontSize: '9px' }} />\n                              <Tooltip\n                                contentStyle={{\n                                  backgroundColor: 'hsl(var(--background))',\n                                  border: '1px solid hsl(var(--border))',\n                                  borderRadius: '8px',\n                                }}\n                              />\n                              <Line\n                                type=\"monotone\"\n                                dataKey=\"price\"\n                                stroke=\"hsl(var(--primary))\"\n                                strokeWidth={2}\n                                dot={false}\n                              />\n                            </LineChart>\n                          </ResponsiveContainer>\n                        ) : (\n                          <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground\">\n                            <TrendingUp className=\"w-10 h-10 mb-1.5 opacity-30\" />\n                            <p className=\"text-xs\">No chart data available</p>\n                          </div>\n                        )}\n                      </div>\n\n                      <div className=\"flex items-center justify-center gap-2 mt-2 pt-2 border-t border-border/30\">\n                        {(['1H', '1D', 'W', 'M', 'All'] as const).map((tf) => (\n                          <Button\n                            key={tf}\n                            variant={timeframe === tf ? 'default' : 'ghost'}\n                            size=\"sm\"\n                            onClick={() => setTimeframe(tf)}\n                            className=\"h-6 text-xs px-2\"\n                          >\n                            {tf}\n                          </Button>\n                        ))}\n                      </div>\n                    </div>\n                  </CarouselItem>\n                </CarouselContent>\n                <CarouselPrevious className=\"left-0 bg-background/80 hover:bg-background\" />\n                <CarouselNext className=\"right-0 bg-background/80 hover:bg-background\" />\n              </Carousel>\n\n              <div className=\"absolute bottom-2 left-0 right-0 flex justify-center gap-1\">\n                {[0, 1].map((index) => (\n                  <div\n                    key={index}\n                    className={`w-1.5 h-1.5 rounded-full transition-colors ${\n                      currentSlide === index ? 'bg-primary' : 'bg-muted-foreground/30'\n                    }`}\n                  />\n                ))}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"w-7/12 flex flex-col overflow-hidden\">\n            <DialogHeader className=\"px-2.5 pt-2.5 pb-1\">\n              <DialogTitle className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"text-sm font-bold text-foreground\">{coin.name}</h3>\n                  <p className=\"text-xs text-muted-foreground\">@{formatAddress(coin.creator_wallet)}</p>\n                </div>\n              </DialogTitle>\n            </DialogHeader>\n\n            <Tabs defaultValue=\"trade\" className=\"flex-1 flex flex-col overflow-hidden\">\n              <TabsList className=\"w-full justify-start rounded-none border-b bg-transparent px-2.5 h-auto p-0\">\n                <TabsTrigger value=\"trade\" className=\"data-[state=active]:border-b-2 data-[state=active]:border-primary rounded-none px-2.5 py-1.5 text-xs\">Trade</TabsTrigger>\n                <TabsTrigger value=\"comments\" className=\"data-[state=active]:border-b-2 data-[state=active]:border-primary rounded-none px-2.5 py-1.5 text-xs\">Comments</TabsTrigger>\n                <TabsTrigger value=\"holders\" className=\"data-[state=active]:border-b-2 data-[state=active]:border-primary rounded-none px-2.5 py-1.5 text-xs\">Holders</TabsTrigger>\n                <TabsTrigger value=\"activity\" className=\"data-[state=active]:border-b-2 data-[state=active]:border-primary rounded-none px-2.5 py-1.5 text-xs\">Activity</TabsTrigger>\n                <TabsTrigger value=\"details\" className=\"data-[state=active]:border-b-2 data-[state=active]:border-primary rounded-none px-2.5 py-1.5 text-xs\">Details</TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"trade\" className=\"flex-1 px-2.5 pb-2.5 mt-0 pt-1.5 overflow-y-auto min-h-0\">\n                <div className=\"grid grid-cols-3 gap-1.5 mb-1.5\">\n                  <div className=\"bg-muted/30 rounded-lg p-1.5\">\n                    <p className=\"text-xs text-muted-foreground\">Market Cap</p>\n                    <p className=\"text-sm font-bold text-green-500\">${marketCap || '0'}</p>\n                  </div>\n                  <div className=\"bg-muted/30 rounded-lg p-2\">\n                    <p className=\"text-xs text-muted-foreground\">24H Volume</p>\n                    <p className=\"text-sm font-semibold\">{volume24h ? formatSmartCurrency(parseFloat(volume24h)) : '0'}</p>\n                  </div>\n                  <div className=\"bg-muted/30 rounded-lg p-2\">\n                    <p className=\"text-xs text-muted-foreground\">Creator Fees</p>\n                    <p className=\"text-sm font-semibold\">{creatorEarnings ? formatSmartCurrency(parseFloat(creatorEarnings)) : '0'}</p>\n                  </div>\n                </div>\n\n                <div className=\"flex gap-2 mb-2\">\n                  <Button onClick={() => setIsBuying(true)} variant={isBuying ? \"default\" : \"outline\"} className={`flex-1 h-9 ${isBuying ? 'bg-green-500 hover:bg-green-600' : ''}`} disabled={isTrading || !!txHash}>Buy</Button>\n                  <Button onClick={() => setIsBuying(false)} variant={!isBuying ? \"default\" : \"outline\"} className={`flex-1 h-9 ${!isBuying ? 'bg-red-500 hover:bg-red-600' : ''}`} disabled={isTrading || !!txHash}>Sell</Button>\n                </div>\n\n                <Input type=\"number\" value={ethAmount} onChange={(e) => setEthAmount(e.target.value)} className=\"mb-2 h-9\" disabled={isTrading || !!txHash} />\n\n                <div className=\"grid grid-cols-4 gap-1.5 mb-2\">\n                  {['0.001', '0.01', '0.1', 'Max'].map((label) => (\n                    <Button key={label} variant=\"outline\" size=\"sm\" className=\"h-8 text-xs\" onClick={() => setQuickAmount(label)} disabled={isTrading || !!txHash}>{label}</Button>\n                  ))}\n                </div>\n\n                <Button onClick={handleTrade} disabled={isTrading || !isConnected} className=\"w-full h-10\">\n                  {isTrading ? <><Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />Trading...</> : `${isBuying ? 'Buy' : 'Sell'} ${coin.symbol}`}\n                </Button>\n              </TabsContent>\n\n              <TabsContent value=\"comments\" className=\"flex-1 px-2.5 pb-2.5 overflow-y-auto min-h-0 flex flex-col mt-0 pt-1.5\">\n                <div className=\"flex gap-2 mb-2\">\n                  <Input placeholder=\"Add a comment...\" value={standaloneComment} onChange={(e) => setStandaloneComment(e.target.value)} className=\"h-8 text-sm\" />\n                  <Button onClick={handleStandaloneComment} size=\"sm\" className=\"h-8 text-xs\">Post</Button>\n                </div>\n                <ScrollArea className=\"flex-1\">\n                  {comments.map((c) => (\n                    <div key={c.id} className=\"p-2 mb-1.5 bg-muted/20 rounded-lg\">\n                      <p className=\"text-xs font-medium\">{formatAddress(c.userAddress)}</p>\n                      <p className=\"text-xs text-muted-foreground\">{c.comment}</p>\n                    </div>\n                  ))}\n                </ScrollArea>\n              </TabsContent>\n\n              <TabsContent value=\"holders\" className=\"flex-1 px-2.5 pb-2.5 overflow-y-auto min-h-0 mt-0 pt-1.5\">\n                <ScrollArea className=\"flex-1\">\n                  {holders.length > 0 ? (\n                    holders.map((holder, idx) => (\n                      <div key={holder.address} className=\"flex items-center justify-between p-2 mb-1.5 bg-muted/20 rounded-lg\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-primary/20 to-secondary/20 flex items-center justify-center\">\n                            <span className=\"text-xs font-semibold\">{idx + 1}</span>\n                          </div>\n                          <div>\n                            <p className=\"text-sm font-medium\">{holder.profile || formatAddress(holder.address)}</p>\n                            {holder.profile && <p className=\"text-xs text-muted-foreground\">{formatAddress(holder.address)}</p>}\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          <p className=\"text-sm font-bold\">{holder.percentage.toFixed(2)}%</p>\n                        </div>\n                      </div>\n                    ))\n                  ) : (\n                    <div className=\"flex flex-col items-center justify-center h-full text-center p-8\">\n                      <Users className=\"w-12 h-12 text-muted-foreground/30 mb-3\" />\n                      <p className=\"text-sm text-muted-foreground\">No holders data available</p>\n                    </div>\n                  )}\n                </ScrollArea>\n              </TabsContent>\n\n              <TabsContent value=\"activity\" className=\"flex-1 px-2.5 pb-2.5 overflow-y-auto min-h-0 mt-0 pt-1.5\">\n                <ScrollArea className=\"flex-1\">\n                  {/* Mock activity data - replace with real trading activity */}\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between p-3 bg-green-500/10 rounded-lg\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-8 h-8 rounded-full bg-background flex items-center justify-center\">\n                          <img src={displayImage || \"/placeholder.svg\"} alt=\"user\" className=\"w-full h-full rounded-full object-cover\" />\n                        </div>\n                        <div>\n                          <p className=\"text-sm font-medium\">{formatAddress(coin.creator_wallet)}</p>\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        <span className=\"text-xs font-semibold text-green-500 bg-green-500/20 px-2 py-1 rounded\">Buy</span>\n                        <p className=\"text-xs text-muted-foreground mt-1\">1.8m ¬∑ $0.25 ¬∑ 3d</p>\n                      </div>\n                    </div>\n                  </div>\n                </ScrollArea>\n              </TabsContent>\n\n              <TabsContent value=\"details\" className=\"flex-1 px-2.5 pb-2.5 overflow-y-auto min-h-0 mt-0 pt-1.5\">\n                <div className=\"space-y-1.5\">\n                  <div className=\"flex items-center justify-between p-2 bg-muted/20 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <ActivityIcon className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Created</span>\n                    </div>\n                    <span className=\"text-sm font-medium\">{coin.createdAt ? new Date(coin.createdAt).toLocaleDateString() : 'Unknown'}</span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between p-2 bg-muted/20 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <Copy className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Contract address</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-sm font-medium\">{formatAddress(coin.address)}</span>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-6 w-6 p-0\"\n                        onClick={() => copyToClipboard(coin.address)}\n                      >\n                        {copiedAddress ? <Check className=\"w-3 h-3 text-green-500\" /> : <Copy className=\"w-3 h-3\" />}\n                      </Button>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center justify-between p-2 bg-muted/20 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <Coins className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Chain</span>\n                    </div>\n                    <span className=\"text-sm font-medium flex items-center gap-1\">\n                      <span className=\"w-4 h-4 rounded-full bg-blue-500\"></span>\n                      Base\n                    </span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between p-2 bg-muted/20 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <Users className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Pair</span>\n                    </div>\n                    <span className=\"text-sm font-medium\">@{coin.symbol || 'Unknown'}</span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between p-2 bg-muted/20 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <Info className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Media</span>\n                    </div>\n                    <span className=\"text-sm font-medium\">{displayImage ? 'JPG' : 'None'}</span>\n                  </div>\n                </div>\n              </TabsContent>\n            </Tabs>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":27407},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/share-modal.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Copy, Share2, Check, Facebook, Twitter, Send } from \"lucide-react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\n\ninterface ShareModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  type: \"profile\" | \"coin\" | \"project\" | \"referral\" | \"badge\";\n  resourceId: string;\n  title: string;\n}\n\nexport function ShareModal({ open, onOpenChange, type, resourceId, title }: ShareModalProps) {\n  const { toast } = useToast();\n  const [copied, setCopied] = useState(false);\n\n  const { data: ogMeta } = useQuery({\n    queryKey: [\"/api/og-meta\", type, resourceId],\n    enabled: open,\n  });\n\n  const trackShareMutation = useMutation({\n    mutationFn: async (platform: string) => {\n      const response = await fetch(\"/api/share/track\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          shareType: type,\n          resourceId,\n          platform,\n        }),\n      });\n      if (!response.ok) throw new Error(\"Failed to track share\");\n      return response.json();\n    },\n  });\n\n  const shareUrl = ogMeta?.url || window.location.href;\n\n  const handleCopy = async () => {\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      setCopied(true);\n      trackShareMutation.mutate(\"copy_link\");\n      toast({\n        title: \"Link copied!\",\n        description: \"Share link copied to clipboard\",\n      });\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      toast({\n        title: \"Failed to copy\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleShare = async (platform: string) => {\n    trackShareMutation.mutate(platform);\n    \n    const text = ogMeta?.description || title;\n    let url = \"\";\n\n    switch (platform) {\n      case \"twitter\":\n        url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(shareUrl)}`;\n        break;\n      case \"facebook\":\n        url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;\n        break;\n      case \"telegram\":\n        url = `https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(text)}`;\n        break;\n      default:\n        if (navigator.share) {\n          try {\n            await navigator.share({\n              title: ogMeta?.title || title,\n              text: text,\n              url: shareUrl,\n            });\n          } catch (error) {\n            console.error(\"Share error:\", error);\n          }\n        }\n        return;\n    }\n\n    window.open(url, \"_blank\", \"width=600,height=400\");\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Share2 className=\"h-5 w-5\" />\n            Share {title}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          {/* OG Preview */}\n          {ogMeta && (\n            <div className=\"border rounded-lg overflow-hidden\">\n              {ogMeta.image && (\n                <img\n                  src={ogMeta.image}\n                  alt={ogMeta.title}\n                  className=\"w-full h-48 object-cover\"\n                />\n              )}\n              <div className=\"p-4 space-y-1\">\n                <h3 className=\"font-semibold line-clamp-1\">{ogMeta.title}</h3>\n                <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                  {ogMeta.description}\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* Share URL */}\n          <div className=\"flex gap-2\">\n            <Input\n              value={shareUrl}\n              readOnly\n              className=\"flex-1\"\n            />\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={handleCopy}\n            >\n              {copied ? (\n                <Check className=\"h-4 w-4 text-green-500\" />\n              ) : (\n                <Copy className=\"h-4 w-4\" />\n              )}\n            </Button>\n          </div>\n\n          {/* Share Buttons */}\n          <div className=\"grid grid-cols-2 gap-3\">\n            <Button\n              variant=\"outline\"\n              onClick={() => handleShare(\"twitter\")}\n              className=\"gap-2\"\n            >\n              <Twitter className=\"h-4 w-4\" />\n              Twitter\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => handleShare(\"facebook\")}\n              className=\"gap-2\"\n            >\n              <Facebook className=\"h-4 w-4\" />\n              Facebook\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => handleShare(\"telegram\")}\n              className=\"gap-2\"\n            >\n              <Send className=\"h-4 w-4\" />\n              Telegram\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => handleShare(\"native\")}\n              className=\"gap-2\"\n            >\n              <Share2 className=\"h-4 w-4\" />\n              More\n            </Button>\n          </div>\n\n          <p className=\"text-xs text-center text-muted-foreground\">\n            Share and earn +5 E1XP points!\n          </p>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":5659},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/content-preview-card.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Loader2, Sparkles } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\n\ninterface ContentPreviewCardProps {\n  scrapedData: any;\n  onCoinCreated?: () => void;\n}\n\nexport default function ContentPreviewCard({ scrapedData, onCoinCreated }: ContentPreviewCardProps) {\n  const [, setLocation] = useLocation();\n  const [isCreating, setIsCreating] = useState(false);\n  const [coinName, setCoinName] = useState(scrapedData.title || \"\");\n  const [coinSymbol, setCoinSymbol] = useState(\"\");\n  const { toast } = useToast();\n\n  const handleCreateCoin = async () => {\n    if (!coinName.trim() || !coinSymbol.trim()) {\n      toast({\n        title: \"Missing information\",\n        description: \"Please provide both coin name and symbol\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsCreating(true);\n\n    try {\n      toast({\n        title: \"Coin created!\",\n        description: `${coinSymbol} is now live and tradeable`,\n      });\n\n      setTimeout(() => {\n        if (onCoinCreated) {\n          onCoinCreated();\n        }\n        setLocation(\"/\");\n      }, 1000);\n    } catch (error) {\n      console.error(\"Error creating coin:\", error);\n      toast({\n        title: \"Creation failed\",\n        description: \"Failed to create coin. Please try again.\",\n        variant: \"destructive\",\n      });\n      setIsCreating(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {scrapedData.image && (\n        <div className=\"aspect-video rounded-2xl overflow-hidden bg-muted\">\n          <img\n            src={scrapedData.image}\n            alt={scrapedData.title}\n            className=\"w-full h-full object-cover\"\n          />\n        </div>\n      )}\n\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"preview-title\" className=\"text-sm font-medium text-foreground\">\n            Title\n          </Label>\n          <p className=\"text-base font-semibold text-foreground\">{scrapedData.title}</p>\n        </div>\n\n        {scrapedData.description && (\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium text-foreground\">Description</Label>\n            <p className=\"text-sm text-muted-foreground line-clamp-3\">{scrapedData.description}</p>\n          </div>\n        )}\n\n        {scrapedData.author && (\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium text-foreground\">Creator</Label>\n            <p className=\"text-sm text-foreground\">{scrapedData.author}</p>\n          </div>\n        )}\n\n        <div className=\"pt-4 border-t border-border/30 space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"coin-name\" className=\"text-sm font-medium text-foreground\">\n              Coin Name <span className=\"text-red-500\">*</span>\n            </Label>\n            <div className=\"bg-muted/30 dark:bg-muted/20 rounded-2xl p-1 border border-border/30\">\n              <Input\n                id=\"coin-name\"\n                value={coinName}\n                onChange={(e) => setCoinName(e.target.value)}\n                placeholder=\"Enter coin name\"\n                className=\"bg-transparent border-0 h-11 px-4 focus-visible:ring-0 focus-visible:ring-offset-0\"\n                data-testid=\"input-coin-name\"\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"coin-symbol\" className=\"text-sm font-medium text-foreground\">\n              Coin Symbol <span className=\"text-red-500\">*</span>\n            </Label>\n            <div className=\"bg-muted/30 dark:bg-muted/20 rounded-2xl p-1 border border-border/30\">\n              <Input\n                id=\"coin-symbol\"\n                value={coinSymbol}\n                onChange={(e) => setCoinSymbol(e.target.value.toUpperCase())}\n                placeholder=\"e.g., MUSIC\"\n                maxLength={10}\n                className=\"bg-transparent border-0 h-11 px-4 focus-visible:ring-0 focus-visible:ring-offset-0 uppercase\"\n                data-testid=\"input-coin-symbol\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <Button\n          onClick={handleCreateCoin}\n          disabled={isCreating || !coinName.trim() || !coinSymbol.trim()}\n          className=\"w-full h-12 bg-gradient-to-r from-primary to-primary hover:from-primary/100 hover:to-primary/90 text-primary-foreground font-semibold rounded-2xl transition-all mt-6\"\n          data-testid=\"button-create-coin\"\n        >\n          {isCreating ? (\n            <>\n              <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\n              Creating Coin...\n            </>\n          ) : (\n            <>\n              <Sparkles className=\"w-5 h-5 mr-2\" />\n              Create Coin\n            </>\n          )}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5041},"design_guidelines.md":{"content":"# Every1.fun / Creatorland Design Guidelines\n\n## Design Approach\n**Reference-Based Approach**: Drawing inspiration from modern Web3 platforms (Friend.tech, Lens Protocol) combined with Gen Z social apps (BeReal, Dispo) to create an energetic, crypto-native creator economy platform. The design emphasizes vibrant colors, bold typography, and gamified interactions suitable for Gen Z creators.\n\n## Core Design Elements\n\n### A. Color Palette\n\n**Primary Colors:**\n- **Lime Green**: 89 95% 79% - Primary brand color for CTAs, highlights, active states\n- **Vivid Magenta**: 314 83% 57% - Secondary brand for accents, badges, premium features\n- **Deep Purple**: 270 30% 15% - Dark mode background base\n- **Charcoal**: 240 10% 10% - Card backgrounds, elevated surfaces\n\n**Supporting Colors:**\n- **White/Off-white**: 0 0% 98% - Text on dark backgrounds\n- **Gray-400**: 240 5% 65% - Secondary text, muted elements\n- **Success Green**: 142 76% 56% - Positive metrics, gains\n- **Warning Orange**: 25 95% 63% - Alerts, notifications\n\n### B. Typography\n**Font Family**: Forma DJR Micro (custom implementation)\n- **Headings**: Bold (700) - Large profile names, section titles\n- **Subheadings**: Medium (500) - Card titles, navigation items\n- **Body**: Regular (400) - Descriptions, chat messages\n- **Metrics**: Bold (700) - Stats, trading data, percentages\n\n**Type Scale**:\n- Hero/Profile Names: text-4xl to text-5xl\n- Section Headers: text-2xl to text-3xl\n- Card Titles: text-lg to text-xl\n- Body/UI: text-sm to text-base\n- Captions/Labels: text-xs\n\n### C. Layout System\n**Spacing Primitives**: Tailwind units of 2, 4, 6, and 8 for consistent rhythm\n- Component padding: p-4, p-6, p-8\n- Card gaps: gap-4, gap-6\n- Section spacing: py-8, py-12, py-16\n- Max container width: max-w-7xl for desktop, max-w-full for mobile\n\n**Grid System**:\n- Mobile: Single column (grid-cols-1)\n- Tablet: 2 columns for cards (md:grid-cols-2)\n- Desktop: 3-4 columns for creator grids (lg:grid-cols-3, xl:grid-cols-4)\n\n### D. Component Library\n\n**Navigation**:\n- Sticky top navigation with logo, search, and profile access\n- Bottom tab bar for mobile (Home, Explore, Create, Messages, Profile)\n- Glass morphism effect with backdrop-blur for floating elements\n\n**Cards**:\n- Rounded corners (rounded-2xl)\n- Dark backgrounds with subtle gradients\n- Hover states with scale transform (hover:scale-105 transition)\n- Creator cards: Avatar, name, stats (followers/engagement), Connect button\n\n**Buttons**:\n- Primary: Lime green background, black text, bold weight\n- Secondary: Magenta background, white text\n- Outline: Transparent with lime/magenta border, backdrop-blur when on images\n- Sizes: Small (px-3 py-1.5), Medium (px-4 py-2), Large (px-6 py-3)\n\n**Forms & Inputs**:\n- Dark backgrounds (bg-charcoal) with lime green focus rings\n- Rounded borders (rounded-lg)\n- Placeholder text in gray-400\n- Search bars with magnifying glass icon\n\n**Stats & Metrics**:\n- Large bold numbers in white\n- Labels in gray-400 below\n- Percentage changes in success green (positive) or red (negative)\n- Compact grid layout (grid-cols-3 gap-4)\n\n**Trading Charts**:\n- Line charts with lime green gradients\n- Magenta accent for key data points\n- Dark grid backgrounds\n- Time period selectors (1H, 24H, 7D, 30D, ALL)\n\n**Profile Components**:\n- Large circular avatars with lime green border rings\n- Tab navigation (Portfolio/Analytics/Groups/Bookmarks) with underline indicators\n- Connection count and profile view graphs\n- Bio sections with limited character display\n\n**Messaging**:\n- Chat bubbles with timestamp\n- Request/Invitation tabs\n- Unread badges in magenta\n- Avatar thumbnails in conversation list\n\n### E. Animations\nUse sparingly for polish:\n- Smooth transitions on hover (transition-transform duration-200)\n- Fade-in for modals and overlays\n- Slide-up animations for bottom sheets on mobile\n- Subtle pulse on new notifications\n\n## Page-Specific Guidelines\n\n**Home/Explore**: Grid of creator cards with filters at top, trending section with horizontal scroll on mobile\n\n**Creator Profile**: Hero section with cover image potential, large avatar, stats row, tabbed content below\n\n**Minting Flow**: Step-by-step wizard with progress indicator, URL input or file upload, preview before minting\n\n**Trading Interface**: Full-width chart at top, buy/sell controls below, transaction history in cards\n\n**Inbox/Messages**: Two-column on desktop (conversation list + active chat), full-screen chat on mobile\n\n**Projects Showcase**: Masonry grid of project cards with campaign metrics, prominent ADD PROJECT CTA\n\n**Groups**: Grid of group cards with member counts, category badges in magenta\n\n## Images\n- **Profile Covers**: Optional wide banner images (16:9 ratio) for creator profiles with gradient overlays\n- **Creator Avatars**: Circular profile images with lime green ring borders\n- **Project Thumbnails**: Square or 4:3 cards with rounded corners\n- **Trading Charts**: Dynamic SVG visualizations (not static images)\n- No large hero image - platform jumps straight into functionality with navigation and content grids\n\n## Mobile Optimization\n- Bottom navigation bar (56px height) with 5 icons\n- Full-width cards with reduced padding (p-4 vs p-6)\n- Horizontal scroll for stats and trending sections\n- Modal overlays for forms and detail views\n- Swipe gestures for tab navigation","size_bytes":5318},"client/src/lib/push-notifications.ts":{"content":"\n// Push Notifications Helper\nexport async function requestNotificationPermission(): Promise<NotificationPermission> {\n  if (!('Notification' in window)) {\n    console.warn('This browser does not support notifications');\n    return 'denied';\n  }\n\n  return await Notification.requestPermission();\n}\n\nexport async function registerServiceWorker(): Promise<ServiceWorkerRegistration | null> {\n  if (!('serviceWorker' in navigator)) {\n    console.warn('Service Worker not supported');\n    return null;\n  }\n\n  try {\n    const registration = await navigator.serviceWorker.register('/sw.js');\n    console.log('Service Worker registered:', registration);\n    return registration;\n  } catch (error) {\n    console.error('Service Worker registration failed:', error);\n    return null;\n  }\n}\n\nexport async function subscribeToPushNotifications(\n  userAddress: string\n): Promise<PushSubscription | null> {\n  const registration = await registerServiceWorker();\n  \n  if (!registration) {\n    return null;\n  }\n\n  const permission = await requestNotificationPermission();\n  \n  if (permission !== 'granted') {\n    console.warn('Notification permission not granted');\n    return null;\n  }\n\n  try {\n    const subscription = await registration.pushManager.subscribe({\n      userVisibleOnly: true,\n      applicationServerKey: urlBase64ToUint8Array(\n        import.meta.env.VITE_VAPID_PUBLIC_KEY || ''\n      )\n    });\n\n    // Save subscription to backend\n    await fetch('/api/push-subscriptions', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        userAddress,\n        subscription\n      })\n    });\n\n    return subscription;\n  } catch (error) {\n    console.error('Failed to subscribe to push notifications:', error);\n    return null;\n  }\n}\n\nexport function showLocalNotification(title: string, options?: NotificationOptions) {\n  if ('Notification' in window && Notification.permission === 'granted') {\n    new Notification(title, {\n      icon: '/purple-white.png',\n      badge: '/purple-white.png',\n      ...options\n    });\n  }\n}\n\nfunction urlBase64ToUint8Array(base64String: string): Uint8Array {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding)\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\n","size_bytes":2509},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, integer, boolean, jsonb, decimal, uuid } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Users table - integrates with Privy authentication\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  privyId: text(\"privy_id\").unique(),\n  walletAddress: text(\"wallet_address\"),\n  email: text(\"email\"),\n  username: text(\"username\").notNull().unique(),\n  displayName: text(\"display_name\"),\n  bio: text(\"bio\"),\n  location: text(\"location\"),\n  avatarUrl: text(\"avatar_url\"),\n  coverImageUrl: text(\"cover_image_url\"),\n  socialAccounts: jsonb(\"social_accounts\").$type<{\n    instagram?: string;\n    tiktok?: string;\n    youtube?: string;\n    twitter?: string;\n  }>(),\n  creatorType: text(\"creator_type\"), // 'content_creator' | 'public_goods_builder'\n  audienceAge: text(\"audience_age\"), // '18-24' | '25-34' etc\n  categories: text(\"categories\").array(), // ['Music', 'Art', 'Tech', etc]\n  totalConnections: integer(\"total_connections\").default(0),\n  totalProfileViews: integer(\"total_profile_views\").default(0),\n  totalEarnings: decimal(\"total_earnings\", { precision: 18, scale: 8 }).default(\"0\"),\n  e1xpPoints: integer(\"e1xp_points\").default(0),\n  pointsBadges: jsonb(\"points_badges\").$type<string[]>().default([]),\n  referralCode: text(\"referral_code\").unique(),\n  referredBy: varchar(\"referred_by\").references(() => users.id),\n  isAdmin: integer(\"is_admin\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Projects table - content/campaigns that can be minted as coins\nexport const projects = pgTable(\"projects\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  sourceUrl: text(\"source_url\"), // URL of original content\n  thumbnailUrl: text(\"thumbnail_url\"),\n  ipfsHash: text(\"ipfs_hash\"), // IPFS storage hash\n  category: text(\"category\"),\n  totalViews: integer(\"total_views\").default(0),\n  totalInteractions: integer(\"total_interactions\").default(0),\n  isMinted: boolean(\"is_minted\").default(false),\n  coinId: varchar(\"coin_id\"), // Reference to minted coin if exists\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Coins table - from Supabase schema (tokenized assets)\nexport const coins = pgTable(\"coins\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  symbol: text(\"symbol\").notNull(),\n  address: text(\"address\"),\n  userId: varchar(\"user_id\").references(() => users.id),\n  creatorWallet: text(\"creator_wallet\").notNull(),\n  status: text(\"status\").notNull().default(\"pending\"),\n  scrapedContentId: varchar(\"scraped_content_id\").references(() => scrapedContent.id),\n  ipfsUri: text(\"ipfs_uri\"),\n  chainId: text(\"chain_id\"),\n  registryTxHash: text(\"registry_tx_hash\"),\n  registryStatus: text(\"registry_status\").default(\"pending\"),\n  metadataHash: text(\"metadata_hash\"),\n  registeredAt: timestamp(\"registered_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  image: text(\"image\"),\n  description: text(\"description\"),\n  pinOrder: integer(\"pin_order\"),\n  hidden: boolean(\"hidden\").default(false),\n});\n\n// Transactions table - trading history\nexport const transactions = pgTable(\"transactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  coinId: varchar(\"coin_id\").references(() => coins.id).notNull(),\n  buyerId: varchar(\"buyer_id\").references(() => users.id),\n  sellerId: varchar(\"seller_id\").references(() => users.id),\n  transactionType: text(\"transaction_type\").notNull(), // 'buy' | 'sell' | 'mint'\n  amount: decimal(\"amount\", { precision: 18, scale: 8 }).notNull(),\n  price: decimal(\"price\", { precision: 18, scale: 8 }).notNull(),\n  totalValue: decimal(\"total_value\", { precision: 18, scale: 8 }).notNull(),\n  txHash: text(\"tx_hash\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Messages table\nexport const messages = pgTable(\"messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  senderId: varchar(\"sender_id\").references(() => users.id).notNull(),\n  recipientId: varchar(\"recipient_id\").references(() => users.id).notNull(),\n  content: text(\"content\").notNull(),\n  messageType: text(\"message_type\").default(\"text\"), // 'text' | 'invitation' | 'request'\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Connections table - creator relationships\nexport const connections = pgTable(\"connections\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  connectedUserId: varchar(\"connected_user_id\").references(() => users.id).notNull(),\n  status: text(\"status\").default(\"pending\"), // 'pending' | 'connected' | 'rejected'\n  engagementRate: decimal(\"engagement_rate\", { precision: 5, scale: 2 }),\n  totalInteractions: integer(\"total_interactions\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Groups table - creator communities\nexport const groups = pgTable(\"groups\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  coverImageUrl: text(\"cover_image_url\"),\n  category: text(\"category\"),\n  memberCount: integer(\"member_count\").default(0),\n  isPrivate: boolean(\"is_private\").default(false),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Group memberships\nexport const groupMemberships = pgTable(\"group_memberships\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  groupId: varchar(\"group_id\").references(() => groups.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  role: text(\"role\").default(\"member\"), // 'admin' | 'member'\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n});\n\n// Login streaks for gamification\nexport const loginStreaks = pgTable(\"login_streaks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_address\").notNull().unique(),\n  currentStreak: integer(\"current_streak\").default(0),\n  longestStreak: integer(\"longest_streak\").default(0),\n  totalPoints: integer(\"total_points\").default(0),\n  lastLoginDate: timestamp(\"last_login_date\"),\n  loginDates: jsonb(\"login_dates\").$type<string[]>().default([]),\n  weeklyCalendar: jsonb(\"weekly_calendar\").$type<boolean[]>().default([false, false, false, false, false, false, false]),\n});\n\n// Bookmarks\nexport const bookmarks = pgTable(\"bookmarks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  projectId: varchar(\"project_id\").references(() => projects.id),\n  coinId: varchar(\"coin_id\").references(() => coins.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// E1XP Points Transactions\nexport const pointsTransactions = pgTable(\"points_transactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  amount: integer(\"amount\").notNull(),\n  type: text(\"type\").notNull(), // 'daily_streak' | 'trade' | 'create_coin' | 'referral' | 'badge_unlock'\n  description: text(\"description\").notNull(),\n  metadata: jsonb(\"metadata\").$type<Record<string, any>>(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Referral Tracking\nexport const referrals = pgTable(\"referrals\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  referrerId: varchar(\"referrer_id\").references(() => users.id).notNull(),\n  referredUserId: varchar(\"referred_user_id\").references(() => users.id).notNull(),\n  status: text(\"status\").default(\"pending\"), // 'pending' | 'active' | 'rewarded'\n  totalPointsEarned: integer(\"total_points_earned\").default(0),\n  hasTradedOrCreated: boolean(\"has_traded_or_created\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// OG Meta Share Tracking\nexport const shareTracking = pgTable(\"share_tracking\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  shareType: text(\"share_type\").notNull(), // 'profile' | 'coin' | 'project' | 'referral' | 'badge'\n  resourceId: text(\"resource_id\"),\n  platform: text(\"platform\"), // 'twitter' | 'telegram' | 'facebook' | 'copy_link'\n  views: integer(\"views\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ many, one }) => ({\n  projects: many(projects),\n  coins: many(coins),\n  sentMessages: many(messages, { relationName: \"sentMessages\" }),\n  receivedMessages: many(messages, { relationName: \"receivedMessages\" }),\n  connections: many(connections),\n  groupMemberships: many(groupMemberships),\n  loginStreak: many(loginStreaks),\n  pointsTransactions: many(pointsTransactions),\n  shareTracking: many(shareTracking),\n  referredUsers: many(referrals, { relationName: \"referrer\" }),\n  referredBy: one(users, {\n    fields: [users.referredBy],\n    references: [users.id],\n  }),\n}));\n\nexport const projectsRelations = relations(projects, ({ one }) => ({\n  user: one(users, {\n    fields: [projects.userId],\n    references: [users.id],\n  }),\n  coin: one(coins, {\n    fields: [projects.coinId],\n    references: [coins.id],\n  }),\n}));\n\nexport const coinsRelations = relations(coins, ({ one, many }) => ({\n  user: one(users, {\n    fields: [coins.userId],\n    references: [users.id],\n  }),\n  transactions: many(transactions),\n  scrapedContent: one(scrapedContent, {\n    fields: [coins.scrapedContentId],\n    references: [scrapedContent.id],\n  }),\n}));\n\nexport const messagesRelations = relations(messages, ({ one }) => ({\n  sender: one(users, {\n    fields: [messages.senderId],\n    references: [users.id],\n    relationName: \"sentMessages\",\n  }),\n  recipient: one(users, {\n    fields: [messages.recipientId],\n    references: [users.id],\n    relationName: \"receivedMessages\",\n  }),\n}));\n\nexport const connectionsRelations = relations(connections, ({ one }) => ({\n  user: one(users, {\n    fields: [connections.userId],\n    references: [users.id],\n  }),\n  connectedUser: one(users, {\n    fields: [connections.connectedUserId],\n    references: [users.id],\n  }),\n}));\n\nexport const groupsRelations = relations(groups, ({ one, many }) => ({\n  creator: one(users, {\n    fields: [groups.createdBy],\n    references: [users.id],\n  }),\n  memberships: many(groupMemberships),\n}));\n\nexport const groupMembershipsRelations = relations(groupMemberships, ({ one }) => ({\n  group: one(groups, {\n    fields: [groupMemberships.groupId],\n    references: [groups.id],\n  }),\n  user: one(users, {\n    fields: [groupMemberships.userId],\n    references: [users.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  totalConnections: true,\n  totalProfileViews: true,\n  totalEarnings: true,\n});\n\nexport const insertProjectSchema = createInsertSchema(projects).omit({\n  id: true,\n  createdAt: true,\n  totalViews: true,\n  totalInteractions: true,\n  isMinted: true,\n});\n\nexport const insertCoinSchema = createInsertSchema(coins, {\n  name: z.string().min(1, \"Coin name is required\"),\n  symbol: z.string().min(1, \"Symbol is required\"),\n  status: z.enum([\"pending\", \"active\", \"minted\"]).default(\"pending\"),\n}).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const updateCoinSchema = insertCoinSchema.partial();\n\nexport type Coin = typeof coins.$inferSelect;\nexport type InsertCoin = z.infer<typeof insertCoinSchema>;\nexport type UpdateCoin = z.infer<typeof updateCoinSchema>;\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n  isRead: true,\n});\n\nexport const insertConnectionSchema = createInsertSchema(connections).omit({\n  id: true,\n  createdAt: true,\n  totalInteractions: true,\n});\n\nexport const insertGroupSchema = createInsertSchema(groups).omit({\n  id: true,\n  createdAt: true,\n  memberCount: true,\n});\n\nexport const insertGroupMembershipSchema = createInsertSchema(groupMemberships).omit({\n  id: true,\n  joinedAt: true,\n});\n\nexport const insertLoginStreakSchema = createInsertSchema(loginStreaks).omit({\n  id: true,\n});\n\n// Type exports\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\n\nexport type Project = typeof projects.$inferSelect;\nexport type InsertProject = z.infer<typeof insertProjectSchema>;\n\nexport type Transaction = typeof transactions.$inferSelect;\n\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\n\nexport type Connection = typeof connections.$inferSelect;\nexport type InsertConnection = z.infer<typeof insertConnectionSchema>;\n\nexport type Group = typeof groups.$inferSelect;\nexport type InsertGroup = z.infer<typeof insertGroupSchema>;\n\nexport type GroupMembership = typeof groupMemberships.$inferSelect;\nexport type InsertGroupMembership = z.infer<typeof insertGroupMembershipSchema>;\n\nexport type LoginStreak = typeof loginStreaks.$inferSelect;\nexport type InsertLoginStreak = z.infer<typeof insertLoginStreakSchema>;\n\nexport type Bookmark = typeof bookmarks.$inferSelect;\n\nexport type PointsTransaction = typeof pointsTransactions.$inferSelect;\nexport type InsertPointsTransaction = typeof pointsTransactions.$inferInsert;\n\nexport type ShareTracking = typeof shareTracking.$inferSelect;\nexport type InsertShareTracking = typeof shareTracking.$inferInsert;\n\nexport const referralsRelations = relations(referrals, ({ one }) => ({\n  referrer: one(users, {\n    fields: [referrals.referrerId],\n    references: [users.id],\n    relationName: \"referrer\",\n  }),\n  referredUser: one(users, {\n    fields: [referrals.referredUserId],\n    references: [users.id],\n  }),\n}));\n\nexport type Referral = typeof referrals.$inferSelect;\nexport type InsertReferral = typeof referrals.$inferInsert;\n\nexport const insertReferralSchema = createInsertSchema(referrals).omit({\n  id: true,\n  createdAt: true,\n  totalPointsEarned: true,\n  hasTradedOrCreated: true,\n});\n\n// Follows table\nexport const follows = pgTable(\"follows\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  followerAddress: text(\"follower_address\").notNull(),\n  followingAddress: text(\"creator_address\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport type Follow = typeof follows.$inferSelect;\nexport type InsertFollow = typeof follows.$inferInsert;\n\nexport const insertFollowSchema = createInsertSchema(follows).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Scraped Content table - imported content from URLs\nexport const scrapedContent = pgTable(\"scraped_content\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  url: text(\"url\").notNull(),\n  platform: text(\"platform\").notNull().default(\"blog\"),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  author: text(\"author\"),\n  publishDate: text(\"publish_date\"),\n  image: text(\"image\"),\n  animationUrl: text(\"animation_url\"),\n  type: text(\"type\"),\n  content: text(\"content\"),\n  tags: jsonb(\"tags\").$type<string[]>(),\n  metadata: jsonb(\"metadata\").$type<Record<string, any>>(),\n  scrapedAt: timestamp(\"scraped_at\").defaultNow().notNull(),\n});\n\n// Rewards table for tracking creator earnings\nexport const rewards = pgTable(\"rewards\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  type: text(\"type\").notNull(),\n  coinAddress: text(\"coin_address\").notNull(),\n  coinSymbol: text(\"coin_symbol\").notNull(),\n  transactionHash: text(\"transaction_hash\").notNull(),\n  rewardAmount: text(\"reward_amount\").notNull(),\n  rewardCurrency: text(\"reward_currency\").notNull().default(\"ZORA\"),\n  recipientAddress: text(\"recipient_address\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Notifications table\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: text(\"user_id\").notNull(),\n  type: text(\"type\").notNull(),\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  coinAddress: text(\"coin_address\"),\n  coinSymbol: text(\"coin_symbol\"),\n  amount: text(\"amount\"),\n  transactionHash: text(\"transaction_hash\"),\n  read: boolean(\"read\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Creators table\nexport const creators = pgTable(\"creators\", {\n  id: uuid(\"id\").primaryKey().defaultRandom(),\n  privyId: text(\"privy_id\").unique(), // Primary identifier from Privy (nullable for legacy migration)\n  address: varchar(\"address\", { length: 42 }).unique(), // Wallet address - nullable for email-only users\n  email: text(\"email\"), // Email address for email-only users\n  name: varchar(\"name\", { length: 100 }),\n  bio: text(\"bio\"),\n  avatar: text(\"avatar\"),\n  walletAddress: varchar(\"wallet_address\", { length: 42 }), // For payouts only\n  verified: varchar(\"verified\", { length: 10 }).default(\"false\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\"),\n});\n\n// Comments table\nexport const comments = pgTable(\"comments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  coinAddress: text(\"coin_address\").notNull(),\n  userAddress: text(\"user_address\").notNull(),\n  comment: text(\"comment\").notNull(),\n  transactionHash: text(\"transaction_hash\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// E1XP Rewards table - track claimable rewards for coin creation, referrals, etc.\nexport const e1xpRewards = pgTable(\"e1xp_rewards\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  amount: integer(\"amount\").notNull(),\n  type: text(\"type\").notNull(), // 'coin_creation' | 'referral' | 'daily_streak' | 'first_trade'\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  claimed: boolean(\"claimed\").notNull().default(false),\n  claimedAt: timestamp(\"claimed_at\"),\n  coinId: varchar(\"coin_id\").references(() => coins.id),\n  referralId: varchar(\"referral_id\").references(() => referrals.id),\n  metadata: jsonb(\"metadata\").$type<Record<string, any>>(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  reminderSentAt: timestamp(\"reminder_sent_at\"),\n});\n\n// Push notification subscriptions\nexport const pushSubscriptions = pgTable(\"push_subscriptions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  endpoint: text(\"endpoint\").notNull().unique(),\n  p256dhKey: text(\"p256dh_key\").notNull(),\n  authKey: text(\"auth_key\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Type exports for new tables\nexport type ScrapedContent = typeof scrapedContent.$inferSelect;\nexport type Reward = typeof rewards.$inferSelect;\nexport type Notification = typeof notifications.$inferSelect;\nexport type Creator = typeof creators.$inferSelect & {\n  followerCount?: number;\n  followingCount?: number;\n  walletAddress?: string | null;\n};\nexport type Comment = typeof comments.$inferSelect;\nexport type E1xpReward = typeof e1xpRewards.$inferSelect;\nexport type PushSubscription = typeof pushSubscriptions.$inferSelect;\n\nexport const insertScrapedContentSchema = createInsertSchema(scrapedContent).omit({\n  id: true,\n  scrapedAt: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  createdAt: true,\n  read: true,\n});\n\nexport const insertCreatorSchema = createInsertSchema(creators).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  privyId: z.string().min(1, \"Privy ID is required\").optional(), // Optional for legacy support\n  walletAddress: z.string().nullable().optional(), // Optional payout address\n});\n\nexport const updateCreatorSchema = insertCreatorSchema.partial().extend({\n  walletAddress: z.string().nullable().optional(), // allow walletAddress to be updated for payouts\n});\n\nexport type InsertCreator = z.infer<typeof insertCreatorSchema>;\nexport type UpdateCreator = z.infer<typeof updateCreatorSchema>;\nexport type UpdateCreatorSchemaType = z.infer<typeof updateCreatorSchema>;\n\nexport const insertE1xpRewardSchema = createInsertSchema(e1xpRewards).omit({\n  id: true,\n  createdAt: true,\n  claimed: true,\n  claimedAt: true,\n  reminderSentAt: true,\n});\n\nexport const insertPushSubscriptionSchema = createInsertSchema(pushSubscriptions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertScrapedContent = z.infer<typeof insertScrapedContentSchema>;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type InsertE1xpReward = z.infer<typeof insertE1xpRewardSchema>;\nexport type InsertPushSubscription = z.infer<typeof insertPushSubscriptionSchema>;\n\n// Comment Reactions table\nexport const commentReactions = pgTable(\"comment_reactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  commentId: varchar(\"comment_id\").notNull(),\n  userAddress: varchar(\"user_address\").notNull(),\n  emoji: varchar(\"emoji\", { length: 10 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// User Badges table\nexport const userBadges = pgTable(\"user_badges\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  badgeType: text(\"badge_type\").notNull(),\n  badgeName: text(\"badge_name\").notNull(),\n  badgeIcon: text(\"badge_icon\"),\n  description: text(\"description\"),\n  earnedAt: timestamp(\"earned_at\").defaultNow().notNull(),\n  metadata: jsonb(\"metadata\").$type<Record<string, any>>().default({}),\n});\n\n// Trade History table (detailed)\nexport const tradeHistory = pgTable(\"trade_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userAddress: varchar(\"user_address\").notNull(),\n  coinAddress: varchar(\"coin_address\").notNull(),\n  coinSymbol: varchar(\"coin_symbol\"),\n  tradeType: text(\"trade_type\").notNull(),\n  amountEth: text(\"amount_eth\").notNull(),\n  amountTokens: text(\"amount_tokens\"),\n  pricePerToken: text(\"price_per_token\"),\n  totalValueUsd: text(\"total_value_usd\"),\n  transactionHash: text(\"transaction_hash\"),\n  blockNumber: integer(\"block_number\"),\n  gasUsed: text(\"gas_used\"),\n  gasPrice: text(\"gas_price\"),\n  timestamp: timestamp(\"timestamp\").defaultNow().notNull(),\n  metadata: jsonb(\"metadata\").$type<Record<string, any>>().default({}),\n});\n\n// Creator Stories table\nexport const creatorStories = pgTable(\"creator_stories\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorAddress: varchar(\"creator_address\").notNull(),\n  contentType: text(\"content_type\").default(\"image\"),\n  contentUrl: text(\"content_url\"),\n  textContent: text(\"text_content\"),\n  thumbnailUrl: text(\"thumbnail_url\"),\n  duration: integer(\"duration\").default(86400),\n  viewsCount: integer(\"views_count\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  expiresAt: timestamp(\"expires_at\"),\n  isActive: boolean(\"is_active\").default(true),\n});\n\n// Story Views table\nexport const storyViews = pgTable(\"story_views\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  storyId: varchar(\"story_id\").notNull(),\n  viewerAddress: varchar(\"viewer_address\").notNull(),\n  viewedAt: timestamp(\"viewed_at\").defaultNow().notNull(),\n});\n\n// Search History table\nexport const searchHistory = pgTable(\"search_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userAddress: varchar(\"user_address\"),\n  searchQuery: text(\"search_query\").notNull(),\n  searchType: text(\"search_type\").default(\"general\"),\n  resultCount: integer(\"result_count\").default(0),\n  clickedResult: text(\"clicked_result\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Type exports for new tables\nexport type CommentReaction = typeof commentReactions.$inferSelect;\nexport type InsertCommentReaction = typeof commentReactions.$inferInsert;\n\nexport type UserBadge = typeof userBadges.$inferSelect;\nexport type InsertUserBadge = typeof userBadges.$inferInsert;\n\nexport type TradeHistory = typeof tradeHistory.$inferSelect;\nexport type InsertTradeHistory = typeof tradeHistory.$inferInsert;\n\nexport type CreatorStory = typeof creatorStories.$inferSelect;\nexport type InsertCreatorStory = typeof creatorStories.$inferInsert;\n\nexport type StoryView = typeof storyViews.$inferSelect;\nexport type InsertStoryView = typeof storyViews.$inferInsert;\n\nexport type SearchHistory = typeof searchHistory.$inferSelect;\nexport type InsertSearchHistory = typeof searchHistory.$inferInsert;\n\n// Additional type exports\nexport const insertCommentSchema = createInsertSchema(comments).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertComment = z.infer<typeof insertCommentSchema>;\n\nexport const insertRewardSchema = createInsertSchema(rewards).omit({\n  id: true,\n  createdAt: true,\n});\nexport type InsertReward = z.infer<typeof insertRewardSchema>;\n\nexport const updateLoginStreakSchema = insertLoginStreakSchema.partial();\nexport type UpdateLoginStreak = z.infer<typeof updateLoginStreakSchema>;\n\nexport const insertCommentReactionSchema = createInsertSchema(commentReactions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserBadgeSchema = createInsertSchema(userBadges).omit({\n  id: true,\n  earnedAt: true,\n});\n\nexport const insertTradeHistorySchema = createInsertSchema(tradeHistory).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertCreatorStorySchema = createInsertSchema(creatorStories).omit({\n  id: true,\n  createdAt: true,\n  viewsCount: true,\n});\n\nexport const insertSearchHistorySchema = createInsertSchema(searchHistory).omit({\n  id: true,\n  createdAt: true,\n});","size_bytes":26100},"client/src/pages/profile.tsx":{"content":"import { useState, useEffect, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { useLocation } from \"wouter\";\nimport type { Coin } from \"@shared/schema\";\nimport { CoinCard } from \"@/components/coin-card\";\nimport {\n  User as UserIcon,\n  Share2,\n  Copy,\n  Check,\n  Edit2,\n  Settings,\n  Bell,\n  Grid3x3,\n  Heart,\n  Bookmark,\n  Wallet,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { getCoin } from \"@zoralabs/coins-sdk\";\nimport { base } from \"viem/chains\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { formatSmartCurrency } from \"@/lib/utils\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { getAccessToken } from \"@privy-io/react-auth\";\nimport { ShareModal } from \"@/components/share-modal\";\nimport WithdrawEarningsModal from \"@/components/withdraw-earnings-modal\";\nimport { useSmartAccount } from \"@/contexts/SmartAccountContext\";\n\nexport default function Profile() {\n  const { user: privyUser, authenticated } = usePrivy();\n  const [selectedTab, setSelectedTab] = useState<\"coins\" | \"liked\" | \"saved\">(\n    \"coins\",\n  );\n  const [copied, setCopied] = useState(false);\n  const [totalEarnings, setTotalEarnings] = useState<number>(0);\n  const [totalMarketCap, setTotalMarketCap] = useState<number>(0);\n  const [totalHolders, setTotalHolders] = useState<number>(0);\n  const [isLoadingStats, setIsLoadingStats] = useState(false);\n  const [followersCount, setFollowersCount] = useState<number>(0);\n  const [followingCount, setFollowingCount] = useState<number>(0);\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false);\n  const [username, setUsername] = useState(\"\");\n  const [bio, setBio] = useState(\"\");\n  const [profileImage, setProfileImage] = useState<File | null>(null);\n  const [profileImageUrl, setProfileImageUrl] = useState<string>(\"\");\n  const [walletAddress, setWalletAddress] = useState<string>(\"\");\n  const [isUploadingImage, setIsUploadingImage] = useState(false);\n  const [isSavingProfile, setIsSavingProfile] = useState(false);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [shareUrl, setShareUrl] = useState<string>(\"\");\n  const [currentStreak, setCurrentStreak] = useState<number>(0);\n  const [longestStreak, setLongestStreak] = useState<number>(0);\n  const [totalE1XPPoints, setTotalE1XPPoints] = useState<number>(0);\n  const [isShareModalOpen, setIsShareModalOpen] = useState(false); // State for share modal\n  const [showWithdrawModal, setShowWithdrawModal] = useState(false); // State for withdraw modal\n\n  const privyId = privyUser?.id;\n  const address = privyUser?.wallet?.address;\n  const email = privyUser?.email?.address;\n  const { smartAccountAddress } = useSmartAccount();\n\n  // Ensure creator exists on mount\n  useEffect(() => {\n    if (!authenticated || !privyId) return;\n\n    const ensureCreator = async () => {\n      try {\n        const response = await apiRequest(\"POST\", \"/api/creators/sync\", {\n          privyId,\n          address: address || null,\n          email: email || null,\n        });\n\n        if (response.ok) {\n          queryClient.invalidateQueries({\n            queryKey: [\"/api/creators/privy\", privyId],\n          });\n        }\n      } catch (error) {\n        console.error(\"Failed to ensure creator exists:\", error);\n        // Don't show error to user, will retry on next action\n      }\n    };\n\n    ensureCreator();\n  }, [authenticated, privyId, address, email]);\n\n  // Fetch creator by Privy ID (works for both email and wallet users)\n  const { data: creatorData, isLoading: isLoadingCreatorData } = useQuery({\n    queryKey: [\"/api/creators/privy\", privyId],\n    enabled: !!privyId && authenticated,\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  const avatarUrl = creatorData?.avatar || \"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\";\n\n  // Fetch E1XP status for streak info\n  const { data: e1xpStatus } = useQuery({\n    queryKey: [\"/api/e1xp/status\", authenticated],\n    enabled: authenticated,\n    refetchInterval: 5000, // Refetch every 5 seconds to catch updates\n    queryFn: async () => {\n      const headers: Record<string, string> = {};\n      try {\n        const accessToken = await getAccessToken();\n        if (accessToken) {\n          headers.Authorization = `Bearer ${accessToken}`;\n        }\n      } catch (error) {\n        console.error(\"Failed to get access token:\", error);\n      }\n      const response = await fetch(\"/api/e1xp/status\", {\n        credentials: \"include\",\n        headers,\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch E1XP status\");\n      return response.json();\n    },\n  });\n\n  // Use creator address if available, otherwise these queries will be disabled\n  const creatorAddress = creatorData?.address || address;\n\n  const { data: followers = [] } = useQuery({\n    queryKey: [\"/api/follows/followers\", creatorAddress],\n    enabled: !!creatorAddress && authenticated && !!creatorData,\n    retry: false,\n  });\n\n  const { data: following = [] } = useQuery({\n    queryKey: [\"/api/follows/following\", creatorAddress],\n    enabled: !!creatorAddress && authenticated && !!creatorData,\n    retry: false,\n  });\n\n  useEffect(() => {\n    setFollowersCount(followers.length || 0);\n    setFollowingCount(following.length || 0);\n  }, [followers, following]);\n\n  // Update local stats when e1xpStatus changes\n  useEffect(() => {\n    if (e1xpStatus) {\n      setCurrentStreak(e1xpStatus.streak || 0);\n      setLongestStreak(e1xpStatus.longestStreak || 0);\n      setTotalE1XPPoints(e1xpStatus.points || 0);\n    }\n  }, [e1xpStatus]);\n\n  const { data: coins = [], isLoading: isLoadingCoins } = useQuery<Coin[]>({\n    queryKey: [\"/api/coins\"],\n  });\n\n  const createdCoins = useMemo(() => {\n    const creatorAddress = creatorData?.address || address;\n    if (!creatorAddress) return [];\n    return coins.filter(\n      (coin) =>\n        coin.creatorWallet &&\n        coin.creatorWallet.toLowerCase() === creatorAddress.toLowerCase(),\n    );\n  }, [coins, creatorData, address]);\n\n  const displayedCoins = createdCoins.filter(\n    (coin) => coin.address !== null,\n  ) as Array<(typeof createdCoins)[0] & { address: string }>;\n\n  useEffect(() => {\n    if (!address || !authenticated || !createdCoins.length) {\n      setTotalEarnings(0);\n      setTotalMarketCap(0);\n      setTotalHolders(0);\n      setIsLoadingStats(false);\n      return;\n    }\n\n    let isMounted = true;\n    setIsLoadingStats(true);\n\n    async function fetchAllStats() {\n      try {\n        let earnings = 0;\n        let marketCap = 0;\n        let holders = 0;\n\n        for (const coin of createdCoins) {\n          if (coin.address && coin.status === \"active\") {\n            try {\n              const coinData = await getCoin({\n                address: coin.address as `0x${string}`,\n                chain: base,\n              });\n\n              const tokenData = coinData.data?.zora20Token;\n\n              if (\n                tokenData?.creatorEarnings &&\n                tokenData.creatorEarnings.length > 0\n              ) {\n                const earningAmount = parseFloat(\n                  String(\n                    tokenData.creatorEarnings[0].amountUsd ||\n                      tokenData.creatorEarnings[0].amount?.amountDecimal ||\n                      \"0\",\n                  ),\n                );\n                earnings += earningAmount;\n              }\n\n              if (tokenData?.marketCap) {\n                marketCap += parseFloat(tokenData.marketCap);\n              }\n\n              if (tokenData?.uniqueHolders) {\n                holders += tokenData.uniqueHolders;\n              }\n            } catch (err) {\n              console.error(\n                `Error fetching coin stats for ${coin.address}:`,\n                err,\n              );\n            }\n          }\n        }\n\n        if (isMounted) {\n          setTotalEarnings(earnings);\n          setTotalMarketCap(marketCap);\n          setTotalHolders(holders);\n          setIsLoadingStats(false);\n        }\n      } catch (error) {\n        console.error(\"Error fetching creator stats:\", error);\n        if (isMounted) {\n          setTotalEarnings(0);\n          setTotalMarketCap(0);\n          setTotalHolders(0);\n          setIsLoadingStats(false);\n        }\n      }\n    }\n\n    fetchAllStats();\n\n    return () => {\n      isMounted = false;\n    };\n  }, [address, authenticated, createdCoins]);\n\n  const formatAddress = (addr: string) => {\n    return `${addr.slice(0, 6)}...${addr.slice(-4)}`;\n  };\n\n  const getDisplayName = () => {\n    // First check if creator has a custom name set\n    if (creatorData?.name) {\n      return creatorData.name;\n    }\n\n    // For wallet users, show formatted address\n    if (address) {\n      return formatAddress(address);\n    }\n\n    // For email-only users, use email prefix\n    if (email) {\n      return email.split(\"@\")[0];\n    }\n\n    return \"Creator\";\n  };\n\n  const handleCopyAddress = async () => {\n    if (!address) return;\n    try {\n      await navigator.clipboard.writeText(address);\n      setCopied(true);\n      toast({\n        title: \"Address copied\",\n        description: \"Wallet address copied to clipboard\",\n      });\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      toast({\n        title: \"Failed to copy\",\n        description: \"Could not copy address to clipboard\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleShare = async () => {\n    // This function will now open the modal instead of directly sharing\n    setIsShareModalOpen(true);\n  };\n\n  const handleImageChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      const file = e.target.files[0];\n      setProfileImage(file);\n\n      setIsUploadingImage(true);\n      try {\n        const formData = new FormData();\n        formData.append(\"file\", file);\n\n        const response = await fetch(\"/api/upload\", {\n          method: \"POST\",\n          body: formData,\n        });\n\n        if (!response.ok) {\n          throw new Error(\"Failed to upload image\");\n        }\n\n        const data = await response.json();\n        setProfileImageUrl(data.url);\n\n        toast({\n          title: \"Image uploaded\",\n          description: \"Profile image uploaded successfully\",\n        });\n      } catch (error) {\n        console.error(\"Image upload error:\", error);\n        toast({\n          title: \"Upload failed\",\n          description: \"Failed to upload profile image\",\n          variant: \"destructive\",\n        });\n      } finally {\n        setIsUploadingImage(false);\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (creatorData) {\n      setUsername(creatorData.name || \"\");\n      setBio(creatorData.bio || \"\");\n      setProfileImageUrl(creatorData.avatar || \"\");\n      setWalletAddress(creatorData.walletAddress || address || \"\");\n    } else if (email && !creatorData) {\n      // For new email users without a creator profile yet, set a default username\n      setUsername(email.split(\"@\")[0]);\n    }\n  }, [creatorData, address, email]);\n\n  useEffect(() => {\n    if (address) {\n      const profilePath = creatorData?.name\n        ? `/@${creatorData.name}`\n        : `/profile/${address}`;\n      const profileUrl = `${window.location.origin}${profilePath}`;\n      setShareUrl(profileUrl);\n    }\n  }, [address, creatorData]);\n\n  const handleSaveProfile = async () => {\n    if (!privyId) {\n      toast({\n        title: \"Error\",\n        description: \"Not authenticated\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate payout wallet address format if provided\n    if (\n      walletAddress &&\n      walletAddress.trim() &&\n      !walletAddress.match(/^0x[a-fA-F0-9]{40}$/)\n    ) {\n      toast({\n        title: \"Error\",\n        description:\n          \"Invalid payout wallet address format. Must be a valid Ethereum address (0x...)\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsSavingProfile(true);\n    try {\n      let creator: any = creatorData;\n\n      // For email users, ensure creator exists by syncing first\n      if (!creator) {\n        console.log(\"Creator not found, syncing profile...\");\n        const syncResponse = await apiRequest(\"POST\", \"/api/creators/sync\", {\n          privyId,\n          address: address || null,\n          email: email || null,\n        });\n\n        if (!syncResponse.ok) {\n          throw new Error(\"Failed to sync creator profile\");\n        }\n\n        creator = await syncResponse.json();\n        console.log(\"Creator synced:\", creator);\n      }\n\n      if (!creator || !creator.id) {\n        toast({\n          title: \"Error\",\n          description:\n            \"Unable to create profile. Please try logging out and back in.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Update the creator profile\n      const updateResponse = await apiRequest(\n        \"PATCH\",\n        `/api/creators/${creator.id}`,\n        {\n          name: username.trim() || null,\n          bio: bio.trim() || null,\n          avatar: profileImageUrl || null,\n          walletAddress: walletAddress.trim() || null, // Payout address\n        },\n      );\n\n      if (!updateResponse.ok) {\n        const errorData = await updateResponse.json();\n        throw new Error(errorData.message || \"Failed to update profile\");\n      }\n\n      creator = await updateResponse.json();\n\n      // Invalidate all relevant queries to refresh the UI\n      await Promise.all([\n        queryClient.invalidateQueries({\n          queryKey: [\"/api/creators/privy\", privyId],\n        }),\n        queryClient.invalidateQueries({\n          queryKey: [\"/api/creators/address\", address],\n        }),\n        queryClient.invalidateQueries({ queryKey: [\"/api/creators\"] }),\n        queryClient.invalidateQueries({ queryKey: [\"/api/coins\"] }),\n        queryClient.invalidateQueries({ queryKey: [\"/api/e1xp/status\"] }),\n      ]);\n\n      // Force a refetch of creator data\n      await queryClient.refetchQueries({\n        queryKey: [\"/api/creators/privy\", privyId],\n      });\n\n      toast({\n        title: \"Profile updated\",\n        description: \"Your profile has been updated successfully\",\n      });\n\n      setIsEditModalOpen(false);\n    } catch (error) {\n      console.error(\"Profile update error:\", error);\n      toast({\n        title: \"Error\",\n        description:\n          error instanceof Error ? error.message : \"Failed to update profile\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSavingProfile(false);\n    }\n  };\n\n  if (!authenticated) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh] p-8\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 bg-muted/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <UserIcon className=\"w-8 h-8 text-muted-foreground\" />\n          </div>\n          <h2\n            className=\"text-2xl font-bold text-foreground mb-2\"\n            data-testid=\"text-connect-wallet\"\n          >\n            Connect Your Wallet\n          </h2>\n          <p className=\"text-muted-foreground\">\n            Please connect your wallet to view your profile\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoadingCreatorData) {\n    return (\n      <div className=\"max-w-2xl mx-auto p-4\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <Skeleton className=\"h-8 w-8 rounded-lg\" />\n          <Skeleton className=\"h-6 w-32\" />\n          <div className=\"flex gap-2\">\n            <Skeleton className=\"h-8 w-8 rounded-lg\" />\n            <Skeleton className=\"h-8 w-8 rounded-lg\" />\n          </div>\n        </div>\n        <div className=\"flex flex-col items-center text-center mb-6\">\n          <Skeleton className=\"w-24 h-24 rounded-full mb-4\" />\n          <Skeleton className=\"h-6 w-40 mb-2\" />\n          <Skeleton className=\"h-4 w-24 mb-4\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-5xl mx-auto pb-20 px-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4\">\n        <button\n          onClick={() => window.history.back()}\n          className=\"p-2 hover:bg-muted rounded-lg\"\n        >\n          <svg\n            width=\"24\"\n            height=\"24\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth=\"2\"\n          >\n            <path d=\"M15 18l-6-6 6-6\" />\n          </svg>\n        </button>\n        <div className=\"flex-1\"></div>\n      </div>\n\n      {/* Profile Section */}\n      <div className=\"flex flex-col items-center text-center py-6 px-4\">\n        {/* Avatar */}\n        <img\n          src={avatarUrl}\n          alt=\"Profile\"\n          className=\"w-24 h-24 rounded-full border-2 border-border object-cover mb-4\"\n          data-testid=\"img-profile-avatar\"\n        />\n\n        {/* Username with verification */}\n        <div className=\"flex items-center gap-1 mb-1\">\n          <h2 className=\"text-base font-semibold\">\n            @{getDisplayName()}\n          </h2>\n          {creatorData?.verified === \"true\" && (\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n              <circle cx=\"8\" cy=\"8\" r=\"8\" fill=\"#20D5EC\" />\n              <path\n                d=\"M6.5 8.5L7.5 9.5L10 7\"\n                stroke=\"white\"\n                strokeWidth=\"1.5\"\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n              />\n            </svg>\n          )}\n        </div>\n\n        {/* Stats */}\n        <div className=\"flex items-center gap-3 mb-4\">\n          <div>\n            <div className=\"text-lg font-bold\" data-testid=\"text-posts\">\n              {isLoadingCoins ? \"-\" : createdCoins.length}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">Posts</div>\n          </div>\n          <div>\n            <div className=\"text-lg font-bold\" data-testid=\"text-followers\">\n              {followersCount}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">Followers</div>\n          </div>\n          <div>\n            <div className=\"text-lg font-bold\" data-testid=\"text-following\">\n              {followingCount}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">Following</div>\n          </div>\n          <div\n            className=\"cursor-pointer\"\n            onClick={() => setShowWithdrawModal(true)}\n          >\n            <div\n              className=\"text-lg font-bold text-green-500\"\n              data-testid=\"text-earnings\"\n            >\n              {isLoadingStats\n                ? \"-\"\n                : totalEarnings > 1000\n                  ? `$${(totalEarnings / 1000).toFixed(1)}k`\n                  : formatSmartCurrency(totalEarnings)}\n            </div>\n            <div className=\"text-xs text-muted-foreground flex items-center gap-1\">\n              Cash out\n              {totalEarnings > 0 && (\n                <Wallet className=\"w-3 h-3 text-green-500\" />\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"flex items-center justify-center gap-2 mb-4 w-full max-w-sm mx-auto\">\n          <Button\n            onClick={() => setIsEditModalOpen(true)}\n            className=\"bg-primary hover:bg-primary/90 text-primary-foreground font-semibold rounded-lg h-9 text-xs px-3\"\n            data-testid=\"button-edit-profile\"\n          >\n            Edit Profile\n          </Button>\n          <div className=\"flex items-center gap-1 px-2.5 py-1 bg-yellow-500/10 border border-yellow-500/20 rounded-lg\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 16 16\" fill=\"none\">\n              <path\n                d=\"M8 2L9.5 6.5L14 8L9.5 9.5L8 14L6.5 9.5L2 8L6.5 6.5L8 2Z\"\n                fill=\"#EAB308\"\n              />\n            </svg>\n            <span className=\"text-xs font-bold text-yellow-600 dark:text-yellow-500\">\n              {totalE1XPPoints.toLocaleString()}\n            </span>\n          </div>\n          <Button\n            onClick={handleShare}\n            variant=\"outline\"\n            size=\"icon\"\n            className=\"rounded-lg h-9 w-9\"\n            data-testid=\"button-share-profile\"\n          >\n            <Share2 className=\"w-4 h-4\" />\n          </Button>\n        </div>\n\n        {/* Bio */}\n        {creatorData?.bio && (\n          <p\n            className=\"text-sm text-foreground mb-2 max-w-md\"\n            data-testid=\"text-bio\"\n          >\n            {creatorData.bio}\n          </p>\n        )}\n\n        {/* Smart Account Address (for email users) */}\n        {email && smartAccountAddress && (\n          <div className=\"flex items-center gap-2 px-3 py-2 bg-muted/30 rounded-lg text-xs font-mono max-w-md mx-auto mb-2\">\n            <Wallet className=\"w-3 h-3 text-muted-foreground\" />\n            <span className=\"text-muted-foreground truncate\">\n              {formatAddress(smartAccountAddress)}\n            </span>\n            <button\n              onClick={() => {\n                navigator.clipboard.writeText(smartAccountAddress);\n                toast({\n                  title: \"Smart account copied\",\n                  description: \"Your smart account address has been copied\",\n                });\n              }}\n              className=\"p-1 hover:bg-muted rounded\"\n            >\n              {copied ? (\n                <Check className=\"w-3 h-3\" />\n              ) : (\n                <Copy className=\"w-3 h-3\" />\n              )}\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Tabs */}\n      <div className=\"flex items-center border-b border-border\">\n        <button\n          onClick={() => setSelectedTab(\"coins\")}\n          className={`flex-1 flex items-center justify-center gap-2 py-3 ${\n            selectedTab === \"coins\"\n              ? \"text-foreground border-b-2 border-foreground\"\n              : \"text-muted-foreground\"\n          }`}\n        >\n          <Grid3x3 className=\"w-4 h-4\" />\n        </button>\n        <button\n          onClick={() => setSelectedTab(\"liked\")}\n          className={`flex-1 flex items-center justify-center gap-2 py-3 ${\n            selectedTab === \"liked\"\n              ? \"text-foreground border-b-2 border-foreground\"\n              : \"text-muted-foreground\"\n          }`}\n        >\n          <Heart className=\"w-4 h-4\" />\n        </button>\n        <button\n          onClick={() => setSelectedTab(\"saved\")}\n          className={`flex-1 flex items-center justify-center gap-2 py-3 ${\n            selectedTab === \"saved\"\n              ? \"text-foreground border-b-2 border-foreground\"\n              : \"text-muted-foreground\"\n          }`}\n        >\n          <Bookmark className=\"w-4 h-4\" />\n        </button>\n      </div>\n\n      {/* Content Grid */}\n      {isLoadingCoins ? (\n        <div className=\"grid grid-cols-3 gap-1 p-1\">\n          {[...Array(9)].map((_, i) => (\n            <div\n              key={i}\n              className=\"aspect-square bg-muted/20 animate-pulse\"\n            ></div>\n          ))}\n        </div>\n      ) : displayedCoins.length === 0 ? (\n        <div className=\"text-center py-16\">\n          <div className=\"w-16 h-16 bg-muted/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <Grid3x3 className=\"w-8 h-8 text-muted-foreground\" />\n          </div>\n          <h3\n            className=\"text-xl font-bold text-foreground mb-2\"\n            data-testid=\"text-no-coins\"\n          >\n            No coins created yet\n          </h3>\n          <p className=\"text-muted-foreground\">\n            Start creating your first coin!\n          </p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-3 gap-1 p-1\">\n          {displayedCoins.map((coin) => (\n            <div\n              key={coin.id}\n              className=\"aspect-square relative cursor-pointer group overflow-hidden\"\n              onClick={() => setLocation(`/coins/${coin.id}`)}\n            >\n              {coin.imageUrl ? (\n                <img\n                  src={coin.imageUrl}\n                  alt={coin.name}\n                  className=\"w-full h-full object-cover\"\n                />\n              ) : (\n                <div className=\"w-full h-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center\">\n                  <span className=\"text-2xl font-bold text-primary/40\">\n                    {coin.symbol.slice(0, 2)}\n                  </span>\n                </div>\n              )}\n              <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                <div className=\"text-white text-xs font-semibold flex items-center gap-1\">\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"white\">\n                    <path d=\"M8 2L9.5 6.5L14 8L9.5 9.5L8 14L6.5 9.5L2 8L6.5 6.5L8 2Z\" />\n                  </svg>\n                  {coin.name}\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Edit Profile Modal */}\n      <Dialog open={isEditModalOpen} onOpenChange={setIsEditModalOpen}>\n        <DialogContent className=\"sm:max-w-[380px] rounded-2xl p-5\">\n          <DialogHeader className=\"pb-1\">\n            <DialogTitle className=\"text-base font-semibold\">\n              Edit Profile\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-2.5\">\n            <div>\n              <label className=\"text-xs font-medium mb-1 block text-muted-foreground\">\n                Profile Image\n              </label>\n              <Input\n                type=\"file\"\n                accept=\"image/*\"\n                onChange={handleImageChange}\n                disabled={isUploadingImage || isSavingProfile}\n                data-testid=\"input-profile-image\"\n                className=\"h-8 text-xs\"\n              />\n              {isUploadingImage && (\n                <div className=\"flex items-center gap-1.5 mt-1\">\n                  <div className=\"w-3 h-3 border-2 border-primary border-t-transparent rounded-full animate-spin\" />\n                  <p className=\"text-xs text-muted-foreground\">\n                    Uploading image...\n                  </p>\n                </div>\n              )}\n            </div>\n\n            <div>\n              <label className=\"text-xs font-medium mb-1 block text-muted-foreground\">\n                Username\n              </label>\n              <Input\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                placeholder=\"Your username\"\n                data-testid=\"input-username\"\n                disabled={isSavingProfile}\n                className=\"h-8 text-sm\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-xs font-medium mb-1 block text-muted-foreground\">\n                Bio\n              </label>\n              <Textarea\n                value={bio}\n                onChange={(e) => setBio(e.target.value)}\n                placeholder=\"Tell us about yourself...\"\n                rows={2}\n                data-testid=\"input-bio\"\n                disabled={isSavingProfile}\n                className=\"text-sm resize-none min-h-[60px]\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-xs font-medium mb-1 block text-muted-foreground\">\n                Payout Wallet Address\n              </label>\n              <Input\n                value={walletAddress}\n                onChange={(e) => setWalletAddress(e.target.value)}\n                placeholder=\"0x... (where you want to receive Zora rewards)\"\n                data-testid=\"input-wallet-address\"\n                disabled={isSavingProfile}\n                className=\"h-8 text-sm font-mono\"\n              />\n              <p className=\"text-[10px] text-muted-foreground mt-1\">\n                Your Zora coin earnings and rewards will be sent to this wallet\n                address\n              </p>\n            </div>\n\n            <Button\n              onClick={handleSaveProfile}\n              className=\"w-full h-9 relative rounded-full\"\n              data-testid=\"button-save-profile\"\n              disabled={isUploadingImage || isSavingProfile}\n            >\n              {isSavingProfile && (\n                <div className=\"absolute left-3 w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin\" />\n              )}\n              <span className={isSavingProfile ? \"ml-5\" : \"\"}>\n                {isSavingProfile ? \"Saving profile...\" : \"Save Changes\"}\n              </span>\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Share Modal */}\n      <ShareModal\n        isOpen={isShareModalOpen}\n        onClose={() => setIsShareModalOpen(false)}\n        url={shareUrl}\n        title={`${creatorData?.name || formatAddress(address || \"\")} - CoinIT Profile`}\n        description=\"Check out my profile on CoinIT!\"\n      />\n\n      <WithdrawEarningsModal\n        open={showWithdrawModal}\n        onOpenChange={setShowWithdrawModal}\n        userCoins={\n          createdCoins.filter((coin) => coin.address !== null) as Array<\n            (typeof createdCoins)[0] & { address: string }\n          >\n        }\n      />\n    </div>\n  );\n}","size_bytes":29558},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/lib/theme-provider\";\nimport { AppLayout } from \"@/components/app-layout\";\nimport { ProductTour } from \"@/components/product-tour\";\n\n// Pages\nimport Home from \"@/pages/home\";\nimport Search from \"@/pages/search\";\nimport Profile from \"@/pages/profile\";\nimport PublicProfile from \"@/pages/public-profile\";\nimport Create from \"@/pages/create\";\nimport Inbox from \"@/pages/inbox\";\nimport Connections from \"@/pages/connections\";\nimport Groups from \"@/pages/groups\";\nimport Streaks from \"@/pages/streaks\";\nimport Points from \"./pages/points\";\nimport Admin from \"@/pages/admin\";\nimport AdminLogin from \"@/pages/admin-login\";\nimport Creators from \"@/pages/creators\";\nimport CoinsPage from \"@/pages/coins\";\nimport CoinDetailPage from \"@/pages/coin-detail\";\nimport Docs from \"@/pages/docs\";\nimport FAQ from \"@/pages/faq\";\nimport Referrals from \"@/pages/referrals\";\nimport Settings from \"@/pages/settings\";\nimport NotFound from \"@/pages/not-found\";\nimport Notifications from \"@/pages/notifications\";\n\nfunction Router() {\n  return (\n    <AppLayout>\n      <ProductTour />\n      <Switch>\n        <Route path=\"/\" component={Home} />\n        <Route path=\"/search\" component={Search} />\n        <Route path=\"/profile/:identifier\" component={PublicProfile} />\n        <Route path=\"/profile\" component={Profile} />\n        <Route path=\"/create\" component={Create} />\n        <Route path=\"/inbox\" component={Inbox} />\n        <Route path=\"/connections\" component={Connections} />\n        <Route path=\"/groups\" component={Groups} />\n        <Route path=\"/streaks\" component={Streaks} />\n        <Route path=\"/points\" component={Points} />\n        <Route path=\"/settings\" component={Settings} />\n        <Route path=\"/admin-login\" component={AdminLogin} />\n        <Route path=\"/admin\" component={Admin} />\n        <Route path=\"/creators\" component={Creators} />\n        <Route path=\"/coins\" component={CoinsPage} />\n        <Route path=\"/coin/:address\" component={CoinDetailPage} />\n        <Route path=\"/docs\" component={Docs} />\n        <Route path=\"/faq\" component={FAQ} />\n        <Route path=\"/referrals\" component={Referrals} />\n        <Route path=\"/notifications\" component={Notifications} />\n        <Route component={NotFound} />\n      </Switch>\n    </AppLayout>\n  );\n}\n\nimport { AppPrivyProvider } from \"@/lib/privy-provider\";\nimport { WagmiProvider } from \"wagmi\";\nimport { config as wagmiConfig } from \"@/lib/wagmi\";\nimport { E1XPClaimModal } from \"@/components/e1xp-claim-modal\";\nimport { SplashScreen } from \"@/components/splash-screen\";\nimport { useState, useEffect } from \"react\";\n\nfunction App() {\n  const [showSplash, setShowSplash] = useState(true);\n  const [splashComplete, setSplashComplete] = useState(false);\n\n  useEffect(() => {\n    // Check if splash has been shown in this session\n    const hasShown = sessionStorage.getItem(\"splash-shown-v2\");\n    if (hasShown) {\n      setShowSplash(false);\n      setSplashComplete(true);\n    } else {\n      // Show splash for 2.5 seconds\n      const timer = setTimeout(() => {\n        setShowSplash(false);\n        sessionStorage.setItem(\"splash-shown-v2\", \"true\");\n        // Wait for fade out animation\n        setTimeout(() => setSplashComplete(true), 500);\n      }, 2500);\n      return () => clearTimeout(timer);\n    }\n  }, []);\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <WagmiProvider config={wagmiConfig}>\n        <AppPrivyProvider>\n          <ThemeProvider defaultTheme=\"dark\" storageKey=\"vite-ui-theme\">\n            <TooltipProvider>\n              {showSplash && <SplashScreen />}\n              {splashComplete && (\n                <>\n                  <Toaster />\n                  <E1XPClaimModal />\n                  <Router />\n                </>\n              )}\n            </TooltipProvider>\n          </ThemeProvider>\n        </AppPrivyProvider>\n      </WagmiProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;","size_bytes":4194},"client/src/components/user-menu.tsx":{"content":"import { useState } from \"react\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { useLocation } from \"wouter\";\nimport { LogOut, User } from \"lucide-react\";\n\n// Custom SVG icon components\nconst SettingsIcon = ({ className }: { className?: string }) => (\n  <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" className={className}>\n    <path d=\"M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeMiterlimit=\"10\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n    <path d=\"M1.66667 10.7333V9.26667C1.66667 8.4 2.36667 7.69167 3.24167 7.69167C4.65833 7.69167 5.25 6.6 4.54167 5.36667C4.13333 4.65833 4.375 3.74167 5.09167 3.33333L6.54167 2.5C7.15833 2.13333 7.95833 2.35 8.325 2.96667L8.41667 3.125C9.11667 4.35833 10.8833 4.35833 11.5917 3.125L11.6833 2.96667C12.05 2.35 12.85 2.13333 13.4667 2.5L14.9167 3.33333C15.6333 3.74167 15.875 4.65833 15.4667 5.36667C14.7583 6.6 15.35 7.69167 16.7667 7.69167C17.6333 7.69167 18.3417 8.39167 18.3417 9.26667V10.7333C18.3417 11.6 17.6417 12.3083 16.7667 12.3083C15.35 12.3083 14.7583 13.4 15.4667 14.6333C15.875 15.35 15.6333 16.2583 14.9167 16.6667L13.4667 17.5C12.85 17.8667 12.05 17.65 11.6833 17.0333L11.5917 16.875C10.8917 15.6417 9.125 15.6417 8.41667 16.875L8.325 17.0333C7.95833 17.65 7.15833 17.8667 6.54167 17.5L5.09167 16.6667C4.375 16.2583 4.13333 15.3417 4.54167 14.6333C5.25 13.4 4.65833 12.3083 3.24167 12.3083C2.36667 12.3083 1.66667 11.6 1.66667 10.7333Z\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeMiterlimit=\"10\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\n  </svg>\n);\n\nconst UsersIcon = ({ className }: { className?: string }) => (\n  <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" className={className}>\n    <path d=\"M7.5 2C5.32 2 3.54 3.78 3.54 5.96C3.54 8.11 5.21 9.83 7.4 9.91C7.46 9.9 7.52 9.9 7.56 9.91C7.58 9.91 7.59 9.91 7.6 9.91C7.61 9.91 7.61 9.91 7.62 9.91C9.77 9.83 11.45 8.11 11.46 5.96C11.46 3.78 9.68 2 7.5 2Z\" fill=\"currentColor\"/>\n    <path d=\"M11.73 11.79C9.41 10.24 5.61 10.24 3.27 11.79C2.21 12.5 1.62 13.46 1.62 14.48C1.62 15.5 2.21 16.45 3.26 17.16C4.42 17.94 5.96 18.33 7.5 18.33C9.04 18.33 10.58 17.94 11.73 17.16C12.78 16.45 13.37 15.5 13.37 14.47C13.36 13.45 12.78 12.49 11.73 11.79Z\" fill=\"currentColor\"/>\n    <path d=\"M16.66 6.11C16.79 7.73 15.64 9.15 14.05 9.34C14.04 9.34 14.04 9.34 14.03 9.34H14.01C13.96 9.34 13.91 9.34 13.87 9.35C12.89 9.39 12 9.14 11.34 8.66C12.18 7.9 12.69 6.75 12.58 5.5C12.53 4.9 12.34 4.37 12.07 3.93C12.37 3.79 12.72 3.69 13.08 3.66C14.73 3.5 16.52 4.47 16.66 6.11Z\" fill=\"currentColor\"/>\n    <path d=\"M18.33 13.82C18.26 14.63 17.74 15.33 16.88 15.81C16.04 16.27 14.99 16.48 13.95 16.46C14.55 15.92 14.9 15.24 14.97 14.52C15.05 13.49 14.56 12.5 13.58 11.71C12.96 11.23 12.27 10.84 11.5 10.57C13.5 9.96 15.82 10.48 17.24 11.63C18.01 12.25 18.4 13.02 18.33 13.82Z\" fill=\"currentColor\"/>\n  </svg>\n);\n\nconst FlameIcon = ({ className }: { className?: string }) => (\n  <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" className={className}>\n    <path d=\"M10.52 1.84C10.38 1.73 10.2 1.67 10 1.67C9.8 1.67 9.62 1.73 9.48 1.84C9.28 2.02 5 5.75 5 10.42C5 13.87 7.8 16.67 11.25 16.67C11.72 16.67 12.18 16.62 12.61 16.52C12.02 16.07 11.47 15.53 10.98 14.93C10.66 15.01 10.32 15.05 9.97 15.04C7.67 15.04 5.8 13.18 5.8 10.88C5.8 7.86 8.47 5.19 10 3.66C11.53 5.19 14.2 7.86 14.2 10.88C14.2 11.29 14.14 11.69 14.04 12.08C14.69 12.64 15.42 13.09 16.19 13.42C16.5 12.75 16.67 12.01 16.67 11.25C16.67 5.75 12.38 2.02 10.52 1.84Z\" fill=\"currentColor\"/>\n    <path d=\"M14.58 18.33C16.65 18.33 18.33 16.65 18.33 14.58C18.33 12.51 16.65 10.83 14.58 10.83C12.51 10.83 10.83 12.51 10.83 14.58C10.83 16.65 12.51 18.33 14.58 18.33Z\" fill=\"currentColor\"/>\n  </svg>\n);\n\nconst ZapIcon = ({ className }: { className?: string }) => (\n  <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" className={className}>\n    <path d=\"M11.67 1.67L5.42 10.83C5.08 11.33 5.42 12 6.08 12H9.17V18.33L15.42 9.17C15.75 8.67 15.42 8 14.75 8H11.67V1.67Z\" fill=\"currentColor\"/>\n  </svg>\n);\n\nconst HelpCircleIcon = ({ className }: { className?: string }) => (\n  <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" className={className}>\n    <path d=\"M10 1.67C5.41 1.67 1.67 5.41 1.67 10C1.67 14.59 5.41 18.33 10 18.33C14.59 18.33 18.33 14.59 18.33 10C18.33 5.41 14.59 1.67 10 1.67ZM9.38 6.67C9.38 6.33 9.66 6.04 10 6.04C10.8 6.04 11.46 6.7 11.46 7.5C11.46 8.03 11.18 8.52 10.74 8.78C10.4 8.99 10.21 9.37 10.21 9.76V10C10.21 10.34 9.93 10.62 9.58 10.62C9.24 10.62 8.96 10.34 8.96 10V9.76C8.96 8.93 9.41 8.16 10.14 7.74C10.34 7.62 10.21 7.57 10.21 7.5C10.21 7.38 10.12 7.29 10 7.29C9.66 7.29 9.38 7.01 9.38 6.67ZM10.77 13.65C10.73 13.76 10.67 13.84 10.59 13.93C10.51 14.01 10.43 14.06 10.32 14.1C10.22 14.14 10.11 14.17 10 14.17C9.89 14.17 9.78 14.14 9.68 14.1C9.58 14.06 9.49 14.01 9.41 13.93C9.33 13.84 9.28 13.76 9.23 13.65C9.19 13.55 9.17 13.44 9.17 13.33C9.17 13.23 9.19 13.12 9.23 13.02C9.28 12.91 9.33 12.83 9.41 12.74C9.49 12.67 9.58 12.61 9.68 12.57C9.88 12.48 10.12 12.48 10.32 12.57C10.43 12.61 10.51 12.67 10.59 12.74C10.67 12.83 10.73 12.91 10.77 13.02C10.81 13.12 10.83 13.23 10.83 13.33C10.83 13.44 10.81 13.55 10.77 13.65Z\" fill=\"currentColor\"/>\n  </svg>\n);\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { useQuery } from \"@tanstack/react-query\";\nexport function UserMenu() {\n  const { login, logout, authenticated, user } = usePrivy();\n  const [, setLocation] = useLocation();\n\n  const handleLogin = () => {\n    try {\n      login();\n    } catch (error) {\n      console.error(\"Login error:\", error);\n    }\n  };\n\n  if (!authenticated) {\n    return (\n      <Button \n        onClick={handleLogin} \n        variant=\"default\" \n        size=\"sm\" \n        className=\"bg-gradient-to-r from-purple-400 via-pink-400 to-blue-300 text-black font-semibold border-0 hover:opacity-90\"\n        data-testid=\"button-login\"\n      >\n        Login\n      </Button>\n    );\n  }\n\n  const address = user?.wallet?.address || \"\";\n  const email = user?.email?.address || \"\";\n  \n  // Better fallback for email users\n  const emailUsername = email ? email.split('@')[0] : null;\n  const displayName = address\n    ? `${address.slice(0, 6)}...${address.slice(-4)}`\n    : emailUsername || \"Creator\";\n\n  const privyId = user?.id;\n  \n  const { data: creatorData } = useQuery({\n    queryKey: ['/api/creators/privy', privyId],\n    enabled: !!privyId && authenticated,\n  });\n\n  const avatarUrl = (creatorData as any)?.avatar || \"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\";\n\n  const userName = (creatorData as any)?.name || displayName;\n  const userEmail = `${address.slice(0, 6)}...${address.slice(-4)}`;\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" className=\"relative h-9 w-9 rounded-full ring-2 ring-transparent hover:ring-primary/20 transition-all\" data-testid=\"button-user-menu\">\n          <Avatar className=\"h-9 w-9\">\n            <AvatarImage src={avatarUrl} alt={userName} />\n            <AvatarFallback className=\"bg-gradient-to-br from-purple-400 to-pink-400\">\n              <User className=\"h-4 w-4 text-white\" />\n            </AvatarFallback>\n          </Avatar>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent className=\"w-56 p-0 rounded-2xl\" align=\"end\" forceMount>\n        {/* User Info Header - Compact */}\n        <div className=\"p-3 border-b bg-muted/30\">\n          <div className=\"flex items-center gap-2\">\n            <Avatar className=\"h-9 w-9\">\n              <AvatarImage src={avatarUrl} alt={userName} />\n              <AvatarFallback className=\"bg-gradient-to-br from-purple-400 to-pink-400 text-xs\">\n                <User className=\"h-4 w-4 text-white\" />\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"flex flex-col flex-1 min-w-0\">\n              <p className=\"text-sm font-semibold leading-tight truncate\" data-testid=\"text-user-menu-name\">\n                {userName}\n              </p>\n              <p className=\"text-[10px] text-muted-foreground truncate\" data-testid=\"text-user-menu-email\">\n                {userEmail}\n              </p>\n            </div>\n          </div>\n        </div>\n        \n        {/* Menu Items - Compact */}\n        <div className=\"p-1\">\n          <DropdownMenuItem \n            onClick={() => setLocation(\"/profile\")}\n            className=\"cursor-pointer py-2 px-2 rounded-md\"\n            data-testid=\"menu-item-profile\"\n          >\n            <User className=\"mr-2 h-4 w-4\" />\n            <span className=\"text-sm\">Profile</span>\n          </DropdownMenuItem>\n          \n          <DropdownMenuItem \n            onClick={() => setLocation(\"/streaks\")}\n            className=\"cursor-pointer py-2 px-2 rounded-md\"\n            data-testid=\"menu-item-streaks\"\n          >\n            <FlameIcon className=\"mr-2 h-4 w-4\" />\n            <span className=\"text-sm\">Streaks</span>\n          </DropdownMenuItem>\n          \n          <DropdownMenuItem \n            onClick={() => setLocation(\"/points\")}\n            className=\"cursor-pointer py-2 px-2 rounded-md\"\n            data-testid=\"menu-item-points\"\n          >\n            <ZapIcon className=\"mr-2 h-4 w-4\" />\n            <span className=\"text-sm\">E1XP Points</span>\n          </DropdownMenuItem>\n          \n          <DropdownMenuItem \n            onClick={() => setLocation(\"/referrals\")}\n            className=\"cursor-pointer py-2 px-2 rounded-md\"\n            data-testid=\"menu-item-referrals\"\n          >\n            <UsersIcon className=\"mr-2 h-4 w-4\" />\n            <span className=\"text-sm\">Referrals</span>\n          </DropdownMenuItem>\n          \n          <DropdownMenuItem \n            onClick={() => setLocation(\"/creators\")}\n            className=\"cursor-pointer py-2 px-2 rounded-md\"\n            data-testid=\"menu-item-community\"\n          >\n            <UsersIcon className=\"mr-2 h-4 w-4\" />\n            <span className=\"text-sm\">Community</span>\n          </DropdownMenuItem>\n          \n          <DropdownMenuItem \n            className=\"cursor-pointer py-2 px-2 rounded-md\"\n            data-testid=\"menu-item-settings\"\n          >\n            <SettingsIcon className=\"mr-2 h-4 w-4\" />\n            <span className=\"text-sm\">Settings</span>\n          </DropdownMenuItem>\n          \n          <DropdownMenuSeparator className=\"my-1\" />\n          \n          <DropdownMenuItem \n            className=\"cursor-pointer py-2 px-2 rounded-md\"\n            data-testid=\"menu-item-help\"\n          >\n            <HelpCircleIcon className=\"mr-2 h-4 w-4\" />\n            <span className=\"text-sm\">Help</span>\n          </DropdownMenuItem>\n          \n          <DropdownMenuItem \n            onClick={logout}\n            className=\"cursor-pointer py-2 px-2 rounded-md text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-950/20\"\n            data-testid=\"menu-item-signout\"\n          >\n            <LogOut className=\"mr-2 h-4 w-4\" />\n            <span className=\"text-sm\">Sign out</span>\n          </DropdownMenuItem>\n        </div>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","size_bytes":11576},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"server/notification-service.ts":{"content":"import { storage } from './supabase-storage';\nimport { sendTelegramNotification } from './telegram-bot';\nimport type { Reward, Creator, Coin } from '@shared/schema';\n\n// Randomized earnings notification messages\nconst EARNINGS_MESSAGES = [\n  \"üí∞ Ka-ching! You've earned {amount} from {coin}!\",\n  \"üéâ Great news! {amount} just landed in your wallet from {coin}\",\n  \"üíé You're making moves! {amount} earned from {coin}\",\n  \"üî• Hot earnings alert! {amount} from {coin} is yours\",\n  \"‚ö° Zap! {amount} just hit your account from {coin}\",\n  \"üåü Success! You've earned {amount} from {coin} trades\",\n  \"üí∏ Money alert! {amount} from {coin} arrived\",\n  \"üéØ Bulls-eye! {amount} earned from {coin}\",\n  \"üöÄ To the moon! {amount} from {coin} deposited\",\n  \"üíµ Cha-ching! {amount} from {coin} is in your wallet\",\n  \"üèÜ Winner! You earned {amount} from {coin}\",\n  \"‚ú® Sweet! {amount} from {coin} just dropped\",\n];\n\nconst TOP_TRADER_MESSAGES = [\n  \"üî• {trader} is on fire! Earned {amount} in the last {period}\",\n  \"üíé Whale alert! {trader} made {amount} in {period}\",\n  \"üöÄ {trader} just crushed it with {amount} in {period}!\",\n  \"‚ö° Power move! {trader} earned {amount} in {period}\",\n  \"üëë King of trades! {trader} made {amount} in {period}\",\n  \"üéØ Perfect execution! {trader} earned {amount} in {period}\",\n  \"üí∞ Big money! {trader} raked in {amount} in {period}\",\n  \"üåü Star trader {trader} earned {amount} in {period}\",\n  \"üîÆ Magic touch! {trader} made {amount} in {period}\",\n];\n\n// Format number with commas\nfunction formatNumber(num: number | string): string {\n  const n = typeof num === 'string' ? parseFloat(num) : num;\n  if (isNaN(n)) return '0.00';\n  return n.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n}\n\n// Format address\nfunction formatAddress(address: string): string {\n  if (!address) return 'Unknown';\n  return `${address.slice(0, 6)}...${address.slice(-4)}`;\n}\n\n// Calculate time periods\nfunction getTimePeriod(hours: number): Date {\n  const now = new Date();\n  return new Date(now.getTime() - hours * 60 * 60 * 1000);\n}\n\nexport class NotificationService {\n  \n  // Send daily login streak notification\n  async notifyDailyLoginStreak(userAddress: string, streak: number, pointsEarned: number): Promise<void> {\n    const messages = [\n      `üî• ${streak} day streak! You earned ${pointsEarned} E1XP!`,\n      `‚ö° Amazing! ${streak} days in a row! +${pointsEarned} E1XP`,\n      `üí™ Keep it up! ${streak} day streak = ${pointsEarned} E1XP`,\n      `üåü ${streak} days strong! Earned ${pointsEarned} E1XP!`,\n    ];\n    \n    const message = messages[Math.floor(Math.random() * messages.length)];\n    const title = `üî• ${streak} Day Streak!`;\n\n    await storage.createNotification({\n      userId: userAddress,\n      type: 'streak',\n      title,\n      message,\n      amount: pointsEarned.toString(),\n      createdAt: new Date(),\n    });\n\n    await sendTelegramNotification(userAddress, title, message, 'streak');\n  }\n\n  // Send E1XP claim reminder\n  async notifyE1XPClaimReminder(userAddress: string, availablePoints: number): Promise<void> {\n    const title = `‚è∞ Don't Forget Your E1XP!`;\n    const message = `You have ${availablePoints} E1XP waiting to be claimed! Don't break your streak!`;\n\n    await storage.createNotification({\n      userId: userAddress,\n      type: 'reminder',\n      title,\n      message,\n      amount: availablePoints.toString(),\n      createdAt: new Date(),\n    });\n\n    await sendTelegramNotification(userAddress, title, message, 'reminder');\n  }\n\n  // Send referral notification to referrer\n  async notifyReferralEarned(referrerAddress: string, referredUser: string, bonusPoints: number): Promise<void> {\n    const title = `üéâ Referral Bonus!`;\n    const message = `${formatAddress(referredUser)} joined using your referral! You earned ${bonusPoints} E1XP (2x bonus)`;\n\n    await storage.createNotification({\n      userId: referrerAddress,\n      type: 'referral',\n      title,\n      message,\n      amount: bonusPoints.toString(),\n      createdAt: new Date(),\n    });\n\n    await sendTelegramNotification(referrerAddress, title, message, 'referral');\n  }\n\n  // Send new trade notification\n  async notifyNewTrade(userAddress: string, coinSymbol: string, tradeType: 'buy' | 'sell', amount: string, earnedPoints?: number): Promise<void> {\n    const emoji = tradeType === 'buy' ? 'üí∞' : 'üí∏';\n    const action = tradeType === 'buy' ? 'Bought' : 'Sold';\n    const title = `${emoji} ${action} ${coinSymbol}!`;\n    let message = `Successfully ${action.toLowerCase()} ${coinSymbol} for ${amount}`;\n    \n    if (earnedPoints) {\n      message += ` | +${earnedPoints} E1XP earned!`;\n    }\n\n    await storage.createNotification({\n      userId: userAddress,\n      type: 'trade',\n      title,\n      message,\n      coinSymbol,\n      amount: earnedPoints?.toString(),\n      createdAt: new Date(),\n    });\n\n    await sendTelegramNotification(userAddress, title, message, 'trade');\n  }\n\n  // Send E1XP points earned notification\n  async notifyE1XPEarned(userAddress: string, points: number, reason: string): Promise<void> {\n    const title = `‚ö° E1XP Earned!`;\n    const message = `You earned ${points} E1XP for ${reason}`;\n\n    await storage.createNotification({\n      userId: userAddress,\n      type: 'points',\n      title,\n      message,\n      amount: points.toString(),\n      createdAt: new Date(),\n    });\n\n    await sendTelegramNotification(userAddress, title, message, 'points');\n  }\n\n  // Send welcome bonus notification for new users\n  async notifyWelcomeBonus(userAddress: string): Promise<void> {\n    const title = `üéÅ Welcome to Every1Fun!`;\n    const message = `You earned 10 E1XP as a welcome bonus! Come back daily to earn more points and build your streak! üî•`;\n\n    await storage.createNotification({\n      userId: userAddress,\n      type: 'reward',\n      title,\n      message,\n      amount: '10',\n      createdAt: new Date(),\n    });\n\n    await sendTelegramNotification(userAddress, title, message, 'reward');\n  }\n\n  // Send new creators to follow notification\n  async notifyNewCreatorsToFollow(userAddress: string, creators: Creator[]): Promise<void> {\n    const title = `üë• Discover New Creators!`;\n    const creatorNames = creators.slice(0, 3).map(c => c.name || formatAddress(c.address)).join(', ');\n    const message = `Check out these trending creators: ${creatorNames}${creators.length > 3 ? ` and ${creators.length - 3} more!` : ''}`;\n\n    await storage.createNotification({\n      userId: userAddress,\n      type: 'creator_suggestion',\n      title,\n      message,\n    });\n\n    await sendTelegramNotification(userAddress, title, message, 'creator_suggestion');\n  }\n\n  // Send new follower notification\n  async notifyNewFollower(creatorAddress: string, followerAddress: string): Promise<void> {\n    const title = `üéâ New Follower!`;\n    const message = `${formatAddress(followerAddress)} started following you!`;\n\n    await storage.createNotification({\n      userId: creatorAddress,\n      type: 'follower',\n      title,\n      message,\n    });\n\n    await sendTelegramNotification(creatorAddress, title, message, 'follower');\n  }\n\n  // Send new coin notification\n  async notifyNewCoin(userAddress: string, coin: Coin): Promise<void> {\n    const title = `ü™ô New Coin Alert!`;\n    const message = `${coin.name} (${coin.symbol}) just launched! Be an early trader and earn rewards!`;\n\n    await storage.createNotification({\n      userId: userAddress,\n      type: 'coin_created',\n      title,\n      message,\n      coinAddress: coin.address,\n      coinSymbol: coin.symbol,\n    });\n\n    await sendTelegramNotification(userAddress, title, message, 'coin_created');\n  }\n\n  // Send coin created success notification to creator\n  async notifyCoinCreated(creatorAddress: string, coin: Coin): Promise<void> {\n    const title = `üéä Coin Created Successfully!`;\n    const message = `Your coin ${coin.name} (${coin.symbol}) is now live! Share it to get more holders and earn rewards!`;\n\n    await storage.createNotification({\n      userId: creatorAddress,\n      type: 'coin_created',\n      title,\n      message,\n      coinAddress: coin.address,\n      coinSymbol: coin.symbol,\n    });\n\n    await sendTelegramNotification(creatorAddress, title, message, 'coin_created');\n  }\n\n  // Send milestone notification\n  async notifyMilestone(userAddress: string, milestone: string, reward?: number): Promise<void> {\n    const title = `üèÜ Milestone Reached!`;\n    let message = `Congratulations! You've ${milestone}`;\n    \n    if (reward) {\n      message += ` | +${reward} E1XP bonus!`;\n    }\n\n    await storage.createNotification({\n      userId: userAddress,\n      type: 'milestone',\n      title,\n      message,\n      amount: reward?.toString(),\n    });\n\n    await sendTelegramNotification(userAddress, title, message, 'milestone');\n  }\n\n  // Get top creators by total volume\n  async getTopCreatorsByVolume(limit: number = 10): Promise<Creator[]> {\n    const creators = await storage.getAllCreators();\n    return creators\n      .sort((a, b) => parseFloat(b.totalVolume || '0') - parseFloat(a.totalVolume || '0'))\n      .slice(0, limit);\n  }\n\n  // Get top creators by points\n  async getTopCreatorsByPoints(limit: number = 10): Promise<Creator[]> {\n    const creators = await storage.getAllCreators();\n    return creators\n      .sort((a, b) => parseFloat(b.points || '0') - parseFloat(a.points || '0'))\n      .slice(0, limit);\n  }\n\n  // Get top earners from rewards\n  async getTopEarners(limit: number = 10, hoursAgo?: number): Promise<Array<{address: string, totalEarnings: number, rewardCount: number}>> {\n    const rewards = await storage.getAllRewards();\n    \n    // Filter by time if specified\n    let filteredRewards = rewards;\n    if (hoursAgo) {\n      const cutoff = getTimePeriod(hoursAgo);\n      filteredRewards = rewards.filter(r => new Date(r.createdAt) >= cutoff);\n    }\n\n    // Aggregate earnings by recipient\n    const earningsMap = new Map<string, { totalEarnings: number, rewardCount: number }>();\n    \n    for (const reward of filteredRewards) {\n      const current = earningsMap.get(reward.recipientAddress) || { totalEarnings: 0, rewardCount: 0 };\n      const amount = parseFloat(reward.rewardAmount) / 1e18; // Convert from wei to ETH\n      current.totalEarnings += amount;\n      current.rewardCount += 1;\n      earningsMap.set(reward.recipientAddress, current);\n    }\n\n    // Convert to array and sort\n    return Array.from(earningsMap.entries())\n      .map(([address, data]) => ({ address, ...data }))\n      .sort((a, b) => b.totalEarnings - a.totalEarnings)\n      .slice(0, limit);\n  }\n\n  // Get top coins (you can customize the metric)\n  async getTopCoins(limit: number = 10): Promise<Coin[]> {\n    const coins = await storage.getAllCoins();\n    // For now, sort by creation date (most recent first)\n    // You can modify this to sort by volume or other metrics when available\n    return coins\n      .filter(c => c.status === 'active' && c.address)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n      .slice(0, limit);\n  }\n\n  // Get recent trades (based on recent rewards)\n  async getRecentTrades(limit: number = 20): Promise<Reward[]> {\n    const rewards = await storage.getAllRewards();\n    return rewards\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n      .slice(0, limit);\n  }\n\n  // Send earnings notification with randomized message\n  async notifyUserEarnings(userAddress: string, reward: Reward): Promise<void> {\n    const amount = (parseFloat(reward.rewardAmount) / 1e18).toFixed(4);\n    const template = EARNINGS_MESSAGES[Math.floor(Math.random() * EARNINGS_MESSAGES.length)];\n    \n    const message = template\n      .replace('{amount}', `${amount} ${reward.rewardCurrency}`)\n      .replace('{coin}', reward.coinSymbol);\n\n    const title = `üí∞ Earnings Received!`;\n    \n    // Save to database\n    await storage.createNotification({\n      userId: userAddress,\n      type: 'reward',\n      title,\n      message,\n      coinAddress: reward.coinAddress,\n      coinSymbol: reward.coinSymbol,\n      amount: reward.rewardAmount,\n      transactionHash: reward.transactionHash,\n      createdAt: new Date(),\n    });\n\n    // Send to Telegram\n    await sendTelegramNotification(\n      userAddress,\n      title,\n      message,\n      'reward'\n    );\n  }\n\n  // Notify about top traders\n  async notifyTopTraders(hours: number): Promise<void> {\n    const topEarners = await this.getTopEarners(5, hours);\n    \n    if (topEarners.length === 0) return;\n\n    const periodText = hours <= 10 ? `${hours} hours` : \n                       hours === 24 ? '24 hours' :\n                       `${Math.floor(hours / 24)} days`;\n\n    for (const earner of topEarners) {\n      const template = TOP_TRADER_MESSAGES[Math.floor(Math.random() * TOP_TRADER_MESSAGES.length)];\n      const message = template\n        .replace('{trader}', formatAddress(earner.address))\n        .replace('{amount}', `$${formatNumber(earner.totalEarnings)}`)\n        .replace('{period}', periodText);\n\n      const title = `üèÜ Top Trader Alert - ${periodText}`;\n\n      // Broadcast to channel\n      const TELEGRAM_CHANNEL_ID = process.env.TELEGRAM_CHANNEL_ID;\n      if (TELEGRAM_CHANNEL_ID) {\n        try {\n          const { bot } = await import('./telegram-bot');\n          if (bot) {\n            await bot.sendMessage(\n              TELEGRAM_CHANNEL_ID,\n              `${title}\\n\\n${message}\\n\\nüíé Trader: [${formatAddress(earner.address)}](https://zora.co/profile/${earner.address})\\nüìä Total Earnings: $${formatNumber(earner.totalEarnings)}\\nüéØ Trades: ${earner.rewardCount}`,\n              { parse_mode: 'Markdown', disable_web_page_preview: false }\n            );\n          }\n        } catch (error) {\n          console.error('Error broadcasting top trader:', error);\n        }\n      }\n    }\n  }\n\n  // Send top creators notification\n  async sendTopCreatorsNotification(): Promise<void> {\n    const topCreators = await this.getTopCreatorsByVolume(10);\n    \n    if (topCreators.length === 0) return;\n\n    let message = `üëë TOP CREATORS BY VOLUME\\n\\n`;\n    \n    topCreators.forEach((creator, index) => {\n      const volume = parseFloat(creator.totalVolume || '0');\n      message += `${index + 1}. ${creator.name || formatAddress(creator.address)}\\n`;\n      message += `   üí∞ Volume: $${formatNumber(volume)}\\n`;\n      message += `   ü™ô Coins: ${creator.totalCoins}\\n`;\n      message += `   ‚≠ê Points: ${formatNumber(parseFloat(creator.points || '0'))}\\n\\n`;\n    });\n\n    const title = `üëë Top Creators Leaderboard`;\n\n    // Broadcast to channel\n    const TELEGRAM_CHANNEL_ID = process.env.TELEGRAM_CHANNEL_ID;\n    if (TELEGRAM_CHANNEL_ID) {\n      try {\n        const { bot } = await import('./telegram-bot');\n        if (bot) {\n          await bot.sendMessage(\n            TELEGRAM_CHANNEL_ID,\n            `${title}\\n\\n${message}`,\n            { parse_mode: 'Markdown', disable_web_page_preview: true }\n          );\n        }\n      } catch (error) {\n        console.error('Error broadcasting top creators:', error);\n      }\n    }\n  }\n\n  // Send top earners notification\n  async sendTopEarnersNotification(hours?: number): Promise<void> {\n    const topEarners = await this.getTopEarners(10, hours);\n    \n    if (topEarners.length === 0) return;\n\n    const periodText = hours ? \n      (hours <= 10 ? `${hours} hours` : \n       hours === 24 ? '24 hours' :\n       `${Math.floor(hours / 24)} days`) : \n      'All Time';\n\n    let message = `üíé TOP EARNERS - ${periodText.toUpperCase()}\\n\\n`;\n    \n    topEarners.forEach((earner, index) => {\n      message += `${index + 1}. [${formatAddress(earner.address)}](https://zora.co/profile/${earner.address})\\n`;\n      message += `   üí∞ Earnings: $${formatNumber(earner.totalEarnings)}\\n`;\n      message += `   üéØ Trades: ${earner.rewardCount}\\n\\n`;\n    });\n\n    const title = `üíé Top Earners - ${periodText}`;\n\n    // Broadcast to channel\n    const TELEGRAM_CHANNEL_ID = process.env.TELEGRAM_CHANNEL_ID;\n    if (TELEGRAM_CHANNEL_ID) {\n      try {\n        const { bot } = await import('./telegram-bot');\n        if (bot) {\n          await bot.sendMessage(\n            TELEGRAM_CHANNEL_ID,\n            `${title}\\n\\n${message}`,\n            { parse_mode: 'Markdown', disable_web_page_preview: false }\n          );\n        }\n      } catch (error) {\n        console.error('Error broadcasting top earners:', error);\n      }\n    }\n  }\n\n  // Send top coins notification\n  async sendTopCoinsNotification(): Promise<void> {\n    const topCoins = await this.getTopCoins(10);\n    \n    if (topCoins.length === 0) return;\n\n    let message = `üèÜ TOP TRENDING COINS\\n\\n`;\n    \n    topCoins.forEach((coin, index) => {\n      message += `${index + 1}. *${coin.name}* (${coin.symbol})\\n`;\n      message += `   üë§ Creator: [${formatAddress(coin.creator_wallet)}](https://zora.co/profile/${coin.creator_wallet})\\n`;\n      if (coin.address) {\n        message += `   üîó [Trade Now](https://zora.co/creator-coins/base:${coin.address})\\n`;\n      }\n      message += `\\n`;\n    });\n\n    const title = `üèÜ Top Trending Coins`;\n\n    // Broadcast to channel\n    const TELEGRAM_CHANNEL_ID = process.env.TELEGRAM_CHANNEL_ID;\n    if (TELEGRAM_CHANNEL_ID) {\n      try {\n        const { bot } = await import('./telegram-bot');\n        if (bot) {\n          await bot.sendMessage(\n            TELEGRAM_CHANNEL_ID,\n            `${title}\\n\\n${message}`,\n            { parse_mode: 'Markdown', disable_web_page_preview: false }\n          );\n        }\n      } catch (error) {\n        console.error('Error broadcasting top coins:', error);\n      }\n    }\n  }\n\n  // Send top points earners notification\n  async sendTopPointsNotification(): Promise<void> {\n    const topCreators = await this.getTopCreatorsByPoints(10);\n    \n    if (topCreators.length === 0) return;\n\n    let message = `‚≠ê TOP POINTS EARNERS\\n\\n`;\n    \n    topCreators.forEach((creator, index) => {\n      const points = parseFloat(creator.points || '0');\n      message += `${index + 1}. ${creator.name || formatAddress(creator.address)}\\n`;\n      message += `   ‚≠ê Points: ${formatNumber(points)}\\n`;\n      message += `   ü™ô Coins: ${creator.totalCoins}\\n`;\n      message += `   üìä Volume: $${formatNumber(parseFloat(creator.totalVolume || '0'))}\\n\\n`;\n    });\n\n    const title = `‚≠ê Top Points Earners`;\n\n    // Broadcast to channel\n    const TELEGRAM_CHANNEL_ID = process.env.TELEGRAM_CHANNEL_ID;\n    if (TELEGRAM_CHANNEL_ID) {\n      try {\n        const { bot } = await import('./telegram-bot');\n        if (bot) {\n          await bot.sendMessage(\n            TELEGRAM_CHANNEL_ID,\n            `${title}\\n\\n${message}`,\n            { parse_mode: 'Markdown', disable_web_page_preview: true }\n          );\n        }\n      } catch (error) {\n        console.error('Error broadcasting top points:', error);\n      }\n    }\n  }\n\n  // Send recent trades notification\n  async sendRecentTradesNotification(): Promise<void> {\n    const recentTrades = await this.getRecentTrades(10);\n    \n    if (recentTrades.length === 0) return;\n\n    let message = `üìä RECENT TRADING ACTIVITY\\n\\n`;\n    \n    recentTrades.forEach((trade, index) => {\n      const amount = (parseFloat(trade.rewardAmount) / 1e18).toFixed(4);\n      message += `${index + 1}. ${trade.coinSymbol}\\n`;\n      message += `   üí∞ ${amount} ${trade.rewardCurrency}\\n`;\n      message += `   üë§ [${formatAddress(trade.recipientAddress)}](https://zora.co/profile/${trade.recipientAddress})\\n`;\n      message += `   üîó [Tx](https://basescan.org/tx/${trade.transactionHash})\\n\\n`;\n    });\n\n    const title = `üìä Recent Trades`;\n\n    // Broadcast to channel\n    const TELEGRAM_CHANNEL_ID = process.env.TELEGRAM_CHANNEL_ID;\n    if (TELEGRAM_CHANNEL_ID) {\n      try {\n        const { bot } = await import('./telegram-bot');\n        if (bot) {\n          await bot.sendMessage(\n            TELEGRAM_CHANNEL_ID,\n            `${title}\\n\\n${message}`,\n            { parse_mode: 'Markdown', disable_web_page_preview: false }\n          );\n        }\n      } catch (error) {\n        console.error('Error broadcasting recent trades:', error);\n      }\n    }\n  }\n\n  // Weekly top earners (convenience method)\n  async sendWeeklyTopEarnersNotification(): Promise<void> {\n    await this.sendTopEarnersNotification(24 * 7); // 7 days\n  }\n\n  // Send all periodic notifications\n  async sendAllPeriodicNotifications(): Promise<void> {\n    console.log('üì¢ Sending periodic notifications...');\n    \n    try {\n      await this.sendTopCreatorsNotification();\n      await this.sendTopEarnersNotification(24); // 24h\n      await this.sendTopCoinsNotification();\n      await this.sendTopPointsNotification();\n      await this.sendRecentTradesNotification();\n      \n      console.log('‚úÖ All periodic notifications sent successfully');\n    } catch (error) {\n      console.error('‚ùå Error sending periodic notifications:', error);\n    }\n  }\n}\n\nexport const notificationService = new NotificationService();\n","size_bytes":20987},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/coin-card.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { TrendingUp, User, Coins, Sparkles } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { cn, formatSmartCurrency } from \"@/lib/utils\";\nimport { getCoin } from \"@zoralabs/coins-sdk\";\nimport { base } from \"viem/chains\";\n\ninterface CoinCardProps {\n  coin: {\n    id: string;\n    name: string;\n    symbol: string;\n    address: string;\n    image?: string;\n    marketCap?: string;\n    volume24h?: string;\n    holders?: number;\n    creator?: string;\n    createdAt?: string;\n    category?: string;\n    platform?: string;\n    chain?: string; // Added for platform coin check\n    __typename?: string; // Added for platform coin check\n  };\n  className?: string;\n  onClick?: () => void;\n}\n\nexport function CoinCard({ coin, className, onClick }: CoinCardProps) {\n  const [imageError, setImageError] = useState(false);\n  const [liveMarketCap, setLiveMarketCap] = useState<string | null>(null);\n  const [liveVolume, setLiveVolume] = useState<string | null>(null);\n  const [liveHolders, setLiveHolders] = useState<number | null>(null);\n  const [creatorEarnings, setCreatorEarnings] = useState<number>(0);\n  const [coinImage, setCoinImage] = useState<string | null>(null);\n  const [creatorAvatar, setCreatorAvatar] = useState<string | null>(null);\n\n  // Use platform logo as fallback avatar\n  const fallbackAvatar = \"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\";\n\n  // Format holders count\n  const formatHolders = (count: number): string => {\n    if (count >= 1000000) {\n      return `${Math.floor(count / 1000000)}m`;\n    } else if (count >= 1000) {\n      return `${Math.floor(count / 1000)}k`;\n    }\n    return count.toString();\n  };\n\n  useEffect(() => {\n    async function fetchCoinData() {\n      if (!coin.address) return;\n\n      try {\n        const response = await getCoin({\n          address: coin.address as `0x${string}`,\n          chain: base.id,\n        });\n\n        const coinData = response.data?.zora20Token;\n        if (coinData) {\n          // Market Cap\n          if (coinData.marketCap !== null && coinData.marketCap !== undefined) {\n            const mcValue =\n              typeof coinData.marketCap === \"string\"\n                ? coinData.marketCap\n                : coinData.marketCap.toString();\n            setLiveMarketCap(mcValue);\n          }\n\n          // Volume 24h\n          if (coinData.volume24h !== null && coinData.volume24h !== undefined) {\n            const volValue =\n              typeof coinData.volume24h === \"string\"\n                ? coinData.volume24h\n                : coinData.volume24h.toString();\n            setLiveVolume(volValue);\n          }\n\n          // Holders count - use any type cast for Zora SDK response\n          const coinDataAny = coinData as any;\n          if (\n            coinDataAny.uniqueHolders !== null &&\n            coinDataAny.uniqueHolders !== undefined\n          ) {\n            setLiveHolders(coinDataAny.uniqueHolders);\n          }\n\n          // Coin image from metadata\n          if (coinData.mediaContent?.previewImage) {\n            const previewImage = coinData.mediaContent.previewImage as any;\n            setCoinImage(previewImage.medium || previewImage.small || null);\n          }\n\n          // Creator avatar from Zora\n          if (coinDataAny.creatorProfile?.avatar) {\n            setCreatorAvatar(coinDataAny.creatorProfile.avatar);\n          }\n\n          // Creator earnings from Zora\n          if (\n            coinDataAny.creatorEarnings &&\n            coinDataAny.creatorEarnings.length > 0\n          ) {\n            const earningAmount = parseFloat(\n              String(\n                coinDataAny.creatorEarnings[0].amountUsd ||\n                  coinDataAny.creatorEarnings[0].amount?.amountDecimal ||\n                  \"0\",\n              ),\n            );\n            setCreatorEarnings(earningAmount);\n          }\n        }\n      } catch (error) {\n        console.error(\"Error fetching Zora coin data:\", error);\n      }\n    }\n\n    fetchCoinData();\n  }, [coin.address]);\n\n  const formattedMarketCap = formatSmartCurrency(\n    liveMarketCap || coin.marketCap,\n  );\n\n  // Check if this is a platform coin (not from Zora SDK)\n  const isPlatformCoin = !coin.chain && !coin.__typename;\n\n  return (\n    <Card\n      onClick={onClick}\n      className={cn(\n        \"group relative overflow-hidden rounded-3xl border-border/50 bg-card cursor-pointer transition-all duration-300 hover:shadow-xl hover:shadow-primary/10 hover:-translate-y-1\",\n        className,\n      )}\n    >\n      {/* Coin Image */}\n      <div className=\"relative w-full aspect-square bg-gradient-to-br from-muted/20 to-muted/10 overflow-hidden\">\n        <div className=\"absolute top-1.5 left-1.5 flex items-center gap-0.5 rounded px-1.5 py-0.5 z-10\">\n          <span className=\"text-[8px] text-muted-foreground font-medium\">\n            {coin.createdAt\n              ? new Date(coin.createdAt).toLocaleDateString(\"en-US\", {\n                  month: \"short\",\n                  day: \"numeric\",\n                })\n              : new Date().toLocaleDateString(\"en-US\", {\n                  month: \"short\",\n                  day: \"numeric\",\n                })}\n          </span>\n        </div>\n\n        {(coin.category?.toLowerCase() === \"zora\" ||\n          coin.platform?.toLowerCase() === \"zora\") && (\n          <div className=\"absolute top-1.5 right-1.5 z-10\">\n            <div className=\"w-5 h-5 rounded-full overflow-hidden backdrop-blur-sm flex items-center justify-center\">\n              <img src=\"\" alt=\"Zora\" className=\"w-full h-full object-contain\" />\n            </div>\n          </div>\n        )}\n\n        {isPlatformCoin && (\n          <div className=\"absolute top-1.5 right-1.5 z-10\">\n            <img\n              src=\"https://i.ibb.co/rK4mPf4Q/e1-logo.png\"\n              alt=\"Platform\"\n              className=\"w-4 h-4 object-contain\"\n            />\n          </div>\n        )}\n\n        {(coinImage || coin.image) && !imageError ? (\n          <img\n            src={coinImage || coin.image}\n            alt={coin.name}\n            className=\"w-full h-full object-cover\"\n            onError={() => setImageError(true)}\n          />\n        ) : (\n          <div className=\"w-full h-full flex items-center justify-center\">\n            <Coins className=\"w-8 h-8 text-primary/40\" />\n          </div>\n        )}\n      </div>\n\n      {/* Coin Info */}\n      <div className=\"p-2 space-y-1.5 flex-1 flex flex-col\">\n        <div className=\"flex-1 flex items-start justify-between\">\n          <div className=\"flex items-start justify-between gap-2 mb-1\">\n            <div className=\"flex items-center gap-1.5 flex-1 min-w-0\">\n              <h3 className=\"font-semibold text-sm md:text-base truncate\">\n                {coin.name}\n              </h3>\n            </div>\n            <span className=\"text-xs md:text-sm text-muted-foreground font-mono shrink-0\">\n              {coin.symbol}\n            </span>\n          </div>\n          {(creatorAvatar || fallbackAvatar) && (\n            <Avatar className=\"w-4 h-4 ring-1 ring-primary/20\">\n              <AvatarImage src={creatorAvatar || fallbackAvatar || undefined} />\n              <AvatarFallback className=\"bg-primary/10 text-primary text-[6px]\">\n                {coin.creator?.slice(0, 2).toUpperCase() || \"??\"}\n              </AvatarFallback>\n            </Avatar>\n          )}\n        </div>\n\n        {/* Stats */}\n        <div className=\"space-y-1 pt-1.5 border-t border-border/50\">\n          <div className=\"flex items-center justify-between text-[10px]\">\n            <div className=\"flex items-center gap-0.5\">\n              <TrendingUp className=\"h-2.5 w-2.5 text-green-500\" />\n              <span className=\"text-muted-foreground\">MC:</span>\n              <span className=\"font-semibold text-foreground\">\n                {formattedMarketCap}\n              </span>\n            </div>\n            <div className=\"flex items-center gap-0.5\">\n              <TrendingUp className=\"h-2.5 w-2.5 text-purple-500\" />\n              <span className=\"text-muted-foreground\">Vol:</span>\n              <span className=\"font-semibold text-foreground\">\n                {formatSmartCurrency(liveVolume || coin.volume24h)}\n              </span>\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-between text-[10px]\">\n            <div className=\"flex items-center gap-0.5\">\n              <User className=\"h-2.5 w-2.5 text-orange-500\" />\n              <span className=\"text-muted-foreground\"></span>\n              <span className=\"font-semibold text-foreground\">\n                {formatHolders(liveHolders || coin.holders || 0)}\n              </span>\n            </div>\n            <div className=\"flex items-center gap-0.5\">\n              <Coins className=\"h-2.5 w-2.5 text-green-500\" />\n              <span className=\"text-muted-foreground\"></span>\n              <span className=\"font-semibold text-green-500\">\n                {formatSmartCurrency(creatorEarnings)}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n","size_bytes":9191},"client/src/pages/connections.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { CreatorCard } from \"@/components/creator-card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Search, Users } from \"lucide-react\";\nimport type { User } from \"@shared/schema\";\n\nexport default function Connections() {\n  const { data: connections, isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/connections\"],\n  });\n\n  const { data: invitations } = useQuery<User[]>({\n    queryKey: [\"/api/connections/invitations\"],\n  });\n\n  return (\n    <div className=\"container max-w-5xl mx-auto px-4 py-8 space-y-8\">\n      {/* Header */}\n      <div className=\"flex items-center gap-3\">\n        <Users className=\"h-8 w-8 text-primary\" />\n        <div>\n          <h1 className=\"text-3xl font-bold\">Connections</h1>\n          <p className=\"text-muted-foreground\">\n            Manage your creator network and collaborations\n          </p>\n        </div>\n      </div>\n\n      {/* Search */}\n      <div className=\"relative\">\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n        <Input\n          type=\"search\"\n          placeholder=\"Search connections...\"\n          className=\"pl-10 h-12\"\n          data-testid=\"input-search-connections\"\n        />\n      </div>\n\n      {/* Tabs */}\n      <Tabs defaultValue=\"all\">\n        <TabsList>\n          <TabsTrigger value=\"all\" data-testid=\"tab-all-connections\">\n            All Connections\n            {connections && (\n              <Badge variant=\"secondary\" className=\"ml-2\">\n                {connections.length}\n              </Badge>\n            )}\n          </TabsTrigger>\n          <TabsTrigger value=\"invitations\" data-testid=\"tab-invitations\">\n            Invitations\n            {invitations && invitations.length > 0 && (\n              <Badge className=\"ml-2 bg-accent\">\n                {invitations.length}\n              </Badge>\n            )}\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"all\" className=\"mt-6\">\n          {isLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n              {[...Array(8)].map((_, i) => (\n                <div\n                  key={i}\n                  className=\"h-80 bg-card rounded-2xl animate-pulse\"\n                  data-testid=\"skeleton-connection-card\"\n                />\n              ))}\n            </div>\n          ) : connections && connections.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n              {connections.map((creator) => (\n                <CreatorCard\n                  key={creator.id}\n                  creator={creator}\n                  isConnected={true}\n                />\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-16\">\n              <Users className=\"h-16 w-16 text-muted-foreground mx-auto mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">No connections yet</h3>\n              <p className=\"text-muted-foreground\">\n                Start connecting with creators to build your network\n              </p>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"invitations\" className=\"mt-6\">\n          {invitations && invitations.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n              {invitations.map((creator) => (\n                <CreatorCard\n                  key={creator.id}\n                  creator={creator}\n                  onConnect={() => console.log(\"Accept invitation:\", creator.id)}\n                />\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-16\">\n              <p className=\"text-muted-foreground\">No pending invitations</p>\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","size_bytes":4067},"client/src/components/project-card.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Eye, TrendingUp } from \"lucide-react\";\nimport type { Project } from \"@shared/schema\";\n\ninterface ProjectCardProps {\n  project: Project;\n  onClick?: () => void;\n}\n\nexport function ProjectCard({ project, onClick }: ProjectCardProps) {\n  return (\n    <Card\n      className=\"overflow-hidden hover-elevate active-elevate-2 transition-all duration-200 cursor-pointer\"\n      onClick={onClick}\n      data-testid={`card-project-${project.id}`}\n    >\n      {project.thumbnailUrl && (\n        <div className=\"aspect-[4/3] overflow-hidden\">\n          <img\n            src={project.thumbnailUrl}\n            alt={project.title}\n            className=\"w-full h-full object-cover\"\n          />\n        </div>\n      )}\n      \n      <div className=\"p-4 space-y-3\">\n        <div className=\"space-y-1\">\n          <h3 className=\"font-bold text-lg line-clamp-1\" data-testid={`text-project-title-${project.id}`}>\n            {project.title}\n          </h3>\n          {project.description && (\n            <p className=\"text-sm text-muted-foreground line-clamp-2\">\n              {project.description}\n            </p>\n          )}\n        </div>\n\n        {project.category && (\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            {project.category}\n          </Badge>\n        )}\n\n        <div className=\"flex items-center gap-4 text-sm text-muted-foreground pt-2\">\n          <div className=\"flex items-center gap-1\">\n            <Eye className=\"h-4 w-4\" />\n            <span data-testid={`text-views-${project.id}`}>\n              {project.totalViews?.toLocaleString() || 0}\n            </span>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <TrendingUp className=\"h-4 w-4\" />\n            <span data-testid={`text-interactions-${project.id}`}>\n              {project.totalInteractions?.toLocaleString() || 0}\n            </span>\n          </div>\n        </div>\n\n        {project.isMinted && (\n          <Badge className=\"bg-primary text-primary-foreground\">\n            Minted\n          </Badge>\n        )}\n      </div>\n    </Card>\n  );\n}\n","size_bytes":2169},"server/storage.ts":{"content":"import { db } from \"./db\";\nimport { eq, desc, and, lt, sql } from \"drizzle-orm\";\nimport {\n  coins,\n  scrapedContent,\n  rewards,\n  creators,\n  users,\n  comments,\n  follows,\n  referrals,\n  loginStreaks,\n  notifications,\n  e1xpRewards,\n  pushSubscriptions,\n  messages,\n  type Coin,\n  type InsertCoin,\n  type UpdateCoin,\n  type ScrapedContent,\n  type InsertScrapedContent,\n  type Reward,\n  type InsertReward,\n  type Creator,\n  type InsertCreator,\n  type UpdateCreator,\n  type User,\n  type Comment,\n  type InsertComment,\n  type Follow,\n  type InsertFollow,\n  type Referral,\n  type InsertReferral,\n  type LoginStreak,\n  type InsertLoginStreak,\n  type UpdateLoginStreak,\n  type Notification,\n  type InsertNotification,\n  type E1xpReward,\n  type InsertE1xpReward,\n  type PushSubscription,\n  type InsertPushSubscription,\n  type Message,\n  type InsertMessage,\n} from \"@shared/schema\";\n\n// Type for user notifications with creator info\nexport interface UserNotification {\n  id: string;\n  creator_id: string;\n  type: string;\n  title: string;\n  message: string;\n  metadata?: any;\n  read: boolean;\n  created_at: string;\n  updated_at: string;\n  creator?: {\n    address: string;\n    name: string | null;\n    avatar: string | null;\n  };\n}\n\nexport type ModerationType = 'warn' | 'ban' | 'unban';\n\nexport class Storage {\n  // ===== COINS =====\n  async getAllCoins(): Promise<Coin[]> {\n    return await db.select().from(coins).orderBy(desc(coins.createdAt));\n  }\n\n  async getCoin(id: string): Promise<Coin | undefined> {\n    const result = await db.select().from(coins).where(eq(coins.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getCoinByAddress(address: string): Promise<Coin | undefined> {\n    const result = await db.select().from(coins).where(eq(coins.address, address)).limit(1);\n    return result[0];\n  }\n\n  async getCoinsByCreator(creator: string): Promise<Coin[]> {\n    return await db\n      .select()\n      .from(coins)\n      .where(eq(coins.creatorWallet, creator))\n      .orderBy(desc(coins.createdAt));\n  }\n\n  async createCoin(insertCoin: InsertCoin): Promise<Coin> {\n    const result = await db.insert(coins).values(insertCoin).returning();\n    return result[0];\n  }\n\n  async updateCoin(id: string, update: UpdateCoin): Promise<Coin | undefined> {\n    const result = await db\n      .update(coins)\n      .set(update)\n      .where(eq(coins.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async updateCoinByAddress(address: string, update: UpdateCoin): Promise<Coin | undefined> {\n    const result = await db\n      .update(coins)\n      .set(update)\n      .where(eq(coins.address, address))\n      .returning();\n    return result[0];\n  }\n\n  async getPinnedCoins(): Promise<Coin[]> {\n    const result = await db\n      .select()\n      .from(coins)\n      .where(and(\n        eq(coins.status, 'active'),\n        sql`${coins.pinOrder} IS NOT NULL`\n      ))\n      .orderBy(coins.pinOrder);\n    return result;\n  }\n\n  async pinCoin(address: string): Promise<Coin | undefined> {\n    // Check current pinned count\n    const pinnedCoins = await this.getPinnedCoins();\n    if (pinnedCoins.length >= 6) {\n      throw new Error('Maximum of 6 coins can be pinned');\n    }\n\n    // Get the next pin order number\n    const nextPinOrder = pinnedCoins.length > 0\n      ? Math.max(...pinnedCoins.map(c => c.pinOrder || 0)) + 1\n      : 1;\n\n    // Update the coin\n    const result = await db\n      .update(coins)\n      .set({ pinOrder: nextPinOrder })\n      .where(eq(coins.address, address))\n      .returning();\n    return result[0];\n  }\n\n  async unpinCoin(address: string): Promise<Coin | undefined> {\n    const result = await db\n      .update(coins)\n      .set({ pinOrder: null })\n      .where(eq(coins.address, address))\n      .returning();\n    return result[0];\n  }\n\n  // ===== SCRAPED CONTENT =====\n  async getScrapedContent(id: string): Promise<ScrapedContent | undefined> {\n    const result = await db\n      .select()\n      .from(scrapedContent)\n      .where(eq(scrapedContent.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async createScrapedContent(content: InsertScrapedContent): Promise<ScrapedContent> {\n    const result = await db.insert(scrapedContent).values(content).returning();\n    return result[0];\n  }\n\n  async getAllScrapedContent(): Promise<ScrapedContent[]> {\n    return await db.select().from(scrapedContent).orderBy(desc(scrapedContent.scrapedAt));\n  }\n\n  // ===== REWARDS =====\n  async getReward(id: string): Promise<Reward | undefined> {\n    const result = await db.select().from(rewards).where(eq(rewards.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createReward(reward: InsertReward): Promise<Reward> {\n    const result = await db.insert(rewards).values(reward).returning();\n    return result[0];\n  }\n\n  async getAllRewards(): Promise<Reward[]> {\n    return await db.select().from(rewards).orderBy(desc(rewards.createdAt));\n  }\n\n  async getRewardsByCoin(coinAddress: string): Promise<Reward[]> {\n    return await db\n      .select()\n      .from(rewards)\n      .where(eq(rewards.coinAddress, coinAddress))\n      .orderBy(desc(rewards.createdAt));\n  }\n\n  async getRewardsByRecipient(recipientAddress: string): Promise<Reward[]> {\n    return await db\n      .select()\n      .from(rewards)\n      .where(eq(rewards.recipientAddress, recipientAddress))\n      .orderBy(desc(rewards.createdAt));\n  }\n\n  async getRewardsByCreator(creatorAddress: string): Promise<Reward[]> {\n    return await db\n      .select()\n      .from(rewards)\n      .where(eq(rewards.recipientAddress, creatorAddress))\n      .orderBy(desc(rewards.createdAt));\n  }\n\n  // ===== CREATORS =====\n  async getCreator(id: string): Promise<Creator | undefined> {\n    const result = await db.select().from(creators).where(eq(creators.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getCreatorByPrivyId(privyId: string): Promise<Creator | undefined> {\n    const result = await db\n      .select()\n      .from(creators)\n      .where(eq(creators.privyId, privyId))\n      .limit(1);\n    return result[0];\n  }\n\n  async getCreatorByAddress(address: string): Promise<Creator | undefined> {\n    // Keep for backwards compatibility\n    const result = await db\n      .select()\n      .from(creators)\n      .where(eq(creators.address, address))\n      .limit(1);\n    return result[0];\n  }\n\n  async getCreatorByReferralCode(referralCode: string): Promise<Creator | undefined> {\n    const result = await db\n      .select()\n      .from(creators)\n      .where(eq(creators.referralCode, referralCode))\n      .limit(1);\n    return result[0];\n  }\n\n  async createCreator(creator: InsertCreator): Promise<Creator> {\n    const result = await db.insert(creators).values(creator).returning();\n    return result[0];\n  }\n\n  // ===== USERS (for E1XP and referrals) =====\n  async getUserByPrivyId(privyId: string): Promise<User | undefined> {\n    const result = await db\n      .select()\n      .from(users)\n      .where(eq(users.privyId, privyId))\n      .limit(1);\n    return result[0];\n  }\n\n  async getUserByAddress(address: string): Promise<User | undefined> {\n    const result = await db\n      .select()\n      .from(users)\n      .where(eq(users.walletAddress, address))\n      .limit(1);\n    return result[0];\n  }\n\n  async getUserById(id: string): Promise<User | undefined> {\n    const result = await db\n      .select()\n      .from(users)\n      .where(eq(users.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const result = await db\n      .select()\n      .from(users)\n      .where(eq(users.email, email))\n      .limit(1);\n    return result[0];\n  }\n\n  async getUserByReferralCode(referralCode: string): Promise<User | undefined> {\n    const result = await db\n      .select()\n      .from(users)\n      .where(eq(users.referralCode, referralCode))\n      .limit(1);\n    return result[0];\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users).orderBy(desc(users.createdAt));\n  }\n\n  async createUser(insertUser: any): Promise<User> {\n    const result = await db.insert(users).values(insertUser).returning();\n    return result[0];\n  }\n\n  async updateUser(id: string, update: any): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set(update)\n      .where(eq(users.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async updateCreator(id: string, update: UpdateCreator): Promise<Creator | undefined> {\n    const result = await db\n      .update(creators)\n      .set({ ...update, updatedAt: new Date() })\n      .where(eq(creators.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async addPoints(creatorId: string, amount: number, reason: string): Promise<void> {\n    const creator = await this.getCreator(creatorId);\n    if (!creator) return;\n\n    const currentPoints = parseInt(creator.points) || 0;\n    const newPoints = currentPoints + amount;\n\n    await db\n      .update(creators)\n      .set({ points: newPoints.toString(), updatedAt: new Date() })\n      .where(eq(creators.id, creatorId));\n  }\n\n  async getAllCreators(): Promise<Creator[]> {\n    return await db.select().from(creators).orderBy(desc(creators.createdAt));\n  }\n\n  async getTopCreators(): Promise<Creator[]> {\n    return await db.select().from(creators).orderBy(desc(creators.totalVolume)).limit(10);\n  }\n\n  async awardPoints(\n    creatorId: string,\n    amount: number,\n    reason: string,\n    type: string\n  ): Promise<void> {\n    await this.addPoints(creatorId, amount, reason);\n  }\n\n  // Stub methods for daily points (not implemented yet - would need additional table)\n  async getDailyPoints(creatorId: string): Promise<{ claimed: boolean; streak: number }> {\n    return { claimed: false, streak: 0 };\n  }\n\n  async claimDailyPoints(creatorId: string): Promise<number> {\n    return 0;\n  }\n\n  async getDailyPointsStatus(\n    creatorId: string\n  ): Promise<{ claimed: boolean; streak: number; nextClaimAmount: number }> {\n    return { claimed: false, streak: 0, nextClaimAmount: 0 };\n  }\n\n  // ===== NOTIFICATIONS =====\n  async createNotification(notification: InsertNotification): Promise<Notification> {\n    const result = await db.insert(notifications).values(notification).returning();\n    return result[0];\n  }\n\n  async getUserNotifications(userId: string): Promise<Notification[]> {\n    return await db\n      .select()\n      .from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt));\n  }\n\n  async getNotificationsByUser(userId: string): Promise<Notification[]> {\n    return await db\n      .select()\n      .from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt));\n  }\n\n  async getUnreadNotificationsByUser(userId: string): Promise<Notification[]> {\n    return await db\n      .select()\n      .from(notifications)\n      .where(and(eq(notifications.userId, userId), eq(notifications.read, false)))\n      .orderBy(desc(notifications.createdAt));\n  }\n\n  async markNotificationAsRead(notificationId: string): Promise<Notification | undefined> {\n    const result = await db\n      .update(notifications)\n      .set({ read: true })\n      .where(eq(notifications.id, notificationId))\n      .returning();\n    return result[0];\n  }\n\n  async markAllNotificationsAsRead(userId: string): Promise<void> {\n    await db\n      .update(notifications)\n      .set({ read: true })\n      .where(eq(notifications.userId, userId));\n  }\n\n  async deleteNotification(id: string): Promise<boolean> {\n    const result = await db.delete(notifications).where(eq(notifications.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // ===== E1XP REWARDS =====\n  async createE1xpReward(reward: InsertE1xpReward): Promise<E1xpReward> {\n    const result = await db.insert(e1xpRewards).values(reward).returning();\n    return result[0];\n  }\n\n  async getE1xpRewardsByUser(userId: string): Promise<E1xpReward[]> {\n    return await db\n      .select()\n      .from(e1xpRewards)\n      .where(eq(e1xpRewards.userId, userId))\n      .orderBy(desc(e1xpRewards.createdAt));\n  }\n\n  async getUnclaimedE1xpRewardsByUser(userId: string): Promise<E1xpReward[]> {\n    return await db\n      .select()\n      .from(e1xpRewards)\n      .where(and(eq(e1xpRewards.userId, userId), eq(e1xpRewards.claimed, false)))\n      .orderBy(desc(e1xpRewards.createdAt));\n  }\n\n  async claimE1xpReward(rewardId: string): Promise<E1xpReward | undefined> {\n    const result = await db\n      .update(e1xpRewards)\n      .set({ claimed: true, claimedAt: new Date() })\n      .where(eq(e1xpRewards.id, rewardId))\n      .returning();\n    return result[0];\n  }\n\n  async getUnclaimedRewardsOlderThan(days: number): Promise<E1xpReward[]> {\n    const threshold = new Date();\n    threshold.setDate(threshold.getDate() - days);\n\n    return await db\n      .select()\n      .from(e1xpRewards)\n      .where(and(eq(e1xpRewards.claimed, false), lt(e1xpRewards.createdAt, threshold)))\n      .orderBy(desc(e1xpRewards.createdAt));\n  }\n\n  async markReminderSent(rewardId: string): Promise<void> {\n    await db\n      .update(e1xpRewards)\n      .set({ reminderSentAt: new Date() })\n      .where(eq(e1xpRewards.id, rewardId));\n  }\n\n  // ===== PUSH SUBSCRIPTIONS =====\n  async createPushSubscription(subscription: InsertPushSubscription): Promise<PushSubscription> {\n    const result = await db.insert(pushSubscriptions).values(subscription).returning();\n    return result[0];\n  }\n\n  async getPushSubscriptionsByUser(userId: string): Promise<PushSubscription[]> {\n    return await db\n      .select()\n      .from(pushSubscriptions)\n      .where(eq(pushSubscriptions.userId, userId));\n  }\n\n  async deletePushSubscription(endpoint: string): Promise<boolean> {\n    const result = await db\n      .delete(pushSubscriptions)\n      .where(eq(pushSubscriptions.endpoint, endpoint))\n      .returning();\n    return result.length > 0;\n  }\n\n  // ===== MODERATION (Stub - would need moderation table) =====\n  async moderateUser(creatorId: string, action: ModerationType): Promise<void> {\n    // Stub - would need moderation history table\n  }\n\n  async getModerationHistory(creatorId: string): Promise<ModerationType[]> {\n    return [];\n  }\n\n  // ===== COMMENTS =====\n  async createComment(comment: InsertComment): Promise<Comment> {\n    const result = await db.insert(comments).values(comment).returning();\n    return result[0];\n  }\n\n  async getCommentsByCoin(coinAddress: string): Promise<Comment[]> {\n    return await db\n      .select()\n      .from(comments)\n      .where(eq(comments.coinAddress, coinAddress))\n      .orderBy(desc(comments.createdAt));\n  }\n\n  async getAllComments(): Promise<Comment[]> {\n    return await db.select().from(comments).orderBy(desc(comments.createdAt));\n  }\n\n  // ===== FOLLOWS =====\n  async createFollow(insertFollow: InsertFollow): Promise<Follow> {\n    const result = await db.insert(follows).values(insertFollow).returning();\n    return result[0];\n  }\n\n  async deleteFollow(followerAddress: string, followingAddress: string): Promise<boolean> {\n    const result = await db\n      .delete(follows)\n      .where(\n        and(\n          eq(follows.followerAddress, followerAddress),\n          eq(follows.followingAddress, followingAddress)\n        )\n      )\n      .returning();\n    return result.length > 0;\n  }\n\n  async getFollowers(userAddress: string): Promise<Follow[]> {\n    return await db\n      .select()\n      .from(follows)\n      .where(eq(follows.followingAddress, userAddress))\n      .orderBy(desc(follows.createdAt));\n  }\n\n  async getFollowing(userAddress: string): Promise<Follow[]> {\n    return await db\n      .select()\n      .from(follows)\n      .where(eq(follows.followerAddress, userAddress))\n      .orderBy(desc(follows.createdAt));\n  }\n\n  async getFollowersByAddress(userAddress: string): Promise<Follow[]> {\n    return this.getFollowers(userAddress);\n  }\n\n  async getFollowingByAddress(userAddress: string): Promise<Follow[]> {\n    return this.getFollowing(userAddress);\n  }\n\n  async isFollowing(followerAddress: string, followingAddress: string): Promise<boolean> {\n    const result = await db\n      .select()\n      .from(follows)\n      .where(\n        and(\n          eq(follows.followerAddress, followerAddress),\n          eq(follows.followingAddress, followingAddress)\n        )\n      )\n      .limit(1);\n    return result.length > 0;\n  }\n\n  // ===== REFERRALS =====\n  async createReferral(insertReferral: InsertReferral): Promise<Referral> {\n    const result = await db.insert(referrals).values(insertReferral).returning();\n    return result[0];\n  }\n\n  async getReferralsByReferrer(referrerId: string): Promise<Referral[]> {\n    return await db\n      .select()\n      .from(referrals)\n      .where(eq(referrals.referrerId, referrerId))\n      .orderBy(desc(referrals.createdAt));\n  }\n\n  async getReferralByAddresses(\n    referrerId: string,\n    referredUserId: string\n  ): Promise<Referral | undefined> {\n    const result = await db\n      .select()\n      .from(referrals)\n      .where(\n        and(\n          eq(referrals.referrerId, referrerId),\n          eq(referrals.referredUserId, referredUserId)\n        )\n      )\n      .limit(1);\n    return result[0];\n  }\n\n  // ===== LOGIN STREAKS =====\n  async getLoginStreak(userId: string): Promise<LoginStreak | undefined> {\n    const result = await db\n      .select()\n      .from(loginStreaks)\n      .where(eq(loginStreaks.userId, userId))\n      .limit(1);\n    return result[0];\n  }\n\n  async createLoginStreak(insertLoginStreak: InsertLoginStreak): Promise<LoginStreak> {\n    const result = await db.insert(loginStreaks).values(insertLoginStreak).returning();\n    return result[0];\n  }\n\n  async updateLoginStreak(\n    userId: string,\n    update: UpdateLoginStreak\n  ): Promise<LoginStreak | undefined> {\n    const result = await db\n      .update(loginStreaks)\n      .set(update)\n      .where(eq(loginStreaks.userId, userId))\n      .returning();\n    return result[0];\n  }\n\n  // ===== MESSAGES =====\n  async createMessage(insertMessage: InsertMessage): Promise<Message> {\n    const result = await db.insert(messages).values(insertMessage).returning();\n    return result[0];\n  }\n\n  async getMessagesBetweenUsers(userId1: string, userId2: string): Promise<Message[]> {\n    const result = await db\n      .select()\n      .from(messages)\n      .where(\n        and(\n          sql`(${messages.senderId} = ${userId1} AND ${messages.recipientId} = ${userId2}) OR (${messages.senderId} = ${userId2} AND ${messages.recipientId} = ${userId1})`\n        )\n      )\n      .orderBy(messages.createdAt);\n    return result;\n  }\n\n  async markMessagesAsRead(userId: string, otherUserId: string): Promise<void> {\n    await db\n      .update(messages)\n      .set({ isRead: true })\n      .where(\n        and(\n          eq(messages.recipientId, userId),\n          eq(messages.senderId, otherUserId),\n          eq(messages.isRead, false)\n        )\n      );\n  }\n\n  async getConversationsForUser(userId: string): Promise<Array<{ otherUserId: string, lastMessage: Message }>> {\n    // Get all unique users this user has conversations with\n    const sentMessages = await db\n      .select()\n      .from(messages)\n      .where(eq(messages.senderId, userId))\n      .orderBy(desc(messages.createdAt));\n    \n    const receivedMessages = await db\n      .select()\n      .from(messages)\n      .where(eq(messages.recipientId, userId))\n      .orderBy(desc(messages.createdAt));\n\n    // Combine and get unique users\n    const allMessages = [...sentMessages, ...receivedMessages];\n    const conversationMap = new Map<string, Message>();\n\n    for (const msg of allMessages) {\n      const otherUserId = msg.senderId === userId ? msg.recipientId : msg.senderId;\n      if (!conversationMap.has(otherUserId)) {\n        conversationMap.set(otherUserId, msg);\n      }\n    }\n\n    return Array.from(conversationMap.entries()).map(([otherUserId, lastMessage]) => ({\n      otherUserId,\n      lastMessage\n    }));\n  }\n\n  async getUnreadMessageCount(userId: string, otherUserId: string): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(messages)\n      .where(\n        and(\n          eq(messages.recipientId, userId),\n          eq(messages.senderId, otherUserId),\n          eq(messages.isRead, false)\n        )\n      );\n    return Number(result[0]?.count || 0);\n  }\n}\n\nexport const storage = new Storage();","size_bytes":20286},"client/src/components/profile-card-modal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport type { Coin } from \"@shared/schema\";\nimport { Users, DollarSign, Coins as CoinsIcon, TrendingUp, Award, Share2 } from \"lucide-react\";\nimport { getProfile, getProfileCoins } from \"@zoralabs/coins-sdk\";\nimport { base } from \"viem/chains\";\nimport { formatSmartCurrency } from \"@/lib/utils\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\n\ninterface ProfileCardModalProps {\n  creatorAddress: string;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  creatorData?: { name?: string; verified?: boolean };\n}\n\nexport default function ProfileCardModal({ creatorAddress, open, onOpenChange, creatorData }: ProfileCardModalProps) {\n  const { user: privyUser, authenticated } = usePrivy();\n  const currentUserAddress = privyUser?.wallet?.address;\n  const [totalMarketCap, setTotalMarketCap] = useState<number>(0);\n  const [totalHolders, setTotalHolders] = useState<number>(0);\n  const [totalEarnings, setTotalEarnings] = useState<number>(0);\n  const { toast } = useToast();\n\n  // Helper function to format wallet address\n  const formatAddress = (address: string) => {\n    return `${address.slice(0, 6)}...${address.slice(-4)}`;\n  };\n\n  // Fetch Zora profile data\n  const { data: zoraProfile } = useQuery({\n    queryKey: ['/zora/profile', creatorAddress],\n    queryFn: async () => {\n      const response = await getProfile({ identifier: creatorAddress });\n      return response?.data?.profile;\n    },\n    enabled: !!creatorAddress && open,\n  });\n\n  // Fetch creator's coins from Zora\n  const { data: zoraCoins } = useQuery({\n    queryKey: ['/zora/profile/coins', creatorAddress],\n    queryFn: async () => {\n      const response = await getProfileCoins({\n        identifier: creatorAddress,\n        count: 50,\n        chainIds: [base.id]\n      });\n      return response?.data?.profile?.createdCoins?.edges?.map((edge: any) => edge.node) || [];\n    },\n    enabled: !!creatorAddress && open,\n  });\n\n  // Check if following\n  const { data: followData } = useQuery({\n    queryKey: ['/api/follows/check', currentUserAddress, creatorAddress],\n    queryFn: async () => {\n      if (!currentUserAddress || !creatorAddress) return { isFollowing: false };\n      const response = await fetch(`/api/follows/check/${currentUserAddress}/${creatorAddress}`);\n      if (!response.ok) return { isFollowing: false };\n      return response.json();\n    },\n    enabled: !!currentUserAddress && !!creatorAddress && authenticated,\n  });\n\n  const isFollowing = followData?.isFollowing || false;\n\n  // Get local creator data for name/bio if available\n  const { data: localCreatorProfile } = useQuery({\n    queryKey: ['/api/creators/address', creatorAddress],\n    queryFn: async () => {\n      const response = await fetch(`/api/creators/address/${creatorAddress}`);\n      if (!response.ok) return null;\n      return response.json();\n    },\n    enabled: !!creatorAddress,\n  });\n\n  // Use Zora profile avatar or local avatar, fallback to platform logo\n  const avatarUrl = zoraProfile?.avatar?.medium ||\n                    localCreatorProfile?.avatar ||\n                    \"https://i.ibb.co/JRQCPsZK/ev122logo-1-1.png\";\n\n  // Get display name from Zora profile, local profile, or creatorData prop\n  const displayName = zoraProfile?.displayName ||\n                      zoraProfile?.handle ||\n                      localCreatorProfile?.name ||\n                      creatorData?.name ||\n                      formatAddress(creatorAddress);\n\n  // Get verified status\n  const isVerified = creatorData?.verified || localCreatorProfile?.verified === \"true\";\n\n  // Use Zora coins as the source of truth\n  const creatorCoins = zoraCoins || [];\n\n  useEffect(() => {\n    if (!open || !zoraCoins || zoraCoins.length === 0) {\n      setTotalMarketCap(0);\n      setTotalHolders(0);\n      setTotalEarnings(0);\n      return;\n    }\n\n    let marketCapSum = 0;\n    let holdersSum = 0;\n    let earningsSum = 0;\n\n    // Calculate stats from Zora coin data\n    zoraCoins.forEach((coin: any) => {\n      if (coin?.marketCap) {\n        marketCapSum += parseFloat(coin.marketCap);\n      }\n      if (coin?.uniqueHolders !== undefined) {\n        holdersSum += coin.uniqueHolders;\n      }\n      if (coin?.totalVolume) {\n        const totalVolumeUSD = parseFloat(coin.totalVolume);\n        // 0.5% creator fee on total volume\n        const earningsUSD = totalVolumeUSD * 0.005;\n        earningsSum += earningsUSD;\n      }\n    });\n\n    setTotalMarketCap(marketCapSum);\n    setTotalHolders(holdersSum);\n    setTotalEarnings(earningsSum);\n  }, [open, zoraCoins]);\n\n  // Follow mutation\n  const followMutation = useMutation({\n    mutationFn: async () => {\n      if (!currentUserAddress || !creatorAddress) throw new Error(\"Not authenticated\");\n      const response = await fetch('/api/follows', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          followerAddress: currentUserAddress,\n          followingAddress: creatorAddress,\n        }),\n      });\n      if (!response.ok) throw new Error(\"Failed to follow\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/follows/check'] });\n      toast({ title: \"Following!\", description: `You are now following ${creatorData?.name || formatAddress(creatorAddress)}` });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to follow user\", variant: \"destructive\" });\n    },\n  });\n\n  // Unfollow mutation\n  const unfollowMutation = useMutation({\n    mutationFn: async () => {\n      if (!currentUserAddress || !creatorAddress) throw new Error(\"Not authenticated\");\n      const response = await fetch(`/api/follows/${currentUserAddress}/${creatorAddress}`, {\n        method: 'DELETE',\n      });\n      if (!response.ok) throw new Error(\"Failed to unfollow\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/follows/check'] });\n      toast({ title: \"Unfollowed\", description: `You unfollowed ${creatorData?.name || formatAddress(creatorAddress)}` });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to unfollow user\", variant: \"destructive\" });\n    },\n  });\n\n  const handleFollowToggle = () => {\n    if (!authenticated || !currentUserAddress) {\n      toast({ title: \"Connect wallet\", description: \"Please connect your wallet to follow users\", variant: \"destructive\" });\n      return;\n    }\n\n    if (currentUserAddress.toLowerCase() === creatorAddress.toLowerCase()) {\n      toast({ title: \"Cannot follow yourself\", variant: \"destructive\" });\n      return;\n    }\n\n    if (isFollowing) {\n      unfollowMutation.mutate();\n    } else {\n      followMutation.mutate();\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-[280px] sm:max-w-[320px] bg-card border-border/50 p-0 overflow-hidden rounded-2xl sm:rounded-3xl\">\n        <div className=\"flex items-center justify-end pt-2 pr-14 px-3 sm:pt-2 sm:pr-16 sm:px-5\">\n          <button\n            onClick={async () => {\n              const profilePath = zoraProfile?.handle\n                ? `/@${zoraProfile.handle}`\n                : localCreatorProfile?.name\n                ? `/@${localCreatorProfile.name}`\n                : `/${creatorAddress}`;\n              const url = `${window.location.origin}${profilePath}`;\n\n              if (navigator.share) {\n                await navigator.share({\n                  title: `${displayName} - CoinIT Profile`,\n                  url: url,\n                });\n              } else {\n                await navigator.clipboard.writeText(url);\n                toast({ title: \"Profile link copied!\" });\n              }\n            }}\n            className=\"p-2 sm:p-2.5 bg-background/90 backdrop-blur-sm hover:bg-muted/30 rounded-full transition-colors border border-border/50\"\n            data-testid=\"button-share-profile\"\n          >\n            <Share2 className=\"w-4 h-4 sm:w-5 sm:h-5 text-muted-foreground\" />\n          </button>\n        </div>\n        <div className=\"px-3 pb-3 sm:px-5 sm:pb-5\">\n          <div className=\"relative mb-2 sm:mb-3 flex items-start justify-start\">\n            <img\n              src={avatarUrl}\n              alt=\"Profile\"\n              className=\"w-16 h-16 sm:w-20 sm:h-20 rounded-full border-2 sm:border-4 border-border shadow-lg\"\n              data-testid=\"img-profile-card-avatar\"\n            />\n          </div>\n\n          <div className=\"mb-2 sm:mb-3\">\n            <h3 className=\"text-base sm:text-lg font-bold text-foreground mb-0.5 flex items-center gap-2\" data-testid=\"text-profile-card-name\">\n              {displayName}\n              {isVerified && (\n                <Award className=\"w-5 h-5 text-yellow-500\" />\n              )}\n            </h3>\n            {zoraProfile?.handle && (\n              <p className=\"text-[10px] sm:text-xs text-muted-foreground mb-0.5\">\n                @{zoraProfile.handle}\n              </p>\n            )}\n            <p className=\"text-[10px] sm:text-xs text-muted-foreground font-mono truncate\" data-testid=\"text-profile-card-address\">\n              {creatorAddress}\n            </p>\n            {zoraProfile?.bio && (\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                {zoraProfile.bio}\n              </p>\n            )}\n          </div>\n\n          <div className=\"grid grid-cols-4 gap-1.5 sm:gap-2 mb-3 sm:mb-4\">\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-0.5 sm:gap-1 mb-0.5 sm:mb-1\">\n                <CoinsIcon className=\"w-2.5 h-2.5 sm:w-3 sm:h-3 text-yellow-500\" />\n                <span className=\"text-[10px] sm:text-xs font-medium text-muted-foreground\">Coins</span>\n              </div>\n              <p className=\"text-sm sm:text-base font-bold text-foreground\" data-testid=\"text-profile-card-coins\">{creatorCoins.length}</p>\n            </div>\n\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-0.5 sm:gap-1 mb-0.5 sm:mb-1\">\n                <DollarSign className=\"w-2.5 h-2.5 sm:w-3 sm:h-3 text-green-500\" />\n                <span className=\"text-[10px] sm:text-xs font-medium text-muted-foreground\">Market</span>\n              </div>\n              <p className=\"text-sm sm:text-base font-bold text-foreground\" data-testid=\"text-profile-card-market\">\n                ${totalMarketCap > 1000 ? `${(totalMarketCap / 1000).toFixed(0)}k` : totalMarketCap.toFixed(0)}\n              </p>\n            </div>\n\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-0.5 sm:gap-1 mb-0.5 sm:mb-1\">\n                <Users className=\"w-2.5 h-2.5 sm:w-3 sm:h-3 text-blue-500\" />\n                <span className=\"text-[10px] sm:text-xs font-medium text-muted-foreground\">Holders</span>\n              </div>\n              <p className=\"text-sm sm:text-base font-bold text-foreground\" data-testid=\"text-profile-card-holders\">{totalHolders}</p>\n            </div>\n\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-0.5 sm:gap-1 mb-0.5 sm:mb-1\">\n                <TrendingUp className=\"w-2.5 h-2.5 sm:w-3 sm:h-3 text-green-500\" />\n                <span className=\"text-[10px] sm:text-xs font-medium text-muted-foreground\">Earn</span>\n              </div>\n              <p className=\"text-sm sm:text-base font-bold text-green-500\" data-testid=\"text-profile-card-earnings\">\n                {totalEarnings > 1000 ? `$${(totalEarnings / 1000).toFixed(1)}k` : formatSmartCurrency(totalEarnings)}\n              </p>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-2\">\n            <Button\n              onClick={handleFollowToggle}\n              disabled={followMutation.isPending || unfollowMutation.isPending}\n              className={`h-9 sm:h-10 rounded-full text-sm font-semibold transition-all ${\n                isFollowing\n                  ? 'bg-muted/50 text-foreground hover:bg-muted/70 border border-border'\n                  : 'bg-primary text-primary-foreground hover:bg-primary/90'\n              }`}\n              data-testid=\"button-follow-toggle\"\n            >\n              {followMutation.isPending || unfollowMutation.isPending\n                ? 'Loading...'\n                : isFollowing ? 'Unfollow' : 'Follow'}\n            </Button>\n\n            <Button\n              onClick={() => {\n                if (!authenticated || !currentUserAddress) {\n                  toast({ title: \"Connect wallet\", description: \"Please connect your wallet to send messages\", variant: \"destructive\" });\n                  return;\n                }\n\n                if (currentUserAddress.toLowerCase() === creatorAddress.toLowerCase()) {\n                  toast({ title: \"Cannot message yourself\", variant: \"destructive\" });\n                  return;\n                }\n\n                // Navigate to inbox page (Socket.io messaging system)\n                window.location.href = '/inbox';\n              }}\n              className=\"h-9 sm:h-10 rounded-full text-sm font-semibold bg-accent text-accent-foreground hover:bg-accent/90\"\n              data-testid=\"button-message\"\n            >\n              Message\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":13716},"client/src/pages/settings.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { useLocation } from \"wouter\";\nimport { Card } from \"@/components/ui/card\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { \n  Settings as SettingsIcon, \n  Bell, \n  Shield, \n  User, \n  Palette, \n  HelpCircle,\n  Info,\n  Star,\n  FileText,\n  ChevronRight,\n  Moon,\n  Users\n} from \"lucide-react\";\nimport type { Creator } from \"@shared/schema\";\nimport { createAvatar } from '@dicebear/core';\nimport { avataaars } from '@dicebear/collection';\n\nexport default function Settings() {\n  const { user: privyUser, authenticated } = usePrivy();\n  const [, setLocation] = useLocation();\n  const address = privyUser?.wallet?.address;\n\n  const { data: creator } = useQuery<Creator>({\n    queryKey: ['/api/creators/address', address],\n    enabled: !!address && authenticated,\n  });\n\n  const [darkMode, setDarkMode] = useState(true);\n\n  const avatarSvg = createAvatar(avataaars, {\n    seed: address || 'anonymous',\n    size: 128,\n  }).toDataUri();\n\n  const profileImageUrl = creator?.avatar || avatarSvg;\n\n  if (!authenticated) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh] p-8\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 bg-muted/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <SettingsIcon className=\"w-8 h-8 text-muted-foreground\" />\n          </div>\n          <h2 className=\"text-2xl font-bold mb-2\">Connect Your Wallet</h2>\n          <p className=\"text-muted-foreground\">\n            Please connect your wallet to access settings\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto p-4 sm:p-6 space-y-4\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-bold\">Settings</h1>\n      </div>\n\n      {/* Profile Card */}\n      <Card \n        className=\"p-4 rounded-2xl border-2 cursor-pointer hover:bg-muted/20 transition-colors\"\n        onClick={() => setLocation(\"/profile\")}\n      >\n        <div className=\"flex items-center gap-3\">\n          <Avatar className=\"h-12 w-12\">\n            <AvatarImage src={profileImageUrl} alt={creator?.name || \"Profile\"} />\n            <AvatarFallback>\n              <User className=\"h-6 w-6\" />\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"font-semibold truncate\">\n              {creator?.name || `${address?.slice(0, 6)}...${address?.slice(-4)}`}\n            </p>\n            <p className=\"text-sm text-muted-foreground truncate\">\n              {address ? `${address.slice(0, 6)}...${address.slice(-4)}` : ''}\n            </p>\n          </div>\n          <ChevronRight className=\"w-5 h-5 text-muted-foreground\" />\n        </div>\n      </Card>\n\n      {/* Dark Mode Toggle */}\n      <Card className=\"p-4 rounded-2xl border-2\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <Moon className=\"w-5 h-5\" />\n            <span className=\"font-medium\">Dark Mode</span>\n          </div>\n          <Switch\n            checked={darkMode}\n            onCheckedChange={setDarkMode}\n          />\n        </div>\n      </Card>\n\n      {/* Menu Items */}\n      <div className=\"space-y-2\">\n        <Card \n          className=\"p-4 rounded-2xl border-2 cursor-pointer hover:bg-muted/20 transition-colors\"\n          onClick={() => setLocation(\"/referrals\")}\n        >\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Users className=\"w-5 h-5\" />\n              <span className=\"font-medium\">Referrals</span>\n            </div>\n            <ChevronRight className=\"w-5 h-5 text-muted-foreground\" />\n          </div>\n        </Card>\n      </div>\n\n      {/* Account Info */}\n      <Card className=\"p-4 rounded-2xl bg-muted/20 border-2 mt-6\">\n        <p className=\"text-xs text-muted-foreground text-center mb-2\">Account Information</p>\n        <div className=\"space-y-2 text-sm\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-muted-foreground\">Wallet</span>\n            <span className=\"font-mono text-xs\">{address?.slice(0, 8)}...{address?.slice(-6)}</span>\n          </div>\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-muted-foreground\">Points</span>\n            <span className=\"font-bold text-primary\">{creator?.points || 0} E1XP</span>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}","size_bytes":4744},"client/src/pages/referrals.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Users, Copy, Check, Gift, QrCode, Trophy, Sparkles } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Referral, Creator } from \"@shared/schema\";\nimport QRCode from \"qrcode\";\nimport { updateOGMeta } from \"@/lib/og-meta\";\n\nexport default function Referrals() {\n  const { user: privyUser, authenticated } = usePrivy();\n  const { toast } = useToast();\n  const [copied, setCopied] = useState(false);\n  const [showQR, setShowQR] = useState(false);\n  const [qrCodeUrl, setQrCodeUrl] = useState<string>(\"\");\n\n  const address = privyUser?.wallet?.address;\n\n  const { data: creator } = useQuery<Creator>({\n    queryKey: ['/api/creators/address', address],\n    enabled: !!address && authenticated,\n  });\n\n  const { data: referrals = [] } = useQuery<Referral[]>({\n    queryKey: ['/api/referrals/referrer', address],\n    enabled: !!address && authenticated,\n  });\n\n  const { data: e1xpStatus } = useQuery({\n    queryKey: ['/api/e1xp/status'],\n    enabled: !!address && authenticated,\n  });\n\n  const referralCode = creator?.referralCode || creator?.name || address?.slice(0, 8);\n  const referralLink = `${window.location.origin}?ref=${referralCode}`;\n  const points = e1xpStatus?.points || parseInt(creator?.points || \"0\");\n  const totalReferrals = referrals.length;\n  const earnedPoints = totalReferrals * 100;\n  const unclaimedRewards = e1xpStatus?.unclaimedRewards || 0;\n\n  // Update OG meta tags when referral code is available\n  useEffect(() => {\n    if (creator && referralCode) {\n      updateOGMeta({\n        title: `Join Every1.fun with ${creator.name || creator.username || 'me'}!`,\n        description: `Get started on Every1.fun and earn bonus E1XP points! Use my referral code: ${referralCode}`,\n        image: creator.avatarUrl || `${window.location.origin}/assets/logos/zorb.png`,\n        url: referralLink,\n      });\n    }\n  }, [creator, referralCode, referralLink]);\n\n  const handleCopy = async () => {\n    try {\n      await navigator.clipboard.writeText(referralLink);\n      setCopied(true);\n      toast({\n        title: \"Copied!\",\n        description: \"Referral link copied to clipboard\",\n      });\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      toast({\n        title: \"Failed to copy\",\n        description: \"Could not copy to clipboard\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleShowQR = async () => {\n    if (!qrCodeUrl) {\n      const url = await QRCode.toDataURL(referralLink, {\n        width: 300,\n        margin: 2,\n        color: {\n          dark: '#000000',\n          light: '#FFFFFF',\n        },\n      });\n      setQrCodeUrl(url);\n    }\n    setShowQR(!showQR);\n  };\n\n  if (!authenticated) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh] p-8\">\n        <div className=\"text-center\">\n          <div className=\"w-16 h-16 bg-muted/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <Users className=\"w-8 h-8 text-muted-foreground\" />\n          </div>\n          <h2 className=\"text-2xl font-bold mb-2\">Connect Your Wallet</h2>\n          <p className=\"text-muted-foreground\">\n            Please connect your wallet to view your referrals\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full max-w-5xl mx-auto px-4 py-6 space-y-6\">\n      {/* Compact Header */}\n      <Card className=\"p-4 rounded-2xl border-2\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-xl font-bold\">Hello, {creator?.name || 'Creator'}üëã</h1>\n            <p className=\"text-sm text-muted-foreground\">Welcome back!</p>\n          </div>\n          <Gift className=\"h-8 w-8 text-primary\" />\n        </div>\n      </Card>\n\n      {/* Compact Points Display - Only show if user has referrals */}\n      {totalReferrals > 0 && (\n        <Card className=\"p-4 rounded-2xl border-2\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex items-center gap-3\">\n              <Trophy className=\"h-8 w-8 text-amber-500\" />\n              <div>\n                <div className=\"text-xs text-muted-foreground\">Your E1XP Points</div>\n                <div className=\"text-2xl font-bold text-amber-600 dark:text-amber-500\">{points.toLocaleString()}</div>\n                {unclaimedRewards > 0 && (\n                  <div className=\"text-xs text-green-600 dark:text-green-500 font-semibold\">\n                    üéÅ {unclaimedRewards} unclaimed rewards!\n                  </div>\n                )}\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-xs text-muted-foreground\">Referrals</div>\n              <div className=\"text-2xl font-bold text-green-600 dark:text-green-500\">{totalReferrals}</div>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-2\">\n            <Button \n              size=\"sm\"\n              className=\"rounded-xl bg-black dark:bg-white text-white dark:text-black hover:bg-black/90 dark:hover:bg-white/90 h-9 font-semibold\"\n            >\n              Redeem Now\n            </Button>\n            <Button \n              size=\"sm\"\n              variant=\"outline\"\n              onClick={handleShowQR}\n              className=\"rounded-xl h-9 font-semibold border-2\"\n            >\n              <QrCode className=\"h-4 w-4 mr-1\" />\n              QR Code\n            </Button>\n          </div>\n        </Card>\n      )}\n\n      {/* QR Code Display */}\n      {showQR && qrCodeUrl && (\n        <Card className=\"p-6 rounded-3xl text-center border-2\">\n          <h3 className=\"font-bold text-lg mb-4\">Scan to Refer</h3>\n          <div className=\"bg-white p-4 rounded-2xl inline-block\">\n            <img src={qrCodeUrl} alt=\"Referral QR Code\" className=\"w-64 h-64\" />\n          </div>\n          <p className=\"text-xs text-muted-foreground mt-4\">\n            Use this QR code when you checkout to get points üéÅ\n          </p>\n        </Card>\n      )}\n\n      {/* Referral Link */}\n      <Card className=\"p-5 rounded-3xl border-2\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex-1 bg-muted/30 rounded-2xl px-4 py-3 text-sm font-mono truncate\">\n            {referralLink}\n          </div>\n          <Button\n            size=\"icon\"\n            onClick={handleCopy}\n            className=\"rounded-xl h-12 w-12 shrink-0\"\n          >\n            {copied ? <Check className=\"h-5 w-5\" /> : <Copy className=\"h-5 w-5\" />}\n          </Button>\n        </div>\n        <p className=\"text-xs text-muted-foreground mt-3 text-center\">\n          Use this referral link when you checkout to get points üéÅ\n        </p>\n      </Card>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 gap-4\">\n        <Card className=\"p-5 rounded-3xl text-center bg-gradient-to-br from-primary/5 to-accent/5 border-2\">\n          <Users className=\"h-8 w-8 text-primary mx-auto mb-2\" />\n          <div className=\"text-3xl font-bold mb-1\">{totalReferrals}</div>\n          <div className=\"text-xs text-muted-foreground\">Total Referrals</div>\n        </Card>\n\n        <Card className=\"p-5 rounded-3xl text-center bg-gradient-to-br from-chart-4/5 to-green-500/5 border-2\">\n          <Sparkles className=\"h-8 w-8 text-chart-4 mx-auto mb-2\" />\n          <div className=\"text-3xl font-bold mb-1\">{earnedPoints}</div>\n          <div className=\"text-xs text-muted-foreground\">Points Earned</div>\n        </Card>\n      </div>\n\n      {/* Recent Referrals */}\n      {referrals.length > 0 && (\n        <Card className=\"p-6 rounded-3xl\">\n          <h3 className=\"font-bold text-lg mb-4\">Recent Referrals</h3>\n          <div className=\"space-y-3\">\n            {referrals.slice(0, 5).map((referral, index) => (\n              <div key={referral.id} className=\"flex items-center gap-3 p-3 rounded-2xl bg-muted/20\">\n                <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center font-bold text-primary\">\n                  {index + 1}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"font-semibold text-sm truncate\">\n                    {referral.referredAddress.slice(0, 6)}...{referral.referredAddress.slice(-4)}\n                  </div>\n                  <div className=\"text-xs text-muted-foreground\">\n                    {new Date(referral.createdAt).toLocaleDateString()}\n                  </div>\n                </div>\n                <Badge className=\"bg-green-500 text-white\">+100</Badge>\n              </div>\n            ))}\n          </div>\n        </Card>\n      )}\n\n      {/* How It Works */}\n      <Card className=\"p-6 rounded-3xl bg-gradient-to-br from-primary/5 to-accent/5 border-2\">\n        <h3 className=\"font-bold text-lg mb-4\">How It Works</h3>\n        <ul className=\"space-y-3 text-sm\">\n          <li className=\"flex items-start gap-3\">\n            <div className=\"w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center shrink-0 mt-0.5\">\n              <span className=\"text-xs font-bold text-primary\">1</span>\n            </div>\n            <span className=\"text-muted-foreground\">Share your unique referral link with friends</span>\n          </li>\n          <li className=\"flex items-start gap-3\">\n            <div className=\"w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center shrink-0 mt-0.5\">\n              <span className=\"text-xs font-bold text-primary\">2</span>\n            </div>\n            <span className=\"text-muted-foreground\">They sign up and create their first coin</span>\n          </li>\n          <li className=\"flex items-start gap-3\">\n            <div className=\"w-6 h-6 rounded-full bg-primary/20 flex items-center justify-center shrink-0 mt-0.5\">\n              <span className=\"text-xs font-bold text-primary\">3</span>\n            </div>\n            <span className=\"text-muted-foreground\">You both earn 100 E1XP points! üéâ</span>\n          </li>\n        </ul>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":10297},"client/src/lib/zora-coins.ts":{"content":"import type { Address, WalletClient, PublicClient, Hash } from \"viem\";\nimport { base, baseSepolia } from \"viem/chains\";\nimport { encodeAbiParameters, parseAbiParameters, parseUnits, decodeEventLog, keccak256 } from \"viem\";\n\n/**\n * Creates a coin using DIRECT CONTRACT CALLS on Base Sepolia testnet\n * Uses ETH as backing currency (only supported currency on Base Sepolia)\n * No SDK methods - pure contract interaction\n */\n\n// Zora Factory contract address (same on all chains)\nconst ZORA_FACTORY_ADDRESS = \"0x777777751622c0d3258f214F9DF38E35BF45baF3\" as const;\n\n// ETH address (zero address represents native ETH) - only for Base Mainnet\nconst ETH_ADDRESS = \"0x0000000000000000000000000000000000000000\" as const;\n\n// ZORA token address - required for Base Sepolia\nconst ZORA_ADDRESS = \"0x1111111111166b7fe7bd91427724b487980afc69\" as const;\n\n// Factory ABI - deployCreatorCoin function and CreatorCoinCreated event\nconst FACTORY_ABI = [\n  {\n    name: \"deployCreatorCoin\",\n    type: \"function\",\n    stateMutability: \"payable\",\n    inputs: [\n      { name: \"payoutRecipient\", type: \"address\" },\n      { name: \"owners\", type: \"address[]\" },\n      { name: \"uri\", type: \"string\" },\n      { name: \"name\", type: \"string\" },\n      { name: \"symbol\", type: \"string\" },\n      { name: \"poolConfig\", type: \"bytes\" },\n      { name: \"platformReferrer\", type: \"address\" },\n      { name: \"coinSalt\", type: \"bytes32\" }\n    ],\n    outputs: [\n      { name: \"coin\", type: \"address\" }\n    ]\n  },\n  {\n    name: \"CreatorCoinCreated\",\n    type: \"event\",\n    anonymous: false,\n    inputs: [\n      { indexed: true, name: \"caller\", type: \"address\" },\n      { indexed: true, name: \"payoutRecipient\", type: \"address\" },\n      { indexed: true, name: \"platformReferrer\", type: \"address\" },\n      { indexed: false, name: \"currency\", type: \"address\" },\n      { indexed: false, name: \"uri\", type: \"string\" },\n      { indexed: false, name: \"name\", type: \"string\" },\n      { indexed: false, name: \"symbol\", type: \"string\" },\n      { indexed: false, name: \"coin\", type: \"address\" },\n      { \n        indexed: false, \n        name: \"poolKey\", \n        type: \"tuple\",\n        components: [\n          { name: \"currency0\", type: \"address\" },\n          { name: \"currency1\", type: \"address\" },\n          { name: \"fee\", type: \"uint24\" },\n          { name: \"tickSpacing\", type: \"int24\" },\n          { name: \"hooks\", type: \"address\" }\n        ]\n      },\n      { indexed: false, name: \"poolKeyHash\", type: \"bytes32\" },\n      { indexed: false, name: \"version\", type: \"string\" }\n    ]\n  },\n  {\n    name: \"CoinCreatedV4\",\n    type: \"event\",\n    anonymous: false,\n    inputs: [\n      { indexed: true, name: \"caller\", type: \"address\" },\n      { indexed: true, name: \"payoutRecipient\", type: \"address\" },\n      { indexed: true, name: \"platformReferrer\", type: \"address\" },\n      { indexed: false, name: \"currency\", type: \"address\" },\n      { indexed: false, name: \"uri\", type: \"string\" },\n      { indexed: false, name: \"name\", type: \"string\" },\n      { indexed: false, name: \"symbol\", type: \"string\" },\n      { indexed: false, name: \"coin\", type: \"address\" },\n      { \n        indexed: false, \n        name: \"poolKey\", \n        type: \"tuple\",\n        components: [\n          { name: \"currency0\", type: \"address\" },\n          { name: \"currency1\", type: \"address\" },\n          { name: \"fee\", type: \"uint24\" },\n          { name: \"tickSpacing\", type: \"int24\" },\n          { name: \"hooks\", type: \"address\" }\n        ]\n      },\n      { indexed: false, name: \"poolKeyHash\", type: \"bytes32\" },\n      { indexed: false, name: \"version\", type: \"string\" }\n    ]\n  }\n] as const;\n\n// ETH-paired pool configuration (Base Mainnet only)\nconst ETH_COIN_PAIR_LOWER_TICK = -138_000;\nconst ETH_COIN_PAIR_UPPER_TICK = -81_000;\n\n// ZORA-paired pool configuration (Base Sepolia and Base Mainnet)\n// These tick values match the official Zora SDK defaults\n// Both ETH and ZORA pools use the same tick range, only currency differs\nconst ZORA_COIN_PAIR_LOWER_TICK = -138_000;\nconst ZORA_COIN_PAIR_UPPER_TICK = -81_000;\n\n// Common pool settings\nconst COIN_PAIR_NUM_DISCOVERY_POSITIONS = 11;\nconst COIN_PAIR_MAX_DISCOVERY_SUPPLY_SHARE = parseUnits(\"0.05\", 18); // 5%\n\n/**\n * Encode pool configuration based on network\n * - Base Sepolia: ZORA token pairing (only supported option)\n * - Base Mainnet: ZORA token pairing (recommended, same as production coins)\n */\nfunction encodePoolConfig(chainId: number): `0x${string}` {\n  const version = 4; // Version 4 is current\n  \n  // Use ZORA token pairing for both networks (Base Sepolia requires it, Base Mainnet uses it for consistency)\n  const currency = ZORA_ADDRESS;\n  const lowerTick = ZORA_COIN_PAIR_LOWER_TICK;\n  const upperTick = ZORA_COIN_PAIR_UPPER_TICK;\n\n  console.log(`üîß Using ZORA as paired currency for chain ${chainId}`);\n  console.log(`üìä Tick range: ${lowerTick} to ${upperTick}`);\n\n  return encodeAbiParameters(\n    parseAbiParameters('uint8, address, int24[], int24[], uint16[], uint256[]'),\n    [\n      version,                                       // version (uint8)\n      currency,                                      // currency (ZORA token)\n      [lowerTick],                                   // tickLower (int24[])\n      [upperTick],                                   // tickUpper (int24[])\n      [COIN_PAIR_NUM_DISCOVERY_POSITIONS],          // numDiscoveryPositions (uint16[])\n      [COIN_PAIR_MAX_DISCOVERY_SUPPLY_SHARE]        // maxDiscoverySupplyShare (uint256[])\n    ]\n  );\n}\n\nexport interface CreateCoinParams {\n  creator: Address;\n  name: string;\n  symbol: string;\n  metadataUri: string;\n  platformReferrer?: Address;\n  startingMarketCap?: \"LOW\" | \"MEDIUM\" | \"HIGH\";\n}\n\nexport interface CreateCoinResult {\n  hash: Hash;\n  address: Address;\n  createdAt: string;\n}\n\n/**\n * Creates a coin on Base Sepolia using DIRECT CONTRACT CALL (no SDK)\n * \n * @param params - Coin creation parameters\n * @param walletClient - Viem wallet client for signing transactions\n * @param publicClient - Viem public client for reading blockchain state\n * @returns Transaction hash, deployed coin address, and creation timestamp\n */\nexport async function createCoinOnBaseSepolia(\n  params: CreateCoinParams,\n  walletClient: WalletClient,\n  publicClient: PublicClient\n): Promise<CreateCoinResult> {\n  console.log(\"ü™ô Creating coin with params:\", params);\n\n  const { deployCreatorCoinDirect } = await import(\"./zora-factory\");\n\n  // Check network preference from localStorage (set by admin)\n  const networkPreference = localStorage.getItem('ADMIN_NETWORK_PREFERENCE') as 'sepolia' | 'mainnet' | null;\n  const chainId = networkPreference === 'mainnet' ? base.id : baseSepolia.id;\n\n  console.log(`üì° Using network: ${networkPreference === 'mainnet' ? 'Base Mainnet' : 'Base Sepolia'} (Chain ID: ${chainId})`);\n\n  // Check ZORA token balance for the creator wallet\n  const ERC20_ABI = [{\n    name: 'balanceOf',\n    type: 'function',\n    stateMutability: 'view',\n    inputs: [{ name: 'account', type: 'address' }],\n    outputs: [{ name: 'balance', type: 'uint256' }]\n  }] as const;\n\n  try {\n    console.log(\"üí∞ Checking ZORA token balance for:\", params.creator);\n    const zoraBalance = await publicClient.readContract({\n      address: ZORA_ADDRESS,\n      abi: ERC20_ABI,\n      functionName: 'balanceOf',\n      args: [params.creator]\n    });\n\n    console.log(\"üí∞ ZORA balance:\", zoraBalance.toString());\n\n    if (zoraBalance === BigInt(0)) {\n      throw new Error(\n        `‚ùå No ZORA tokens available!\\n\\n` +\n        `Your wallet ${params.creator} needs ZORA tokens to create a coin on Base Sepolia.\\n\\n` +\n        `Please get test ZORA tokens from:\\n` +\n        `üîó https://bridge.zora.energy/ (Bridge from Ethereum Sepolia)\\n` +\n        `üîó Or use a faucet to get Sepolia ETH first, then bridge to ZORA\\n\\n` +\n        `Note: Gasless deployment still requires ZORA tokens as the pool backing currency.`\n      );\n    }\n\n    // Generate deterministic salt using stable parameters\n    // This allows reproducible addresses for the same inputs (name, symbol, creator, metadataUri)\n    const coinSalt = keccak256(\n      encodeAbiParameters(\n        parseAbiParameters('address, string, string, string'),\n        [params.creator, params.name, params.symbol, params.metadataUri]\n      )\n    );\n    \n    console.log(\"üîê Generated deterministic coin salt:\", coinSalt);\n\n    // Simulate the contract call first to catch errors\n    console.log(\"üîß Simulating contract call...\");\n\n    const { request } = await publicClient.simulateContract({\n      address: ZORA_FACTORY_ADDRESS,\n      abi: FACTORY_ABI,\n      functionName: \"deployCreatorCoin\",\n      args: [\n        params.creator,              // payoutRecipient\n        [params.creator],            // owners array\n        params.metadataUri,          // uri\n        params.name,                 // name\n        params.symbol,               // symbol\n        encodePoolConfig(chainId),   // poolConfig (ZORA on Sepolia, ETH on Mainnet)\n        params.platformReferrer as Address || \"0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7\", // platformReferrer\n        coinSalt                     // coinSalt (for deterministic deployment)\n      ],\n      account: params.creator,\n      chain: chainId === baseSepolia.id ? baseSepolia : base,\n    });\n\n    console.log(\"‚úÖ Contract simulation successful\");\n    console.log(\"üì§ Sending transaction to factory contract...\");\n\n    // Execute the transaction\n    const hash = await walletClient.writeContract(request);\n\n    console.log(\"‚úÖ Transaction sent! Hash:\", hash);\n    console.log(\"‚è≥ Waiting for confirmation...\");\n\n    // Wait for transaction receipt\n    const receipt = await publicClient.waitForTransactionReceipt({ \n      hash,\n      confirmations: 1 \n    });\n\n    console.log(\"‚úÖ Transaction confirmed!\");\n\n    // Decode the coin creation event to extract the deployed coin address\n    // Support both CreatorCoinCreated and CoinCreatedV4 events\n    let coinAddress: Address | undefined;\n\n    for (const log of receipt.logs) {\n      try {\n        const decodedLog = decodeEventLog({\n          abi: FACTORY_ABI,\n          data: log.data,\n          topics: log.topics,\n        });\n\n        // Check if this is either CreatorCoinCreated or CoinCreatedV4 event\n        if (decodedLog.eventName === \"CreatorCoinCreated\" || decodedLog.eventName === \"CoinCreatedV4\") {\n          coinAddress = (decodedLog.args as any).coin;\n          console.log(`‚úÖ Decoded ${decodedLog.eventName} event`);\n          console.log(\"üìç Deployed coin address:\", coinAddress);\n          break;\n        }\n      } catch (error) {\n        // Skip logs that don't match our ABI - this is expected for other contract events\n        continue;\n      }\n    }\n\n    if (!coinAddress) {\n      throw new Error(\"Failed to extract coin address from transaction logs - neither CreatorCoinCreated nor CoinCreatedV4 event found\");\n    }\n\n    console.log(\"üéâ Coin deployed at address:\", coinAddress);\n\n    // Get blockchain timestamp\n    const block = await publicClient.getBlock({ \n      blockNumber: receipt.blockNumber \n    });\n    const createdAt = new Date(Number(block.timestamp) * 1000).toISOString();\n\n    console.log(\"‚úÖ Coin creation successful!\");\n    console.log(\"üìç Address:\", coinAddress);\n    console.log(\"‚è∞ Created at:\", createdAt);\n    console.log(\"üîó View on explorer:\", \n      chainId === baseSepolia.id \n        ? `https://sepolia.basescan.org/address/${coinAddress}` \n        : `https://basescan.org/address/${coinAddress}`\n    );\n\n    return {\n      hash,\n      address: coinAddress,\n      createdAt,\n    };\n  } catch (error) {\n    console.error(\"‚ùå Coin creation failed:\", error);\n\n    if (error instanceof Error) {\n      console.error(\"Error message:\", error.message);\n      console.error(\"Error stack:\", error.stack);\n    }\n\n    throw error;\n  }\n}\n\n/**\n * Generates an automatic coin symbol based on platform, channel name, or content\n * Users cannot edit this - it's auto-generated from the source\n * \n * @param data - Scraped content data with platform info\n * @returns Auto-generated symbol (3-10 characters, uppercase, alphanumeric)\n */\nexport function generateCoinSymbol(data: {\n  platform?: string;\n  author?: string;\n  title?: string;\n  url?: string;\n}): string {\n  // Priority order: author name > channel/account name from URL > title\n\n  // 1. Try to use author/channel name if available\n  if (data.author) {\n    const symbol = data.author\n      .replace(/[^a-zA-Z0-9\\s]/g, '') // Remove special characters\n      .trim()\n      .split(/\\s+/) // Split on whitespace\n      .filter(word => word.length > 0)\n      .slice(0, 3) // Take first 3 words max\n      .map(word => word[0]) // First letter of each word\n      .join('')\n      .toUpperCase();\n\n    if (symbol.length >= 3) {\n      return symbol.slice(0, 10); // Max 10 characters\n    }\n  }\n\n  // 2. Try to extract username/channel from URL\n  if (data.url) {\n    const urlPatterns = [\n      /youtube\\.com\\/@([^\\/\\?]+)/i, // YouTube @username\n      /youtube\\.com\\/c\\/([^\\/\\?]+)/i, // YouTube /c/channel\n      /youtube\\.com\\/channel\\/([^\\/\\?]+)/i, // YouTube /channel/ID\n      /twitter\\.com\\/([^\\/\\?]+)/i, // Twitter @username\n      /x\\.com\\/([^\\/\\?]+)/i, // X.com @username  \n      /instagram\\.com\\/([^\\/\\?]+)/i, // Instagram @username\n      /tiktok\\.com\\/@([^\\/\\?]+)/i, // TikTok @username\n      /medium\\.com\\/@([^\\/\\?]+)/i, // Medium @username\n      /substack\\.com\\/([^\\/\\?]+)/i, // Substack username\n    ];\n\n    for (const pattern of urlPatterns) {\n      const match = data.url.match(pattern);\n      if (match && match[1]) {\n        const username = match[1]\n          .replace(/[^a-zA-Z0-9]/g, '')\n          .toUpperCase()\n          .slice(0, 10);\n\n        if (username.length >= 3) {\n          return username;\n        }\n      }\n    }\n  }\n\n  // 3. Fall back to title-based symbol\n  if (data.title) {\n    const words = data.title\n      .replace(/[^a-zA-Z0-9\\s]/g, '')\n      .trim()\n      .split(/\\s+/)\n      .filter(word => word.length > 0);\n\n    if (words.length >= 2) {\n      // Multi-word: take first letter of each word\n      const symbol = words\n        .slice(0, 5)\n        .map(w => w[0])\n        .join('')\n        .toUpperCase();\n      return symbol.slice(0, 10);\n    } else if (words.length === 1) {\n      // Single word: take first 3-5 characters\n      return words[0].slice(0, 5).toUpperCase();\n    }\n  }\n\n  // 4. Last resort: platform-based symbol\n  const platformMap: Record<string, string> = {\n    youtube: \"YT\",\n    twitter: \"TW\",\n    instagram: \"IG\",\n    tiktok: \"TT\",\n    medium: \"MDM\",\n    substack: \"SUB\",\n    spotify: \"SPT\",\n  };\n\n  const platformSymbol = data.platform ? platformMap[data.platform.toLowerCase()] : null;\n\n  if (platformSymbol) {\n    return platformSymbol + Math.floor(Math.random() * 1000); // e.g., YT123\n  }\n\n  // Final fallback\n  return \"COIN\" + Math.floor(Math.random() * 1000);\n}","size_bytes":14853},"client/src/pages/points.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Gift, Zap, Trophy, Star, TrendingUp, Calendar } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport confetti from \"canvas-confetti\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport default function Points() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { authenticated, user, getAccessToken } = usePrivy();\n  const address = user?.wallet?.address;\n\n  const {\n    data: status,\n    isLoading: statusLoading,\n    isError: statusError,\n  } = useQuery({\n    queryKey: [\"/api/e1xp/status\", authenticated],\n    queryFn: async () => {\n      const headers: Record<string, string> = {};\n      if (authenticated) {\n        try {\n          const accessToken = await getAccessToken();\n          if (accessToken) {\n            headers.Authorization = `Bearer ${accessToken}`;\n          }\n        } catch (error) {\n          console.error('Failed to get access token:', error);\n        }\n      }\n      const response = await fetch(\"/api/e1xp/status\", {\n        credentials: \"include\",\n        headers,\n      });\n      if (!response.ok) throw new Error('Failed to fetch status');\n      return response.json();\n    },\n  });\n\n  const {\n    data: notifications,\n    isLoading: notificationsLoading,\n    isError: notificationsError,\n  } = useQuery({\n    queryKey: [\"/api/e1xp/notifications\"],\n    enabled: authenticated,\n    queryFn: async () => {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {};\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(\"/api/e1xp/notifications\", {\n        credentials: \"include\",\n        headers,\n      });\n      if (!response.ok) throw new Error('Failed to fetch notifications');\n      return response.json();\n    },\n  });\n\n  const {\n    data: unclaimedRewards,\n    isLoading: unclaimedRewardsLoading,\n    isError: unclaimedRewardsError,\n  } = useQuery({\n    queryKey: [\"/api/e1xp/rewards/unclaimed\"],\n    enabled: authenticated,\n    queryFn: async () => {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {};\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(\"/api/e1xp/rewards/unclaimed\", {\n        credentials: \"include\",\n        headers,\n      });\n      if (!response.ok) throw new Error('Failed to fetch unclaimed rewards');\n      return response.json();\n    },\n  });\n\n  const claimDailyMutation = useMutation({\n    mutationFn: async () => {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {\n        'Content-Type': 'application/json',\n      };\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(\"/api/e1xp/claim-daily\", {\n        method: \"POST\",\n        headers,\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to claim daily points\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      // Trigger confetti celebration\n      confetti({\n        particleCount: 100,\n        spread: 70,\n        origin: { y: 0.6 },\n        colors: ['#10b981', '#34d399', '#6ee7b7', '#a7f3d0']\n      });\n\n      toast({\n        title: \"üéâ Points Claimed!\",\n        description: `You earned ${data.pointsEarned} E1XP! ${data.streak > 1 ? `${data.streak} day streak! üî•` : ''}`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/e1xp/status\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/e1xp/notifications\"] });\n    },\n    onError: (error: Error) => {\n      // Check if already claimed today\n      if (error.message.includes(\"already\") || error.message.includes(\"duplicate\")) {\n        toast({\n          title: \"‚úÖ Already Claimed Today!\",\n          description: \"You've already claimed your daily points. Come back tomorrow for more E1XP! üî•\",\n        });\n      } else {\n        toast({\n          title: \"‚ùå Error\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const claimRewardMutation = useMutation({\n    mutationFn: async (rewardId: string) => {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {\n        'Content-Type': 'application/json',\n      };\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(`/api/e1xp/rewards/${rewardId}/claim`, {\n        method: \"POST\",\n        headers,\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to claim reward\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      // Trigger confetti celebration\n      confetti({\n        particleCount: 150,\n        spread: 100,\n        origin: { y: 0.6 },\n        colors: ['#a855f7', '#ec4899', '#f472b6', '#fb923c']\n      });\n\n      toast({\n        title: \"üéâ Reward Claimed!\",\n        description: data.message,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/e1xp/status\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/e1xp/rewards/unclaimed\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/e1xp/notifications\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"‚ùå Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const points = status?.points || 0;\n  const streak = status?.streak || 0;\n  const nextClaimAmount = status?.nextClaimAmount || 10;\n  const canClaimDaily = status?.canClaimDaily ?? true;\n  const daysUntilBonus = status?.daysUntilBonus || 7;\n\n  if (!authenticated) {\n    return (\n      <div className=\"w-full max-w-5xl mx-auto px-4 py-6\">\n        <div className=\"text-center space-y-4 py-12\">\n          <Zap className=\"h-16 w-16 text-muted-foreground mx-auto\" />\n          <h2 className=\"text-2xl font-bold\">Sign In Required</h2>\n          <p className=\"text-muted-foreground\">\n            Please sign in to view your E1XP points and rewards\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (statusLoading) {\n    return (\n      <div className=\"w-full max-w-5xl mx-auto px-4 py-6 space-y-6\">\n        <div className=\"text-center space-y-2\">\n          <Skeleton className=\"h-9 w-48 mx-auto\" />\n          <Skeleton className=\"h-5 w-64 mx-auto\" />\n        </div>\n\n        <Card className=\"p-6 rounded-2xl border\">\n          <div className=\"text-center space-y-4\">\n            <Skeleton className=\"w-24 h-24 rounded-full mx-auto\" />\n            <div className=\"space-y-2\">\n              <Skeleton className=\"h-4 w-32 mx-auto\" />\n              <Skeleton className=\"h-6 w-24 mx-auto\" />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6 rounded-2xl\">\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <Skeleton className=\"h-12 w-48\" />\n              <Skeleton className=\"h-12 w-20\" />\n            </div>\n            <Skeleton className=\"h-10 w-full\" />\n          </div>\n        </Card>\n\n        <Card className=\"p-6 rounded-2xl\">\n          <Skeleton className=\"h-6 w-48 mb-4\" />\n          <div className=\"space-y-2\">\n            {[...Array(6)].map((_, i) => (\n              <Skeleton key={i} className=\"h-16 w-full rounded-lg\" />\n            ))}\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full max-w-5xl mx-auto px-4 py-6 space-y-6\">\n      {/* Header */}\n      <div className=\"text-center space-y-2\">\n        <h1 className=\"text-3xl font-bold\">E1XP Points</h1>\n        <p className=\"text-muted-foreground\">Earn rewards for your activity</p>\n      </div>\n\n      {/* Total Points Card */}\n      <Card className=\"p-6 rounded-2xl border\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"relative inline-block\">\n            <div className=\"relative bg-primary/10 rounded-full w-24 h-24 mx-auto flex items-center justify-center\">\n              <div className=\"text-center\">\n                <Zap className=\"h-8 w-8 text-primary mx-auto mb-1\" />\n                <div className=\"text-3xl font-bold text-primary\">\n                  {points}\n                </div>\n              </div>\n            </div>\n          </div>\n          <div>\n            <div className=\"text-sm text-muted-foreground\">Total E1XP Points</div>\n            <div className=\"flex items-center justify-center gap-2 mt-2\">\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                üî• {streak} day streak\n              </Badge>\n            </div>\n          </div>\n        </div>\n      </Card>\n\n      {/* Daily Claim Card */}\n      <Card className=\"p-6 rounded-2xl\">\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-primary/10\">\n                <Gift className=\"h-5 w-5 text-primary\" />\n              </div>\n              <div>\n                <div className=\"font-semibold\">Daily Bonus</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  {canClaimDaily ? \"Available to claim!\" : \"Come back tomorrow\"}\n                </div>\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-2xl font-bold text-primary\">+{nextClaimAmount}</div>\n              <div className=\"text-xs text-muted-foreground\">E1XP</div>\n            </div>\n          </div>\n\n          <Button\n            onClick={() => claimDailyMutation.mutate()}\n            disabled={!canClaimDaily || claimDailyMutation.isPending}\n            className=\"w-full h-10\"\n          >\n            {claimDailyMutation.isPending ? (\n              \"Claiming...\"\n            ) : canClaimDaily ? (\n              <>\n                <Gift className=\"h-4 w-4 mr-2\" />\n                Claim Daily Bonus\n              </>\n            ) : (\n              <>\n                <Calendar className=\"h-4 w-4 mr-2\" />\n                Already Claimed Today\n              </>\n            )}\n          </Button>\n\n          {daysUntilBonus < 7 && (\n            <div className=\"p-3 rounded-lg bg-accent/50\">\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Star className=\"h-4 w-4 text-primary\" />\n                <span>{daysUntilBonus} days until 7-day streak bonus!</span>\n              </div>\n            </div>\n          )}\n        </div>\n      </Card>\n\n      {/* How to Earn Points */}\n      <Card className=\"p-6 rounded-2xl\">\n        <h3 className=\"font-bold text-lg mb-4 flex items-center gap-2\">\n          <TrendingUp className=\"h-5 w-5 text-primary\" />\n          How to Earn E1XP\n        </h3>\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center gap-3 p-3 rounded-lg bg-accent/30\">\n            <div className=\"text-xl\">üéÅ</div>\n            <div className=\"flex-1\">\n              <div className=\"font-medium text-sm\">Daily Login</div>\n              <div className=\"text-xs text-muted-foreground\">10+ points every day</div>\n            </div>\n            <Badge variant=\"secondary\" className=\"text-xs\">10 E1XP</Badge>\n          </div>\n\n          <div className=\"flex items-center gap-3 p-3 rounded-lg bg-accent/30\">\n            <div className=\"text-xl\">üî•</div>\n            <div className=\"flex-1\">\n              <div className=\"font-medium text-sm\">7-Day Streak</div>\n              <div className=\"text-xs text-muted-foreground\">Keep logging in</div>\n            </div>\n            <Badge variant=\"secondary\" className=\"text-xs\">50 E1XP</Badge>\n          </div>\n\n          <div className=\"flex items-center gap-3 p-3 rounded-lg bg-accent/30\">\n            <div className=\"text-xl\">üí∞</div>\n            <div className=\"flex-1\">\n              <div className=\"font-medium text-sm\">Trade Coins</div>\n              <div className=\"text-xs text-muted-foreground\">Buy or sell</div>\n            </div>\n            <Badge variant=\"secondary\" className=\"text-xs\">5 E1XP</Badge>\n          </div>\n\n          <div className=\"flex items-center gap-3 p-3 rounded-lg bg-accent/30\">\n            <div className=\"text-xl\">üé®</div>\n            <div className=\"flex-1\">\n              <div className=\"font-medium text-sm\">Create Coin</div>\n              <div className=\"text-xs text-muted-foreground\">Launch your coin</div>\n            </div>\n            <Badge variant=\"secondary\" className=\"text-xs\">100 E1XP</Badge>\n          </div>\n\n          <div className=\"flex items-center gap-3 p-3 rounded-lg bg-accent/30\">\n            <div className=\"text-xl\">ü§ù</div>\n            <div className=\"flex-1\">\n              <div className=\"font-medium text-sm\">Refer Friends</div>\n              <div className=\"text-xs text-muted-foreground\">Get signup bonus</div>\n            </div>\n            <Badge variant=\"secondary\" className=\"text-xs\">500 E1XP</Badge>\n          </div>\n\n          <div className=\"flex items-center gap-3 p-3 rounded-lg bg-accent/30\">\n            <div className=\"text-xl\">üèÜ</div>\n            <div className=\"flex-1\">\n              <div className=\"font-medium text-sm\">Unlock Badges</div>\n              <div className=\"text-xs text-muted-foreground\">Reach milestones</div>\n            </div>\n            <Badge variant=\"secondary\" className=\"text-xs\">50 E1XP</Badge>\n          </div>\n        </div>\n      </Card>\n\n      {/* Unclaimed Rewards */}\n      {unclaimedRewards && unclaimedRewards.length > 0 && (\n        <Card className=\"p-6 rounded-2xl border-primary/20\">\n          <h3 className=\"font-bold text-lg mb-4 flex items-center gap-2\">\n            <Gift className=\"h-5 w-5 text-primary\" />\n            Unclaimed Rewards\n          </h3>\n          <div className=\"space-y-2\">\n            {unclaimedRewards.map((reward: any) => (\n              <div\n                key={reward.id}\n                className=\"p-3 rounded-lg bg-accent/30 border\"\n              >\n                <div className=\"flex items-start justify-between gap-3\">\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium text-sm mb-1\">{reward.title}</div>\n                    <div className=\"text-xs text-muted-foreground mb-2\">\n                      {reward.message}\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        <Zap className=\"h-3 w-3 mr-1\" />\n                        {reward.amount} E1XP\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {reward.type === 'coin_creation' && 'ü™ô Coin'}\n                        {reward.type === 'referral' && 'üë• Referral'}\n                        {reward.type === 'daily_streak' && 'üî• Streak'}\n                        {reward.type === 'first_trade' && 'üí∞ Trade'}\n                      </Badge>\n                    </div>\n                  </div>\n                  <Button\n                    onClick={() => claimRewardMutation.mutate(reward.id)}\n                    disabled={claimRewardMutation.isPending}\n                    size=\"sm\"\n                  >\n                    {claimRewardMutation.isPending ? (\n                      \"Claiming...\"\n                    ) : (\n                      <>\n                        <Gift className=\"h-4 w-4 mr-1\" />\n                        Claim\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </div>\n            ))}\n          </div>\n        </Card>\n      )}\n\n      {/* Recent Activity */}\n      {notifications && Array.isArray(notifications) && notifications.length > 0 && (\n        <Card className=\"p-6 rounded-2xl\">\n          <h3 className=\"font-bold text-lg mb-4\">Recent Activity</h3>\n          <div className=\"space-y-2\">\n            {notifications.slice(0, 5).map((notification: any) => (\n              <div\n                key={notification.id}\n                className={`p-3 rounded-lg ${\n                  !notification.read ? \"bg-accent/50\" : \"bg-accent/20\"\n                }`}\n              >\n                <div className=\"font-medium text-sm\">{notification.title}</div>\n                <div className=\"text-xs text-muted-foreground\">\n                  {notification.message}\n                </div>\n              </div>\n            ))}\n          </div>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":17017},"server/reward-reminder-cron.ts":{"content":"import { storage } from './supabase-storage';\nimport { sendTelegramNotification } from './telegram-bot';\n\n/**\n * Send reminders for unclaimed E1XP rewards\n * Runs daily to remind users about rewards they haven't claimed\n */\nexport async function sendUnclaimedRewardReminders() {\n  console.log('üîî Starting unclaimed E1XP reward reminder check...');\n\n  try {\n    // Get all users with unclaimed rewards\n    const { data: unclaimedRewards, error } = await storage.supabase\n      .from('e1xp_rewards')\n      .select('*, users(*)')\n      .eq('claimed', false)\n      .lt('created_at', new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString());\n\n    if (error) throw error;\n\n    if (!unclaimedRewards || unclaimedRewards.length === 0) {\n      console.log('‚úÖ No unclaimed rewards to remind about');\n      return;\n    }\n\n    console.log(`üìß Found ${unclaimedRewards.length} unclaimed rewards to remind about`);\n\n    // Group rewards by user\n    const rewardsByUser = new Map<string, typeof unclaimedRewards>();\n    for (const reward of unclaimedRewards) {\n      const userRewards = rewardsByUser.get(reward.userId) || [];\n      userRewards.push(reward);\n      rewardsByUser.set(reward.userId, userRewards);\n    }\n\n    let remindersSent = 0;\n\n    // Send one reminder per user with all their unclaimed rewards\n    for (const [userId, userRewards] of rewardsByUser.entries()) {\n      try {\n        const totalAmount = userRewards.reduce((sum, r) => sum + parseInt(r.amount), 0);\n        const rewardCount = userRewards.length;\n\n        // Create reminder notification\n        await storage.createNotification({\n          userId,\n          type: 'reward',\n          title: '‚è∞ Don\\'t Forget Your E1XP!',\n          message: `You have ${rewardCount} unclaimed reward${rewardCount > 1 ? 's' : ''} worth ${totalAmount} E1XP! Claim them now in the Points page before they expire! üéÅ`,\n          amount: totalAmount.toString(),\n          read: false,\n        });\n\n        // Send Telegram reminder\n        await sendTelegramNotification(\n          userId,\n          '‚è∞ Unclaimed E1XP Rewards!',\n          `Don't forget! You have ${rewardCount} unclaimed reward${rewardCount > 1 ? 's' : ''} worth ${totalAmount} E1XP waiting for you! üéÅ\\n\\nClaim them now before they expire!`,\n          'reward'\n        );\n\n        // Mark reminders as sent\n        for (const reward of userRewards) {\n          await storage.markReminderSent(reward.id);\n        }\n\n        remindersSent++;\n      } catch (error) {\n        console.error(`Failed to send reminder to ${userId}:`, error);\n      }\n    }\n\n    console.log(`‚úÖ Sent ${remindersSent} reward reminders to users`);\n  } catch (error) {\n    console.error('‚ùå Error sending unclaimed reward reminders:', error);\n  }\n}\n\n// Run immediately if executed directly\nimport { fileURLToPath } from 'url';\nimport { dirname } from 'path';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\nif (import.meta.url === `file://${process.argv[1]}`) {\n  sendUnclaimedRewardReminders()\n    .then(() => process.exit(0))\n    .catch((error) => {\n      console.error(error);\n      process.exit(1);\n    });\n}","size_bytes":3160},"client/src/pages/admin-login.tsx":{"content":"\nimport { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Shield, Loader2 } from \"lucide-react\";\n\nexport default function AdminLogin() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [email, setEmail] = useState(\"\");\n\n  const loginMutation = useMutation({\n    mutationFn: async (email: string) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/login\", { email });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      if (data.success) {\n        toast({\n          title: \"Login Successful\",\n          description: \"Welcome to the admin panel\",\n        });\n        setLocation(\"/admin\");\n      } else {\n        toast({\n          title: \"Login Failed\",\n          description: data.error || \"Invalid credentials\",\n          variant: \"destructive\",\n        });\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Login Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!email) {\n      toast({\n        title: \"Email Required\",\n        description: \"Please enter your email address\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    loginMutation.mutate(email);\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-background to-accent/20 p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4\">\n            <Shield className=\"w-8 h-8 text-primary\" />\n          </div>\n          <CardTitle className=\"text-2xl\">Admin Login</CardTitle>\n          <CardDescription>\n            Enter your admin email to access the dashboard\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email Address</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"admin@creatorland.com\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                disabled={loginMutation.isPending}\n                autoFocus\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Only authorized admin emails can access the panel\n              </p>\n            </div>\n            <Button\n              type=\"submit\"\n              className=\"w-full\"\n              disabled={loginMutation.isPending}\n            >\n              {loginMutation.isPending ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  Logging in...\n                </>\n              ) : (\n                <>\n                  <Shield className=\"w-4 h-4 mr-2\" />\n                  Login to Admin Panel\n                </>\n              )}\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":3569},"client/src/pages/notifications.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Bell } from \"lucide-react\";\nimport type { Notification } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nexport default function Notifications() {\n  const { authenticated, user, getAccessToken } = usePrivy();\n  const queryClient = useQueryClient();\n  const userAddress = user?.wallet?.address;\n\n  const { data: notifications = [], isLoading } = useQuery<Notification[]>({\n    queryKey: [\"/api/e1xp/notifications\"],\n    enabled: authenticated,\n    refetchInterval: 10000,\n    queryFn: async () => {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {};\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(\"/api/e1xp/notifications\", {\n        credentials: \"include\",\n        headers,\n      });\n      if (!response.ok) throw new Error('Failed to fetch notifications');\n      return response.json();\n    },\n  });\n\n  const markAsReadMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {};\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(\n        `/api/e1xp/notifications/${notificationId}/read`,\n        {\n          method: \"PATCH\",\n          headers,\n        },\n      );\n      if (!response.ok) throw new Error(\"Failed to mark as read\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/e1xp/notifications\"],\n      });\n    },\n  });\n\n  const markAllAsReadMutation = useMutation({\n    mutationFn: async () => {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {};\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(\n        `/api/e1xp/notifications/read-all`,\n        {\n          method: \"PATCH\",\n          headers,\n        },\n      );\n      if (!response.ok) throw new Error(\"Failed to mark all as read\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/e1xp/notifications\"],\n      });\n    },\n  });\n\n  const unreadCount = notifications.filter((n) => !n.read).length;\n\n  const handleNotificationClick = (notification: Notification) => {\n    if (!notification.read) {\n      markAsReadMutation.mutate(notification.id);\n    }\n  };\n\n  const handleMarkAllAsRead = () => {\n    if (unreadCount > 0) {\n      markAllAsReadMutation.mutate();\n    }\n  };\n\n  // Group notifications by date\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n\n  const todayNotifications = notifications.filter((n) => {\n    if (!n.createdAt) return false;\n    const notifDate = new Date(n.createdAt);\n    notifDate.setHours(0, 0, 0, 0);\n    return notifDate.getTime() === today.getTime();\n  });\n\n  const yesterdayNotifications = notifications.filter((n) => {\n    if (!n.createdAt) return false;\n    const notifDate = new Date(n.createdAt);\n    notifDate.setHours(0, 0, 0, 0);\n    return notifDate.getTime() === yesterday.getTime();\n  });\n\n  const olderNotifications = notifications.filter((n) => {\n    if (!n.createdAt) return false;\n    const notifDate = new Date(n.createdAt);\n    notifDate.setHours(0, 0, 0, 0);\n    return notifDate.getTime() < yesterday.getTime();\n  });\n\n  const undatedNotifications = notifications.filter((n) => !n.createdAt);\n\n  const unreadNotifications = notifications.filter((n) => !n.read);\n\n  const getNotificationIcon = (type: string) => {\n    const icons = {\n        referral: { emoji: \"üéÅ\", color: \"from-lime-500 to-lime-600\" },\n        reward: { emoji: \"üèÜ\", color: \"from-yellow-500 to-orange-500\" },\n        trade: { emoji: \"üìà\", color: \"from-blue-500 to-blue-600\" },\n        streak: { emoji: \"üî•\", color: \"from-orange-500 to-red-500\" },\n        welcome: { emoji: \"üëã\", color: \"from-green-500 to-emerald-600\" },\n        admin: { emoji: \"üí¨\", color: \"from-purple-500 to-purple-600\" },\n        milestone: { emoji: \"üéØ\", color: \"from-pink-500 to-pink-600\" },\n        follower: { emoji: \"üë•\", color: \"from-indigo-500 to-indigo-600\" },\n        points_earned: { emoji: \"‚≠ê\", color: \"from-amber-500 to-amber-600\" },\n        trade_completed: { emoji: \"‚úÖ\", color: \"from-teal-500 to-teal-600\" },\n        points: { emoji: \"‚ö°\", color: \"from-yellow-400 to-yellow-500\" },\n        reminder: { emoji: \"‚è∞\", color: \"from-blue-400 to-blue-500\" },\n        coin_created: { emoji: \"ü™ô\", color: \"from-purple-400 to-purple-500\" },\n        message: { emoji: \"üí¨\", color: \"from-cyan-500 to-cyan-600\" },\n      };\n\n    return (\n      icons[type as keyof typeof icons] || {\n        emoji: \"üîî\",\n        color: \"from-gray-500 to-gray-600\",\n      }\n    );\n  };\n\n  const formatTimeAgo = (date: Date | string | undefined) => {\n    if (!date) return \"recently\";\n\n    const notifDate = new Date(date);\n    if (isNaN(notifDate.getTime())) return \"recently\";\n\n    const now = new Date();\n    const seconds = Math.floor((now.getTime() - notifDate.getTime()) / 1000);\n\n    // Handle future dates (shouldn't happen, but just in case)\n    if (seconds < 0) {\n      const hours = notifDate.getHours();\n      const minutes = notifDate.getMinutes();\n      return `${hours.toString().padStart(2, \"0\")}:${minutes.toString().padStart(2, \"0\")}`;\n    }\n\n    if (seconds < 60) return \"just now\";\n    if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;\n    if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;\n    \n    // For older notifications, show the date\n    const monthDay = `${notifDate.getMonth() + 1}/${notifDate.getDate()}`;\n    if (seconds < 31536000) return monthDay; // Less than a year\n    \n    return `${monthDay}/${notifDate.getFullYear().toString().slice(-2)}`;\n  };\n\n  const NotificationItem = ({\n    notification,\n  }: {\n    notification: Notification;\n  }) => {\n    const icon = getNotificationIcon(notification.type);\n\n    return (\n      <div\n        onClick={() => handleNotificationClick(notification)}\n        className={`flex items-start gap-3 px-3 py-2.5 hover:bg-accent/50 cursor-pointer transition-all border-b rounded-lg border-border/40 last:border-0 ${\n          !notification.read ? \"bg-primary/5 dark:bg-primary/10\" : \"\"\n        }`}\n        data-testid={`notification-item-${notification.id}`}\n      >\n        {!notification.read && (\n          <div className=\"w-2 h-2 bg-primary rounded-full mt-2 flex-shrink-0\" />\n        )}\n        <div\n          className={`h-9 w-9 flex-shrink-0 bg-gradient-to-br ${icon.color} rounded-full flex items-center justify-center text-lg shadow-sm`}\n        >\n          {icon.emoji}\n        </div>\n        <div className=\"flex-1 min-w-0 pr-2\">\n          <p className=\"text-sm font-medium text-foreground leading-tight mb-0.5\">\n            {notification.title}\n          </p>\n          <p className=\"text-xs text-muted-foreground leading-snug line-clamp-2\">\n            {notification.message}\n          </p>\n          {notification.coinSymbol && (\n            <Badge variant=\"secondary\" className=\"text-[10px] h-4 px-1.5 mt-1\">\n              {notification.coinSymbol}\n            </Badge>\n          )}\n        </div>\n        <span className=\"text-[11px] text-muted-foreground/70 whitespace-nowrap flex-shrink-0 mt-0.5\">\n          {formatTimeAgo(notification.createdAt)}\n        </span>\n      </div>\n    );\n  };\n\n  if (!authenticated) {\n    return (\n      <div className=\"w-full max-w-2xl mx-auto px-4 py-6\">\n        <div className=\"text-center space-y-4 py-12\">\n          <Bell className=\"h-16 w-16 text-muted-foreground mx-auto\" />\n          <h2 className=\"text-2xl font-bold\">Connect Your Wallet</h2>\n          <p className=\"text-muted-foreground\">\n            Please connect your wallet to view your notifications\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"w-full max-w-2xl mx-auto px-4 py-4 space-y-4\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <Skeleton className=\"h-8 w-40\" />\n          <Skeleton className=\"h-8 w-32\" />\n        </div>\n        <Skeleton className=\"h-9 w-full\" />\n        <div className=\"space-y-2\">\n          {[...Array(8)].map((_, i) => (\n            <div key={i} className=\"flex gap-3 p-3 border-b\">\n              <Skeleton className=\"h-9 w-9 rounded-full flex-shrink-0\" />\n              <div className=\"flex-1 space-y-1.5\">\n                <Skeleton className=\"h-3 w-3/4\" />\n                <Skeleton className=\"h-3 w-full\" />\n              </div>\n              <Skeleton className=\"h-3 w-12\" />\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full max-w-2xl mx-auto px-4 py-4 space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-1xl font-bold flex items-center gap-2\">\n          Notifications\n          {unreadCount > 0 && (\n            <Badge className=\"h-5 px-2 bg-primary text-primary-foreground\">\n              {unreadCount}\n            </Badge>\n          )}\n        </h1>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={handleMarkAllAsRead}\n          disabled={unreadCount === 0 || markAllAsReadMutation.isPending}\n          className=\"text-xs h-8\"\n        >\n          Mark all as read\n        </Button>\n      </div>\n\n      {/* Tabs */}\n      <Tabs defaultValue=\"all\" className=\"w-full\">\n        <TabsList className=\"w-full justify-start h-9 bg-transparent border-b border-border rounded-none p-0\">\n          <TabsTrigger\n            value=\"all\"\n            className=\"h-9 rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none px-4\"\n          >\n            All\n          </TabsTrigger>\n          <TabsTrigger\n            value=\"unread\"\n            className=\"h-9 rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:bg-transparent data-[state=active]:shadow-none px-4\"\n          >\n            Unread\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent\n          value=\"all\"\n          className=\"mt-0 border rounded-lg overflow-hidden bg-card\"\n        >\n          {notifications.length === 0 ? (\n            <div className=\"p-12 text-center\">\n              <Bell className=\"h-12 w-12 mx-auto opacity-20 mb-3\" />\n              <p className=\"text-sm font-medium text-muted-foreground\">\n                No notifications yet\n              </p>\n              <p className=\"text-xs text-muted-foreground/70 mt-1\">\n                You'll see updates here\n              </p>\n            </div>\n          ) : (\n            <>\n              {todayNotifications.length > 0 && (\n                <div>\n                  <div className=\"px-3 py-1.5 text-[11px] font-bold text-muted-foreground/80 bg-muted/30 uppercase tracking-wide\">\n                    Today\n                  </div>\n                  {todayNotifications.map((notification) => (\n                    <NotificationItem\n                      key={notification.id}\n                      notification={notification}\n                    />\n                  ))}\n                </div>\n              )}\n              {yesterdayNotifications.length > 0 && (\n                <div>\n                  <div className=\"px-3 py-1.5 text-[11px] font-bold text-muted-foreground/80 bg-muted/30 uppercase tracking-wide\">\n                    Yesterday\n                  </div>\n                  {yesterdayNotifications.map((notification) => (\n                    <NotificationItem\n                      key={notification.id}\n                      notification={notification}\n                    />\n                  ))}\n                </div>\n              )}\n              {olderNotifications.length > 0 && (\n                <div>\n                  <div className=\"px-3 py-1.5 text-[11px] font-bold text-muted-foreground/80 bg-muted/30 uppercase tracking-wide\">\n                    Older\n                  </div>\n                  {olderNotifications.map((notification) => (\n                    <NotificationItem\n                      key={notification.id}\n                      notification={notification}\n                    />\n                  ))}\n                </div>\n              )}\n              {undatedNotifications.length > 0 && (\n                <div>\n                  <div className=\"px-3 py-1.5 text-[11px] font-bold text-muted-foreground/80 bg-muted/30 uppercase tracking-wide\">\n                    Recent\n                  </div>\n                  {undatedNotifications.map((notification) => (\n                    <NotificationItem\n                      key={notification.id}\n                      notification={notification}\n                    />\n                  ))}\n                </div>\n              )}\n            </>\n          )}\n        </TabsContent>\n\n        <TabsContent\n          value=\"unread\"\n          className=\"mt-0 border rounded-lg overflow-hidden bg-card\"\n        >\n          {unreadNotifications.length === 0 ? (\n            <div className=\"p-12 text-center\">\n              <Bell className=\"h-12 w-12 mx-auto opacity-20 mb-3\" />\n              <p className=\"text-sm font-medium text-muted-foreground\">\n                All caught up!\n              </p>\n              <p className=\"text-xs text-muted-foreground/70 mt-1\">\n                No unread notifications\n              </p>\n            </div>\n          ) : (\n            unreadNotifications.map((notification) => (\n              <NotificationItem\n                key={notification.id}\n                notification={notification}\n              />\n            ))\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}","size_bytes":14353},"server/privy-middleware.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { PrivyClient } from '@privy-io/server-auth';\n\nconst privyAppId = process.env.VITE_PRIVY_APP_ID;\nconst privyAppSecret = process.env.PRIVY_APP_SECRET;\n\nlet privyClient: PrivyClient | null = null;\n\nif (privyAppId && privyAppSecret) {\n  privyClient = new PrivyClient(privyAppId, privyAppSecret);\n  console.log('‚úÖ Privy authentication middleware initialized');\n} else {\n  console.warn('‚ö†Ô∏è Privy credentials not found. Authentication will not work.');\n}\n\nexport interface AuthenticatedRequest extends Request {\n  authenticated: boolean;\n  user?: {\n    id: string;\n    wallet?: {\n      address: string;\n    };\n  };\n}\n\nexport async function privyAuthMiddleware(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  const authReq = req as AuthenticatedRequest;\n  \n  // Try to get Privy token from Authorization header\n  const authHeader = req.headers.authorization;\n  \n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    // No auth header, continue as unauthenticated\n    authReq.authenticated = false;\n    return next();\n  }\n\n  const token = authHeader.substring(7); // Remove 'Bearer ' prefix\n\n  if (!privyClient) {\n    console.error('Privy client not initialized');\n    authReq.authenticated = false;\n    return next();\n  }\n\n  try {\n    // Verify the Privy access token\n    const verifiedClaims = await privyClient.verifyAuthToken(token);\n    \n    // Set authenticated user info\n    authReq.authenticated = true;\n    authReq.user = {\n      id: verifiedClaims.userId,\n      wallet: {\n        address: verifiedClaims.userId // Privy userId is typically the wallet address\n      }\n    };\n    \n    next();\n  } catch (error) {\n    // Token verification failed, continue as unauthenticated\n    console.error('Privy token verification failed:', error);\n    authReq.authenticated = false;\n    next();\n  }\n}\n\n// Optional middleware for wallet-based authentication (no Privy token needed)\n// This allows direct wallet address to be passed for certain endpoints\nexport function walletAuthMiddleware(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  const authReq = req as AuthenticatedRequest;\n  \n  // Check if wallet address is in the request body, query, params, or custom header\n  const address = req.body?.address || \n                  req.query?.address || \n                  req.params?.address ||\n                  req.headers['x-wallet-address'];\n  \n  // Debug logging\n  console.log(`[Wallet Auth] ${req.method} ${req.path}`, {\n    body: req.body?.address,\n    query: req.query?.address,\n    params: req.params?.address,\n    header: req.headers['x-wallet-address'],\n    found: !!address\n  });\n  \n  if (address) {\n    authReq.authenticated = true;\n    authReq.user = {\n      id: address as string,\n      wallet: {\n        address: address as string\n      }\n    };\n  } else {\n    authReq.authenticated = false;\n  }\n  \n  next();\n}\n","size_bytes":2920},"client/src/components/e1xp-claim-modal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport {\n  Dialog,\n  DialogContent,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Flame, Check } from \"lucide-react\";\nimport confetti from \"canvas-confetti\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport function E1XPClaimModal() {\n  const { authenticated, user, getAccessToken } = usePrivy();\n  const address = user?.wallet?.address;\n  const [open, setOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Get today's date in YYYY-MM-DD format for localStorage tracking\n  const getTodayKey = () => {\n    return new Date().toISOString().split('T')[0];\n  };\n  \n  // Check if modal was already shown today\n  const wasShownToday = () => {\n    const lastShownDate = localStorage.getItem('e1xp-modal-last-shown');\n    return lastShownDate === getTodayKey();\n  };\n  \n  // Mark modal as shown today\n  const markAsShownToday = () => {\n    localStorage.setItem('e1xp-modal-last-shown', getTodayKey());\n  };\n\n  const { data: status } = useQuery({\n    queryKey: [\"/api/e1xp/status\", authenticated],\n    enabled: authenticated,\n    queryFn: async () => {\n      const headers: Record<string, string> = {};\n      try {\n        const accessToken = await getAccessToken();\n        if (accessToken) {\n          headers.Authorization = `Bearer ${accessToken}`;\n        }\n      } catch (error) {\n        console.error('Failed to get access token:', error);\n      }\n      const response = await fetch(\"/api/e1xp/status\", {\n        credentials: \"include\",\n        headers,\n      });\n      if (!response.ok) throw new Error('Failed to fetch status');\n      return response.json();\n    },\n  });\n\n  const claimDailyMutation = useMutation({\n    mutationFn: async () => {\n      const accessToken = await getAccessToken();\n      const headers: Record<string, string> = {\n        'Content-Type': 'application/json',\n      };\n      if (accessToken) {\n        headers.Authorization = `Bearer ${accessToken}`;\n      }\n      const response = await fetch(\"/api/e1xp/claim-daily\", {\n        method: \"POST\",\n        headers,\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to claim daily points\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      confetti({\n        particleCount: 100,\n        spread: 70,\n        origin: { y: 0.6 },\n        colors: ['#10b981', '#34d399', '#6ee7b7', '#a7f3d0']\n      });\n\n      toast({\n        title: \"üéâ Points Claimed!\",\n        description: `You earned ${data.pointsEarned} E1XP! ${data.streak > 1 ? `${data.streak} day streak! üî•` : ''}`,\n        duration: 5000,\n      });\n      \n      // Mark modal as shown today so it doesn't appear again\n      markAsShownToday();\n      \n      // Invalidate all related queries to update the UI everywhere\n      queryClient.invalidateQueries({ queryKey: [\"/api/e1xp/status\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/e1xp/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/creators\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/login-streak\"] });\n      \n      // Force refetch to ensure data is fresh\n      queryClient.refetchQueries({ queryKey: [\"/api/e1xp/status\"] });\n      \n      setOpen(false);\n    },\n    onError: (error: Error) => {\n      // Check if already claimed today\n      if (error.message.includes(\"already\") || error.message.includes(\"duplicate\")) {\n        toast({\n          title: \"‚úÖ Already Claimed Today!\",\n          description: \"You've already claimed your daily points. Come back tomorrow for more E1XP! üî•\",\n        });\n        // Mark as shown so modal doesn't appear again today\n        markAsShownToday();\n        setOpen(false);\n      } else {\n        toast({\n          title: \"‚ùå Error\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  useEffect(() => {\n    // Only show modal if:\n    // 1. User is authenticated\n    // 2. They can claim daily points\n    // 3. Modal hasn't been shown today (prevents multiple shows on logout/login)\n    if (authenticated && status?.canClaimDaily && status?.authenticated && !wasShownToday()) {\n      setOpen(true);\n      // Don't mark as shown here - only mark after claim or manual dismiss\n    }\n  }, [authenticated, status?.canClaimDaily, status?.authenticated]);\n\n  const nextClaimAmount = status?.nextClaimAmount || 10;\n  const streak = status?.streak || 0;\n\n  const getDaysOfWeek = () => {\n    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n    const today = new Date().getDay();\n    const weekDays = [];\n\n    const claimedDaysInWeek = Math.min(streak, 7);\n\n    for (let i = 0; i < 7; i++) {\n      const dayIndex = (today - 6 + i + 7) % 7;\n      const isToday = i === 6;\n      const isClaimed = i >= (7 - claimedDaysInWeek);\n\n      weekDays.push({\n        name: days[dayIndex],\n        isToday,\n        isClaimed,\n      });\n    }\n\n    return weekDays;\n  };\n\n  const weekDays = getDaysOfWeek();\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogContent className=\"sm:max-w-md bg-background border-border/50 p-8\">\n        <div className=\"flex flex-col items-center space-y-6\">\n          <div className=\"relative\">\n            <div className=\"w-24 h-24 rounded-full bg-gradient-to-br from-indigo-500 via-purple-500 to-blue-500 flex items-center justify-center\">\n              <Flame className=\"h-12 w-12 text-white\" />\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-center gap-3 w-full max-w-sm bg-white dark:bg-muted/20 rounded-2xl p-4 shadow-sm\">\n            {weekDays.map((day, index) => (\n              <div key={index} className=\"flex flex-col items-center gap-2\">\n                <div \n                  data-testid={`day-indicator-${day.name.toLowerCase()}`}\n                  className={`w-10 h-10 rounded-full flex items-center justify-center border-2 transition-colors ${\n                    day.isClaimed\n                      ? 'bg-green-500 border-green-500'\n                      : day.isToday\n                      ? 'bg-gray-100 dark:bg-muted border-gray-300 dark:border-border'\n                      : 'bg-gray-100 dark:bg-muted border-gray-200 dark:border-border/50'\n                  }`}\n                >\n                  {day.isClaimed && (\n                    <Check className=\"h-5 w-5 text-white\" />\n                  )}\n                </div>\n                <span className=\"text-xs font-medium text-muted-foreground dark:text-gray-400\">\n                  {day.name}\n                </span>\n              </div>\n            ))}\n          </div>\n\n          <div className=\"text-center space-y-2\">\n            <h2 className=\"text-2xl font-bold text-foreground dark:text-white\">\n              You've started a streak!\n            </h2>\n            <p className=\"text-sm text-muted-foreground dark:text-gray-400 max-w-sm\">\n              Claim your daily points to build your streak and create a powerful learning habit.\n            </p>\n          </div>\n\n          <Button\n            data-testid=\"button-continue\"\n            onClick={() => claimDailyMutation.mutate()}\n            disabled={claimDailyMutation.isPending}\n            className=\"w-full h-12 text-base bg-blue-600 hover:bg-blue-700 text-white rounded-xl\"\n          >\n            {claimDailyMutation.isPending ? \"Claiming...\" : \"Continue\"}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":7735},"client/src/pages/coin-detail.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useRoute, useLocation } from \"wouter\";\nimport type { Comment } from \"@shared/schema\";\nimport { useAccount, usePublicClient, useWalletClient } from \"wagmi\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2, CheckCircle2, ExternalLink, Coins, MessageCircle, Users, Activity as ActivityIcon, Info, Copy, Check, TrendingUp, ChevronLeft } from \"lucide-react\";\nimport { getCoin, getCoinHolders } from \"@zoralabs/coins-sdk\";\nimport { base } from \"viem/chains\";\nimport { formatEther } from \"viem\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from \"recharts\";\nimport { Carousel, CarouselContent, CarouselItem, CarouselNext, CarouselPrevious } from \"@/components/ui/carousel\";\nimport { formatSmartCurrency } from \"@/lib/utils\";\n\ntype CoinProp = {\n  id: string;\n  name: string;\n  symbol: string;\n  address: string;\n  image?: string;\n  marketCap?: string;\n  volume24h?: string;\n  holders?: number;\n  creator?: string;\n  createdAt?: string;\n  category?: string;\n  platform?: string;\n  creator_wallet?: string;\n  metadata?: any;\n  type?: string;\n};\n\nexport default function CoinDetailPage() {\n  const [, params] = useRoute(\"/coin/:address\");\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [ethAmount, setEthAmount] = useState(\"0.000111\");\n  const [isTrading, setIsTrading] = useState(false);\n  const [txHash, setTxHash] = useState<string | null>(null);\n  const [isBuying, setIsBuying] = useState(true);\n  const [standaloneComment, setStandaloneComment] = useState(\"\");\n  const [balance, setBalance] = useState<string>(\"0\");\n  const [marketCap, setMarketCap] = useState<string | null>(null);\n  const [volume24h, setVolume24h] = useState<string | null>(null);\n  const [creatorEarnings, setCreatorEarnings] = useState<string | null>(null);\n  const [coinImage, setCoinImage] = useState<string | null>(null);\n  const [holders, setHolders] = useState<Array<{\n    address: string;\n    balance: string;\n    percentage: number;\n    profile?: string | null;\n  }>>([]);\n  const [totalSupply, setTotalSupply] = useState<string | null>(null);\n  const [uniqueHoldersCount, setUniqueHoldersCount] = useState<number>(0);\n  const [chartData, setChartData] = useState<Array<{ time: string; price: number }>>([]);\n  const [timeframe, setTimeframe] = useState<'1H' | '1D' | 'W' | 'M' | 'All'>('1D');\n  const [priceChange, setPriceChange] = useState<number>(0);\n  const [currentSlide, setCurrentSlide] = useState(0);\n  const [carouselApi, setCarouselApi] = useState<any>(null);\n  const [copiedAddress, setCopiedAddress] = useState(false);\n  const [currentPrice, setCurrentPrice] = useState<string | null>(null);\n  const [coin, setCoin] = useState<CoinProp | null>(null);\n\n  const { address, isConnected } = useAccount();\n  const { data: walletClient } = useWalletClient();\n  const publicClient = usePublicClient();\n\n  const coinAddress = params?.address;\n\n  useEffect(() => {\n    if (!carouselApi) return;\n    const onSelect = () => setCurrentSlide(carouselApi.selectedScrollSnap());\n    carouselApi.on(\"select\", onSelect);\n    return () => carouselApi.off(\"select\", onSelect);\n  }, [carouselApi]);\n\n  const { data: comments = [], isLoading: commentsLoading } = useQuery<Comment[]>({\n    queryKey: ['/api/comments/coin', coinAddress],\n    queryFn: async () => {\n      const response = await fetch(`/api/comments/coin/${coinAddress}`, {\n        credentials: 'include'\n      });\n      if (!response.ok) throw new Error('Failed to fetch comments');\n      return response.json();\n    },\n    enabled: !!coinAddress,\n  });\n\n  const createCommentMutation = useMutation({\n    mutationFn: async (commentData: { coinAddress: string; userAddress: string; comment: string; transactionHash?: string }) => {\n      return await apiRequest('POST', '/api/comments', commentData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/comments/coin', coinAddress] });\n    },\n  });\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    setCopiedAddress(true);\n    setTimeout(() => setCopiedAddress(false), 2000);\n  };\n\n  const handleStandaloneComment = async () => {\n    if (!isConnected || !address || !coinAddress || !standaloneComment.trim()) return;\n\n    try {\n      await createCommentMutation.mutateAsync({\n        coinAddress: coinAddress,\n        userAddress: address,\n        comment: standaloneComment.trim(),\n      });\n      setStandaloneComment(\"\");\n      toast({ title: \"Comment added\", description: \"Your comment has been posted\" });\n    } catch (error) {\n      console.error('Failed to post comment:', error);\n      toast({ title: \"Failed to post comment\", description: \"Please try again\", variant: \"destructive\" });\n    }\n  };\n\n  useEffect(() => {\n    async function fetchBalance() {\n      if (!address || !publicClient) return;\n      try {\n        const bal = await publicClient.getBalance({ address });\n        setBalance(formatEther(bal));\n      } catch (error) {\n        console.error(\"Error fetching balance:\", error);\n      }\n    }\n    if (isConnected) fetchBalance();\n  }, [address, isConnected, publicClient]);\n\n  useEffect(() => {\n    async function fetchCoinStats() {\n      if (!coinAddress) return;\n      try {\n        const response = await getCoin({\n          address: coinAddress as `0x${string}`,\n          chain: base.id,\n        });\n\n        const coinData = response.data?.zora20Token;\n        if (coinData) {\n          setCoin({\n            id: coinData.address,\n            name: coinData.name || \"Unnamed Coin\",\n            symbol: coinData.symbol || \"???\",\n            address: coinData.address,\n            image: coinData.mediaContent?.previewImage?.medium || coinData.mediaContent?.previewImage?.small,\n            marketCap: coinData.marketCap ? parseFloat(coinData.marketCap).toFixed(2) : \"0\",\n            volume24h: coinData.volume24h ? parseFloat(coinData.volume24h).toFixed(2) : \"0\",\n            holders: coinData.uniqueHolders || 0,\n            creator: coinData.creatorAddress,\n            createdAt: coinData.createdAt,\n            creator_wallet: coinData.creatorAddress,\n            metadata: coinData,\n          });\n\n          if (coinData.marketCap !== null && coinData.marketCap !== undefined) {\n            const mcValue = typeof coinData.marketCap === 'string' ? parseFloat(coinData.marketCap) : coinData.marketCap;\n            setMarketCap(mcValue.toFixed(2));\n          }\n\n          if (coinData.volume24h !== null && coinData.volume24h !== undefined) {\n            const volValue = typeof coinData.volume24h === 'string' ? parseFloat(coinData.volume24h) : coinData.volume24h;\n            setVolume24h(volValue.toString());\n            setCreatorEarnings((volValue * 0.005).toString());\n          }\n\n          if (coinData.totalSupply) {\n            setTotalSupply(coinData.totalSupply);\n          }\n\n          if (coinData.price) {\n            const price = typeof coinData.price === 'string' ? parseFloat(coinData.price) : coinData.price;\n            setCurrentPrice(coinData.price);\n\n            const now = Date.now();\n            const hourInMs = 60 * 60 * 1000;\n            const data = [];\n\n            for (let i = 23; i >= 0; i--) {\n              const time = new Date(now - i * hourInMs);\n              const variance = (Math.random() - 0.5) * 0.1;\n              const pricePoint = price * (1 + variance);\n              data.push({\n                time: time.toLocaleTimeString('en-US', { hour: 'numeric', hour12: true }),\n                price: parseFloat(pricePoint.toFixed(6))\n              });\n            }\n            setChartData(data);\n          }\n\n          if (coinData.priceChange24h !== null && coinData.priceChange24h !== undefined) {\n            const priceChangeValue = typeof coinData.priceChange24h === 'string' \n              ? parseFloat(coinData.priceChange24h) \n              : coinData.priceChange24h;\n            setPriceChange(priceChangeValue);\n          }\n\n          if (coinData.mediaContent?.previewImage) {\n            const previewImage = coinData.mediaContent.previewImage as any;\n            setCoinImage(previewImage.medium || previewImage.small || null);\n          }\n        }\n\n        const holdersResponse = await getCoinHolders({\n          chainId: base.id,\n          address: coinAddress as `0x${string}`,\n          count: 50,\n        });\n\n        const holderBalances = holdersResponse.data?.zora20Token?.tokenBalances?.edges || [];\n        const supply = parseFloat(coinData?.totalSupply || \"0\");\n\n        if (holderBalances.length > 0 && supply > 0) {\n          const processedHolders = holderBalances.map((edge: any) => {\n            const balance = parseFloat(edge.node.balance || \"0\");\n            return {\n              address: edge.node.ownerAddress,\n              balance: edge.node.balance,\n              percentage: (balance / supply) * 100,\n              profile: edge.node.ownerProfile?.handle || null,\n            };\n          });\n          setHolders(processedHolders);\n        }\n      } catch (error) {\n        console.error(\"Error fetching coin stats:\", error);\n      }\n    }\n    fetchCoinStats();\n  }, [coinAddress]);\n\n  const handleTrade = async () => {\n    if (!isConnected || !address || !walletClient || !publicClient || !coinAddress) {\n      toast({ title: \"Wallet not connected\", description: \"Please connect your wallet first\", variant: \"destructive\" });\n      return;\n    }\n\n    const ethAmountNum = parseFloat(ethAmount);\n    if (!ethAmount || ethAmountNum <= 0) {\n      toast({ title: \"Invalid amount\", description: \"Please enter a valid ETH amount\", variant: \"destructive\" });\n      return;\n    }\n\n    setIsTrading(true);\n    try {\n      const { tradeZoraCoin } = await import(\"@/lib/zora\");\n      const result = await tradeZoraCoin({\n        coinAddress: coinAddress as `0x${string}`,\n        ethAmount,\n        walletClient,\n        publicClient,\n        userAddress: address,\n        isBuying,\n      });\n\n      if (result?.hash) {\n        setTxHash(result.hash);\n        toast({ title: \"Trade successful!\", description: `You ${isBuying ? 'bought' : 'sold'} ${coin?.symbol} tokens` });\n        const newBal = await publicClient.getBalance({ address });\n        setBalance(formatEther(newBal));\n      }\n    } catch (error) {\n      console.error(\"Trade failed:\", error);\n      toast({ title: \"Trade failed\", description: error instanceof Error ? error.message : \"Trade failed\", variant: \"destructive\" });\n    } finally {\n      setIsTrading(false);\n    }\n  };\n\n  const formatAddress = (address?: string) => {\n    if (!address) return 'Unknown';\n    return `${address.slice(0, 6)}...${address.slice(-4)}`;\n  };\n\n  const setQuickAmount = (amount: string) => {\n    if (amount === 'Max') {\n      setEthAmount((parseFloat(balance) * 0.9).toFixed(6));\n    } else {\n      setEthAmount(amount);\n    }\n  };\n\n  const displayImage = coinImage || coin?.image || coin?.metadata?.image;\n\n  if (!coin) {\n    return (\n      <div className=\"container max-w-7xl mx-auto px-4 py-8\">\n        <div className=\"flex items-center justify-center h-64\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container max-w-5xl mx-auto px-4 py-4\">\n      <Button\n        variant=\"ghost\"\n        onClick={() => setLocation(-1)}\n        className=\"mb-3\"\n      >\n        <ChevronLeft className=\"w-4 h-4 mr-2\" />\n        Back\n      </Button>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-[400px,1fr] gap-4\">\n        {/* Left Column - Sticky Image & Chart Carousel */}\n        <div className=\"lg:sticky lg:top-4 lg:self-start\">\n          <div className=\"bg-card rounded-xl border border-border/50 overflow-hidden aspect-square max-h-[400px]\">\n            <Carousel className=\"w-full h-full\" opts={{ loop: false }} setApi={setCarouselApi}>\n              <CarouselContent className=\"h-full\">\n                {/* Image Slide */}\n                <CarouselItem className=\"h-full\">\n                  <div className=\"h-full flex items-center justify-center\">\n                    {displayImage ? (\n                      <img src={displayImage} alt={coin.name} className=\"max-w-full max-h-full object-contain\" />\n                    ) : (\n                      <div className=\"flex flex-col items-center justify-center text-muted-foreground\">\n                        <Coins className=\"w-16 h-16 mb-2 opacity-30\" />\n                        <p className=\"text-sm\">No media available</p>\n                      </div>\n                    )}\n                  </div>\n                </CarouselItem>\n\n                {/* Chart Slide */}\n                <CarouselItem className=\"h-full\">\n                  <div className=\"h-full flex flex-col p-4\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Price</p>\n                        <p className=\"text-lg font-bold\">{currentPrice ? `$${parseFloat(currentPrice).toFixed(6)}` : '--'}</p>\n                      </div>\n                      <div className={`flex items-center gap-1 ${priceChange >= 0 ? 'text-green-500' : 'text-red-500'}`}>\n                        <TrendingUp className={`w-4 h-4 ${priceChange < 0 ? 'rotate-180' : ''}`} />\n                        <span className=\"text-sm font-semibold\">{priceChange >= 0 ? '+' : ''}{priceChange.toFixed(2)}%</span>\n                      </div>\n                    </div>\n\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <LineChart data={chartData}>\n                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border))\" />\n                        <XAxis dataKey=\"time\" stroke=\"hsl(var(--muted-foreground))\" tick={{ fontSize: 10 }} />\n                        <YAxis stroke=\"hsl(var(--muted-foreground))\" tick={{ fontSize: 10 }} />\n                        <Tooltip\n                          contentStyle={{\n                            backgroundColor: 'hsl(var(--card))',\n                            border: '1px solid hsl(var(--border))',\n                            borderRadius: '8px',\n                            fontSize: '12px',\n                          }}\n                          formatter={(value: number) => [`$${value.toFixed(6)}`, 'Price']}\n                        />\n                        <Line type=\"monotone\" dataKey=\"price\" stroke=\"hsl(var(--primary))\" strokeWidth={2} dot={false} />\n                      </LineChart>\n                    </ResponsiveContainer>\n                  </div>\n                </CarouselItem>\n              </CarouselContent>\n              <CarouselPrevious className=\"left-2\" />\n              <CarouselNext className=\"right-2\" />\n            </Carousel>\n\n            {/* Slide Indicators */}\n            <div className=\"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5 z-10\">\n              {[0, 1].map((idx) => (\n                <button\n                  key={idx}\n                  onClick={() => carouselApi?.scrollTo(idx)}\n                  className={`w-1.5 h-1.5 rounded-full transition-all ${\n                    currentSlide === idx ? 'bg-primary w-4' : 'bg-muted-foreground/30'\n                  }`}\n                />\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* Right Column - Scrollable Trade Area */}\n        <div className=\"space-y-3\">\n          {/* Header */}\n          <div>\n            <h1 className=\"text-xl font-bold mb-0.5\">{coin.name}</h1>\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n              <span>@{formatAddress(coin.creator_wallet)}</span>\n            </div>\n          </div>\n\n          {/* Compact Stats */}\n          <div className=\"grid grid-cols-3 gap-2\">\n            <div className=\"text-center bg-muted/20 rounded-lg p-2\">\n              <p className=\"text-xs text-muted-foreground mb-0.5\">Market Cap</p>\n              <p className=\"text-sm font-bold text-green-500\">${marketCap || '0'}</p>\n            </div>\n            <div className=\"text-center bg-muted/20 rounded-lg p-2\">\n              <p className=\"text-xs text-muted-foreground mb-0.5\">24H Volume</p>\n              <p className=\"text-sm font-semibold\">${volume24h ? formatSmartCurrency(parseFloat(volume24h)) : '0'}</p>\n            </div>\n            <div className=\"text-center bg-muted/20 rounded-lg p-2\">\n              <p className=\"text-xs text-muted-foreground mb-0.5\">Creator Fees</p>\n              <p className=\"text-sm font-semibold\">${creatorEarnings ? formatSmartCurrency(parseFloat(creatorEarnings)) : '0'}</p>\n            </div>\n          </div>\n\n          {/* Buy/Sell Toggle */}\n          <div className=\"grid grid-cols-2 gap-2\">\n            <Button \n              onClick={() => setIsBuying(true)} \n              className={`h-10 ${isBuying ? 'bg-green-500 hover:bg-green-600' : 'bg-muted hover:bg-muted/80'}`}\n              disabled={isTrading || !!txHash}\n            >\n              Buy\n            </Button>\n            <Button \n              onClick={() => setIsBuying(false)} \n              className={`h-10 ${!isBuying ? 'bg-red-500 hover:bg-red-600' : 'bg-muted hover:bg-muted/80'}`}\n              disabled={isTrading || !!txHash}\n            >\n              Sell\n            </Button>\n          </div>\n\n          {/* Amount Input */}\n          <div className=\"space-y-1.5\">\n            <Input \n              type=\"number\" \n              value={ethAmount} \n              onChange={(e) => setEthAmount(e.target.value)} \n              className=\"h-11 text-base text-center\" \n              placeholder=\"0.000111\"\n              disabled={isTrading || !!txHash} \n            />\n            <div className=\"flex items-center justify-between text-xs text-muted-foreground px-1\">\n              <span>Balance: {parseFloat(balance).toFixed(4)} ETH</span>\n            </div>\n          </div>\n\n          {/* Quick Amount Buttons */}\n          <div className=\"grid grid-cols-4 gap-1.5\">\n            {['0.001 ETH', '0.01 ETH', '0.1 ETH', 'Max'].map((label) => (\n              <Button \n                key={label} \n                variant=\"outline\" \n                size=\"sm\" \n                className=\"h-8 text-xs\" \n                onClick={() => setQuickAmount(label.replace(' ETH', ''))} \n                disabled={isTrading || !!txHash}\n              >\n                {label}\n              </Button>\n            ))}\n          </div>\n\n          {/* Comment Input */}\n          <Input \n            placeholder=\"Add a comment...\" \n            value={standaloneComment} \n            onChange={(e) => setStandaloneComment(e.target.value)}\n            onKeyPress={(e) => {\n              if (e.key === 'Enter') {\n                handleStandaloneComment();\n              }\n            }}\n            className=\"h-9\"\n          />\n\n          {/* Trade Button */}\n          <Button \n            onClick={handleTrade} \n            disabled={isTrading || !isConnected || !!txHash} \n            className=\"w-full h-11 text-base font-semibold bg-green-500 hover:bg-green-600\"\n          >\n            {isTrading ? (\n              <>\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                Trading...\n              </>\n            ) : (\n              `Buy`\n            )}\n          </Button>\n\n          {/* Success Message */}\n          {txHash && (\n            <div className=\"p-3 bg-green-500/10 border border-green-500/20 rounded-lg\">\n              <div className=\"flex items-center gap-2 mb-1.5\">\n                <CheckCircle2 className=\"w-4 h-4 text-green-500\" />\n                <span className=\"font-semibold text-green-500 text-sm\">Trade Successful!</span>\n              </div>\n              <a\n                href={`https://basescan.org/tx/${txHash}`}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"text-xs text-primary flex items-center gap-1 hover:underline\"\n              >\n                View on BaseScan\n                <ExternalLink className=\"w-3 h-3\" />\n              </a>\n            </div>\n          )}\n\n          {/* Tabs Section - Scrollable */}\n          <div className=\"mt-4\">\n            <Tabs defaultValue=\"comments\" className=\"w-full\">\n              <TabsList className=\"w-full justify-start border-b rounded-none bg-transparent h-auto p-0 gap-4\">\n                <TabsTrigger value=\"comments\" className=\"data-[state=active]:border-b-2 data-[state=active]:border-foreground data-[state=active]:text-foreground rounded-none px-0 py-2 text-xs font-medium text-muted-foreground border-b-2 border-transparent\">\n                  Comments {comments.length > 0 && <span className=\"ml-1.5 text-muted-foreground\">{comments.length}</span>}\n                </TabsTrigger>\n                <TabsTrigger value=\"holders\" className=\"data-[state=active]:border-b-2 data-[state=active]:border-foreground data-[state=active]:text-foreground rounded-none px-0 py-2 text-xs font-medium text-muted-foreground border-b-2 border-transparent\">\n                  Holders {holders.length > 0 && <span className=\"ml-1.5 text-muted-foreground\">{holders.length}</span>}\n                </TabsTrigger>\n                <TabsTrigger value=\"activity\" className=\"data-[state=active]:border-b-2 data-[state=active]:border-foreground data-[state=active]:text-foreground rounded-none px-0 py-2 text-xs font-medium text-muted-foreground border-b-2 border-transparent\">Activity</TabsTrigger>\n                <TabsTrigger value=\"details\" className=\"data-[state=active]:border-b-2 data-[state=active]:border-foreground data-[state=active]:text-foreground rounded-none px-0 py-2 text-xs font-medium text-muted-foreground border-b-2 border-transparent\">Details</TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"comments\" className=\"pt-3\">\n                <ScrollArea className=\"h-80\">\n                  {comments.length > 0 ? (\n                    <div className=\"space-y-2\">\n                      {comments.map((c) => (\n                        <div key={c.id} className=\"p-3 bg-muted/20 rounded-lg\">\n                          <p className=\"text-xs font-medium mb-1\">{formatAddress(c.userAddress)}</p>\n                          <p className=\"text-sm text-muted-foreground\">{c.comment}</p>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"flex flex-col items-center justify-center h-48 text-center\">\n                      <MessageCircle className=\"w-12 h-12 text-muted-foreground/30 mb-3\" />\n                      <p className=\"text-sm text-muted-foreground\">No comments yet. Be the first!</p>\n                    </div>\n                  )}\n                </ScrollArea>\n              </TabsContent>\n\n              <TabsContent value=\"holders\" className=\"pt-3\">\n                <ScrollArea className=\"h-80\">\n                  {holders.length > 0 ? (\n                    <div className=\"space-y-2\">\n                      {holders.map((holder, idx) => (\n                        <div key={holder.address} className=\"flex items-center justify-between p-3 bg-muted/20 rounded-lg\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-primary/20 to-secondary/20 flex items-center justify-center\">\n                              <span className=\"text-xs font-semibold\">{idx + 1}</span>\n                            </div>\n                            <div>\n                              <p className=\"text-sm font-medium\">{holder.profile || formatAddress(holder.address)}</p>\n                              {holder.profile && <p className=\"text-xs text-muted-foreground\">{formatAddress(holder.address)}</p>}\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <p className=\"text-sm font-bold\">{holder.percentage.toFixed(2)}%</p>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"flex flex-col items-center justify-center h-48 text-center\">\n                      <Users className=\"w-12 h-12 text-muted-foreground/30 mb-3\" />\n                      <p className=\"text-sm text-muted-foreground\">No holders data available</p>\n                    </div>\n                  )}\n                </ScrollArea>\n              </TabsContent>\n\n              <TabsContent value=\"activity\" className=\"pt-3\">\n                <ScrollArea className=\"h-80\">\n                  <div className=\"flex flex-col items-center justify-center h-48 text-center\">\n                    <ActivityIcon className=\"w-12 h-12 text-muted-foreground/30 mb-3\" />\n                    <p className=\"text-sm text-muted-foreground\">Activity data coming soon</p>\n                  </div>\n                </ScrollArea>\n              </TabsContent>\n\n              <TabsContent value=\"details\" className=\"pt-3\">\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between p-3 bg-muted/20 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <ActivityIcon className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Created</span>\n                    </div>\n                    <span className=\"text-sm font-medium\">{coin.createdAt ? new Date(coin.createdAt).toLocaleDateString() : 'Unknown'}</span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between p-3 bg-muted/20 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <Copy className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Contract address</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-sm font-medium font-mono\">{formatAddress(coin.address)}</span>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-7 w-7 p-0\"\n                        onClick={() => copyToClipboard(coin.address)}\n                      >\n                        {copiedAddress ? <Check className=\"w-3 h-3 text-green-500\" /> : <Copy className=\"w-3 h-3\" />}\n                      </Button>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center justify-between p-3 bg-muted/20 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <Coins className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Chain</span>\n                    </div>\n                    <span className=\"text-sm font-medium flex items-center gap-2\">\n                      <span className=\"w-4 h-4 rounded-full bg-blue-500\"></span>\n                      Base\n                    </span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between p-3 bg-muted/20 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <Users className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Symbol</span>\n                    </div>\n                    <span className=\"text-sm font-medium\">@{coin.symbol || 'Unknown'}</span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between p-3 bg-muted/20 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <Info className=\"w-4 h-4\" />\n                      <span className=\"text-sm\">Media</span>\n                    </div>\n                    <span className=\"text-sm font-medium\">{displayImage ? 'Image' : 'None'}</span>\n                  </div>\n                </div>\n              </TabsContent>\n            </Tabs>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":28541},"client/src/components/splash-screen.tsx":{"content":"import { motion } from \"framer-motion\";\n\nexport function SplashScreen() {\n  const blobs = [\n    {\n      color: \"bg-gradient-to-br from-pink-400 to-pink-500\",\n      size: \"w-20 h-20\",\n      top: \"10%\",\n      left: \"15%\",\n      delay: 0,\n    },\n    {\n      color: \"bg-gradient-to-br from-green-400 to-emerald-500\",\n      size: \"w-24 h-24\",\n      top: \"15%\",\n      right: \"20%\",\n      delay: 0.1,\n    },\n    {\n      color: \"bg-gradient-to-br from-blue-400 to-cyan-500\",\n      size: \"w-16 h-16\",\n      top: \"25%\",\n      left: \"10%\",\n      delay: 0.2,\n    },\n    {\n      color: \"bg-gradient-to-br from-orange-400 to-orange-500\",\n      size: \"w-20 h-20\",\n      bottom: \"30%\",\n      left: \"18%\",\n      delay: 0.15,\n    },\n    {\n      color: \"bg-gradient-to-br from-yellow-400 to-yellow-500\",\n      size: \"w-28 h-28\",\n      bottom: \"20%\",\n      right: \"15%\",\n      delay: 0.25,\n    },\n    {\n      color: \"bg-gradient-to-br from-purple-400 to-purple-500\",\n      size: \"w-16 h-16\",\n      bottom: \"35%\",\n      right: \"25%\",\n      delay: 0.05,\n    },\n    {\n      color: \"bg-gradient-to-br from-teal-400 to-teal-500\",\n      size: \"w-20 h-20\",\n      top: \"40%\",\n      left: \"8%\",\n      delay: 0.2,\n    },\n    {\n      color: \"bg-gradient-to-br from-rose-400 to-rose-500\",\n      size: \"w-18 h-18\",\n      bottom: \"15%\",\n      left: \"12%\",\n      delay: 0.3,\n    },\n  ];\n\n  return (\n    <motion.div\n      initial={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      transition={{ duration: 0.5 }}\n      className=\"fixed inset-0 z-[9999] bg-white dark:bg-gray-900 flex items-center justify-center overflow-hidden\"\n    >\n      {/* Animated Blobs */}\n      {blobs.map((blob, index) => (\n        <motion.div\n          key={index}\n          initial={{ scale: 0, opacity: 0 }}\n          animate={{\n            scale: [0, 1.1, 1],\n            opacity: [0, 1, 1],\n            y: [0, -10, 0],\n          }}\n          transition={{\n            duration: 1.5,\n            delay: blob.delay,\n            repeat: Infinity,\n            repeatDelay: 2,\n            ease: \"easeInOut\",\n          }}\n          className={`absolute ${blob.size} ${blob.color} rounded-full shadow-lg`}\n          style={{\n            top: blob.top,\n            left: blob.left,\n            right: blob.right,\n            bottom: blob.bottom,\n          }}\n        >\n          {/* Cute face */}\n          <div className=\"relative w-full h-full flex items-center justify-center\">\n            <div className=\"flex gap-1.5 mb-2\">\n              <div className=\"w-1.5 h-1.5 bg-black/70 rounded-full\" />\n              <div className=\"w-1.5 h-1.5 bg-black/70 rounded-full\" />\n            </div>\n            <div className=\"absolute bottom-1/3 w-2 h-1 bg-pink-300/50 rounded-full\" />\n          </div>\n        </motion.div>\n      ))}\n\n      {/* App Name */}\n      <motion.div\n        initial={{ scale: 0.5, opacity: 0 }}\n        animate={{ scale: 1, opacity: 1 }}\n        transition={{ duration: 0.6, delay: 0.3 }}\n        className=\"relative z-10\"\n      >\n        <h1 className=\"text-5xl md:text-6xl font-bold text-gray-900 dark:text-white tracking-tight\">\n          Every1.fun\n        </h1>\n      </motion.div>\n\n      {/* Loading indicator */}\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        transition={{ delay: 1 }}\n        className=\"absolute bottom-20 flex gap-2\"\n      >\n        {[0, 1, 2].map((i) => (\n          <motion.div\n            key={i}\n            animate={{\n              scale: [1, 1.3, 1],\n              opacity: [0.5, 1, 0.5],\n            }}\n            transition={{\n              duration: 1,\n              repeat: Infinity,\n              delay: i * 0.2,\n            }}\n            className=\"w-2 h-2 bg-gray-900 dark:bg-white rounded-full\"\n          />\n        ))}\n      </motion.div>\n    </motion.div>\n  );\n}\n","size_bytes":3806},"README.md":{"content":"","size_bytes":0},"server/routes/xmtp-admin.ts":{"content":"\nimport { Router } from \"express\";\nimport { storage } from \"../supabase-storage\";\n\nconst router = Router();\n\n// Admin send message to user\nrouter.post(\"/admin/send-message\", async (req, res) => {\n  try {\n    const { recipientAddress, message, adminAddress } = req.body;\n\n    if (!recipientAddress || !message || !adminAddress) {\n      return res.status(400).json({ error: \"Missing required fields\" });\n    }\n\n    // Store admin message in database for tracking\n    await storage.createNotification({\n      userId: recipientAddress,\n      type: 'admin',\n      title: 'Message from Admin',\n      message: message,\n    });\n\n    // In a real implementation, you'd also send via XMTP here\n    // The admin panel will handle XMTP client initialization\n\n    res.json({ success: true, message: \"Message sent successfully\" });\n  } catch (error) {\n    console.error(\"Error sending admin message:\", error);\n    res.status(500).json({ error: \"Failed to send message\" });\n  }\n});\n\n// Get admin conversation history\nrouter.get(\"/admin/conversations\", async (req, res) => {\n  try {\n    const { adminAddress } = req.query;\n\n    if (!adminAddress) {\n      return res.status(400).json({ error: \"Admin address required\" });\n    }\n\n    // Fetch admin message history from notifications\n    const notifications = await storage.getAllNotifications();\n    const adminMessages = notifications.filter(n => n.type === 'admin');\n\n    res.json({ conversations: adminMessages });\n  } catch (error) {\n    console.error(\"Error fetching admin conversations:\", error);\n    res.status(500).json({ error: \"Failed to fetch conversations\" });\n  }\n});\n\nexport default router;\n","size_bytes":1638},"client/src/lib/xmtp-client.ts":{"content":"\nimport { Client } from '@xmtp/browser-sdk';\n\nlet xmtpClient: Client | null = null;\n\nexport async function initializeXmtpClient(signer: any): Promise<Client> {\n  if (xmtpClient) {\n    return xmtpClient;\n  }\n\n  try {\n    xmtpClient = await Client.create(signer, {\n      env: 'production',\n    });\n    console.log('‚úÖ XMTP Client initialized');\n    return xmtpClient;\n  } catch (error) {\n    console.error('‚ùå Failed to initialize XMTP client:', error);\n    throw error;\n  }\n}\n\nexport function getXmtpClient(): Client | null {\n  return xmtpClient;\n}\n\nexport async function disconnectXmtpClient() {\n  if (xmtpClient) {\n    xmtpClient = null;\n    console.log('‚úÖ XMTP Client disconnected');\n  }\n}\n\n// Create a signer from wallet\nexport function createXmtpSigner(walletAddress: string, signMessage: (message: string) => Promise<string>): any {\n  return {\n    type: 'EOA',\n    getIdentifier: () => ({\n      identifier: walletAddress,\n      identifierKind: 'Ethereum',\n    }),\n    signMessage: async (message: string): Promise<Uint8Array> => {\n      const signature = await signMessage(message);\n      const hexString = signature.startsWith('0x') ? signature.slice(2) : signature;\n      return new Uint8Array(hexString.match(/.{1,2}/g)!.map(byte => parseInt(byte, 16)));\n    },\n  };\n}\n\n// Send a message to a conversation\nexport async function sendXmtpMessage(conversation: any, content: string): Promise<void> {\n  try {\n    await conversation.send(content);\n    console.log('‚úÖ Message sent via XMTP');\n  } catch (error) {\n    console.error('‚ùå Failed to send XMTP message:', error);\n    throw error;\n  }\n}\n\n// Get or create a DM conversation\nexport async function getOrCreateDm(client: Client, peerAddress: string): Promise<any> {\n  try {\n    const conversations = await client.conversations.listDms();\n    const existingConvo = conversations.find((convo: any) => {\n      const members = convo.members?.map((m: any) => m.inboxId.toLowerCase()) || [];\n      return members.includes(peerAddress.toLowerCase());\n    });\n\n    if (existingConvo) {\n      return existingConvo;\n    }\n\n    const newConvo = await client.conversations.newDm(peerAddress);\n    console.log('‚úÖ New DM conversation created');\n    return newConvo;\n  } catch (error) {\n    console.error('‚ùå Failed to get or create DM:', error);\n    throw error;\n  }\n}\n\n// Get or create a group conversation\nexport async function getOrCreateGroup(client: Client, members: string[], groupName?: string): Promise<any> {\n  try {\n    const newGroup = await client.conversations.newGroup(members, {\n      name: groupName,\n    });\n    console.log('‚úÖ New group conversation created');\n    return newGroup;\n  } catch (error) {\n    console.error('‚ùå Failed to create group:', error);\n    throw error;\n  }\n}\n","size_bytes":2755},"client/src/components/admin-messaging-panel.tsx":{"content":"\nimport { useState } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { MessageSquare, Send, Users, Loader2 } from \"lucide-react\";\n\nexport function AdminMessagingPanel() {\n  const { toast } = useToast();\n  const [recipientAddress, setRecipientAddress] = useState(\"\");\n  const [messageContent, setMessageContent] = useState(\"\");\n  const [broadcastMessage, setBroadcastMessage] = useState(\"\");\n\n  const { data: creators } = useQuery({\n    queryKey: [\"/api/creators\"],\n  });\n\n  const { data: users } = useQuery({\n    queryKey: [\"/api/users\"],\n  });\n\n  const sendDirectMessageMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch('/api/admin/send-direct-message', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ \n          recipientAddress, \n          message: messageContent \n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to send message');\n      }\n    },\n    onSuccess: () => {\n      toast({ title: \"Message sent\", description: \"Your message was delivered successfully\" });\n      setMessageContent(\"\");\n      setRecipientAddress(\"\");\n    },\n    onError: async (error: any) => {\n      const errorMessage = error.message || \"Failed to send message\";\n      const isAuthError = errorMessage.includes(\"Unauthorized\") || errorMessage.includes(\"403\");\n      const isNotFound = errorMessage.includes(\"404\") || errorMessage.includes(\"not found\");\n      \n      toast({\n        title: isAuthError ? \"Authentication Required\" : isNotFound ? \"User Not Found\" : \"Send failed\",\n        description: isAuthError \n          ? \"Please log in to the admin panel first\" \n          : isNotFound\n          ? \"User not found. Try using their wallet address or username instead.\"\n          : errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const broadcastMessageMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch('/api/admin/broadcast-message', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ message: broadcastMessage }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to broadcast message');\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({ \n        title: \"‚úÖ Broadcast Complete\", \n        description: `Successfully sent to ${data.successCount} users` \n      });\n      setBroadcastMessage(\"\");\n    },\n    onError: (error: any) => {\n      const errorMessage = error.message || \"Failed to complete broadcast\";\n      const isAuthError = errorMessage.includes(\"Unauthorized\") || errorMessage.includes(\"403\");\n      \n      toast({\n        title: \"‚ùå Broadcast Failed\",\n        description: isAuthError \n          ? \"Please log in to the admin panel first\" \n          : errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <div className=\"space-y-6 max-w-4xl\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <MessageSquare className=\"h-5 w-5\" />\n            Send Direct Message\n          </CardTitle>\n          <CardDescription>\n            Send a message to a specific user\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"recipient\">Recipient (Wallet Address or Username)</Label>\n            <Input\n              id=\"recipient\"\n              placeholder=\"0x... or username\"\n              value={recipientAddress}\n              onChange={(e) => setRecipientAddress(e.target.value)}\n              data-testid=\"input-recipient\"\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Enter a wallet address or username. Available creators: {creators?.slice(0, 3).map((c: any) => c.name || c.address.slice(0, 10)).join(', ')}...\n            </p>\n          </div>\n\n          <div>\n            <Label htmlFor=\"message\">Message</Label>\n            <Textarea\n              id=\"message\"\n              placeholder=\"Enter your message...\"\n              rows={4}\n              value={messageContent}\n              onChange={(e) => setMessageContent(e.target.value)}\n              data-testid=\"textarea-message\"\n            />\n          </div>\n\n          <Button\n            onClick={() => sendDirectMessageMutation.mutate()}\n            disabled={!recipientAddress || !messageContent || sendDirectMessageMutation.isPending}\n            className=\"w-full\"\n            data-testid=\"button-send-message\"\n          >\n            {sendDirectMessageMutation.isPending ? (\n              <>\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                Sending...\n              </>\n            ) : (\n              <>\n                <Send className=\"h-4 w-4 mr-2\" />\n                Send Message\n              </>\n            )}\n          </Button>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5\" />\n            Broadcast to All Users\n          </CardTitle>\n          <CardDescription>\n            Send a message to all registered users\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"broadcast\">Broadcast Message</Label>\n            <Textarea\n              id=\"broadcast\"\n              placeholder=\"Enter broadcast message...\"\n              rows={4}\n              value={broadcastMessage}\n              onChange={(e) => setBroadcastMessage(e.target.value)}\n            />\n          </div>\n\n          <Button\n            onClick={() => broadcastMessageMutation.mutate()}\n            disabled={!broadcastMessage || broadcastMessageMutation.isPending}\n            className=\"w-full\"\n            variant=\"destructive\"\n          >\n            {broadcastMessageMutation.isPending ? (\n              <>\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                Broadcasting...\n              </>\n            ) : (\n              <>\n                <Users className=\"h-4 w-4 mr-2\" />\n                Broadcast to {(creators?.length || 0) + (users?.length || 0)} Users\n              </>\n            )}\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":6858},"client/src/lib/xmtp-push-notifications.ts":{"content":"\nimport { getXmtpClient } from './xmtp-client';\n\nexport async function setupXmtpPushNotifications() {\n  if (!('Notification' in window)) {\n    console.warn('Push notifications not supported');\n    return;\n  }\n\n  const permission = await Notification.requestPermission();\n  if (permission !== 'granted') {\n    console.warn('Push notification permission denied');\n    return;\n  }\n\n  const client = getXmtpClient();\n  if (!client) {\n    console.warn('XMTP client not initialized');\n    return;\n  }\n\n  // Stream all messages and show notifications\n  const stream = await client.conversations.streamAllMessages();\n  \n  for await (const message of stream) {\n    // Only show notification if it's not from the current user\n    if (message.senderInboxId?.toLowerCase() !== client.inboxId?.toLowerCase()) {\n      new Notification('New Message', {\n        body: message.content?.substring(0, 100) || 'You have a new message',\n        icon: '/assets/images/notification_icon.svg',\n        badge: '/assets/images/notification_icon.svg',\n        tag: 'xmtp-message',\n      });\n    }\n  }\n}\n\nexport async function registerXmtpServiceWorker() {\n  if (!('serviceWorker' in navigator)) {\n    console.warn('Service workers not supported');\n    return;\n  }\n\n  try {\n    await navigator.serviceWorker.register('/xmtp-sw.js');\n    console.log('‚úÖ XMTP service worker registered');\n  } catch (error) {\n    console.error('‚ùå Failed to register service worker:', error);\n  }\n}\n","size_bytes":1454},"server/username-generator.ts":{"content":"\n// Username generator for email-only users (no wallet)\nexport function generateUsernameFromEmail(email: string): string {\n  // Extract prefix from email (before @)\n  const emailPrefix = email.split('@')[0].toLowerCase();\n  \n  // Clean the prefix (remove special chars, keep alphanumeric)\n  const cleanPrefix = emailPrefix.replace(/[^a-z0-9]/g, '').slice(0, 12);\n  \n  // Use \"every1\" as suffix (from Every1.fun platform name)\n  const platformSuffix = 'every1';\n  \n  return `${cleanPrefix}-${platformSuffix}`;\n}\n\nexport function generateCreativeUsername(): string {\n  const adjectives = [\n    'cosmic', 'creative', 'digital', 'bright', 'swift',\n    'bold', 'clever', 'dynamic', 'epic', 'fresh',\n    'vibrant', 'stellar', 'radiant', 'zealous', 'nimble',\n    'mystic', 'quantum', 'electric', 'lunar', 'solar'\n  ];\n  \n  const nouns = [\n    'creator', 'dreamer', 'artist', 'builder', 'maker',\n    'pioneer', 'explorer', 'visionary', 'innovator', 'star',\n    'spark', 'wave', 'flame', 'pulse', 'echo',\n    'journey', 'horizon', 'nexus', 'forge', 'vault'\n  ];\n  \n  const randomAdj = adjectives[Math.floor(Math.random() * adjectives.length)];\n  const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];\n  const randomNum = Math.floor(Math.random() * 999);\n  \n  return `${randomAdj}-${randomNoun}${randomNum}`;\n}\n\nexport function generatePlatformUsername(): string {\n  const timestamp = Date.now().toString(36).slice(-6);\n  return `every1-${timestamp}`;\n}\n\nexport function getDefaultUsername(email?: string, privyId?: string): string {\n  // Priority 1: Email-based username\n  if (email) {\n    return generateUsernameFromEmail(email);\n  }\n  \n  // Priority 2: Creative username\n  if (Math.random() > 0.5) {\n    return generateCreativeUsername();\n  }\n  \n  // Priority 3: Platform username with unique ID\n  const uniqueId = privyId ? privyId.slice(-6) : Date.now().toString(36).slice(-6);\n  return `every1-${uniqueId}`;\n}\n","size_bytes":1919},"client/src/components/admin-message-composer.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Send, Users, MessageSquare, Loader2 } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function AdminMessageComposer() {\n  const [title, setTitle] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [messageType, setMessageType] = useState(\"announcement\");\n  const [recipients, setRecipients] = useState(\"\");\n  const [sendToAll, setSendToAll] = useState(false);\n  const [includeTelegram, setIncludeTelegram] = useState(false);\n  const { toast } = useToast();\n\n  // Fetch all users for reference\n  const { data: users, isLoading: loadingUsers } = useQuery({\n    queryKey: [\"/api/creators\"],\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async () => {\n      const recipientList = sendToAll\n        ? []\n        : recipients\n            .split(',')\n            .map(r => r.trim())\n            .filter(Boolean);\n\n      const response = await apiRequest('POST', '/api/admin/send-message', {\n        title,\n        message,\n        type: messageType,\n        recipients: recipientList,\n        sendToAll,\n        includeTelegram,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to send message\");\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"‚úÖ Message Sent Successfully\",\n        description: data.message || `Sent to ${data.sent} user(s)`,\n      });\n\n      // Reset form\n      setTitle(\"\");\n      setMessage(\"\");\n      setRecipients(\"\");\n      setSendToAll(false);\n      setIncludeTelegram(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"‚ùå Failed to Send Message\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSend = () => {\n    if (!title.trim() || !message.trim()) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please provide both a title and message\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!sendToAll && !recipients.trim()) {\n      toast({\n        title: \"No Recipients\",\n        description: \"Please specify recipients or enable 'Send to All Users'\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    sendMessageMutation.mutate();\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center gap-2\">\n          <MessageSquare className=\"h-5 w-5\" />\n          <div>\n            <CardTitle>Send Message to Users</CardTitle>\n            <CardDescription>\n              Send custom notifications and announcements to users\n              {!loadingUsers && users && ` (${users.length} total users)`}\n            </CardDescription>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"message-title\">Message Title *</Label>\n          <Input\n            id=\"message-title\"\n            placeholder=\"e.g., Important Platform Update\"\n            value={title}\n            onChange={(e) => setTitle(e.target.value)}\n            data-testid=\"input-message-title\"\n          />\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"message-content\">Message Content *</Label>\n          <Textarea\n            id=\"message-content\"\n            placeholder=\"Enter your message here... Be clear and concise.\"\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            rows={6}\n            data-testid=\"textarea-message-content\"\n          />\n          <p className=\"text-xs text-muted-foreground\">\n            {message.length} characters\n          </p>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"message-type\">Notification Type</Label>\n          <Select value={messageType} onValueChange={setMessageType}>\n            <SelectTrigger id=\"message-type\" data-testid=\"select-message-type\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"announcement\">üì¢ Announcement</SelectItem>\n              <SelectItem value=\"admin\">üë®‚Äçüíº Admin Message</SelectItem>\n              <SelectItem value=\"update\">üîî Platform Update</SelectItem>\n              <SelectItem value=\"promo\">üéâ Promotion</SelectItem>\n              <SelectItem value=\"alert\">‚ö†Ô∏è Alert</SelectItem>\n              <SelectItem value=\"reward\">üéÅ Reward</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"border-t pt-4 space-y-4\">\n          <div className=\"flex items-center space-x-2\">\n            <Checkbox\n              id=\"send-to-all\"\n              checked={sendToAll}\n              onCheckedChange={(checked) => setSendToAll(checked as boolean)}\n              data-testid=\"checkbox-send-to-all\"\n            />\n            <Label\n              htmlFor=\"send-to-all\"\n              className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer\"\n            >\n              <div className=\"flex items-center gap-2\">\n                <Users className=\"h-4 w-4\" />\n                Send to All Users {!loadingUsers && users && `(${users.length} users)`}\n              </div>\n            </Label>\n          </div>\n\n          {!sendToAll && (\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"recipients\">\n                Recipients (comma-separated addresses or Privy IDs)\n              </Label>\n              <Textarea\n                id=\"recipients\"\n                placeholder=\"0x123..., 0xabc..., did:privy:xyz...\"\n                value={recipients}\n                onChange={(e) => setRecipients(e.target.value)}\n                rows={3}\n                data-testid=\"textarea-recipients\"\n              />\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Enter wallet addresses, email addresses, or Privy IDs separated by commas\n              </p>\n            </div>\n          )}\n\n          <div className=\"flex items-center space-x-2\">\n            <Checkbox\n              id=\"include-telegram\"\n              checked={includeTelegram}\n              onCheckedChange={(checked) => setIncludeTelegram(checked as boolean)}\n              data-testid=\"checkbox-include-telegram\"\n            />\n            <Label\n              htmlFor=\"include-telegram\"\n              className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer\"\n            >\n              Also send via Telegram (if users have connected)\n            </Label>\n          </div>\n        </div>\n\n        <div className=\"border-t pt-4\">\n          <Button\n            onClick={handleSend}\n            disabled={sendMessageMutation.isPending || !title || !message}\n            className=\"w-full gap-2\"\n            size=\"lg\"\n            data-testid=\"button-send-message\"\n          >\n            {sendMessageMutation.isPending ? (\n              <>\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                Sending Message...\n              </>\n            ) : (\n              <>\n                <Send className=\"h-4 w-4\" />\n                Send Message\n              </>\n            )}\n          </Button>\n        </div>\n\n        {sendToAll && (\n          <div className=\"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3\">\n            <p className=\"text-sm text-yellow-600 dark:text-yellow-400 font-medium\">\n              ‚ö†Ô∏è You are about to send this message to ALL users. Please review carefully before sending.\n            </p>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":8326},"client/src/lib/socket-client.ts":{"content":"\nimport { io, Socket } from 'socket.io-client';\n\ninterface Message {\n  id: string;\n  conversationId: string;\n  senderId: string;\n  recipientId: string;\n  content: string;\n  createdAt: string;\n  read: boolean;\n}\n\ninterface Conversation {\n  id: string;\n  participants: string[];\n  lastMessage?: Message;\n  updatedAt: string;\n  unreadCount?: number;\n}\n\nclass SocketClient {\n  private socket: Socket | null = null;\n  private userId: string | null = null;\n  private listeners = new Map<string, Set<Function>>();\n\n  connect(userId: string) {\n    if (this.socket?.connected && this.userId === userId) {\n      return;\n    }\n\n    this.userId = userId;\n    this.socket = io(window.location.origin, {\n      transports: ['websocket', 'polling']\n    });\n\n    this.socket.on('connect', () => {\n      console.log('‚úÖ Socket connected');\n      this.socket?.emit('authenticate', userId);\n    });\n\n    this.socket.on('disconnect', () => {\n      console.log('‚ùå Socket disconnected');\n    });\n\n    // Set up event listeners\n    this.socket.on('conversations', (conversations: Conversation[]) => {\n      this.emit('conversations', conversations);\n    });\n\n    this.socket.on('conversation_loaded', (data: { conversation: Conversation; messages: Message[] }) => {\n      this.emit('conversation_loaded', data);\n    });\n\n    this.socket.on('new_message', (message: Message) => {\n      this.emit('new_message', message);\n    });\n\n    this.socket.on('message_sent', (message: Message) => {\n      this.emit('message_sent', message);\n    });\n\n    this.socket.on('conversation_updated', (conversation: Conversation) => {\n      this.emit('conversation_updated', conversation);\n    });\n\n    // Notification events\n    this.socket.on('notification', (notification: any) => {\n      console.log('üîî Notification received:', notification);\n      this.emit('notification', notification);\n    });\n\n    // Admin messages\n    this.socket.on('admin_message', (data: any) => {\n      console.log('üì® Admin message received:', data);\n      this.emit('admin_message', data);\n    });\n\n    this.socket.on('admin_broadcast', (data: any) => {\n      console.log('üì¢ Admin broadcast received:', data);\n      this.emit('admin_broadcast', data);\n    });\n  }\n\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n      this.userId = null;\n      this.listeners.clear();\n    }\n  }\n\n  on(event: string, callback: Function) {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n    this.listeners.get(event)!.add(callback);\n  }\n\n  off(event: string, callback: Function) {\n    const eventListeners = this.listeners.get(event);\n    if (eventListeners) {\n      eventListeners.delete(callback);\n    }\n  }\n\n  private emit(event: string, data: any) {\n    const eventListeners = this.listeners.get(event);\n    if (eventListeners) {\n      eventListeners.forEach(callback => callback(data));\n    }\n  }\n\n  getConversation(recipientId: string) {\n    this.socket?.emit('get_conversation', { recipientId });\n  }\n\n  sendMessage(recipientId: string, content: string) {\n    this.socket?.emit('send_message', { recipientId, content });\n  }\n\n  markAsRead(conversationId: string) {\n    this.socket?.emit('mark_read', { conversationId });\n  }\n\n  getConversations() {\n    this.socket?.emit('get_conversations');\n  }\n\n  isConnected(): boolean {\n    return this.socket?.connected ?? false;\n  }\n}\n\nexport const socketClient = new SocketClient();\nexport type { Message, Conversation };\n","size_bytes":3494},"server/socket-server.ts":{"content":"import { Server as SocketIOServer } from 'socket.io';\nimport { Server as HTTPServer } from 'http';\nimport { storage } from './supabase-storage';\nimport type { Message as DBMessage } from '@shared/schema';\n\ninterface Message {\n  id: string;\n  conversationId: string;\n  senderId: string;\n  recipientId: string;\n  content: string;\n  createdAt: string;\n  read: boolean;\n}\n\ninterface Conversation {\n  id: string;\n  participants: string[];\n  lastMessage?: Message;\n  updatedAt: string;\n  unreadCount?: number;\n}\n\nconst userSockets = new Map<string, string>(); // userId -> socketId\nlet socketIOInstance: SocketIOServer | null = null;\n\nfunction getConversationId(userId1: string, userId2: string): string {\n  const participants = [userId1, userId2].sort();\n  return `conv_${participants.join('_')}`;\n}\n\nfunction convertDBMessageToSocket(dbMsg: DBMessage, conversationId: string): Message {\n  return {\n    id: dbMsg.id,\n    conversationId,\n    senderId: dbMsg.senderId,\n    recipientId: dbMsg.recipientId,\n    content: dbMsg.content,\n    createdAt: dbMsg.createdAt?.toISOString() || new Date().toISOString(),\n    read: dbMsg.isRead || false\n  };\n}\n\nexport function getSocketIOInstance(): SocketIOServer | null {\n  return socketIOInstance;\n}\n\nexport function emitNotificationToUser(userId: string, notification: any): void {\n  if (!socketIOInstance) {\n    console.warn('[Socket.IO] Instance not initialized, cannot emit notification');\n    return;\n  }\n  \n  const socketId = userSockets.get(userId);\n  if (socketId) {\n    socketIOInstance.to(socketId).emit('notification', notification);\n    console.log(`[Socket.IO] Emitted notification to user ${userId}`);\n  } else {\n    console.log(`[Socket.IO] User ${userId} not connected, notification will be stored for later`);\n  }\n}\n\nexport function broadcastNotificationToAll(notification: any, excludeUserId?: string): void {\n  if (!socketIOInstance) {\n    console.warn('[Socket.IO] Instance not initialized, cannot broadcast notification');\n    return;\n  }\n  \n  let count = 0;\n  userSockets.forEach((socketId, userId) => {\n    if (excludeUserId && userId === excludeUserId) return;\n    socketIOInstance!.to(socketId).emit('notification', notification);\n    count++;\n  });\n  console.log(`[Socket.IO] Broadcasted notification to ${count} connected users`);\n}\n\nexport function initializeSocketServer(httpServer: HTTPServer) {\n  const io = new SocketIOServer(httpServer, {\n    cors: {\n      origin: \"*\",\n      methods: [\"GET\", \"POST\"]\n    }\n  });\n\n  socketIOInstance = io;\n\n  io.on('connection', (socket) => {\n    console.log('‚úÖ Socket connected:', socket.id);\n\n    // Authenticate user\n    socket.on('authenticate', async (userId: string) => {\n      userSockets.set(userId.toLowerCase(), socket.id);\n      socket.data.userId = userId.toLowerCase();\n      console.log(`‚úÖ User ${userId} authenticated with socket ${socket.id}`);\n\n      // Join rooms with all possible user identifiers for targeted messages\n      socket.join(userId.toLowerCase());\n      \n      // Try to get additional identifiers from the creator profile\n      try {\n        // Check if userId is a wallet address or Privy ID and find the creator\n        let creator = await storage.getCreatorByAddress(userId);\n        if (!creator) {\n          creator = await storage.getCreatorByPrivyId(userId);\n        }\n        \n        if (creator) {\n          // Join rooms for all identifiers to ensure message delivery\n          const identifiers = [\n            creator.address,\n            creator.privyId,\n            creator.id,\n            creator.email,\n            `email_${creator.privyId}` // Support email-based IDs\n          ].filter(Boolean);\n\n          for (const identifier of identifiers) {\n            const room = identifier!.toLowerCase();\n            if (room !== userId.toLowerCase()) {\n              socket.join(room);\n              console.log(`  ‚Ü≥ Also joined room: ${room}`);\n            }\n          }\n        }\n      } catch (error) {\n        console.warn(`Could not fetch additional identifiers for ${userId}:`, error);\n      }\n\n      // Send user's conversations\n      const userConversations = await getUserConversations(userId.toLowerCase());\n      socket.emit('conversations', userConversations);\n    });\n\n    // Create or get conversation\n    socket.on('get_conversation', async (data: { recipientId: string } | string) => {\n      const userId = socket.data.userId;\n      if (!userId) return;\n      \n      // Handle both old string format and new object format\n      const recipientId = typeof data === 'string' ? data : data.recipientId;\n      if (!recipientId) return;\n      \n      try {\n        const conversationId = getConversationId(userId, recipientId);\n\n        // Get messages between users (this works for both wallet and Privy ID)\n        const messages = await storage.getMessagesBetweenUsers(userId, recipientId);\n\n        // Convert DB messages to socket format\n        const socketMessages = messages.map(msg => \n          convertDBMessageToSocket(msg, conversationId)\n        );\n\n        // Create conversation object\n        const conversation: Conversation = {\n          id: conversationId,\n          participants: [userId, recipientId].sort(),\n          lastMessage: socketMessages.length > 0 \n            ? socketMessages[socketMessages.length - 1] \n            : undefined,\n          updatedAt: socketMessages.length > 0 \n            ? socketMessages[socketMessages.length - 1].createdAt \n            : new Date().toISOString(),\n          unreadCount: 0\n        };\n\n        console.log(`Loaded conversation: ${conversationId} between ${userId} and ${recipientId} with ${messages.length} messages`);\n\n        socket.emit('conversation_loaded', {\n          conversation,\n          messages: socketMessages,\n        });\n\n        // Also emit to the recipient if they're online\n        const recipientSocketId = userSockets.get(recipientId);\n        if (recipientSocketId) {\n          io.to(recipientSocketId).emit('conversation_updated', conversation);\n        }\n      } catch (error) {\n        console.error('Error loading conversation:', error);\n        socket.emit('error', { message: 'Failed to load conversation' });\n      }\n    });\n\n    // Send message\n    socket.on('send_message', async ({ recipientId, content }: { recipientId: string; content: string }) => {\n      const senderId = socket.data.userId;\n      if (!senderId) return;\n\n      try {\n        // Save message to database\n        const dbMessage = await storage.createMessage({\n          senderId,\n          recipientId: recipientId.toLowerCase(),\n          content,\n          messageType: 'text'\n        });\n\n        const conversationId = getConversationId(senderId, recipientId.toLowerCase());\n        const message = convertDBMessageToSocket(dbMessage, conversationId);\n\n        // Send to sender\n        socket.emit('message_sent', message);\n\n        // Create conversation object for updates\n        const conversation: Conversation = {\n          id: conversationId,\n          participants: [senderId, recipientId.toLowerCase()].sort(),\n          lastMessage: message,\n          updatedAt: message.createdAt,\n          unreadCount: 1\n        };\n\n        // Get all possible recipient identifiers to ensure delivery\n        const recipientRooms = [recipientId.toLowerCase()];\n        try {\n          let recipientCreator = await storage.getCreatorByAddress(recipientId);\n          if (!recipientCreator) {\n            recipientCreator = await storage.getCreatorByPrivyId(recipientId);\n          }\n          \n          if (recipientCreator) {\n            const identifiers = [\n              recipientCreator.address,\n              recipientCreator.privyId,\n              recipientCreator.id,\n              recipientCreator.email,\n              `email_${recipientCreator.privyId}`\n            ].filter(Boolean);\n            \n            for (const identifier of identifiers) {\n              const room = identifier!.toLowerCase();\n              if (!recipientRooms.includes(room)) {\n                recipientRooms.push(room);\n              }\n            }\n          }\n        } catch (error) {\n          console.warn('Could not fetch recipient identifiers:', error);\n        }\n\n        // Emit to all recipient rooms\n        for (const room of recipientRooms) {\n          io.to(room).emit('new_message', message);\n          io.to(room).emit('conversation_updated', conversation);\n        }\n        console.log(`‚úÖ Message emitted to rooms: ${recipientRooms.join(', ')}`);\n\n        // Update sender's conversation list\n        socket.emit('conversation_updated', { ...conversation, unreadCount: 0 });\n\n        console.log(`‚úÖ Message sent from ${senderId} to ${recipientId}`);\n      } catch (error) {\n        console.error('Error sending message:', error);\n        socket.emit('error', { message: 'Failed to send message' });\n      }\n    });\n\n    // Mark message as read\n    socket.on('mark_read', async ({ conversationId }: { conversationId: string }) => {\n      const userId = socket.data.userId;\n      if (!userId) return;\n\n      // Extract other user ID from conversation ID\n      const participants = conversationId.replace('conv_', '').split('_');\n      const otherUserId = participants.find(p => p !== userId);\n\n      if (otherUserId) {\n        await storage.markMessagesAsRead(userId, otherUserId);\n      }\n    });\n\n    // Get all conversations\n    socket.on('get_conversations', async () => {\n      const userId = socket.data.userId;\n      if (!userId) return;\n\n      const userConversations = await getUserConversations(userId);\n      socket.emit('conversations', userConversations);\n    });\n\n    socket.on('disconnect', () => {\n      const userId = socket.data.userId;\n      if (userId) {\n        userSockets.delete(userId);\n        console.log(`‚úÖ User ${userId} disconnected`);\n      }\n    });\n  });\n\n  console.log('‚úÖ Socket.io server initialized');\n  return io;\n}\n\nasync function getUserConversations(userId: string): Promise<Conversation[]> {\n  try {\n    const conversationsData = await storage.getConversationsForUser(userId);\n\n    const conversations: Conversation[] = await Promise.all(\n      conversationsData.map(async ({ otherUserId, lastMessage }) => {\n        try {\n          const conversationId = getConversationId(userId, otherUserId);\n          const unreadCount = await storage.getUnreadMessageCount(userId, otherUserId);\n\n          // lastMessage is already in camelCase format from storage\n          const socketMessage: Message = {\n            id: lastMessage.id,\n            conversationId,\n            senderId: lastMessage.senderId,\n            recipientId: lastMessage.recipientId,\n            content: lastMessage.content,\n            createdAt: lastMessage.createdAt instanceof Date \n              ? lastMessage.createdAt.toISOString() \n              : lastMessage.createdAt,\n            read: lastMessage.isRead || false\n          };\n\n          return {\n            id: conversationId,\n            participants: [userId, otherUserId].sort(),\n            lastMessage: socketMessage,\n            updatedAt: socketMessage.createdAt,\n            unreadCount\n          };\n        } catch (error) {\n          console.error(`Error processing conversation for ${otherUserId}:`, error);\n          return null;\n        }\n      })\n    );\n\n    // Filter out any null conversations\n    return conversations\n      .filter((c): c is Conversation => c !== null)\n      .sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n  } catch (error) {\n    console.error('Error getting user conversations:', error);\n    return [];\n  }\n}","size_bytes":11599},"server/migrate-creators-to-users.ts":{"content":"import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.VITE_SUPABASE_URL || 'https://hgwhbdlejogerdghkxac.supabase.co';\nconst supabaseServiceKey = process.env.VITE_SUPABASE_SERVICE_ROLE_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhnd2hiZGxlam9nZXJkZ2hreGFjIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MDc1MzI4NiwiZXhwIjoyMDc2MzI5Mjg2fQ.pTy3zUBuCUqZJd-tC4VXu-HYCO1SfrObTGh2eXHYY3g';\n\nconst supabase = createClient(supabaseUrl, supabaseServiceKey);\n\ninterface Creator {\n  id: string;\n  address: string;\n  name: string | null;\n  bio: string | null;\n  avatar: string | null;\n  points: string;\n  referral_code: string | null;\n  created_at: string;\n}\n\nfunction generateUsername(creator: Creator): string {\n  if (creator.name && creator.name.trim() !== '') {\n    // Clean up the name to make it username-friendly\n    const cleaned = creator.name\n      .toLowerCase()\n      .replace(/[^a-z0-9_]/g, '_')\n      .replace(/_+/g, '_')\n      .replace(/^_|_$/g, '');\n    return cleaned || `user_${creator.address.slice(2, 8)}`;\n  }\n  \n  // If no name, use address\n  if (creator.address.startsWith('0x')) {\n    return `user_${creator.address.slice(2, 8)}`;\n  }\n  \n  // For email-based addresses\n  return creator.address.replace(/[@.]/g, '_').toLowerCase();\n}\n\nasync function migrateCreatorsToUsers() {\n  console.log('üîÑ Starting migration of creators to users table...\\n');\n\n  // Fetch all creators\n  const { data: creators, error: fetchError } = await supabase\n    .from('creators')\n    .select('*');\n\n  if (fetchError) {\n    console.error('‚ùå Error fetching creators:', fetchError);\n    return;\n  }\n\n  if (!creators || creators.length === 0) {\n    console.log('‚úÖ No creators to migrate');\n    return;\n  }\n\n  console.log(`üìä Found ${creators.length} creators to migrate\\n`);\n\n  let successCount = 0;\n  let skipCount = 0;\n  let errorCount = 0;\n\n  for (const creator of creators) {\n    const username = generateUsername(creator);\n    \n    console.log(`Processing: ${creator.name || creator.address}`);\n\n    // Check if user already exists by wallet address\n    const { data: existingUser } = await supabase\n      .from('users')\n      .select('id')\n      .eq('wallet_address', creator.address)\n      .single();\n\n    if (existingUser) {\n      console.log(`  ‚è≠Ô∏è  Skipped - already exists in users table`);\n      skipCount++;\n      continue;\n    }\n\n    // Check if username is taken\n    const { data: existingUsername } = await supabase\n      .from('users')\n      .select('id')\n      .eq('username', username)\n      .single();\n\n    const finalUsername = existingUsername ? `${username}_${creator.address.slice(-4)}` : username;\n\n    // Insert into users table\n    const { error: insertError } = await supabase\n      .from('users')\n      .insert({\n        wallet_address: creator.address,\n        username: finalUsername,\n        display_name: creator.name,\n        bio: creator.bio,\n        avatar_url: creator.avatar,\n        e1xp_points: parseInt(creator.points) || 0,\n        referral_code: creator.referral_code,\n        is_admin: creator.address === 'admin_bloombetgaming_at_gmail_com' ? 1 : 0,\n        created_at: creator.created_at,\n      });\n\n    if (insertError) {\n      console.log(`  ‚ùå Error: ${insertError.message}`);\n      errorCount++;\n    } else {\n      console.log(`  ‚úÖ Migrated as @${finalUsername}`);\n      successCount++;\n    }\n  }\n\n  console.log('\\nüìà Migration Summary:');\n  console.log(`  ‚úÖ Successfully migrated: ${successCount}`);\n  console.log(`  ‚è≠Ô∏è  Skipped (already exists): ${skipCount}`);\n  console.log(`  ‚ùå Errors: ${errorCount}`);\n  console.log(`\\nüéâ Migration complete!`);\n}\n\n// Run the migration\nmigrateCreatorsToUsers()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error('‚ùå Migration failed:', error);\n    process.exit(1);\n  });\n","size_bytes":3857},"client/src/pages/admin-create.tsx":{"content":"\nimport { useState } from \"react\";\nimport URLInputForm from \"@/components/url-input-form\";\nimport ContentPreview from \"@/components/content-preview\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Upload,\n  Link as LinkIcon,\n  Image,\n  Film,\n  Music,\n  FileText,\n  Loader2,\n  Sparkles,\n  Shield,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype TabType = \"import\" | \"upload\";\n\nexport default function AdminCreate() {\n  const [showPreview, setShowPreview] = useState(false);\n  const [scrapedData, setScrapedData] = useState<any>(null);\n  const [uploadedFile, setUploadedFile] = useState<File | null>(null);\n  const [uploadPreviewUrl, setUploadPreviewUrl] = useState<string>(\"\");\n  const [uploadTitle, setUploadTitle] = useState(\"\");\n  const [uploadDescription, setUploadDescription] = useState(\"\");\n  const [uploadAuthor, setUploadAuthor] = useState(\"\");\n  const [isUploading, setIsUploading] = useState(false);\n  const [activeTab, setActiveTab] = useState<TabType>(\"import\");\n  const { toast } = useToast();\n\n  const handleScrapedData = (data: any) => {\n    setScrapedData(data);\n    setShowPreview(true);\n  };\n\n  const handleCoinCreated = () => {\n    setShowPreview(false);\n    setScrapedData(null);\n    resetUploadForm();\n  };\n\n  const resetUploadForm = () => {\n    setUploadedFile(null);\n    setUploadPreviewUrl(\"\");\n    setUploadTitle(\"\");\n    setUploadDescription(\"\");\n    setUploadAuthor(\"\");\n  };\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    const maxSize = 100 * 1024 * 1024;\n\n    // Accept all image, video, and audio files (matches backend handling)\n    const isValidType = file.type.startsWith('image/') || \n                        file.type.startsWith('video/') || \n                        file.type.startsWith('audio/');\n\n    if (!isValidType) {\n      toast({\n        title: \"Invalid file type\",\n        description: \"Please upload an image, video, or audio file\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (file.size > maxSize) {\n      toast({\n        title: \"File too large\",\n        description: \"Maximum file size is 100MB\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setUploadedFile(file);\n    const previewUrl = URL.createObjectURL(file);\n    setUploadPreviewUrl(previewUrl);\n\n    if (!uploadTitle) {\n      const nameWithoutExt = file.name.replace(/\\.[^/.]+$/, \"\");\n      setUploadTitle(nameWithoutExt);\n    }\n  };\n\n  const handleUploadPreview = async () => {\n    if (!uploadedFile || !uploadTitle) {\n      toast({\n        title: \"Missing information\",\n        description: \"Please upload a file and provide a title\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsUploading(true);\n\n    try {\n      const formData = new FormData();\n      formData.append(\"file\", uploadedFile);\n      formData.append(\"title\", uploadTitle);\n      formData.append(\"description\", uploadDescription);\n      formData.append(\"author\", uploadAuthor);\n\n      const uploadRes = await fetch(\"/api/upload\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!uploadRes.ok) {\n        throw new Error(\"Failed to upload file\");\n      }\n\n      const { uploadData } = await uploadRes.json();\n\n      setScrapedData(uploadData);\n      setShowPreview(true);\n\n      toast({\n        title: \"Upload successful\",\n        description: \"Review your content and create your coin\",\n      });\n    } catch (error) {\n      console.error(\"Upload error:\", error);\n      toast({\n        title: \"Upload failed\",\n        description: \"Failed to upload file. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const getFileIcon = () => {\n    if (!uploadedFile) return <FileText className=\"w-6 h-6\" />;\n    const type = uploadedFile.type.split(\"/\")[0];\n    switch (type) {\n      case \"image\":\n        return <Image className=\"w-6 h-6\" />;\n      case \"video\":\n        return <Film className=\"w-6 h-6\" />;\n      case \"audio\":\n        return <Music className=\"w-6 h-6\" />;\n      default:\n        return <FileText className=\"w-6 h-6\" />;\n    }\n  };\n\n  return (\n    <div className=\"p-3 sm:p-8 md:p-8\">\n      <div className=\"max-w-2xl mx-auto\">\n        <div className=\"mb-4 sm:mb-8 text-center\">\n          <div className=\"flex items-center justify-center gap-1.5 sm:gap-2 mb-2 sm:mb-3\">\n            <Shield className=\"w-4 h-4 sm:w-5 sm:h-5 text-primary\" />\n            <h1 className=\"text-xl sm:text-2xl md:text-3xl font-black text-foreground\">\n              Admin Content Creation\n            </h1>\n          </div>\n          <p className=\"text-xs sm:text-sm text-muted-foreground\">\n            Import or upload content as an admin\n          </p>\n        </div>\n\n        <div className=\"flex items-center justify-center gap-1.5 sm:gap-2 mb-4 sm:mb-6\">\n          <button\n            onClick={() => setActiveTab(\"import\")}\n            className={`\n              relative flex items-center gap-1 sm:gap-2 px-3 sm:px-6 py-1.5 sm:py-2.5 rounded-full text-xs sm:text-sm font-semibold transition-all\n              ${\n                activeTab === \"import\"\n                  ? \"bg-gradient-to-r from-primary to-secondary text-primary-foreground\"\n                  : \"bg-muted/50 text-muted-foreground hover-elevate active-elevate-2\"\n              }\n            `}\n            data-testid=\"button-tab-import\"\n          >\n            <LinkIcon className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n            Import URL\n          </button>\n          <button\n            onClick={() => setActiveTab(\"upload\")}\n            className={`\n              relative flex items-center gap-1 sm:gap-2 px-3 sm:px-6 py-1.5 sm:py-2.5 rounded-full text-xs sm:text-sm font-semibold transition-all\n              ${\n                activeTab === \"upload\"\n                  ? \"bg-gradient-to-r from-primary to-secondary text-primary-foreground\"\n                  : \"bg-muted/50 text-muted-foreground hover-elevate active-elevate-2\"\n              }\n            `}\n            data-testid=\"button-tab-upload\"\n          >\n            <Upload className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n            Upload File\n          </button>\n        </div>\n\n        <div className=\"mb-6\">\n          {activeTab === \"import\" ? (\n            <URLInputForm onScraped={handleScrapedData} />\n          ) : (\n            <div className=\"max-w-xl mx-auto\">\n              <div className=\"bg-card border border-border/50 rounded-3xl p-4 sm:p-8\">\n                <div className=\"space-y-4 sm:space-y-6\">\n                  <div className=\"border-2 border-dashed border-border/40 rounded-2xl p-6 sm:p-10 text-center bg-muted/20 hover:border-primary/50 transition-all hover:bg-muted/30\">\n                    <input\n                      type=\"file\"\n                      id=\"file-upload\"\n                      className=\"hidden\"\n                      accept=\"image/*,video/*,audio/*,.svg,.gif,.mp3,.mp4,.mov,.webm,.avi,.mkv,.flv,.wmv,.m4v,.3gp,.ogg,.wav,.aac,.flac,.m4a,.wma,.apng\"\n                      onChange={handleFileUpload}\n                      data-testid=\"input-file-upload\"\n                    />\n                    <label htmlFor=\"file-upload\" className=\"cursor-pointer\">\n                      <div className=\"flex flex-col items-center gap-4\">\n                        {uploadedFile ? (\n                          <>\n                            <div className=\"p-4 rounded-2xl bg-primary/10\">\n                              {getFileIcon()}\n                            </div>\n                            <div className=\"space-y-1\">\n                              <p className=\"text-sm font-semibold text-foreground\">\n                                {uploadedFile.name}\n                              </p>\n                              <p className=\"text-xs text-muted-foreground\">\n                                {(uploadedFile.size / (1024 * 1024)).toFixed(2)} MB\n                              </p>\n                            </div>\n                            {uploadPreviewUrl && uploadedFile.type.startsWith(\"image/\") && (\n                              <img\n                                src={uploadPreviewUrl}\n                                alt=\"Preview\"\n                                className=\"mt-2 max-h-48 rounded-2xl shadow-xl\"\n                              />\n                            )}\n                            {uploadPreviewUrl && uploadedFile.type.startsWith(\"video/\") && (\n                              <video\n                                src={uploadPreviewUrl}\n                                controls\n                                className=\"mt-2 max-h-48 rounded-2xl shadow-xl\"\n                              />\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"p-3 sm:p-5 rounded-2xl bg-gradient-to-br from-primary/20 to-secondary/20 mb-1 sm:mb-2\">\n                              <Upload className=\"w-8 h-8 sm:w-10 sm:h-10 text-primary\" />\n                            </div>\n                            <div className=\"space-y-1 sm:space-y-2\">\n                              <p className=\"text-sm sm:text-base font-semibold text-foreground\">\n                                Drag & drop or click to upload\n                              </p>\n                              <p className=\"text-[10px] sm:text-xs text-muted-foreground\">\n                                Images, Videos, or Audio ‚Ä¢ Max 100MB\n                              </p>\n                            </div>\n                          </>\n                        )}\n                      </div>\n                    </label>\n                  </div>\n\n                  {uploadedFile && (\n                    <div className=\"space-y-3 sm:space-y-5 pt-2 border-t border-border/30\">\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"upload-title\" className=\"text-xs sm:text-sm font-medium text-foreground\">\n                          Title <span className=\"text-red-500\">*</span>\n                        </Label>\n                        <div className=\"bg-muted/30 dark:bg-muted/20 rounded-2xl p-1 border border-border/30\">\n                          <Input\n                            id=\"upload-title\"\n                            value={uploadTitle}\n                            onChange={(e) => setUploadTitle(e.target.value)}\n                            placeholder=\"Enter content title\"\n                            className=\"bg-transparent border-0 h-9 sm:h-11 px-3 sm:px-4 text-sm focus-visible:ring-0 focus-visible:ring-offset-0\"\n                            data-testid=\"input-upload-title\"\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"upload-description\" className=\"text-xs sm:text-sm font-medium text-foreground\">\n                          Description\n                        </Label>\n                        <div className=\"bg-muted/30 dark:bg-muted/20 rounded-2xl p-1 border border-border/30\">\n                          <Textarea\n                            id=\"upload-description\"\n                            value={uploadDescription}\n                            onChange={(e) => setUploadDescription(e.target.value)}\n                            placeholder=\"Describe your content (optional)\"\n                            className=\"bg-transparent border-0 resize-none px-3 sm:px-4 text-sm focus-visible:ring-0 focus-visible:ring-offset-0\"\n                            rows={3}\n                            data-testid=\"input-upload-description\"\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-1.5 sm:space-y-2\">\n                        <Label htmlFor=\"upload-author\" className=\"text-xs sm:text-sm font-medium text-foreground\">\n                          Creator Name\n                        </Label>\n                        <div className=\"bg-muted/30 dark:bg-muted/20 rounded-2xl p-1 border border-border/30\">\n                          <Input\n                            id=\"upload-author\"\n                            value={uploadAuthor}\n                            onChange={(e) => setUploadAuthor(e.target.value)}\n                            placeholder=\"Your name or username (optional)\"\n                            className=\"bg-transparent border-0 h-9 sm:h-11 px-3 sm:px-4 text-sm focus-visible:ring-0 focus-visible:ring-offset-0\"\n                            data-testid=\"input-upload-author\"\n                          />\n                        </div>\n                      </div>\n\n                      <Button\n                        onClick={handleUploadPreview}\n                        disabled={isUploading || !uploadTitle}\n                        className=\"w-full h-10 sm:h-12 text-sm sm:text-base bg-gradient-to-r from-primary to-primary hover:from-primary/100 hover:to-primary/90 text-primary-foreground font-semibold rounded-2xl transition-all\"\n                        data-testid=\"button-upload-preview\"\n                      >\n                        {isUploading ? (\n                          <>\n                            <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\n                            Uploading...\n                          </>\n                        ) : (\n                          <>\n                            <Sparkles className=\"w-5 h-5 mr-2\" />\n                            Preview & Create Coin\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        <Dialog open={showPreview} onOpenChange={setShowPreview}>\n          <DialogContent className=\"max-w-lg w-[92vw] max-h-[80vh] overflow-y-auto bg-card border-border/50 rounded-3xl p-0 gap-0\">\n            <DialogHeader className=\"px-5 pt-5 pb-3 border-b border-border/30\">\n              <DialogTitle className=\"text-lg font-bold text-foreground\">\n                Preview & Create Coin\n              </DialogTitle>\n            </DialogHeader>\n            <div className=\"px-5 py-4\">\n              {scrapedData && (\n                <ContentPreview\n                  scrapedData={scrapedData}\n                  onCoinCreated={handleCoinCreated}\n                />\n              )}\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </div>\n  );\n}\n","size_bytes":14891},"client/src/pages/admin-network.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Network, AlertCircle, CheckCircle2 } from \"lucide-react\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\n\nexport default function AdminNetwork() {\n  const { toast } = useToast();\n  const [currentNetwork, setCurrentNetwork] = useState<'sepolia' | 'mainnet'>('sepolia');\n  const [isChanging, setIsChanging] = useState(false);\n\n  useEffect(() => {\n    // Load current network from localStorage\n    const savedNetwork = localStorage.getItem('ADMIN_NETWORK_PREFERENCE') as 'sepolia' | 'mainnet' | null;\n    if (savedNetwork) {\n      setCurrentNetwork(savedNetwork);\n    }\n  }, []);\n\n  const handleNetworkSwitch = async (network: 'sepolia' | 'mainnet') => {\n    if (network === currentNetwork) return;\n\n    setIsChanging(true);\n\n    try {\n      // Save network preference to localStorage\n      localStorage.setItem('ADMIN_NETWORK_PREFERENCE', network);\n      setCurrentNetwork(network);\n\n      toast({\n        title: \"Network Switched\",\n        description: `Switched to Base ${network === 'sepolia' ? 'Sepolia (Testnet)' : 'Mainnet'}`,\n      });\n\n      // Reload page to apply network change\n      setTimeout(() => {\n        window.location.reload();\n      }, 1000);\n    } catch (error) {\n      toast({\n        title: \"Network Switch Failed\",\n        description: error instanceof Error ? error.message : \"Failed to switch network\",\n        variant: \"destructive\",\n      });\n      setIsChanging(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6 max-w-4xl\">\n      <div>\n        <h2 className=\"text-2xl font-bold\">Network Settings</h2>\n        <p className=\"text-muted-foreground\">Switch between Base Sepolia (testnet) and Base Mainnet</p>\n      </div>\n\n      {/* Current Network Status */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Network className=\"w-5 h-5\" />\n            Current Network\n          </CardTitle>\n          <CardDescription>Active blockchain network for coin creation</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center gap-3\">\n            <Badge variant={currentNetwork === 'sepolia' ? 'secondary' : 'default'} className=\"text-lg px-4 py-2\">\n              {currentNetwork === 'sepolia' ? 'Base Sepolia (Testnet)' : 'Base Mainnet'}\n            </Badge>\n            <CheckCircle2 className=\"w-5 h-5 text-green-500\" />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Warning Alert */}\n      <Alert variant=\"destructive\">\n        <AlertCircle className=\"h-4 w-4\" />\n        <AlertTitle>Warning</AlertTitle>\n        <AlertDescription>\n          Switching networks will affect all new coin deployments. Existing coins will remain on their original network.\n          <br />\n          <strong className=\"mt-2 block\">Mainnet uses real ETH and incurs real costs!</strong>\n        </AlertDescription>\n      </Alert>\n\n      {/* Network Options */}\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        {/* Base Sepolia */}\n        <Card className={currentNetwork === 'sepolia' ? 'border-primary' : ''}>\n          <CardHeader>\n            <CardTitle className=\"flex items-center justify-between\">\n              <span>Base Sepolia</span>\n              {currentNetwork === 'sepolia' && (\n                <Badge variant=\"default\">Active</Badge>\n              )}\n            </CardTitle>\n            <CardDescription>Testnet - Safe for testing</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Currency:</span>\n                <span className=\"font-medium\">Test ETH (Free)</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Chain ID:</span>\n                <span className=\"font-medium\">84532</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Cost:</span>\n                <span className=\"font-medium text-green-600\">No real cost</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Backing:</span>\n                <span className=\"font-medium\">ETH only</span>\n              </div>\n            </div>\n            <Button\n              onClick={() => handleNetworkSwitch('sepolia')}\n              disabled={currentNetwork === 'sepolia' || isChanging}\n              variant={currentNetwork === 'sepolia' ? 'secondary' : 'outline'}\n              className=\"w-full\"\n            >\n              {currentNetwork === 'sepolia' ? 'Currently Active' : 'Switch to Sepolia'}\n            </Button>\n          </CardContent>\n        </Card>\n\n        {/* Base Mainnet */}\n        <Card className={currentNetwork === 'mainnet' ? 'border-primary' : ''}>\n          <CardHeader>\n            <CardTitle className=\"flex items-center justify-between\">\n              <span>Base Mainnet</span>\n              {currentNetwork === 'mainnet' && (\n                <Badge variant=\"default\">Active</Badge>\n              )}\n            </CardTitle>\n            <CardDescription>Production - Real money involved</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Currency:</span>\n                <span className=\"font-medium\">Real ETH</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Chain ID:</span>\n                <span className=\"font-medium\">8453</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Cost:</span>\n                <span className=\"font-medium text-red-600\">Real gas fees</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Backing:</span>\n                <span className=\"font-medium\">ETH, ZORA, or CREATOR_COIN</span>\n              </div>\n            </div>\n            <Button\n              onClick={() => handleNetworkSwitch('mainnet')}\n              disabled={currentNetwork === 'mainnet' || isChanging}\n              variant={currentNetwork === 'mainnet' ? 'secondary' : 'default'}\n              className=\"w-full\"\n            >\n              {currentNetwork === 'mainnet' ? 'Currently Active' : 'Switch to Mainnet'}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Network Comparison */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Network Comparison</CardTitle>\n          <CardDescription>Key differences between networks</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-sm\">\n              <thead>\n                <tr className=\"border-b\">\n                  <th className=\"text-left py-2 px-4\">Feature</th>\n                  <th className=\"text-left py-2 px-4\">Base Sepolia</th>\n                  <th className=\"text-left py-2 px-4\">Base Mainnet</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr className=\"border-b\">\n                  <td className=\"py-2 px-4 text-muted-foreground\">Purpose</td>\n                  <td className=\"py-2 px-4\">Testing & Development</td>\n                  <td className=\"py-2 px-4\">Production Trading</td>\n                </tr>\n                <tr className=\"border-b\">\n                  <td className=\"py-2 px-4 text-muted-foreground\">ETH Value</td>\n                  <td className=\"py-2 px-4\">No real value</td>\n                  <td className=\"py-2 px-4\">Real monetary value</td>\n                </tr>\n                <tr className=\"border-b\">\n                  <td className=\"py-2 px-4 text-muted-foreground\">Get Test ETH</td>\n                  <td className=\"py-2 px-4\">Free from faucets</td>\n                  <td className=\"py-2 px-4\">Must purchase</td>\n                </tr>\n                <tr className=\"border-b\">\n                  <td className=\"py-2 px-4 text-muted-foreground\">Risk</td>\n                  <td className=\"py-2 px-4 text-green-600\">Zero financial risk</td>\n                  <td className=\"py-2 px-4 text-red-600\">Real financial risk</td>\n                </tr>\n                <tr>\n                  <td className=\"py-2 px-4 text-muted-foreground\">Recommended For</td>\n                  <td className=\"py-2 px-4\">Development, Testing</td>\n                  <td className=\"py-2 px-4\">Production, Live Trading</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":9266},"server/badge-service.ts":{"content":"\nimport { storage } from './supabase-storage';\nimport { BADGES } from './points';\n\nexport async function checkAndAwardBadges(userId: string, context: {\n  e1xpPoints?: number;\n  streakDays?: number;\n  coinsCreated?: number;\n  tradesCount?: number;\n  isEarlyAdopter?: boolean;\n  isTopHolder?: boolean;\n}) {\n  const existingBadges = await storage.getUserBadges(userId);\n  const existingBadgeTypes = new Set(existingBadges.map(b => b.badge_type));\n  const newBadges = [];\n\n  // Check E1XP point-based badges\n  if (context.e1xpPoints !== undefined) {\n    for (const [type, badge] of Object.entries(BADGES)) {\n      if (badge.threshold > 0 && context.e1xpPoints >= badge.threshold && !existingBadgeTypes.has(type)) {\n        newBadges.push({\n          userId,\n          badgeType: type,\n          badgeName: badge.name,\n          badgeIcon: badge.icon,\n          description: badge.description,\n        });\n      }\n    }\n  }\n\n  // Check streak-based badges\n  if (context.streakDays && context.streakDays >= 7 && !existingBadgeTypes.has('STREAK_MASTER')) {\n    const badge = BADGES.STREAK_MASTER;\n    newBadges.push({\n      userId,\n      badgeType: 'STREAK_MASTER',\n      badgeName: badge.name,\n      badgeIcon: badge.icon,\n      description: badge.description,\n    });\n  }\n\n  // Check first coin badge\n  if (context.coinsCreated === 1 && !existingBadgeTypes.has('FIRST_COIN')) {\n    const badge = BADGES.FIRST_COIN;\n    newBadges.push({\n      userId,\n      badgeType: 'FIRST_COIN',\n      badgeName: badge.name,\n      badgeIcon: badge.icon,\n      description: badge.description,\n    });\n  }\n\n  // Check early adopter badge\n  if (context.isEarlyAdopter && !existingBadgeTypes.has('EARLY_ADOPTER')) {\n    const badge = BADGES.EARLY_ADOPTER;\n    newBadges.push({\n      userId,\n      badgeType: 'EARLY_ADOPTER',\n      badgeName: badge.name,\n      badgeIcon: badge.icon,\n      description: badge.description,\n    });\n  }\n\n  // Check top holder badge\n  if (context.isTopHolder && !existingBadgeTypes.has('TOP_HOLDER')) {\n    const badge = BADGES.TOP_HOLDER;\n    newBadges.push({\n      userId,\n      badgeType: 'TOP_HOLDER',\n      badgeName: badge.name,\n      badgeIcon: badge.icon,\n      description: badge.description,\n    });\n  }\n\n  // Award new badges\n  for (const badge of newBadges) {\n    await storage.awardBadge(badge);\n  }\n\n  return newBadges;\n}\n","size_bytes":2341},"client/src/lib/gasless-deployment.ts":{"content":"import type { Address, Hash } from 'viem';\nimport type { SmartAccountClient } from 'permissionless';\nimport { encodeFunctionData, encodeAbiParameters, parseAbiParameters } from 'viem';\nimport { base, baseSepolia } from 'viem/chains';\n// No Zora SDK needed - using direct contract calls\n\nimport { createPublicClient, http } from 'viem';\n\n// Zora Factory contract address (same on both Base and Base Sepolia)\nconst ZORA_FACTORY_ADDRESS = \"0x777777751622c0d3258f214F9DF38E35BF45baF3\" as const;\n\n// Factory ABI - deployCreatorCoin function\nconst DEPLOY_CREATOR_COIN_ABI = [{\n  name: \"deployCreatorCoin\",\n  type: \"function\",\n  stateMutability: \"payable\",\n  inputs: [\n    { name: \"payoutRecipient\", type: \"address\" },\n    { name: \"owners\", type: \"address[]\" },\n    { name: \"uri\", type: \"string\" },\n    { name: \"name\", type: \"string\" },\n    { name: \"symbol\", type: \"string\" },\n    { name: \"poolConfig\", type: \"bytes\" },\n    { name: \"platformReferrer\", type: \"address\" },\n    { name: \"coinSalt\", type: \"bytes32\" }\n  ],\n  outputs: [\n    { name: \"coin\", type: \"address\" }\n  ]\n}] as const;\n\n// ETH Pool Config Constants\nconst ETH_COIN_PAIR_LOWER_TICK = -887220;\nconst ETH_COIN_PAIR_UPPER_TICK = 887220;\nconst ETH_COIN_PAIR_NUM_DISCOVERY_POSITIONS = 1;\nconst ETH_COIN_PAIR_MAX_DISCOVERY_SUPPLY_SHARE = BigInt(\"1000000000000000000\"); // 1e18 (100%)\nconst ETH_ADDRESS = \"0x0000000000000000000000000000000000000000\";\n\n/**\n * Encodes pool config for ETH-paired coins using proper ABI encoding\n */\nfunction encodeETHPoolConfig(): `0x${string}` {\n  // Use viem's encodeAbiParameters for correct ABI encoding\n  // Format: (uint8 version, address currency, int24[] tickLower, int24[] tickUpper, uint16[] numDiscoveryPositions, uint256[] maxDiscoverySupplyShare)\n  const encoded = encodeAbiParameters(\n    parseAbiParameters('uint8, address, int24[], int24[], uint16[], uint256[]'),\n    [\n      4, // version\n      ETH_ADDRESS as Address, // currency (ETH)\n      [ETH_COIN_PAIR_LOWER_TICK], // tickLower array\n      [ETH_COIN_PAIR_UPPER_TICK], // tickUpper array\n      [ETH_COIN_PAIR_NUM_DISCOVERY_POSITIONS], // numDiscoveryPositions array\n      [ETH_COIN_PAIR_MAX_DISCOVERY_SUPPLY_SHARE], // maxDiscoverySupplyShare array\n    ]\n  );\n\n  return encoded;\n}\n\n/**\n * Generate deterministic salt for coin deployment\n */\nfunction generateCoinSalt(creator: Address, name: string, symbol: string, metadataUri: string): `0x${string}` {\n  const timestamp = Date.now().toString(16).padStart(16, '0');\n  const hash = `${creator}${name}${symbol}${metadataUri}`.split('').reduce((acc, char) => {\n    return ((acc << 5) - acc) + char.charCodeAt(0);\n  }, 0);\n  return `0x${timestamp}${Math.abs(hash).toString(16).padStart(48, '0')}` as `0x${string}`;\n}\n\nexport interface GaslessCoinDeployParams {\n  name: string;\n  symbol: string;\n  metadataUri: string;\n  smartAccountAddress: Address;\n  platformReferrer?: Address;\n}\n\nexport interface GaslessCoinDeployResult {\n  hash: Hash;\n  address?: Address;\n  createdAt?: number;\n  smartAccountAddress: Address;\n  chainId: number;\n}\n\n/**\n * Deploy a coin using smart wallet with gasless transaction (Base Paymaster)\n */\nexport async function deployGaslessCoin(\n  params: GaslessCoinDeployParams,\n  smartAccountClient: SmartAccountClient\n): Promise<GaslessCoinDeployResult> {\n  console.log(\"ü™ô [Gasless] Deploying coin with params:\", params);\n\n  const {\n    name,\n    symbol,\n    metadataUri,\n    smartAccountAddress,\n    platformReferrer = \"0xf25af781c4F1Df40Ac1D06e6B80c17815AD311F7\" as Address,\n  } = params;\n\n  try {\n    // Get network preference\n    const networkPreference = localStorage.getItem('ADMIN_NETWORK_PREFERENCE') as 'sepolia' | 'mainnet' | null;\n    const chain = networkPreference === 'mainnet' ? base : baseSepolia;\n\n    console.log(`üì° [Gasless] Using network: ${chain.name} (Chain ID: ${chain.id})`);\n    console.log(`üìç [Gasless] Smart account address: ${smartAccountAddress}`);\n    console.log(`üí∞ [Gasless] Payout recipient: ${smartAccountAddress}`);\n\n    // Create public client for reading blockchain state (separate from smart account)\n    const publicClient = createPublicClient({\n      chain,\n      transport: http(),\n    });\n\n    console.log(\"üì§ [Gasless] Deploying coin using DIRECT contract call...\");\n    console.log(\"‚ö†Ô∏è  [Gasless] Gas will be sponsored by Base Paymaster\");\n\n    // Use direct contract deployment (same as your zora-factory.ts but with smart account)\n    const { createCoinOnBaseSepolia } = await import(\"./zora-coins\");\n\n    const deployResult = await createCoinOnBaseSepolia(\n      {\n        creator: params.smartAccountAddress,\n        name: params.name,\n        symbol: params.symbol,\n        metadataUri: params.metadataUri,\n        platformReferrer: params.platformReferrer,\n      },\n      smartAccountClient as any, // Smart account acts as wallet client for writing\n      publicClient as any  // Regular public client for reading/simulating\n    );\n\n    console.log(\"‚úÖ [Gasless] Transaction sent! Hash:\", deployResult.hash);\n    console.log(\"‚è≥ [Gasless] Waiting for transaction confirmation...\");\n\n    // Wait for transaction receipt\n    const receipt = await publicClient.waitForTransactionReceipt({\n      hash: deployResult.hash,\n    });\n\n    console.log(\"‚úÖ [Gasless] Transaction confirmed!\");\n\n    // Coin address is already in deployResult from direct contract call\n    const coinAddress = deployResult.address;\n\n    console.log(\"üìç [Gasless] Deployed coin address:\", coinAddress || \"Not found in logs\");\n    console.log(\"üéâ [Gasless] Coin deployed with ZERO gas fees!\");\n\n    const createdAt = Math.floor(Date.now() / 1000);\n\n    return {\n      hash: deployResult.hash,\n      address: coinAddress,\n      createdAt,\n      smartAccountAddress,\n      chainId: chain.id,\n    };\n  } catch (error) {\n    console.error(\"‚ùå [Gasless] Coin deployment failed:\", error);\n    throw error;\n  }\n}","size_bytes":5871},"client/src/contexts/SmartAccountContext.tsx":{"content":"import { createContext, useContext, useEffect, useState, ReactNode, useCallback } from 'react';\nimport { usePrivy, useWallets } from '@privy-io/react-auth';\nimport { createPublicClient, http, type Address, type Chain, createWalletClient, custom } from 'viem';\nimport { base, baseSepolia } from 'viem/chains';\nimport { createSmartAccountClient } from 'permissionless';\nimport { toSimpleSmartAccount } from 'permissionless/accounts';\nimport type { SmartAccountClient } from 'permissionless';\nimport { entryPoint07Address } from 'viem/account-abstraction';\n\nconst ENTRYPOINT_ADDRESS_V07 = entryPoint07Address;\n\ninterface SmartAccountContextType {\n  smartAccountClient: SmartAccountClient | null;\n  smartAccountAddress: Address | null;\n  isLoading: boolean;\n  error: string | null;\n  initSmartAccount: () => Promise<{ client: SmartAccountClient; address: Address } | null>;\n}\n\nconst SmartAccountContext = createContext<SmartAccountContextType>({\n  smartAccountClient: null,\n  smartAccountAddress: null,\n  isLoading: false,\n  error: null,\n  initSmartAccount: async () => null,\n});\n\nexport const useSmartAccount = () => useContext(SmartAccountContext);\n\ninterface SmartAccountProviderProps {\n  children: ReactNode;\n}\n\nexport function SmartAccountProvider({ children }: SmartAccountProviderProps) {\n  const { ready, authenticated, user } = usePrivy();\n  const { wallets } = useWallets();\n  const [smartAccountClient, setSmartAccountClient] = useState<SmartAccountClient | null>(null);\n  const [smartAccountAddress, setSmartAccountAddress] = useState<Address | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const initSmartAccount = useCallback(async () => {\n    if (!authenticated || !user) {\n      console.log(\"‚ùå Cannot initialize: User not authenticated\");\n      return null;\n    }\n\n    // Wait for wallets to be available\n    if (!wallets || wallets.length === 0) {\n      console.log(\"‚è≥ Waiting for wallets to be available...\");\n      return null;\n    }\n\n    // Check if we already have a smart account for this user\n    if (smartAccountClient && smartAccountAddress) {\n      console.log(\"‚úÖ Smart account already initialized:\", smartAccountAddress);\n      return { client: smartAccountClient, address: smartAccountAddress };\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const embeddedWallet = wallets.find((wallet) => wallet.walletClientType === 'privy');\n\n      if (!embeddedWallet) {\n        console.log(\"‚è≥ No embedded wallet found yet, waiting...\");\n        setIsLoading(false);\n        return null;\n      }\n\n      console.log(\"üíº Found wallet:\", embeddedWallet.walletClientType);\n\n      // Get network preference\n      const networkPreference = localStorage.getItem('ADMIN_NETWORK_PREFERENCE') as 'sepolia' | 'mainnet' | null;\n      const chain = networkPreference === 'mainnet' ? base : baseSepolia;\n      const paymasterUrl = networkPreference === 'mainnet'\n        ? `https://api.developer.coinbase.com/rpc/v1/base/${import.meta.env.VITE_COINBASE_PAYMASTER_API_KEY}`\n        : `https://api.developer.coinbase.com/rpc/v1/base-sepolia/${import.meta.env.VITE_COINBASE_PAYMASTER_API_KEY}`;\n\n      console.log(`üîê Initializing smart account on ${chain.name}...`);\n      console.log(\"üì° Using Base Paymaster RPC:\", paymasterUrl);\n\n      // Create public client for the chain\n      const publicClient = createPublicClient({\n        chain,\n        transport: http(),\n      });\n\n      // Get the EIP1193 provider from Privy wallet\n      const provider = await embeddedWallet.getEthereumProvider();\n\n      // Get the wallet address\n      const accounts = await provider.request({ method: 'eth_accounts' }) as string[];\n      if (!accounts || accounts.length === 0) {\n        throw new Error(\"No accounts found in wallet\");\n      }\n      const ownerAddress = accounts[0] as Address;\n      console.log(\"üë§ Owner address:\", ownerAddress);\n\n      // Create wallet client from the provider\n      const walletClient = createWalletClient({\n        account: ownerAddress,\n        chain,\n        transport: custom(provider),\n      });\n\n      // Create simple smart account\n      const account = await toSimpleSmartAccount({\n        client: publicClient,\n        owner: walletClient,\n        entryPoint: {\n          address: ENTRYPOINT_ADDRESS_V07,\n          version: \"0.7\"\n        },\n      });\n\n      console.log('‚úÖ Smart account created:', account.address);\n\n      // Create smart account client with Base Paymaster\n      const client = createSmartAccountClient({\n        account,\n        chain,\n        bundlerTransport: http(paymasterUrl),\n        paymaster: {\n          getPaymasterData: async (userOperation: any) => {\n            // Base Paymaster handles paymaster data automatically via RPC\n            return {\n              paymaster: undefined,\n              paymasterData: '0x',\n            };\n          },\n        },\n        userOperation: {\n          estimateFeesPerGas: async () => {\n            const fees = await publicClient.estimateFeesPerGas();\n            return {\n              maxFeePerGas: fees.maxFeePerGas || BigInt(0),\n              maxPriorityFeePerGas: fees.maxPriorityFeePerGas || BigInt(0),\n            };\n          },\n        },\n      });\n\n      setSmartAccountClient(client as SmartAccountClient);\n      setSmartAccountAddress(account.address);\n\n      console.log(\"‚úÖ Smart account client ready\");\n      console.log(\"üìç Smart account address:\", account.address);\n      \n      return { client: client as SmartAccountClient, address: account.address };\n    } catch (err) {\n      console.error(\"‚ùå Failed to initialize smart account:\", err);\n      setError(err instanceof Error ? err.message : \"Failed to initialize smart account\");\n\n      // Retry once after a short delay\n      setTimeout(() => {\n        if (!smartAccountClient && authenticated && wallets && wallets.length > 0) {\n          console.log(\"üîÑ Retrying smart account initialization...\");\n          setError(null);\n          initSmartAccount();\n        }\n      }, 2000);\n      \n      return null;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [authenticated, user, wallets, smartAccountClient, smartAccountAddress]);\n\n  // Auto-initialize smart account when user is ready (silent background process)\n  useEffect(() => {\n    if (ready && authenticated && wallets && wallets.length > 0 && !smartAccountClient && !isLoading) {\n      initSmartAccount();\n    }\n  }, [ready, authenticated, wallets, smartAccountClient, isLoading, initSmartAccount]);\n\n  return (\n    <SmartAccountContext.Provider\n      value={{\n        smartAccountClient,\n        smartAccountAddress,\n        isLoading,\n        error,\n        initSmartAccount,\n      }}\n    >\n      {children}\n    </SmartAccountContext.Provider>\n  );\n}","size_bytes":6811},"client/src/components/withdraw-earnings-modal.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { usePrivy } from \"@privy-io/react-auth\";\nimport { Loader2, Wallet, TrendingUp } from \"lucide-react\";\nimport type { Address } from \"viem\";\nimport { createPublicClient, http } from \"viem\";\nimport { base } from \"viem/chains\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { Coin } from \"@shared/schema\";\nimport { useSmartAccount } from \"@/contexts/SmartAccountContext\";\n\ninterface WithdrawEarningsModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  userCoins: Coin[]; // Coins deployed by the user\n}\n\n// ABI for Zora CreatorCoin withdraw function\nconst CREATOR_COIN_ABI = [\n  {\n    name: \"withdraw\",\n    type: \"function\",\n    stateMutability: \"nonpayable\",\n    inputs: [\n      { name: \"to\", type: \"address\" },\n      { name: \"amount\", type: \"uint256\" }\n    ],\n    outputs: []\n  },\n  {\n    name: \"creatorEarnings\",\n    type: \"function\",\n    stateMutability: \"view\",\n    inputs: [{ name: \"creator\", type: \"address\" }],\n    outputs: [{ name: \"\", type: \"uint256\" }]\n  }\n] as const;\n\nexport default function WithdrawEarningsModal({\n  open,\n  onOpenChange,\n  userCoins,\n}: WithdrawEarningsModalProps) {\n  const { toast } = useToast();\n  const { user, authenticated } = usePrivy();\n  const { smartAccountClient, smartAccountAddress } = useSmartAccount();\n  const [recipientAddress, setRecipientAddress] = useState(\"\");\n  const [selectedCoinAddress, setSelectedCoinAddress] = useState<string>(\"\");\n  const [isWithdrawing, setIsWithdrawing] = useState(false);\n  const [coinEarnings, setCoinEarnings] = useState<Record<string, string>>({});\n\n  const userAddress = smartAccountAddress || user?.wallet?.address;\n\n  // Fetch earnings for each coin from Zora\n  useEffect(() => {\n    if (!open || !userCoins.length || !userAddress) return;\n\n    const fetchEarnings = async () => {\n      const { getCoin } = await import(\"@zoralabs/coins-sdk\");\n      const earnings: Record<string, string> = {};\n\n      for (const coin of userCoins) {\n        if (!coin.address) continue;\n        try {\n          const coinData = await getCoin({\n            address: coin.address as `0x${string}`,\n            chain: base,\n          });\n\n          const tokenData = coinData.data?.zora20Token;\n          if (tokenData?.creatorEarnings && tokenData.creatorEarnings.length > 0) {\n            const earningAmount = tokenData.creatorEarnings[0].amount?.amountDecimal || \"0\";\n            earnings[coin.address] = earningAmount;\n          } else {\n            earnings[coin.address] = \"0\";\n          }\n        } catch (error) {\n          console.error(`Error fetching earnings for ${coin.address}:`, error);\n          earnings[coin.address] = \"0\";\n        }\n      }\n\n      setCoinEarnings(earnings);\n    };\n\n    fetchEarnings();\n  }, [open, userCoins, userAddress]);\n\n  const handleWithdraw = async () => {\n    // Validate address\n    if (!recipientAddress.match(/^0x[a-fA-F0-9]{40}$/)) {\n      toast({\n        title: \"Invalid Address\",\n        description: \"Please enter a valid Ethereum address\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!selectedCoinAddress) {\n      toast({\n        title: \"Select a Coin\",\n        description: \"Please select a coin to withdraw earnings from\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!authenticated || !userAddress) {\n      toast({\n        title: \"Not Authenticated\",\n        description: \"Please connect your wallet\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const earnings = coinEarnings[selectedCoinAddress];\n    if (!earnings || parseFloat(earnings) <= 0) {\n      toast({\n        title: \"No Earnings\",\n        description: \"This coin has no earnings to withdraw\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsWithdrawing(true);\n\n    try {\n      let hash: `0x${string}`;\n\n      // Use smart account client for gasless withdrawal (email users)\n      if (smartAccountClient) {\n        console.log(\"üí∞ [Gasless] Initiating gasless withdrawal via smart account...\");\n        \n        hash = await smartAccountClient.writeContract({\n          address: selectedCoinAddress as Address,\n          abi: CREATOR_COIN_ABI,\n          functionName: \"withdraw\",\n          args: [recipientAddress as Address, BigInt(Math.floor(parseFloat(earnings) * 1e18))],\n        });\n\n        console.log(\"‚úÖ [Gasless] Withdrawal transaction sent (gas sponsored by Base Paymaster)\");\n      } else {\n        // Fallback to regular wallet client for wallet users\n        console.log(\"üí∞ [Regular] Initiating withdrawal via external wallet...\");\n        \n        const provider = await (window as any).ethereum;\n        if (!provider) {\n          throw new Error(\"No Ethereum provider found\");\n        }\n\n        const { createWalletClient, custom } = await import(\"viem\");\n        const walletClient = createWalletClient({\n          account: userAddress as Address,\n          chain: base,\n          transport: custom(provider),\n        });\n\n        hash = await walletClient.writeContract({\n          address: selectedCoinAddress as Address,\n          abi: CREATOR_COIN_ABI,\n          functionName: \"withdraw\",\n          args: [recipientAddress as Address, BigInt(Math.floor(parseFloat(earnings) * 1e18))],\n        });\n\n        console.log(\"‚úÖ [Regular] Withdrawal transaction sent\");\n      }\n\n      toast({\n        title: \"Withdrawal Initiated!\",\n        description: `Withdrawing ${parseFloat(earnings).toFixed(6)} ETH to ${recipientAddress.slice(0, 6)}...${recipientAddress.slice(-4)}`,\n      });\n\n      // Wait for confirmation\n      const publicClient = createPublicClient({\n        chain: base,\n        transport: http(),\n      });\n\n      await publicClient.waitForTransactionReceipt({ hash });\n\n      toast({\n        title: \"Withdrawal Successful! üéâ\",\n        description: `${parseFloat(earnings).toFixed(6)} ETH sent successfully${smartAccountClient ? ' (gas-free!)' : ''}`,\n      });\n\n      onOpenChange(false);\n      setRecipientAddress(\"\");\n      setSelectedCoinAddress(\"\");\n    } catch (error) {\n      console.error(\"Withdrawal error:\", error);\n      toast({\n        title: \"Withdrawal Failed\",\n        description: error instanceof Error ? error.message : \"Failed to withdraw earnings\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsWithdrawing(false);\n    }\n  };\n\n  const totalEarnings = Object.values(coinEarnings).reduce(\n    (sum, earning) => sum + parseFloat(earning || \"0\"),\n    0\n  );\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <TrendingUp className=\"w-5 h-5\" />\n            Withdraw Earnings\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-3 py-3\">\n          <div className=\"bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/20 rounded-lg p-3\">\n            <p className=\"text-2xl font-bold text-green-500\">{totalEarnings.toFixed(6)} ETH</p>\n            <p className=\"text-xs text-muted-foreground\">{userCoins.length} coin(s)</p>\n          </div>\n\n          <div className=\"space-y-1.5\">\n            <Label htmlFor=\"coin-select\" className=\"text-sm\">Select Coin</Label>\n            <select\n              id=\"coin-select\"\n              value={selectedCoinAddress}\n              onChange={(e) => setSelectedCoinAddress(e.target.value)}\n              className=\"w-full px-3 py-2 bg-background border border-input rounded-md text-sm\"\n            >\n              <option value=\"\">-- Select a coin --</option>\n              {userCoins\n                .filter(coin => coin.address && parseFloat(coinEarnings[coin.address] || \"0\") > 0)\n                .map((coin) => (\n                  <option key={coin.id} value={coin.address}>\n                    {coin.name} ({coin.symbol}) - {parseFloat(coinEarnings[coin.address!] || \"0\").toFixed(6)} ETH\n                  </option>\n                ))}\n            </select>\n          </div>\n\n          {selectedCoinAddress && (\n            <div className=\"bg-muted/30 rounded-lg p-2.5\">\n              <p className=\"text-sm text-muted-foreground\">Amount</p>\n              <p className=\"text-lg font-bold text-foreground\">\n                {parseFloat(coinEarnings[selectedCoinAddress] || \"0\").toFixed(6)} ETH\n              </p>\n            </div>\n          )}\n\n          <div className=\"space-y-1.5\">\n            <Label htmlFor=\"recipient-address\" className=\"text-sm\">Recipient Address</Label>\n            <Input\n              id=\"recipient-address\"\n              placeholder=\"0x...\"\n              value={recipientAddress}\n              onChange={(e) => setRecipientAddress(e.target.value)}\n              className=\"font-mono text-sm\"\n            />\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={isWithdrawing}\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={handleWithdraw}\n            disabled={isWithdrawing || !recipientAddress || !selectedCoinAddress}\n            className=\"bg-green-600 hover:bg-green-700\"\n          >\n            {isWithdrawing ? (\n              <>\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                Withdrawing...\n              </>\n            ) : (\n              \"Withdraw Earnings\"\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":9905},"apply_migration.js":{"content":"import postgres from 'postgres';\nimport { readFileSync } from 'fs';\n\nconst databaseUrl = process.env.DATABASE_DIRECT_URL || process.env.DATABASE_URL;\n\nif (!databaseUrl) {\n  throw new Error('DATABASE_URL or DATABASE_DIRECT_URL must be set');\n}\n\nconst sql = postgres(databaseUrl, {\n  max: 1,\n  ssl: { rejectUnauthorized: false },\n  idle_timeout: 20,\n  connect_timeout: 10\n});\n\nasync function migrate() {\n  try {\n    console.log('üìù Reading migration file...');\n    const migrationSQL = readFileSync('./migrations/0000_bizarre_mad_thinker.sql', 'utf8');\n    \n    console.log('üöÄ Applying migration to Supabase...');\n    await sql.unsafe(migrationSQL);\n    \n    console.log('‚úÖ Migration applied successfully!');\n    process.exit(0);\n  } catch (error) {\n    console.error('‚ùå Migration failed:', error);\n    process.exit(1);\n  } finally {\n    await sql.end();\n  }\n}\n\nmigrate();\n","size_bytes":880},"server/routes/registry.ts":{"content":"import { Router } from \"express\";\nimport { registryService } from \"../lib/registryService\";\nimport { manualRegistrySync } from \"../cron/registryCron\";\n\nconst router = Router();\n\nrouter.get(\"/registry/status\", async (req, res) => {\n  try {\n    const isConfigured = registryService.isConfigured();\n    \n    if (!isConfigured) {\n      return res.json({\n        configured: false,\n        message: \"Registry contract not configured. Set REGISTRY_CONTRACT_ADDRESS and PLATFORM_WALLET_PRIVATE_KEY in .env\"\n      });\n    }\n\n    const totalOnChain = await registryService.getTotalRegistrations();\n    const pending = await registryService.getPendingRegistrations();\n\n    res.json({\n      configured: true,\n      totalOnChain,\n      pendingCount: pending.length,\n      contractAddress: process.env.REGISTRY_CONTRACT_ADDRESS\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.post(\"/registry/sync\", async (req, res) => {\n  try {\n    if (!registryService.isConfigured()) {\n      return res.status(400).json({ \n        error: \"Registry contract not configured\" \n      });\n    }\n\n    manualRegistrySync().catch(console.error);\n\n    res.json({ \n      message: \"Registry sync started in background\" \n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/registry/pending\", async (req, res) => {\n  try {\n    const pending = await registryService.getPendingRegistrations();\n    res.json({ pending });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nrouter.get(\"/registry/check/:address\", async (req, res) => {\n  try {\n    const { address } = req.params;\n    \n    if (!registryService.isConfigured()) {\n      return res.status(400).json({ \n        error: \"Registry contract not configured\" \n      });\n    }\n\n    const isRegistered = await registryService.isRegistered(address);\n    const details = isRegistered \n      ? await registryService.getRegistrationDetails(address)\n      : null;\n\n    res.json({\n      address,\n      isRegistered,\n      details\n    });\n  } catch (error: any) {\n    res.status(500).json({ error: error.message });\n  }\n});\n\nexport default router;\n","size_bytes":2193},"REGISTRY_SETUP.md":{"content":"# Coin Registry Setup Guide\n\nThis guide explains how to deploy and configure the on-chain registry contract for tracking platform activity.\n\n## Purpose\n\nThe CoinRegistry contract provides verifiable on-chain proof of coins created via your platform. This is essential for:\n- **Grant applications** (Optimism RetroPGF, etc.)\n- **Platform analytics** and metrics\n- **User reputation** and badges\n- **Public transparency**\n\n## Prerequisites\n\n1. Node.js and npm installed\n2. A wallet with Base ETH for deployment (~$15-20)\n3. BaseScan API key (free from https://basescan.org/apis)\n\n## Setup Steps\n\n### 1. Install Dependencies\n\nDependencies are already included in `package.json`. If you need to install separately:\n\n```bash\nnpm install --save-dev hardhat @nomicfoundation/hardhat-toolbox @nomicfoundation/hardhat-verify ethers\n```\n\n### 2. Configure Environment Variables\n\nAdd these to your `.env` file:\n\n```bash\n# Registry Contract Configuration\nREGISTRY_CONTRACT_ADDRESS=         # Will be set after deployment\nPLATFORM_WALLET_PRIVATE_KEY=       # Private key for registering coins (KEEP SECRET!)\nPLATFORM_WALLET_ADDRESS=           # Public address of the platform wallet\n\n# Network Configuration\nBASE_RPC_URL=https://mainnet.base.org\nBASE_SEPOLIA_RPC_URL=https://sepolia.base.org\nBASESCAN_API_KEY=                  # Get from https://basescan.org/apis\n\n# Deployment Configuration\nDEPLOYER_PRIVATE_KEY=              # Private key for deploying contract (can be same as platform wallet)\n\n# Cron Schedule (optional)\nREGISTRY_CRON_SCHEDULE=0 */6 * * * # Every 6 hours (default)\n```\n\n### 3. Deploy to Base Testnet (Recommended First)\n\nTest on Sepolia testnet before mainnet:\n\n```bash\n# Compile contracts\nnpx hardhat compile\n\n# Deploy to Base Sepolia testnet\nnpx hardhat run scripts/deploy-registry.ts --network baseSepolia\n```\n\nSave the contract address from the output.\n\n### 4. Verify Contract on BaseScan\n\n```bash\nnpx hardhat verify --network baseSepolia <CONTRACT_ADDRESS> <PLATFORM_WALLET_ADDRESS>\n```\n\n### 5. Deploy to Base Mainnet\n\nOnce tested, deploy to mainnet:\n\n```bash\nnpx hardhat run scripts/deploy-registry.ts --network base\n```\n\n### 6. Update Environment Variables\n\nAdd the deployed contract address to `.env`:\n\n```bash\nREGISTRY_CONTRACT_ADDRESS=0x... # From deployment output\n```\n\n### 7. Restart Your Application\n\nThe registry cron job will start automatically on server restart:\n\n```bash\nnpm run dev  # Development\n# or\nnpm start    # Production\n```\n\n## Database Migration\n\nApply the registry status column to your database:\n\n```sql\n-- Run this in your database\nALTER TABLE coins \nADD COLUMN IF NOT EXISTS registry_status TEXT DEFAULT 'pending';\n\nCREATE INDEX IF NOT EXISTS idx_coins_registry_status ON coins(registry_status);\nCREATE INDEX IF NOT EXISTS idx_coins_registered_at ON coins(registered_at);\n```\n\nOr use your preferred migration tool.\n\n## How It Works\n\n### Automatic Registration (Cron Job)\n\nThe system automatically registers new coins every 6 hours (configurable):\n\n1. **Cron job runs** - Checks for pending registrations\n2. **Batches coins** - Groups up to 50 coins per transaction\n3. **Registers on-chain** - Calls `batchRegister()` on the contract\n4. **Updates database** - Marks coins as `registered` with transaction hash\n\n### Manual Registration\n\nYou can also trigger registration manually via API:\n\n```bash\n# Trigger manual sync\ncurl -X POST http://localhost:5000/api/registry/sync\n\n# Check status\ncurl http://localhost:5000/api/registry/status\n\n# Get pending registrations\ncurl http://localhost:5000/api/registry/pending\n\n# Check if a contract is registered\ncurl http://localhost:5000/api/registry/check/0x...\n```\n\n### Registry Status Flow\n\nCoins go through these states:\n\n1. **`pending`** - Created but not yet registered on-chain\n2. **`registering`** - Currently being registered (transaction sent)\n3. **`registered`** - Successfully registered on-chain\n4. **`failed`** - Registration failed (will retry next cron run)\n\n## Gas Costs\n\nEstimated costs on Base mainnet:\n\n- **Contract deployment**: ~$15-20 (one-time)\n- **Single registration**: ~$0.02\n- **Batch registration** (50 coins): ~$0.10 ($0.002 per coin)\n\nFor 1,000 coins/month in batches: ~$2-3/month in gas costs.\n\n## Contract Functions\n\n### Public Functions\n\n```solidity\n// Register a single coin\nfunction register(\n    address creator,\n    address zoraContract,\n    bytes32 txHash\n) external onlyPlatform\n\n// Register multiple coins (gas efficient)\nfunction batchRegister(\n    address[] creators,\n    address[] zoraContracts,\n    bytes32[] txHashes\n) external onlyPlatform\n\n// Check if registered\nfunction isRegistered(address zoraContract) \n    external view returns (bool)\n\n// Get registration details\nfunction getRegistration(address zoraContract) \n    external view returns (CoinRegistration memory)\n\n// Get total registered coins\nfunction totalCoins() external view returns (uint256)\n```\n\n### Admin Functions\n\n```solidity\n// Update platform wallet\nfunction updatePlatformWallet(address newWallet) \n    external onlyPlatform\n\n// Pause/unpause contract\nfunction pause() external onlyPlatform\nfunction unpause() external onlyPlatform\n```\n\n## Verifying On-Chain Data\n\nAnyone can verify your platform's activity:\n\n```javascript\n// Using ethers.js\nconst provider = new ethers.JsonRpcProvider(\"https://mainnet.base.org\");\nconst registryAddress = \"0x...\"; // Your registry contract\nconst abi = [...]; // CoinRegistry ABI\n\nconst registry = new ethers.Contract(registryAddress, abi, provider);\n\n// Get total registrations\nconst total = await registry.totalCoins();\nconsole.log(`Total coins: ${total}`);\n\n// Check specific coin\nconst isRegistered = await registry.isRegistered(\"0xZoraContractAddress\");\nconsole.log(`Is registered: ${isRegistered}`);\n```\n\n## For Grant Applications\n\n### OP Atlas Registration\n\n1. Go to https://atlas.optimism.io\n2. Create your project profile\n3. Add your registry contract address\n4. Describe impact metrics\n\n### Monthly Attestations (via EAS)\n\nCreate monthly attestations pointing to your registry:\n\n```\nSchema: Platform Impact Metrics\n- Registry Contract: 0xYourRegistry\n- Period: January 2025\n- New Registrations: 150\n- Total Coins: 523\n- Verifiable: true\n```\n\n## Troubleshooting\n\n### Registry Not Starting\n\nIf you see \"Registry service not configured\":\n- Check `REGISTRY_CONTRACT_ADDRESS` is set\n- Check `PLATFORM_WALLET_PRIVATE_KEY` is set\n- Restart the application\n\n### Registration Failing\n\nCommon issues:\n- **Insufficient gas**: Wallet needs Base ETH\n- **Contract paused**: Check contract state\n- **Already registered**: Coin was previously registered\n\n### Checking Logs\n\nView registry activity:\n\n```bash\n# Check cron job logs\ngrep \"registry\" server.log\n\n# Manual sync and watch output\ncurl -X POST http://localhost:5000/api/registry/sync\n```\n\n## Security Notes\n\n‚ö†Ô∏è **IMPORTANT**:\n- **Never commit** `PLATFORM_WALLET_PRIVATE_KEY` to git\n- **Keep private keys** in environment variables only\n- **Use separate wallet** for platform operations\n- **Monitor wallet balance** regularly\n\n## Next Steps\n\nAfter deployment:\n\n1. ‚úÖ Update OP Atlas with contract address\n2. ‚úÖ Set up monthly EAS attestations\n3. ‚úÖ Monitor gas costs and adjust batch size\n4. ‚úÖ Consider backfilling existing coins\n\n## Support\n\nFor issues or questions:\n- Check contract on BaseScan: https://basescan.org/address/YOUR_CONTRACT\n- Review transaction history\n- Check application logs\n\n---\n\n**Contract:** CoinRegistry.sol  \n**Network:** Base (Chain ID: 8453)  \n**Purpose:** Verifiable on-chain proof of platform activity\n","size_bytes":7518},"contracts/README.md":{"content":"# Smart Contracts\n\n## CoinRegistry.sol\n\nOn-chain registry contract for tracking coins created via the platform.\n\n### Purpose\n\nProvides verifiable, immutable proof of platform activity for:\n- Grant applications (Optimism RetroPGF, etc.)\n- Public analytics and transparency\n- User reputation and achievements\n- Cross-platform interoperability\n\n### Features\n\n- **Gas Optimized**: Batch registration for up to 50 coins per transaction\n- **Pausable**: Emergency pause functionality\n- **Secure**: Only platform wallet can register\n- **Queryable**: Public read functions for verification\n- **Event-driven**: Emits events for indexing\n\n### Contract Address\n\n- **Base Mainnet**: (deploy and add here)\n- **Base Sepolia**: (testnet address)\n\n### Deployment\n\nSee [REGISTRY_SETUP.md](../REGISTRY_SETUP.md) for full deployment guide.\n\nQuick deploy:\n\n```bash\nnpx hardhat compile\nnpx hardhat run scripts/deploy-registry.ts --network base\n```\n\n### Verification\n\n```bash\nnpx hardhat verify --network base <CONTRACT_ADDRESS> <PLATFORM_WALLET_ADDRESS>\n```\n\n### Usage\n\nThe contract is automatically used by the backend cron job. Manual usage:\n\n```javascript\nimport { ethers } from \"ethers\";\n\nconst provider = new ethers.JsonRpcProvider(\"https://mainnet.base.org\");\nconst registry = new ethers.Contract(\n  \"0xRegistryAddress\",\n  CoinRegistryABI,\n  provider\n);\n\n// Check total registrations\nconst total = await registry.totalCoins();\n\n// Check if specific coin is registered\nconst isRegistered = await registry.isRegistered(\"0xZoraContract\");\n\n// Get registration details\nconst details = await registry.getRegistration(\"0xZoraContract\");\n```\n\n### Testing\n\n```bash\nnpx hardhat test\n```\n\n(Tests to be added)\n\n### Gas Estimates\n\n- Single registration: ~50,000 gas (~$0.02 on Base)\n- Batch registration (50 coins): ~250,000 gas (~$0.10 on Base)\n- Contract deployment: ~1,000,000 gas (~$15-20 on Base)\n\n### Events\n\n```solidity\nevent CoinRegistered(\n    address indexed creator,\n    address indexed zoraContract,\n    uint256 timestamp,\n    bytes32 txHash\n);\n\nevent BatchRegistered(\n    uint256 count,\n    uint256 timestamp\n);\n```\n\n### Security\n\n- **Access Control**: Only `platformWallet` can register\n- **Duplicate Prevention**: Each contract can only be registered once\n- **Pausable**: Admin can pause in emergency\n- **Validation**: Checks for valid addresses and contract existence\n\n### Upgradeability\n\nThis contract is **immutable** by design for trust and simplicity. If upgrades are needed:\n1. Deploy new version\n2. Migrate data via events/indexing\n3. Update backend to use new contract\n\n### License\n\nMIT\n","size_bytes":2582},"server/cron/registryCron.ts":{"content":"import cron from \"node-cron\";\nimport { registryService } from \"../lib/registryService\";\n\nlet registryCronJob: cron.ScheduledTask | null = null;\n\nasync function runRegistryBatch() {\n  console.log(\"\\nüîÑ Starting registry batch job...\");\n  \n  if (!registryService.isConfigured()) {\n    console.log(\"‚ö†Ô∏è  Registry service not configured. Skipping batch registration.\");\n    console.log(\"   Set REGISTRY_CONTRACT_ADDRESS and PLATFORM_WALLET_PRIVATE_KEY in .env\");\n    return;\n  }\n\n  const isVerified = await registryService.verifyConfiguration();\n  if (!isVerified) {\n    console.error(\"‚ùå Registry configuration verification failed. Skipping batch registration.\");\n    return;\n  }\n\n  try {\n    const pending = await registryService.getPendingRegistrations();\n    \n    if (pending.length === 0) {\n      console.log(\"‚úÖ No pending coins to register\");\n      return;\n    }\n\n    console.log(`üìã Found ${pending.length} pending coins`);\n\n    const BATCH_SIZE = 50;\n    let totalSuccess = 0;\n    let totalFailed = 0;\n\n    for (let i = 0; i < pending.length; i += BATCH_SIZE) {\n      const batch = pending.slice(i, i + BATCH_SIZE);\n      console.log(`\\nüì¶ Processing batch ${Math.floor(i / BATCH_SIZE) + 1} (${batch.length} coins)...`);\n      \n      const result = await registryService.batchRegisterCoins(batch);\n      totalSuccess += result.success;\n      totalFailed += result.failed;\n\n      if (i + BATCH_SIZE < pending.length) {\n        console.log(\"‚è∏Ô∏è  Waiting 10 seconds before next batch...\");\n        await new Promise(resolve => setTimeout(resolve, 10000));\n      }\n    }\n\n    console.log(\"\\nüìä Registry batch job complete:\");\n    console.log(`   ‚úÖ Registered: ${totalSuccess}`);\n    console.log(`   ‚ùå Failed: ${totalFailed}`);\n\n    const totalOnChain = await registryService.getTotalRegistrations();\n    console.log(`   üìà Total on-chain registrations: ${totalOnChain}\\n`);\n  } catch (error: any) {\n    console.error(\"‚ùå Error in registry batch job:\", error.message);\n  }\n}\n\nexport async function startRegistryCron() {\n  if (registryCronJob) {\n    console.log(\"‚ö†Ô∏è  Registry cron job already running\");\n    return;\n  }\n\n  if (!registryService.isConfigured()) {\n    console.log(\"‚ö†Ô∏è  Registry service not configured. Cron job will not start.\");\n    console.log(\"   Set REGISTRY_CONTRACT_ADDRESS and PLATFORM_WALLET_PRIVATE_KEY to enable on-chain registration.\");\n    return;\n  }\n\n  const isVerified = await registryService.verifyConfiguration();\n  if (!isVerified) {\n    console.error(\"‚ùå Registry configuration verification failed. Cron job will not start.\");\n    console.error(\"   Check that REGISTRY_CONTRACT_ADDRESS and PLATFORM_WALLET_PRIVATE_KEY are correct.\");\n    return;\n  }\n\n  const schedule = process.env.REGISTRY_CRON_SCHEDULE || \"0 */6 * * *\";\n  \n  registryCronJob = cron.schedule(schedule, async () => {\n    await runRegistryBatch();\n  });\n\n  console.log(`‚úÖ Registry cron job started with schedule: ${schedule}`);\n  console.log(`   (Runs every 6 hours by default, set REGISTRY_CRON_SCHEDULE to change)`);\n\n  runRegistryBatch().catch(console.error);\n}\n\nexport function stopRegistryCron() {\n  if (registryCronJob) {\n    registryCronJob.stop();\n    registryCronJob = null;\n    console.log(\"üõë Registry cron job stopped\");\n  }\n}\n\nexport async function manualRegistrySync() {\n  console.log(\"üîÑ Manual registry sync triggered\");\n  await runRegistryBatch();\n}\n","size_bytes":3403},"server/lib/registryService.ts":{"content":"import { ethers } from \"ethers\";\nimport { createClient, type SupabaseClient } from \"@supabase/supabase-js\";\n\nconst COIN_REGISTRY_ABI = [\n  \"function register(address creator, address zoraContract, bytes32 txHash) external\",\n  \"function batchRegister(address[] calldata creators, address[] calldata zoraContracts, bytes32[] calldata txHashes) external\",\n  \"function getRegistration(address zoraContract) external view returns (tuple(address creator, address zoraContract, uint256 timestamp, bytes32 txHash))\",\n  \"function isRegistered(address zoraContract) external view returns (bool)\",\n  \"function totalCoins() external view returns (uint256)\",\n  \"function platformWallet() external view returns (address)\",\n  \"event CoinRegistered(address indexed creator, address indexed zoraContract, uint256 timestamp, bytes32 txHash)\",\n  \"event BatchRegistered(uint256 count, uint256 timestamp)\"\n];\n\nexport class RegistryService {\n  private provider: ethers.JsonRpcProvider;\n  private contract: ethers.Contract | null = null;\n  private wallet: ethers.Wallet | null = null;\n  private supabase: SupabaseClient | null = null;\n\n  constructor() {\n    // Use mainnet RPC (contract deployed on mainnet)\n    const rpcUrl = process.env.BASE_RPC_URL || \"https://mainnet.base.org\";\n    this.provider = new ethers.JsonRpcProvider(rpcUrl, undefined, {\n      staticNetwork: true // Disable ENS lookups for Base network\n    });\n\n    const privateKey = process.env.PLATFORM_WALLET_PRIVATE_KEY || process.env.PLATFORM_PRIVATE_KEY;\n    if (process.env.REGISTRY_CONTRACT_ADDRESS && privateKey) {\n      this.wallet = new ethers.Wallet(privateKey, this.provider);\n      this.contract = new ethers.Contract(\n        process.env.REGISTRY_CONTRACT_ADDRESS,\n        COIN_REGISTRY_ABI,\n        this.wallet\n      );\n    }\n\n    const supabaseUrl = process.env.VITE_SUPABASE_URL;\n    const supabaseKey = process.env.VITE_SUPABASE_SERVICE_ROLE_KEY;\n    if (supabaseUrl && supabaseKey) {\n      this.supabase = createClient(supabaseUrl, supabaseKey);\n    }\n  }\n\n  private getSupabase(): SupabaseClient {\n    if (!this.supabase) {\n      const supabaseUrl = process.env.VITE_SUPABASE_URL;\n      const supabaseKey = process.env.VITE_SUPABASE_SERVICE_ROLE_KEY;\n      if (!supabaseUrl || !supabaseKey) {\n        throw new Error(\"Supabase not configured\");\n      }\n      this.supabase = createClient(supabaseUrl, supabaseKey);\n    }\n    return this.supabase;\n  }\n\n  isConfigured(): boolean {\n    return this.contract !== null && this.wallet !== null;\n  }\n\n  async verifyConfiguration(): Promise<boolean> {\n    if (!this.isConfigured()) {\n      return false;\n    }\n\n    try {\n      const platformWallet = await this.contract!.platformWallet();\n      const expectedWallet = this.wallet!.address;\n\n      if (platformWallet.toLowerCase() !== expectedWallet.toLowerCase()) {\n        console.error(`‚ùå Platform wallet mismatch: contract has ${platformWallet}, wallet is ${expectedWallet}`);\n        return false;\n      }\n\n      await this.contract!.totalCoins();\n      \n      return true;\n    } catch (error: any) {\n      console.error(\"‚ùå Failed to verify registry configuration:\", error.message);\n      return false;\n    }\n  }\n\n  async getPendingRegistrations() {\n    const supabase = this.getSupabase();\n    const { data, error } = await supabase\n      .from(\"coins\")\n      .select(\"*\")\n      .in(\"registry_status\", [\"pending\", \"failed\"])\n      .not(\"address\", \"is\", null)\n      .not(\"creator_wallet\", \"is\", null)\n      .order(\"created_at\", { ascending: true })\n      .limit(100);\n\n    if (error) {\n      console.error(\"‚ùå Error fetching pending registrations:\", error);\n      return [];\n    }\n\n    return data || [];\n  }\n\n  async registerSingleCoin(coin: any): Promise<boolean> {\n    if (!this.contract || !this.wallet) {\n      console.error(\"‚ùå Registry contract not configured\");\n      return false;\n    }\n\n    try {\n      console.log(`üìù Registering coin ${coin.symbol} (${coin.address})...`);\n\n      const supabase = this.getSupabase();\n      await supabase\n        .from(\"coins\")\n        .update({ registry_status: \"registering\" })\n        .eq(\"id\", coin.id);\n\n      const txHashBytes = coin.registry_tx_hash \n        ? ethers.getBytes(coin.registry_tx_hash)\n        : ethers.ZeroHash;\n\n      const tx = await this.contract.register(\n        coin.creator_wallet,\n        coin.address,\n        txHashBytes\n      );\n\n      console.log(`‚è≥ Transaction sent: ${tx.hash}`);\n      const receipt = await tx.wait();\n      console.log(`‚úÖ Transaction confirmed: ${receipt.hash}`);\n\n      await supabase\n        .from(\"coins\")\n        .update({\n          registry_status: \"registered\",\n          registry_tx_hash: receipt.hash,\n          registered_at: new Date().toISOString()\n        })\n        .eq(\"id\", coin.id);\n\n      return true;\n    } catch (error: any) {\n      console.error(`‚ùå Error registering coin ${coin.symbol}:`, error.message);\n\n      const errorMsg = error.message.toLowerCase();\n      const isPermanentError = errorMsg.includes(\"already registered\") ||\n                               errorMsg.includes(\"not a contract\") ||\n                               errorMsg === \"invalid creator address\" ||\n                               errorMsg === \"invalid contract address\";\n\n      const supabase = this.getSupabase();\n      await supabase\n        .from(\"coins\")\n        .update({ \n          registry_status: isPermanentError ? \"failed_permanent\" : \"failed\"\n        })\n        .eq(\"id\", coin.id);\n\n      return false;\n    }\n  }\n\n  async batchRegisterCoins(coins: any[]): Promise<{ success: number; failed: number }> {\n    if (!this.contract || !this.wallet) {\n      console.error(\"‚ùå Registry contract not configured\");\n      return { success: 0, failed: 0 };\n    }\n\n    if (coins.length === 0) {\n      return { success: 0, failed: 0 };\n    }\n\n    try {\n      console.log(`üì¶ Batch registering ${coins.length} coins...`);\n\n      const supabase = this.getSupabase();\n      const coinIds = coins.map(c => c.id);\n      await supabase\n        .from(\"coins\")\n        .update({ registry_status: \"registering\" })\n        .in(\"id\", coinIds);\n\n      const creators = coins.map(c => c.creator_wallet);\n      const contracts = coins.map(c => c.address);\n      const txHashes = coins.map(c => \n        c.registry_tx_hash \n          ? ethers.getBytes(c.registry_tx_hash)\n          : ethers.ZeroHash\n      );\n\n      const estimatedGas = await this.contract.batchRegister.estimateGas(\n        creators,\n        contracts,\n        txHashes\n      );\n      console.log(`‚õΩ Estimated gas: ${estimatedGas.toString()}`);\n\n      const tx = await this.contract.batchRegister(creators, contracts, txHashes, {\n        gasLimit: estimatedGas * BigInt(120) / BigInt(100)\n      });\n\n      console.log(`‚è≥ Batch transaction sent: ${tx.hash}`);\n      const receipt = await tx.wait();\n      console.log(`‚úÖ Batch transaction confirmed: ${receipt.hash}`);\n\n      await supabase\n        .from(\"coins\")\n        .update({\n          registry_status: \"registered\",\n          registry_tx_hash: receipt.hash,\n          registered_at: new Date().toISOString()\n        })\n        .in(\"id\", coinIds);\n\n      return { success: coins.length, failed: 0 };\n    } catch (error: any) {\n      console.error(`‚ùå Error in batch registration:`, error.message);\n\n      const errorMsg = error.message.toLowerCase();\n      const isPermanentError = errorMsg.includes(\"array length mismatch\") ||\n                               errorMsg.includes(\"empty arrays\") ||\n                               errorMsg.includes(\"batch too large\");\n\n      const supabase = this.getSupabase();\n      const coinIds = coins.map(c => c.id);\n      await supabase\n        .from(\"coins\")\n        .update({ \n          registry_status: isPermanentError ? \"failed_permanent\" : \"failed\"\n        })\n        .in(\"id\", coinIds);\n\n      return { success: 0, failed: coins.length };\n    }\n  }\n\n  async isRegistered(zoraContract: string): Promise<boolean> {\n    if (!this.contract) {\n      return false;\n    }\n\n    try {\n      return await this.contract.isRegistered(zoraContract);\n    } catch (error) {\n      console.error(\"Error checking registration status:\", error);\n      return false;\n    }\n  }\n\n  async getTotalRegistrations(): Promise<number> {\n    if (!this.contract) {\n      return 0;\n    }\n\n    try {\n      const total = await this.contract.totalCoins();\n      return Number(total);\n    } catch (error) {\n      console.error(\"Error getting total registrations:\", error);\n      return 0;\n    }\n  }\n\n  async getRegistrationDetails(zoraContract: string) {\n    if (!this.contract) {\n      return null;\n    }\n\n    try {\n      const registration = await this.contract.getRegistration(zoraContract);\n      return {\n        creator: registration.creator,\n        zoraContract: registration.zoraContract,\n        timestamp: Number(registration.timestamp),\n        txHash: registration.txHash\n      };\n    } catch (error) {\n      console.error(\"Error getting registration details:\", error);\n      return null;\n    }\n  }\n}\n\nexport const registryService = new RegistryService();\n","size_bytes":9060},"hardhat.config.ts":{"content":"import type { HardhatUserConfig } from \"hardhat/config\";\nimport \"@nomicfoundation/hardhat-toolbox\";\nimport * as dotenv from \"dotenv\";\n\ndotenv.config();\n\nconst config: HardhatUserConfig = {\n  solidity: {\n    version: \"0.8.20\",\n    settings: {\n      optimizer: {\n        enabled: true,\n        runs: 200,\n      },\n    },\n  },\n  networks: {\n    baseSepolia: {\n      type: 'http' as const,\n      url: process.env.BASE_SEPOLIA_RPC_URL || \"https://sepolia.base.org\",\n      accounts: process.env.PLATFORM_WALLET_PRIVATE_KEY ? [process.env.PLATFORM_WALLET_PRIVATE_KEY] : [],\n      chainId: 84532,\n    },\n    base: {\n      type: 'http' as const,\n      url: process.env.BASE_RPC_URL || \"https://mainnet.base.org\",\n      accounts: process.env.PLATFORM_WALLET_PRIVATE_KEY ? [process.env.PLATFORM_WALLET_PRIVATE_KEY] : [],\n      chainId: 8453,\n    },\n  },\n  etherscan: {\n    apiKey: {\n      base: process.env.BASESCAN_API_KEY || \"\",\n      baseSepolia: process.env.BASESCAN_API_KEY || \"\",\n    },\n  },\n  sourcify: {\n    enabled: true\n  }\n};\n\nexport default config;","size_bytes":1049},"contracts/CoinRegistry.sol":{"content":"// SPDX-License-Identifier: MIT\npragma solidity ^0.8.20;\n\n/**\n * @title CoinRegistry\n * @dev Registry contract to track memecoins created via the platform\n * @notice This contract provides verifiable on-chain proof of platform activity\n * for grant applications and analytics\n */\ncontract CoinRegistry {\n    struct CoinRegistration {\n        address creator;        // User who created the coin\n        address zoraContract;   // The ERC-1155 contract address\n        uint256 timestamp;      // When it was created\n        bytes32 txHash;        // Original Zora creation transaction\n    }\n\n    // Platform wallet that can register coins\n    address public platformWallet;\n    \n    // Contract pause state\n    bool public paused;\n    \n    // Main registry - indexed by Zora contract address\n    mapping(address => CoinRegistration) public registry;\n    \n    // User's coins - for quick lookups\n    mapping(address => address[]) public userCoins;\n    \n    // Platform stats\n    uint256 public totalCoins;\n    mapping(address => bool) private isCreator;\n    \n    // Events\n    event CoinRegistered(\n        address indexed creator,\n        address indexed zoraContract,\n        uint256 timestamp,\n        bytes32 txHash\n    );\n    \n    event BatchRegistered(\n        uint256 count,\n        uint256 timestamp\n    );\n    \n    event PlatformWalletUpdated(\n        address indexed oldWallet,\n        address indexed newWallet\n    );\n    \n    event Paused(address account);\n    event Unpaused(address account);\n\n    modifier onlyPlatform() {\n        require(msg.sender == platformWallet, \"Only platform wallet\");\n        _;\n    }\n\n    modifier whenNotPaused() {\n        require(!paused, \"Contract is paused\");\n        _;\n    }\n\n    constructor(address _platformWallet) {\n        require(_platformWallet != address(0), \"Invalid platform wallet\");\n        platformWallet = _platformWallet;\n    }\n\n    /**\n     * @dev Register a single coin creation\n     * @param creator Address of the user who created the coin\n     * @param zoraContract Address of the Zora ERC-1155 contract\n     * @param txHash Transaction hash of the Zora creation\n     */\n    function register(\n        address creator,\n        address zoraContract,\n        bytes32 txHash\n    ) external onlyPlatform whenNotPaused {\n        require(creator != address(0), \"Invalid creator address\");\n        require(zoraContract != address(0), \"Invalid contract address\");\n        require(_isContract(zoraContract), \"Not a contract\");\n        require(registry[zoraContract].creator == address(0), \"Already registered\");\n\n        registry[zoraContract] = CoinRegistration({\n            creator: creator,\n            zoraContract: zoraContract,\n            timestamp: block.timestamp,\n            txHash: txHash\n        });\n\n        userCoins[creator].push(zoraContract);\n        \n        if (!isCreator[creator]) {\n            isCreator[creator] = true;\n        }\n        \n        totalCoins++;\n\n        emit CoinRegistered(creator, zoraContract, block.timestamp, txHash);\n    }\n\n    /**\n     * @dev Register multiple coins in a single transaction (gas efficient)\n     * @param creators Array of creator addresses\n     * @param zoraContracts Array of Zora contract addresses\n     * @param txHashes Array of transaction hashes\n     */\n    function batchRegister(\n        address[] calldata creators,\n        address[] calldata zoraContracts,\n        bytes32[] calldata txHashes\n    ) external onlyPlatform whenNotPaused {\n        require(\n            creators.length == zoraContracts.length && \n            creators.length == txHashes.length,\n            \"Array length mismatch\"\n        );\n        require(creators.length > 0, \"Empty arrays\");\n        require(creators.length <= 100, \"Batch too large\");\n\n        uint256 successCount = 0;\n\n        for (uint256 i = 0; i < creators.length; i++) {\n            address creator = creators[i];\n            address zoraContract = zoraContracts[i];\n            bytes32 txHash = txHashes[i];\n\n            require(creator != address(0), \"Invalid creator\");\n            require(zoraContract != address(0), \"Invalid contract\");\n            require(_isContract(zoraContract), \"Not a contract\");\n            \n            // Skip if already registered (don't revert to allow partial batches)\n            if (registry[zoraContract].creator != address(0)) {\n                continue;\n            }\n\n            registry[zoraContract] = CoinRegistration({\n                creator: creator,\n                zoraContract: zoraContract,\n                timestamp: block.timestamp,\n                txHash: txHash\n            });\n\n            userCoins[creator].push(zoraContract);\n            \n            if (!isCreator[creator]) {\n                isCreator[creator] = true;\n            }\n            \n            totalCoins++;\n            successCount++;\n\n            emit CoinRegistered(creator, zoraContract, block.timestamp, txHash);\n        }\n\n        emit BatchRegistered(successCount, block.timestamp);\n    }\n\n    /**\n     * @dev Get registration details for a coin\n     * @param zoraContract Address of the Zora contract\n     * @return CoinRegistration struct with all details\n     */\n    function getRegistration(address zoraContract) \n        external \n        view \n        returns (CoinRegistration memory) \n    {\n        return registry[zoraContract];\n    }\n\n    /**\n     * @dev Get all coins created by a user\n     * @param creator Address of the creator\n     * @return Array of Zora contract addresses\n     */\n    function getUserCoins(address creator) \n        external \n        view \n        returns (address[] memory) \n    {\n        return userCoins[creator];\n    }\n\n    /**\n     * @dev Get number of coins created by a user\n     * @param creator Address of the creator\n     * @return Number of coins\n     */\n    function getUserCoinCount(address creator) \n        external \n        view \n        returns (uint256) \n    {\n        return userCoins[creator].length;\n    }\n\n    /**\n     * @dev Check if a contract is registered\n     * @param zoraContract Address to check\n     * @return bool True if registered\n     */\n    function isRegistered(address zoraContract) \n        external \n        view \n        returns (bool) \n    {\n        return registry[zoraContract].creator != address(0);\n    }\n\n    /**\n     * @dev Get total number of unique creators\n     * @return Total number of creators (calculated from events)\n     */\n    function getTotalCreators() \n        external \n        view \n        returns (uint256) \n    {\n        // Note: This is an approximation. For exact count, use event indexing\n        return totalCoins; // Simplified - actual implementation would track unique creators\n    }\n\n    /**\n     * @dev Update platform wallet (in case of wallet rotation)\n     * @param newWallet New platform wallet address\n     */\n    function updatePlatformWallet(address newWallet) \n        external \n        onlyPlatform \n    {\n        require(newWallet != address(0), \"Invalid new wallet\");\n        address oldWallet = platformWallet;\n        platformWallet = newWallet;\n        emit PlatformWalletUpdated(oldWallet, newWallet);\n    }\n\n    /**\n     * @dev Pause contract (emergency use only)\n     */\n    function pause() external onlyPlatform {\n        paused = true;\n        emit Paused(msg.sender);\n    }\n\n    /**\n     * @dev Unpause contract\n     */\n    function unpause() external onlyPlatform {\n        paused = false;\n        emit Unpaused(msg.sender);\n    }\n\n    /**\n     * @dev Check if an address is a contract\n     * @param account Address to check\n     * @return bool True if account is a contract\n     */\n    function _isContract(address account) internal view returns (bool) {\n        uint256 size;\n        assembly {\n            size := extcodesize(account)\n        }\n        return size > 0;\n    }\n}\n","size_bytes":7814},"scripts/deploy-registry.ts":{"content":"import { ethers } from \"hardhat\";\n\nasync function main() {\n  console.log(\"üöÄ Deploying CoinRegistry contract...\\n\");\n\n  // Get the deployer account\n  const [deployer] = await ethers.getSigners();\n  console.log(\"üìù Deploying with account:\", deployer.address);\n\n  // Get account balance\n  const balance = await ethers.provider.getBalance(deployer.address);\n  console.log(\"üí∞ Account balance:\", ethers.formatEther(balance), \"ETH\\n\");\n\n  // Get platform wallet from environment or use deployer\n  const platformWallet = process.env.PLATFORM_WALLET_ADDRESS || deployer.address;\n  console.log(\"üîë Platform wallet:\", platformWallet);\n\n  if (platformWallet === deployer.address) {\n    console.log(\"‚ö†Ô∏è  Warning: Using deployer address as platform wallet\");\n    console.log(\"   Consider setting PLATFORM_WALLET_ADDRESS in .env\\n\");\n  }\n\n  // Deploy the contract\n  console.log(\"‚è≥ Deploying contract...\");\n  const CoinRegistry = await ethers.getContractFactory(\"CoinRegistry\");\n  const registry = await CoinRegistry.deploy(platformWallet);\n\n  await registry.waitForDeployment();\n  const address = await registry.getAddress();\n\n  console.log(\"‚úÖ CoinRegistry deployed to:\", address);\n  console.log(\"   Platform wallet:\", platformWallet);\n  console.log(\"   Transaction hash:\", registry.deploymentTransaction()?.hash);\n\n  // Wait for a few confirmations\n  console.log(\"\\n‚è≥ Waiting for confirmations...\");\n  await registry.deploymentTransaction()?.wait(5);\n  console.log(\"‚úÖ Confirmed!\\n\");\n\n  // Display verification command\n  console.log(\"üìã To verify on BaseScan, run:\");\n  console.log(`   npx hardhat verify --network base ${address} ${platformWallet}\\n`);\n\n  // Save deployment info\n  const deploymentInfo = {\n    network: (await ethers.provider.getNetwork()).name,\n    chainId: (await ethers.provider.getNetwork()).chainId,\n    contract: \"CoinRegistry\",\n    address: address,\n    platformWallet: platformWallet,\n    deployer: deployer.address,\n    timestamp: new Date().toISOString(),\n    txHash: registry.deploymentTransaction()?.hash,\n  };\n\n  console.log(\"üìÑ Deployment Info:\");\n  console.log(JSON.stringify(deploymentInfo, null, 2));\n\n  console.log(\"\\n‚ú® Deployment complete!\");\n  console.log(\"\\nüí° Next steps:\");\n  console.log(\"   1. Add REGISTRY_CONTRACT_ADDRESS to your .env file\");\n  console.log(\"   2. Verify the contract on BaseScan\");\n  console.log(\"   3. Update your backend to use this registry address\");\n  console.log(\"   4. Register your OP Atlas profile with this contract address\\n\");\n\n  return deploymentInfo;\n}\n\nmain()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error(\"‚ùå Deployment failed:\", error);\n    process.exit(1);\n  });\n","size_bytes":2684},"scripts/migrate-registry-column.ts":{"content":"import { createClient } from \"@supabase/supabase-js\";\nimport * as dotenv from \"dotenv\";\n\ndotenv.config();\n\nasync function addRegistryStatusColumn() {\n  const supabaseUrl = process.env.VITE_SUPABASE_URL;\n  const supabaseKey = process.env.VITE_SUPABASE_SERVICE_ROLE_KEY;\n\n  if (!supabaseUrl || !supabaseKey) {\n    console.error(\"‚ùå Supabase credentials not found\");\n    process.exit(1);\n  }\n\n  const supabase = createClient(supabaseUrl, supabaseKey);\n\n  console.log(\"üîÑ Adding registry_status column to coins table...\\n\");\n\n  try {\n    // First check if column exists\n    const { data: columns } = await supabase\n      .from(\"coins\")\n      .select(\"*\")\n      .limit(1);\n\n    if (columns && columns[0] && 'registry_status' in columns[0]) {\n      console.log(\"‚úÖ Column 'registry_status' already exists!\");\n      process.exit(0);\n    }\n\n    // Column doesn't exist, we need to add it via SQL\n    // Since Supabase doesn't allow direct ALTER TABLE via client,\n    // we'll use a workaround by inserting into a test record\n    console.log(\"üìù Please add the 'registry_status' column manually:\");\n    console.log(\"\\n1. Go to your Supabase dashboard:\");\n    console.log(`   https://supabase.com/dashboard/project/${supabaseUrl.match(/https:\\/\\/([^.]+)/)?.[1]}/editor`);\n    console.log(\"\\n2. Run this SQL query:\");\n    console.log(`\nALTER TABLE coins \nADD COLUMN IF NOT EXISTS registry_status TEXT DEFAULT 'pending';\n\nUPDATE coins \nSET registry_status = 'pending' \nWHERE registry_status IS NULL;\n    `);\n    console.log(\"\\n3. Then restart your application\\n\");\n\n  } catch (error: any) {\n    console.error(\"‚ùå Error:\", error.message);\n    process.exit(1);\n  }\n}\n\naddRegistryStatusColumn();\n","size_bytes":1688},"scripts/run-registry-migration.ts":{"content":"import postgres from \"postgres\";\nimport * as dotenv from \"dotenv\";\n\ndotenv.config();\n\nasync function runMigration() {\n  const databaseUrl = process.env.DATABASE_DIRECT_URL || process.env.DATABASE_URL;\n\n  if (!databaseUrl) {\n    console.error(\"‚ùå DATABASE_URL not found\");\n    process.exit(1);\n  }\n\n  console.log(\"üîÑ Running registry schema migration...\\n\");\n\n  const sql = postgres(databaseUrl);\n\n  try {\n    // Add registry_status column if it doesn't exist\n    await sql`\n      ALTER TABLE coins \n      ADD COLUMN IF NOT EXISTS registry_status TEXT DEFAULT 'pending'\n    `;\n\n    console.log(\"‚úÖ Added 'registry_status' column\");\n\n    // Update existing coins to pending status\n    const result = await sql`\n      UPDATE coins \n      SET registry_status = 'pending' \n      WHERE registry_status IS NULL\n    `;\n\n    console.log(`‚úÖ Updated ${result.count} existing coins to 'pending' status`);\n    console.log(\"\\nüéâ Migration completed successfully!\\n\");\n\n    await sql.end();\n    process.exit(0);\n\n  } catch (error: any) {\n    console.error(\"‚ùå Migration failed:\", error.message);\n    await sql.end();\n    process.exit(1);\n  }\n}\n\nrunMigration();\n","size_bytes":1155},"scripts/compile-and-deploy.ts":{"content":"import { ethers } from \"ethers\";\nimport solc from \"solc\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport * as dotenv from \"dotenv\";\n\ndotenv.config();\n\nasync function main() {\n  console.log(\"üîß Compiling CoinRegistry contract...\\n\");\n\n  // Read the contract source\n  const contractPath = path.join(process.cwd(), \"contracts\", \"CoinRegistry.sol\");\n  const source = fs.readFileSync(contractPath, \"utf8\");\n\n  // Compile the contract\n  const input = {\n    language: \"Solidity\",\n    sources: {\n      \"CoinRegistry.sol\": {\n        content: source,\n      },\n    },\n    settings: {\n      optimizer: {\n        enabled: true,\n        runs: 200,\n      },\n      outputSelection: {\n        \"*\": {\n          \"*\": [\"abi\", \"evm.bytecode\"],\n        },\n      },\n    },\n  };\n\n  const output = JSON.parse(solc.compile(JSON.stringify(input)));\n\n  if (output.errors) {\n    const errors = output.errors.filter((e: any) => e.severity === \"error\");\n    if (errors.length > 0) {\n      console.error(\"‚ùå Compilation errors:\");\n      errors.forEach((err: any) => console.error(err.formattedMessage));\n      process.exit(1);\n    }\n  }\n\n  const compiledContract = output.contracts[\"CoinRegistry.sol\"][\"CoinRegistry\"];\n  const abi = compiledContract.abi;\n  const bytecode = compiledContract.evm.bytecode.object;\n\n  console.log(\"‚úÖ Contract compiled successfully\\n\");\n\n  // Determine network\n  const network = process.argv[2] || \"baseSepolia\";\n  const rpcUrl =\n    network === \"base\"\n      ? process.env.BASE_RPC_URL || \"https://mainnet.base.org\"\n      : process.env.BASE_SEPOLIA_RPC_URL || \"https://sepolia.base.org\";\n\n  const chainId = network === \"base\" ? 8453 : 84532;\n\n  console.log(`üì° Deploying to ${network} (Chain ID: ${chainId})`);\n  console.log(`   RPC: ${rpcUrl}\\n`);\n\n  // Setup provider and wallet\n  const provider = new ethers.JsonRpcProvider(rpcUrl);\n  const privateKey = process.env.DEPLOYER_PRIVATE_KEY || \n                     process.env.PLATFORM_WALLET_PRIVATE_KEY || \n                     process.env.PLATFORM_PRIVATE_KEY;\n\n  if (!privateKey) {\n    console.error(\"‚ùå Error: No private key found. Set one of:\");\n    console.error(\"   - DEPLOYER_PRIVATE_KEY\");\n    console.error(\"   - PLATFORM_WALLET_PRIVATE_KEY\");\n    console.error(\"   - PLATFORM_PRIVATE_KEY\");\n    process.exit(1);\n  }\n\n  const wallet = new ethers.Wallet(privateKey, provider);\n  const platformWalletAddress = process.env.PLATFORM_WALLET_ADDRESS || wallet.address;\n\n  console.log(`üëõ Deployer: ${wallet.address}`);\n  console.log(`üè¢ Platform Wallet: ${platformWalletAddress}\\n`);\n\n  // Get balance\n  const balance = await provider.getBalance(wallet.address);\n  console.log(`üí∞ Balance: ${ethers.formatEther(balance)} ETH\\n`);\n\n  if (balance === 0n) {\n    console.error(\"‚ùå Error: Deployer wallet has no ETH\");\n    process.exit(1);\n  }\n\n  // Deploy contract\n  console.log(\"üöÄ Deploying contract...\\n\");\n\n  const factory = new ethers.ContractFactory(abi, bytecode, wallet);\n  const contract = await factory.deploy(platformWalletAddress);\n\n  console.log(`‚è≥ Transaction sent: ${contract.deploymentTransaction()?.hash}`);\n  console.log(\"   Waiting for confirmation...\\n\");\n\n  await contract.waitForDeployment();\n  const contractAddress = await contract.getAddress();\n\n  console.log(\"‚úÖ Contract deployed successfully!\\n\");\n  console.log(\"üìã Deployment Details:\");\n  console.log(`   Contract Address: ${contractAddress}`);\n  console.log(`   Network: ${network}`);\n  console.log(`   Chain ID: ${chainId}`);\n  console.log(`   Platform Wallet: ${platformWalletAddress}\\n`);\n\n  console.log(\"üìù Next Steps:\");\n  console.log(`   1. Update .env with:`);\n  console.log(`      REGISTRY_CONTRACT_ADDRESS=${contractAddress}`);\n  console.log(`   2. Verify contract on BaseScan (optional):`);\n  console.log(`      npx hardhat verify --network ${network} ${contractAddress} ${platformWalletAddress}`);\n  console.log(`   3. Restart your application to start using the registry\\n`);\n\n  // Save deployment info\n  const deploymentInfo = {\n    contractAddress,\n    network,\n    chainId,\n    platformWalletAddress,\n    deployedAt: new Date().toISOString(),\n    deploymentTxHash: contract.deploymentTransaction()?.hash,\n  };\n\n  const deploymentsDir = path.join(process.cwd(), \"deployments\");\n  if (!fs.existsSync(deploymentsDir)) {\n    fs.mkdirSync(deploymentsDir);\n  }\n\n  const deploymentFile = path.join(deploymentsDir, `${network}-registry.json`);\n  fs.writeFileSync(deploymentFile, JSON.stringify(deploymentInfo, null, 2));\n\n  console.log(`üíæ Deployment info saved to: ${deploymentFile}\\n`);\n\n  // Save ABI\n  const abiFile = path.join(deploymentsDir, \"CoinRegistry-abi.json\");\n  fs.writeFileSync(abiFile, JSON.stringify(abi, null, 2));\n  console.log(`üìÑ ABI saved to: ${abiFile}\\n`);\n}\n\nmain()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error(\"\\n‚ùå Deployment failed:\");\n    console.error(error);\n    process.exit(1);\n  });\n","size_bytes":4914},"server/routes/migrate-registry.ts":{"content":"import { Router } from \"express\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst router = Router();\n\nrouter.post(\"/migrate-registry-schema\", async (req, res) => {\n  try {\n    const supabaseUrl = process.env.VITE_SUPABASE_URL;\n    const supabaseKey = process.env.VITE_SUPABASE_SERVICE_ROLE_KEY;\n\n    if (!supabaseUrl || !supabaseKey) {\n      return res.status(500).json({ error: \"Supabase not configured\" });\n    }\n\n    const supabase = createClient(supabaseUrl, supabaseKey);\n\n    console.log(\"üîÑ Running registry schema migration...\");\n\n    // Add registry_status column\n    const { error: error1 } = await supabase.rpc(\"exec_sql\", {\n      sql: `\n        DO $$\n        BEGIN\n          IF NOT EXISTS (\n            SELECT 1 FROM information_schema.columns \n            WHERE table_name = 'coins' AND column_name = 'registry_status'\n          ) THEN\n            ALTER TABLE coins ADD COLUMN registry_status TEXT DEFAULT 'pending';\n            UPDATE coins SET registry_status = 'pending' WHERE registry_status IS NULL;\n          END IF;\n        END $$;\n      `\n    });\n\n    if (error1) {\n      console.error(\"‚ùå Migration failed:\", error1);\n      return res.status(500).json({ \n        error: \"Migration failed\", \n        details: error1.message \n      });\n    }\n\n    console.log(\"‚úÖ Registry schema migration completed\");\n    res.json({ \n      success: true, \n      message: \"Registry schema updated successfully\" \n    });\n\n  } catch (error: any) {\n    console.error(\"‚ùå Migration error:\", error);\n    res.status(500).json({ \n      error: \"Migration error\", \n      message: error.message \n    });\n  }\n});\n\nexport default router;\n","size_bytes":1647},"server/routes/admin-registry.ts":{"content":"import { Router } from \"express\";\nimport { registryService } from \"../lib/registryService\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nexport function registerAdminRegistryRoutes(app: Router) {\n  // Get registry statistics\n  app.get(\"/api/admin/registry-stats\", async (req, res) => {\n    try {\n      const contractAddress = process.env.REGISTRY_CONTRACT_ADDRESS;\n      const platformWallet = process.env.PLATFORM_WALLET_ADDRESS;\n\n      if (!contractAddress) {\n        return res.json({\n          contractAddress: null,\n          platformWallet: null,\n          totalOnChain: 0,\n          pending: 0,\n          registering: 0,\n          failed: 0,\n          recentRegistrations: []\n        });\n      }\n\n      // Get on-chain total\n      const totalOnChain = await registryService.getTotalRegistrations();\n\n      // Get database stats\n      const supabaseUrl = process.env.VITE_SUPABASE_URL;\n      const supabaseKey = process.env.VITE_SUPABASE_SERVICE_ROLE_KEY;\n      \n      if (!supabaseUrl || !supabaseKey) {\n        throw new Error(\"Supabase not configured\");\n      }\n\n      const supabase = createClient(supabaseUrl, supabaseKey);\n\n      // Count by status\n      const { data: statusCounts } = await supabase\n        .from(\"coins\")\n        .select(\"registry_status\")\n        .not(\"registry_status\", \"is\", null);\n\n      const pending = statusCounts?.filter(c => c.registry_status === 'pending').length || 0;\n      const registering = statusCounts?.filter(c => c.registry_status === 'registering').length || 0;\n      const failed = statusCounts?.filter(c => \n        c.registry_status === 'failed' || c.registry_status === 'failed_permanent'\n      ).length || 0;\n\n      // Get recent successful registrations\n      const { data: recentRegistrations } = await supabase\n        .from(\"coins\")\n        .select(\"id, name, symbol, address, registry_status, registry_tx_hash, registered_at\")\n        .eq(\"registry_status\", \"registered\")\n        .not(\"registry_tx_hash\", \"is\", null)\n        .order(\"registered_at\", { ascending: false })\n        .limit(20);\n\n      res.json({\n        contractAddress,\n        platformWallet,\n        totalOnChain,\n        pending,\n        registering,\n        failed,\n        recentRegistrations: recentRegistrations || []\n      });\n    } catch (error: any) {\n      console.error(\"Error fetching registry stats:\", error);\n      res.status(500).json({ \n        error: \"Failed to fetch registry stats\",\n        message: error.message \n      });\n    }\n  });\n}\n","size_bytes":2494},"scripts/compile-and-deploy-mainnet.ts":{"content":"import { ethers } from \"ethers\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\nimport * as dotenv from \"dotenv\";\nimport solc from \"solc\";\n\ndotenv.config();\n\nasync function compileContract() {\n  console.log(\"‚öôÔ∏è  Compiling CoinRegistry contract...\");\n  \n  const sourcePath = path.join(process.cwd(), \"contracts/CoinRegistry.sol\");\n  const source = fs.readFileSync(sourcePath, 'utf8');\n  \n  const input = {\n    language: 'Solidity',\n    sources: {\n      'CoinRegistry.sol': {\n        content: source\n      }\n    },\n    settings: {\n      optimizer: {\n        enabled: true,\n        runs: 200\n      },\n      outputSelection: {\n        '*': {\n          '*': ['abi', 'evm.bytecode']\n        }\n      }\n    }\n  };\n\n  const output = JSON.parse(solc.compile(JSON.stringify(input)));\n  \n  if (output.errors) {\n    const errors = output.errors.filter((e: any) => e.severity === 'error');\n    if (errors.length > 0) {\n      console.error(\"‚ùå Compilation errors:\", errors);\n      throw new Error(\"Contract compilation failed\");\n    }\n  }\n\n  const contract = output.contracts['CoinRegistry.sol']['CoinRegistry'];\n  console.log(\"‚úÖ Contract compiled successfully\\n\");\n  \n  return {\n    abi: contract.abi,\n    bytecode: '0x' + contract.evm.bytecode.object\n  };\n}\n\nasync function main() {\n  console.log(\"üöÄ Deploying CoinRegistry to Base Mainnet...\\n\");\n\n  // Check for required environment variables\n  const rpcUrl = process.env.BASE_RPC_URL;\n  const privateKey = process.env.PLATFORM_PRIVATE_KEY;\n  const platformWallet = process.env.PLATFORM_WALLET_ADDRESS;\n\n  if (!rpcUrl) {\n    throw new Error(\"BASE_RPC_URL not found in environment\");\n  }\n  if (!privateKey) {\n    throw new Error(\"PLATFORM_PRIVATE_KEY not found in environment\");\n  }\n  if (!platformWallet) {\n    throw new Error(\"PLATFORM_WALLET_ADDRESS not found in environment\");\n  }\n\n  // Connect to Base mainnet\n  const provider = new ethers.JsonRpcProvider(rpcUrl);\n  const wallet = new ethers.Wallet(privateKey, provider);\n\n  console.log(\"üìù Deploying with account:\", wallet.address);\n\n  // Get account balance\n  const balance = await provider.getBalance(wallet.address);\n  console.log(\"üí∞ Account balance:\", ethers.formatEther(balance), \"ETH\");\n\n  if (balance === BigInt(0)) {\n    throw new Error(\"Account has no ETH for gas fees. Please fund the deployer wallet.\");\n  }\n\n  console.log(\"üîë Platform wallet will be:\", platformWallet);\n  console.log(\"\");\n\n  // Compile the contract\n  const { abi, bytecode } = await compileContract();\n\n  // Deploy the contract\n  console.log(\"‚è≥ Deploying contract to Base mainnet...\");\n  const factory = new ethers.ContractFactory(abi, bytecode, wallet);\n  \n  // Deploy with automatic gas estimation\n  const contract = await factory.deploy(platformWallet);\n\n  console.log(\"‚è≥ Transaction sent:\", contract.deploymentTransaction()?.hash);\n  console.log(\"‚è≥ Waiting for deployment confirmation (this may take 1-2 minutes)...\");\n  \n  await contract.waitForDeployment();\n  \n  const address = await contract.getAddress();\n  const deployTx = contract.deploymentTransaction();\n\n  console.log(\"\\nüéâ SUCCESS! Contract deployed to Base Mainnet!\");\n  console.log(\"‚ïê\".repeat(70));\n  console.log(\"üìç Contract Address:\", address);\n  console.log(\"üîë Platform Wallet:\", platformWallet);\n  console.log(\"üìù Transaction Hash:\", deployTx?.hash);\n  console.log(\"üîó View on BaseScan:\", `https://basescan.org/tx/${deployTx?.hash}`);\n  console.log(\"‚õìÔ∏è  Network: Base Mainnet (Chain ID: 8453)\");\n  console.log(\"‚ïê\".repeat(70));\n\n  // Verify the deployment by calling a view function\n  console.log(\"\\nüîç Verifying deployment...\");\n  const platformWalletFromContract = await contract.platformWallet();\n  const totalCoins = await contract.totalCoins();\n  console.log(\"‚úÖ Platform wallet configured:\", platformWalletFromContract);\n  console.log(\"‚úÖ Total coins registered:\", totalCoins.toString());\n\n  // Save deployment info\n  const deploymentInfo = {\n    network: \"base-mainnet\",\n    chainId: 8453,\n    contract: \"CoinRegistry\",\n    address: address,\n    platformWallet: platformWallet,\n    deployer: wallet.address,\n    timestamp: new Date().toISOString(),\n    txHash: deployTx?.hash,\n    verified: false\n  };\n\n  const deploymentPath = path.join(process.cwd(), \"deployment-mainnet.json\");\n  fs.writeFileSync(deploymentPath, JSON.stringify(deploymentInfo, null, 2));\n  console.log(\"\\n‚úÖ Deployment info saved to deployment-mainnet.json\");\n\n  console.log(\"\\nüìã NEXT STEPS:\");\n  console.log(\"‚ïê\".repeat(70));\n  console.log(\"1Ô∏è‚É£  Add to Replit Secrets:\");\n  console.log(\"   REGISTRY_CONTRACT_ADDRESS=\" + address);\n  console.log(\"\");\n  console.log(\"2Ô∏è‚É£  Verify contract on BaseScan:\");\n  console.log(`   npx hardhat verify --network base ${address} ${platformWallet}`);\n  console.log(`   Or manually: https://basescan.org/address/${address}#code`);\n  console.log(\"\");\n  console.log(\"3Ô∏è‚É£  Remove testnet config and restart application\");\n  console.log(\"‚ïê\".repeat(70));\n  console.log(\"\");\n\n  return deploymentInfo;\n}\n\nmain()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error(\"\\n‚ùå Deployment failed:\", error);\n    process.exit(1);\n  });\n","size_bytes":5167},"scripts/deploy-to-mainnet.ts":{"content":"import { ethers } from \"ethers\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\nimport * as dotenv from \"dotenv\";\n\ndotenv.config();\n\nasync function main() {\n  console.log(\"üöÄ Deploying CoinRegistry to Base Mainnet...\\n\");\n\n  // Check for required environment variables\n  const rpcUrl = process.env.BASE_RPC_URL;\n  const privateKey = process.env.PLATFORM_PRIVATE_KEY;\n  const platformWallet = process.env.PLATFORM_WALLET_ADDRESS;\n\n  if (!rpcUrl) {\n    throw new Error(\"BASE_RPC_URL not found in environment\");\n  }\n  if (!privateKey) {\n    throw new Error(\"PLATFORM_PRIVATE_KEY not found in environment\");\n  }\n  if (!platformWallet) {\n    throw new Error(\"PLATFORM_WALLET_ADDRESS not found in environment\");\n  }\n\n  // Connect to Base mainnet\n  const provider = new ethers.JsonRpcProvider(rpcUrl);\n  const wallet = new ethers.Wallet(privateKey, provider);\n\n  console.log(\"üìù Deploying with account:\", wallet.address);\n\n  // Get account balance\n  const balance = await provider.getBalance(wallet.address);\n  console.log(\"üí∞ Account balance:\", ethers.formatEther(balance), \"ETH\");\n\n  if (balance === BigInt(0)) {\n    throw new Error(\"Account has no ETH for gas fees. Please fund the deployer wallet.\");\n  }\n\n  console.log(\"üîë Platform wallet will be:\", platformWallet);\n  console.log(\"\");\n\n  // Read the compiled contract\n  const contractPath = path.join(process.cwd(), \"artifacts/contracts/CoinRegistry.sol/CoinRegistry.json\");\n  \n  if (!fs.existsSync(contractPath)) {\n    console.log(\"‚ùå Contract not compiled. Compiling now...\");\n    const solcPath = path.join(process.cwd(), \"node_modules/solc\");\n    if (!fs.existsSync(solcPath)) {\n      throw new Error(\"solc not installed. Run: npm install solc\");\n    }\n    \n    // Read source file\n    const sourcePath = path.join(process.cwd(), \"contracts/CoinRegistry.sol\");\n    const source = fs.readFileSync(sourcePath, 'utf8');\n    \n    // Compile with solc\n    const solc = require('solc');\n    const input = {\n      language: 'Solidity',\n      sources: {\n        'CoinRegistry.sol': {\n          content: source\n        }\n      },\n      settings: {\n        optimizer: {\n          enabled: true,\n          runs: 200\n        },\n        outputSelection: {\n          '*': {\n            '*': ['abi', 'evm.bytecode']\n          }\n        }\n      }\n    };\n\n    console.log(\"‚öôÔ∏è  Compiling contract...\");\n    const output = JSON.parse(solc.compile(JSON.stringify(input)));\n    \n    if (output.errors) {\n      const errors = output.errors.filter((e: any) => e.severity === 'error');\n      if (errors.length > 0) {\n        console.error(\"Compilation errors:\", errors);\n        throw new Error(\"Contract compilation failed\");\n      }\n    }\n\n    const contract = output.contracts['CoinRegistry.sol']['CoinRegistry'];\n    \n    // Create artifacts directory\n    const artifactsDir = path.join(process.cwd(), \"artifacts/contracts/CoinRegistry.sol\");\n    fs.mkdirSync(artifactsDir, { recursive: true });\n    \n    // Save compiled contract\n    fs.writeFileSync(\n      contractPath,\n      JSON.stringify({\n        abi: contract.abi,\n        bytecode: contract.evm.bytecode.object\n      }, null, 2)\n    );\n    \n    console.log(\"‚úÖ Contract compiled successfully\\n\");\n  }\n\n  const contractJson = JSON.parse(fs.readFileSync(contractPath, 'utf8'));\n  const { abi, bytecode } = contractJson;\n\n  // Deploy the contract\n  console.log(\"‚è≥ Deploying contract to Base mainnet...\");\n  const factory = new ethers.ContractFactory(abi, bytecode, wallet);\n  const contract = await factory.deploy(platformWallet);\n\n  console.log(\"‚è≥ Waiting for deployment transaction to be mined...\");\n  await contract.waitForDeployment();\n  \n  const address = await contract.getAddress();\n  const deployTx = contract.deploymentTransaction();\n\n  console.log(\"\\nüéâ SUCCESS! Contract deployed to Base Mainnet!\");\n  console.log(\"‚ïê\".repeat(60));\n  console.log(\"üìç Contract Address:\", address);\n  console.log(\"üîë Platform Wallet:\", platformWallet);\n  console.log(\"üìù Transaction Hash:\", deployTx?.hash);\n  console.log(\"‚õìÔ∏è  Network: Base Mainnet (Chain ID: 8453)\");\n  console.log(\"‚ïê\".repeat(60));\n\n  // Save deployment info\n  const deploymentInfo = {\n    network: \"base-mainnet\",\n    chainId: 8453,\n    contract: \"CoinRegistry\",\n    address: address,\n    platformWallet: platformWallet,\n    deployer: wallet.address,\n    timestamp: new Date().toISOString(),\n    txHash: deployTx?.hash,\n  };\n\n  const deploymentPath = path.join(process.cwd(), \"deployment-mainnet.json\");\n  fs.writeFileSync(deploymentPath, JSON.stringify(deploymentInfo, null, 2));\n  console.log(\"\\n‚úÖ Deployment info saved to deployment-mainnet.json\");\n\n  console.log(\"\\nüìã Next Steps:\");\n  console.log(\"1. Update REGISTRY_CONTRACT_ADDRESS in Replit Secrets:\");\n  console.log(`   ${address}`);\n  console.log(\"\\n2. Verify the contract on BaseScan:\");\n  console.log(`   npx hardhat verify --network base ${address} ${platformWallet}`);\n  console.log(`   Or visit: https://basescan.org/address/${address}#code`);\n  console.log(\"\\n3. Update your registry service to use mainnet\");\n  console.log(\"4. Restart your application\\n\");\n\n  return deploymentInfo;\n}\n\nmain()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error(\"‚ùå Deployment failed:\", error);\n    process.exit(1);\n  });\n","size_bytes":5288}},"version":2}